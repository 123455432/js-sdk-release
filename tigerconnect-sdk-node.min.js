module.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),global._babelPolyfill||n(118);var r="node";n(117)("./"+r);var o=n(69);t.Client=o},function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t){e.exports=require("babel-runtime/helpers/createClass")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-prototype-of")},function(e,t){e.exports=require("babel-runtime/helpers/inherits")},function(e,t){e.exports=require("babel-runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("babel-runtime/core-js/object/keys")},function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("babel-runtime/helpers/typeof")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-own-property-descriptor")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,v["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,v["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,v["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,v["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),u=r(i),s=n(6),c=r(s),f=n(43),l=r(f),d=n(37),p=r(d),y=n(38),g=r(y),h=n(10),v=r(h),m=n(18),b=r(m),w=n(1),E=r(w),x=n(2),_=r(x),k=n(32),I=r(k),T=n(26),O=r(T),j=n(14),A=function(){function e(t,n){(0,E["default"])(this,e),(0,b["default"])(this,n),this.host=t,this.config=t.config,this.httpClient=t.httpClient}return(0,_["default"])(e,[{key:"_resolveModelId",value:function(e){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(e));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+o(e));return"string"==typeof e?e:e?e.serverId||e.id||null:null}},{key:"_resolveModelIdWithTypes",value:function(e,t){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(e));if(!("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "allowedEntityTypes" violates contract.\n\nExpected:\nstring | string[]\n\nGot:\n'+a(t));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+o(e));if(!("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "allowedEntityTypes" violates contract.\n\nExpected:\nstring | string[]\n\nGot:\n'+o(t));if(!e)return null;if("string"==typeof e){var n=this._resolveEntity(e);if(!n)return e;e=n}return O["default"].oneOf("thing",e.$entityType,(0,j.arrayWrap)(t)),e.serverId||e.id||null}},{key:"_resolveEntity",value:function(e,t){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(e));if(!(null==t||"string"==typeof t||null==t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "types" violates contract.\n\nExpected:\n?string | ?string[]\n\nGot:\n'+a(t));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+o(e));if(!(null==t||"string"==typeof t||null==t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "types" violates contract.\n\nExpected:\n?string | ?string[]\n\nGot:\n'+o(t));if(t||(t=this.host.allModelEntityTypes),t=(0,j.arrayWrap)(t),"object"===("undefined"==typeof e?"undefined":(0,v["default"])(e)))return t.includes(e.$entityType)?e:null;if(!t||"function"!=typeof t[g["default"]]&&!Array.isArray(t))throw new TypeError("Expected types to be iterable, got "+o(t));if(!t||"function"!=typeof t[g["default"]]&&!Array.isArray(t))throw new TypeError("Expected types to be iterable, got "+a(t));var n=!0,r=!1,i=void 0;try{for(var u,s=(0,p["default"])(t);!(n=(u=s.next()).done);n=!0){var c=u.value,f=this.host.modelsByEntityType[c].get(e);if(f)return f;if(f=(0,l["default"])(this.host.modelsByEntityType[c].getAll(),{serverId:e}))return f}}catch(d){r=!0,i=d}finally{try{!n&&s["return"]&&s["return"]()}finally{if(r)throw i}}return null}},{key:"mounted",value:function(){}},{key:"dispose",value:function(){}}]),e}();t["default"]=A,(0,b["default"])(A.prototype,I["default"].prototype),e.exports=t["default"]},function(e,t){e.exports=require("class-private-method-decorator")},function(e,t){"use strict";function n(){return r(this)}function r(e){return Array.isArray(e)?e:void 0!=e&&null!=e?[e]:[]}function o(e,t,n){!(n in e)&&t in e&&(e[n]=e[t],delete e[t])}Object.defineProperty(t,"__esModule",{value:!0}),t.arrayWrapBound=n,t.arrayWrap=r,t.replaceKey=o},function(e,t){e.exports=require("lodash/defaults")},function(e,t){e.exports=require("reuse-promise")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={NotSignedInError:n(81),WrongCredentialsError:n(84),NotFoundError:n(80),PermissionDeniedError:n(82),ValidationError:n(49),TargetNotSupportedError:n(83)};t["default"]=r,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("babel-runtime/helpers/extends")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(){var e=arguments.length<=0||void 0===arguments[0]?{fallbackValue:null,httpStatusCodes:[404]}:arguments[0];return function(t,n,r){var o=r.value;return r.value=function(){var t=(0,s["default"])(i["default"].mark(function n(){var t,r,a,u=arguments;return i["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:for(n.prev=0,t=u.length,r=Array(t),a=0;t>a;a++)r[a]=u[a];return n.next=4,o.call.apply(o,[this].concat(r));case 4:return n.abrupt("return",n.sent);case 7:if(n.prev=7,n.t0=n["catch"](0),!n.t0.response||!e.httpStatusCodes.includes(n.t0.response.status)){n.next=13;break}return n.abrupt("return",e.fallbackValue);case 13:throw n.t0;case 14:case"end":return n.stop()}},n,this,[[0,7]])}));return function(e){return t.apply(this,arguments)}}(),r}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a=n(9),i=r(a),u=n(8),s=r(u),c=n(18),f=r(c),l=n(1),d=r(l);t.recoverFromNotFound=o;var p=n(32),y=r(p),g=function h(e,t){(0,d["default"])(this,h),(0,f["default"])(this,t),this.config=e.config,this.host=e,this.httpClient=e.httpClient};t["default"]=g,(0,f["default"])(g.prototype,y["default"].prototype)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ServerValueEnum=t["default"]=void 0;var o=n(146),a=r(o),i=n(30),u=r(i),s=n(3),c=r(s),f=n(5),l=r(f),d=n(4),p=r(d),y=n(121),g=r(y),h=n(20),v=r(h),m=n(1),b=r(m),w=n(2),E=r(w),x=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];(0,b["default"])(this,e),Array.isArray(t)&&(t=t.reduce(function(e,t){return e[t]={},e},{})),this.keys=[],this.entries=[],this.entriesByKey={},this.defaultValue=n.defaultValue||null;for(var r in t){this[r]=r;var o=(0,v["default"])({key:r},t[r]);this.entriesByKey[r]=o,this.entries.push(o),this.keys.push(r)}(0,g["default"])(this.keys),(0,g["default"])(this.entries),(0,g["default"])(this.entriesByKey)}return(0,E["default"])(e,[{key:"resolve",value:function(e){return e||this.defaultValue}},{key:"isValid",value:function(e){return!!this.entriesByKey[e]}}]),e}();t["default"]=x,t.ServerValueEnum=function(e){function t(){return(0,b["default"])(this,t),(0,l["default"])(this,(0,c["default"])(t).apply(this,arguments))}return(0,p["default"])(t,e),(0,E["default"])(t,[{key:"mapEnumKeyToServerValue",value:function(){return this._mapEnumKeyToServerValue||(this._mapEnumKeyToServerValue=(0,u["default"])(this.entries,function(e,t){return e[t.key]=t.serverValue},{}))}},{key:"mapServerValueToEnumKey",value:function(){return this._mapServerValueToEnumKey||(this._mapServerValueToEnumKey=(0,a["default"])(this.mapEnumKeyToServerValue()))}},{key:"fromServer",value:function(e){return this.mapServerValueToEnumKey()[e]}},{key:"toServer",value:function(e){return this.mapEnumKeyToServerValue()[e]||this.mapServerValueToEnumKey()[e]}},{key:"resolve",value:function(e){return(this.isValid(e)?e:this.fromServer(e))||this.defaultValue}}]),t}(x)},function(e,t){e.exports=require("autobind-decorator")},function(e,t){e.exports=require("lodash/each")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={MessageRecipientStatus:n(34),MessageSenderStatus:n(97),MessageDirection:n(95),PresenceStatus:n(50),GroupType:n(94),MessageType:n(98),MessagePriority:n(96)},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=r(o),i=n(49),u=r(i),s={isOneOf:function(e,t,n){return n.includes(t)},isNotEmpty:function(e,t){return!!t},raise:function(e){var t=arguments.length<=1||void 0===arguments[1]?"invalid":arguments[1],n=arguments[2];throw new u["default"](e,t,n)}};(0,a["default"])(s).forEach(function(e){var t=e.replace(/^is([A-Z])/,function(e,t){return t.toLowerCase()}),n=s[e];s[t]=function(e,t,r){for(var o=arguments.length,a=Array(o>3?o-3:0),i=3;o>i;i++)a[i-3]=arguments[i];n.apply(void 0,[e,t,r].concat(a))||s.raise(e,void 0,r)}}),t["default"]=s,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/helpers/objectWithoutProperties")},function(e,t){e.exports=require("lodash-bound/lib/filter")},function(e,t){e.exports=require("lodash-bound/lib/map")},function(e,t){e.exports=require("lodash/transform")},function(e,t){e.exports=require("babel-runtime/helpers/toConsumableArray")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("lodash/values")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),o=new r.ServerValueEnum({READ:{serverValue:"Read"},TO_BE_READ:{serverValue:"ToBeRead"},DELIVERED:{serverValue:"Delivered"},RECEIVED_ON_CLIENT:{serverValue:"ReceivedOnClient"},NEW:{serverValue:"New"},NA:{key:"NA"}});t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){var r=n.before,o=n.after;if(null==arguments[2]||null!=arguments[2].before&&"function"!=typeof arguments[2].before||null!=arguments[2].after&&"function"!=typeof arguments[2].after)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ before: ?Function;\n  after: ?Function;\n}\n\nGot:\n"+i(arguments[2]));if(null==arguments[2]||null!=arguments[2].before&&"function"!=typeof arguments[2].before||null!=arguments[2].after&&"function"!=typeof arguments[2].after)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ before: ?Function;\n  after: ?Function;\n}\n\nGot:\n"+a(arguments[2]));e.ensureEntityOrCreateTemporaryAndFind||(e.ensureEntityOrCreateTemporaryAndFind=function(t,n){function r(){var n=this;if(e.host.config.enableEnsureEntityFindMissing&&!w[E(s)]){var r=function(){var r=(0,h["default"])(y["default"].mark(function o(){return y["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(s.$temporary){n.next=3;break}return e.logger.info("entity "+t+":"+u+" was already updated elsewhere"),n.abrupt("return");case 3:return n.next=5,a();case 5:delete w[E(s)];case 6:case"end":return n.stop()}},o,n)}));return function(){return r.apply(this,arguments)}}(),a=function(){var e=(0,h["default"])(y["default"].mark(function t(){return y["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.finder(u,{bypassCache:!0});case 3:delete s.$temporary,i.after(s,o),o.onLoad(s),e.next=13;break;case 8:e.prev=8,e.t0=e["catch"](0),e.next=12;break;case 12:o.onLoad(null);case 13:case"end":return e.stop()}},t,n,[[0,8]])}));return function(){return e.apply(this,arguments)}}();e.host.config.temporaryEntityDelayBeforeRefreshing?w[E(s)]=setTimeout(r,e.host.config.temporaryEntityDelayBeforeRefreshing):a()}}var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(e.host.config.enableEnsureEntityWithTemp||e.host.config.enableEnsureEntityFindMissing){if(o=(0,m["default"])(o,{onLoad:b.noop,onExists:b.noop,onMissing:b.noop,onlyPlaceholder:!1}),!o.finder)throw new Error("finder is missing in ensureEntityOrCreateTemporaryAndFind call");var a=e.store.models[t],i=a.__addEnsureEntityOrCreateTemporaryAndFind__config,u=n[a.idAttribute],s=e.store.get(t,u);if(i.before(n,s,o),s)i.after(s,o),s.$temporary?o.onlyPlaceholder||r():o.onExists(s);else{if(o.onMissing(),s=e.store.inject(t,n),Object.defineProperty(s,"$temporary",{value:!0,configurable:!0}),o.onlyPlaceholder)return s;r()}return s}}),t.__addEnsureEntityOrCreateTemporaryAndFind__config={before:r||b.noop,after:o||b.noop},t.ensureEntityOrCreateTemporaryAndFind=function(n,r){return e.ensureEntityOrCreateTemporaryAndFind(t.name,n,r)}}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,f["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var c=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof c?"undefined":(0,d["default"])(c))?c.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,f["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var c=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof c?"undefined":(0,d["default"])(c))?c.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var u=n(7),s=r(u),c=n(6),f=r(c),l=n(10),d=r(l),p=n(9),y=r(p),g=n(8),h=r(g),v=n(15),m=r(v);t["default"]=o;var b=n(66),w={},E=function(e){return e.$entityType+":"+e.id};e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){return(0,l["default"])(e)?e.map(function(e){return o(e,t)}):(0,c["default"])(e)?(0,u["default"])(e,function(e,n,r){e[t(r)]=o(n,t)},{}):e}Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),i=(r(a),n(30)),u=r(i),s=n(148),c=r(s),f=n(147),l=r(f),d=n(64),p=r(d),y=n(61),g=r(y),h=n(154),v=r(h),m={camelizeKey:(0,v["default"])(g["default"]),underscoreKey:(0,v["default"])(p["default"]),camelizeObject:function(e){return o(e,m.camelizeKey)},underscoreObject:function(e){return o(e,m.underscoreKey)}};t["default"]=m,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/get-iterator")},function(e,t){e.exports=require("babel-runtime/core-js/symbol/iterator")},function(e,t){e.exports=require("babel-runtime/helpers/defineProperty")},function(e,t){e.exports=require("lodash-bound/lib/flatten")},function(e,t){e.exports=require("lodash-bound/lib/orderBy")},function(e,t){e.exports=require("lodash/filter")},function(e,t){e.exports=require("lodash/find")},function(e,t){e.exports=require("lodash/get")},function(e,t){e.exports=require("lodash/isEmpty")},function(e,t){e.exports=require("lodash/pick")},function(e,t){e.exports=require("lodash/throttle")},function(e,t){e.exports=require("moment")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(3),u=r(i),s=n(1),c=r(s),f=n(5),l=r(f),d=n(4),p=r(d),y=(a=o=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?"invalid":arguments[1],r=arguments.length<=2||void 0===arguments[2]?e+" is "+n:arguments[2];(0,c["default"])(this,t);var o=(0,l["default"])(this,(0,u["default"])(t).call(this,r));return o.code=t.CODE,o.name=e,o.reason=n,o}return(0,p["default"])(t,e),t}(Error),o.CODE="validation",a);t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),o=new r.ServerValueEnum({UNKNOWN:{serverValue:"unknown"},AVAILABLE:{serverValue:"available"},UNAVAILABLE:{serverValue:"unavailable"}});t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Event:n(86),SearchResult:n(92)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict"},function(e,t,n){"use strict";!function(){try{var e=n(125).request().__proto__;e.setNoDelay||(e.setNoDelay=function(){}),e.abort||(e.abort=function(){this.xhr&&this.xhr.abort()})}catch(t){}}()},function(e,t){e.exports=require("btoa")},function(e,t){e.exports=require("file-type")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("jshashes")},function(e,t){e.exports=require("lodash-bound/lib/keys")},function(e,t){e.exports=require("lodash-bound/lib/uniq")},function(e,t){e.exports=require("lodash-bound/lib/values")},function(e,t){e.exports=require("lodash/camelCase")},function(e,t){e.exports=require("lodash/difference")},function(e,t){e.exports=require("lodash/identity")},function(e,t){e.exports=require("lodash/snakeCase")},function(e,t){e.exports=require("lodash/sumBy")},function(e,t){e.exports=require("node-noop")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("shallowequal")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p["default"])(e);if(!Array.isArray(e)){var o=(0,S["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,p["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p["default"])(e);if(!Array.isArray(e)){var o=(0,S["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,p["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var u,s,c,f=n(7),l=r(f),d=n(10),p=r(d),y=n(11),g=r(y),h=n(138),v=r(h),m=n(30),b=r(m),w=n(18),E=r(w),x=n(19),_=r(x),k=n(9),I=r(k),T=n(8),O=r(T),j=n(156),A=r(j),M=n(61),G=r(M),V=n(24),z=r(V),C=n(6),S=r(C),P=n(64),q=r(P),U=n(153),N=r(U),$=n(15),R=r($),F=n(1),D=r(F),B=n(2),L=r(B),K=n(71),Z=r(K),W=n(70),H=r(W),X=n(32),Y=r(X),Q=n(17),J=r(Q),ee=n(79),te=r(ee),ne=n(112),re=r(ne),oe=n(114),ae=r(oe),ie=n(25),ue=r(ie),se=n(127),ce=r(se),fe=(n(13),n(23)),le=r(fe),de=n(116),pe=r(de),ye="UpM28mnfW65vJkbqEATtKvxm",ge={events:{autoAck:!1,isTyping:!0,multiOrg:!0,noOfflineMessages:!1,autoDeliver:!1,hidden:!1,closeAfterMessages:!1},autoAckSuccessfullyHandledEvents:!0,logLevel:"error",eventsAutoReconnect:!0,flushAckInterval:2e3,flushAckMaxEvents:500,flushSetMessageStatusInterval:1e3,flushMessageMaxCount:500,conversationReloadDelay:200,eventsAutoReconnectDelay:2e3,clearTypingStatusTimeout:15e3,organizationRostersChangeThrottleDelay:500,temporaryEntityDelayBeforeRefreshing:100,enableEnsureEntityWithTemp:!0,enableEnsureEntityFindMissing:!0,consumerOrganizationId:ye,maxMetadataKeyCount:8,pushAgent:"consumer",baseUrl:"https://developer.tigertext.me/v2",productKey:"bc1oOf3DZXbnaNZ2LCWZGvSg",version:"1.0",autoSignOutOnBrowserUnload:!1},he=(c=s=function(){function e(){var t=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if((0,D["default"])(this,e),this.VERSION=pe["default"],this.version=pe["default"],!(null==n||n instanceof Object))throw new TypeError('Value of argument "config" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+i(n));if(!(null==n||n instanceof Object))throw new TypeError('Value of argument "config" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+a(n));this.config=(0,R["default"])(n,ge),this.config.autoSignOutOnBrowserUnload=!1,this.httpClient=new H["default"]({baseUrl:this.config.baseUrl,logger:new Z["default"]({name:"HttpClient",level:this.config.logLevel})}),this.enums=ue["default"],this.store=new ae["default"](this,{logger:new Z["default"]({name:"Store",level:this.config.logLevel})}),this.store.defineModels(),this.models=this.store.models,this.modelsByEntityType=(0,N["default"])(this.store.models,function(e,t){return(0,q["default"])(t)}),this.allModelEntityTypes=(0,S["default"])(this.modelsByEntityType),this.logger=new Z["default"]({name:"TigerConnectClient",level:this.config.logLevel}),this.api={},(0,z["default"])(te["default"],function(e,n){t.api[(0,G["default"])(n)]=new e(t,{logger:new Z["default"]({name:e.name,level:t.config.logLevel})})}),this._services={},(0,z["default"])(re["default"],function(e,n){n=(0,G["default"])(n),t._services[n]=t[n]=new e(t,{logger:new Z["default"]({name:e.name,level:t.config.logLevel})})}),(0,z["default"])(this._services,function(e){return e.mounted&&e.mounted()}),this._listenToEvents(),this._startTicker(),this.config.autoSignOutOnBrowserUnload&&this.on("browserUnload",function(e){return e(function(){return t.signOut({async:!1})},100,"signOut")})}return(0,L["default"])(e,[{key:"_listenToEvents",value:function(){var e=this;this.on("signedIn",function(t,n){e.logger.info("signedIn",t.id)}).on("signedOut",function(){e.reset()}).on("signUp",function(t){var n=t.user,r=t.auth;e.logger.info("signUp",n.id),e._setCurrentUser(n,r)}),this.events.on("event",function(t){return e.emit("event",t)}),this.conversations.on("message",function(t){return e.emit("message",t)}),this.conversations.on("change",function(t){return e.emit("conversation:change",t)}),this.groups.on("membership:change",function(t){return e.emit("group:membership:change",t)}),this.presence.on("change",function(t){return e.emit("presence:change",t)}),this.typingStatus.on("change",function(t){return e.emit("typing:change",t)}),"undefined"!=typeof window&&window.addEventListener("beforeunload",this._onBrowserUnload)}},{key:"_onBrowserUnload",value:function(){var e=[],t=function(t,n,r){return e.push({fn:t,priority:n,name:r})};this.emit("browserUnload",t),(0,A["default"])(e,["priority"],["desc"]).forEach(function(e){var t=e.fn,n=e.priority,r=e.name;console.log("[unload]",n,r),t()})}},{key:"_startTicker",value:function(){this.__ticker=setInterval(this._onTick,1e3)}},{key:"_stopTicker",value:function(){clearInterval(this.__ticker)}},{key:"_onTick",value:function(){this.emit("tick")}},{key:"signIn",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,O["default"])(I["default"].mark(function n(e,t){var r,o,a,i=arguments.length<=2||void 0===arguments[2]?{udid:void 0}:arguments[2];return I["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.emit("signingIn"),n.prev=1,n.next=4,this.users.signIn(e,t,i);case 4:return r=n.sent,o=r.user,a=r.auth,this._setCurrentUser(o,a),n.next=10,this.users.me({bypassCache:!0});case 10:return this.emit("signedIn",o,a),n.abrupt("return",{user:o,auth:a});case 14:throw n.prev=14,n.t0=n["catch"](1),n.t0;case 18:case"end":return n.stop()}},n,this,[[1,14]])}));return e}()},{key:"signOut",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,O["default"])(I["default"].mark(function n(){var e,t,r=arguments.length<=0||void 0===arguments[0]?{async:!0}:arguments[0],o=r.async,a=void 0===o?!0:o;return I["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.isSignedIn()){n.next=2;break}return n.abrupt("return",_["default"].resolve());case 2:if(this.emit("signingOut"),a||"undefined"!=typeof XMLHttpRequest){n.next=5;break}throw new Error("async: false option has to be on the browser.");case 5:if(!a){n.next=16;break}return e=this.users.signOut({async:a}),n.next=9,e;case 9:this._currentUser=null,this._auth=null,this.httpClient.removeAuth(),this.events.disconnect(),this.emit("signedOut"),n.next=22;break;case 16:return t=new XMLHttpRequest,t.open("POST",this.config.baseUrl+"/logout",!1),t.setRequestHeader("Authorization",this.httpClient.getAuthHeader()),t.send(null),this.emit("signedOut"),n.abrupt("return",_["default"].resolve());case 22:case"end":return n.stop()}},n,this)}));return e}()},{key:"wipe",value:function(){function e(){return t.apply(this,arguments)}var t=(0,O["default"])(I["default"].mark(function n(){return I["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signOut();case 2:case"end":return e.stop()}},n,this)}));return e}()},{key:"authenticate",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,O["default"])(I["default"].mark(function n(e,t){var r,o,a;return I["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this._setAuth(e,t),n.prev=1,n.next=4,this.httpClient.get("/user");case 4:n.next=25;break;case 6:if(n.prev=6,n.t0=n["catch"](1),r=n.t0.response&&n.t0.response.get("TT_Log_Account_Token")){n.next=11;break}throw new J["default"].WrongCredentialsError;case 11:return n.prev=11,n.next=14,this.users.find(r);case 14:return o=n.sent,a={key:e,secret:t},this._setCurrentUser(o,a),this.emit("signedIn",o,a),n.abrupt("return",o);case 21:throw n.prev=21,n.t1=n["catch"](11),this._removeAuth(),n.t1;case 25:case"end":return n.stop()}},n,this,[[1,6],[11,21]])}));return e}()},{key:"_setCurrentUser",value:function(e,t){this._currentUser=e,this._setAuth(t.key,t.secret,t.resource)}},{key:"_setAuth",value:function(e,t,n){this._auth={key:e,secret:t,resource:n},this.httpClient.setAuth(e,t)}},{key:"_removeAuth",value:function(){this._auth=null,this.httpClient.removeAuth()}},{key:"getCurrentUser",value:function(){return this._currentUser||null}},{key:"getAuth",value:function(){return this._auth}},{key:"isSignedIn",value:function(){return null!=this.getAuth()}},{key:"requireUser",value:function(){if(!this.isSignedIn())throw new J["default"].NotSignedInError}},{key:"reactToAdvisoryEvent",value:function(e,t){switch(this.emit("advisory",{type:e,data:t}),e){case"replayStart":this.emit("messages:offline:start",t);break;case"replayStop":this.emit("messages:offline:stop"),this.emit("messages:new:start")}}},{key:"modelByTypeNS",value:function(e){return this.MODEL_BY_TYPE_NS[e];
}},{key:"injectModel",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?e.xmlns||e.type:arguments[1],n=this.modelByTypeNS(t);return n?n.inject(e):((0,ce["default"])(n,"injectModel: Missing class for "+t),null)}},{key:"getEntity",value:function(e,t){return this.modelsByEntityType[e].get(t)}},{key:"getEntities",value:function(e){var t=this;return e.map(function(e){return t.getEntity(e.type,e.id)})}},{key:"typeNSByModelName",value:function(e){return this.TYPE_NS_BY_MODEL_NAME[e]}},{key:"dispose",value:function(){this._stopTicker(),(0,z["default"])(this._services,function(e){return e.dispose&&e.dispose()}),this.store&&this.store.clear()}},{key:"reset",value:function(){this.dispose(),(0,z["default"])(this._services,function(e){return e.mounted&&e.mounted()}),this._startTicker()}},{key:"configure",value:function(e){return(0,E["default"])(this.config,e),this}},{key:"setDefaultOrganization",value:function(e){return this.configure({defaultOrganizationId:e})}},{key:"currentUser",get:function(){return this.getCurrentUser()}},{key:"currentUserId",get:function(){return this.getCurrentUser()&&this.getCurrentUser().id}},{key:"MODEL_BY_TYPE_NS",get:function(){return this._MODEL_BY_TYPE_NS||(this._MODEL_BY_TYPE_NS={"tigertext:entity:account":this.models.User,"tigertext:entity:group":this.models.Group,"tigertext:entity:list":this.models.Group,"tigertext:iq:message":this.models.Message,"tigertext:iq:group_message":this.models.Message,"tigertext:iq:group:message":this.models.Message}),this._MODEL_BY_TYPE_NS}},{key:"TYPE_NS_BY_MODEL_NAME",get:function(){return this._TYPE_NS_BY_MODEL_NAME||(this._TYPE_NS_BY_MODEL_NAME=(0,b["default"])(this.MODEL_BY_TYPE_NS,function(e,t,n){e[t.name]=n,e[(0,v["default"])(t.name)]=n},{})),this._TYPE_NS_BY_MODEL_NAME}}]),e}(),s.errors=J["default"],s.VERSION=pe["default"],s.version=pe["default"],s.CONSUMER_ORGANIZATION_ID=ye,u=c,o(u.prototype,"_onBrowserUnload",[le["default"]],(0,g["default"])(u.prototype,"_onBrowserUnload"),u.prototype),o(u.prototype,"_onTick",[le["default"]],(0,g["default"])(u.prototype,"_onTick"),u.prototype),u);(0,E["default"])(he.prototype,Y["default"].prototype),t["default"]=he,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){var t=arguments.length<=1||void 0===arguments[1]?"attachment":arguments[1],r=e.name;if(!r)if("string"==typeof e)r=n(67).basename(e);else if(e instanceof Buffer){var o=(0,w["default"])(n(55)(e),"ext");r=t+"."+o}return r}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,x["default"])(e);if(!Array.isArray(e)){var o=(0,f["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var c=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof c?"undefined":(0,x["default"])(c))?c.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,x["default"])(e);if(!Array.isArray(e)){var o=(0,f["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var c=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof c?"undefined":(0,x["default"])(c))?c.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var u=n(7),s=r(u),c=n(6),f=r(c),l=n(159),d=r(l),p=n(45),y=r(p),g=n(18),h=r(g),v=n(15),m=r(v),b=n(44),w=r(b),E=n(10),x=r(E),_=n(19),k=r(_),I=n(9),T=r(I),O=n(8),j=r(O),A=n(1),M=r(A),G=n(2),V=r(G),z=n(168),C=r(z),S=n(54),P=r(S),q=n(17),U=r(q),N=n(169),$=r(N),R=n(16),F=["get","post","put","patch","del"],D=function(){function e(t){(0,M["default"])(this,e),this.downloadImageAndGetURL=function(){return TargetNotSupportedError.raise()},this.downloadFileBlobAndURL=function(){return TargetNotSupportedError.raise()},this.config=t,this.logger=t.logger,this._prefixBaseUrl=(0,$["default"])(this.config.baseUrl)}return(0,V["default"])(e,[{key:"setAuth",value:function(e,t){this._key=e,this._secret=t}},{key:"removeAuth",value:function(){this._key=null,this._secret=null}},{key:"getAuthHeader",value:function(){return this.getAuthHeaderForKeyAndSecret(this._key,this._secret)}},{key:"getAuthHeaderForKeyAndSecret",value:function(e,t){return e&&t?"Basic "+(0,P["default"])(e+":"+t):null}},{key:"_contentType",value:function(e){switch(e){case"json":return"application/json";case"event-stream":return"text/event-stream";case"text":default:return"plain/text"}}},{key:"downloadFileBlob",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));TargetNotSupportedError.raise()}},{key:"downloadToFile",value:function(e,t){var r=this,o=function(){var o=n(56);return{v:new k["default"](function(a,i){var u=r.config.baseUrl+e;n(167)({url:u,headers:{Authorization:r.getAuthHeader()}},function(e,t){e||t.statusCode<200||t.statusCode>299?i(new Error("Failed downloading "+u+". Status = "+xhr.status)):a()}).pipe(o.createWriteStream(t))})}}();return"object"===("undefined"==typeof o?"undefined":(0,x["default"])(o))?o.v:void 0}}]),e}();F.forEach(function(e){D.prototype[e]=function(){var t=(0,j["default"])(T["default"].mark(function n(t){var r,a,i=this,u=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return T["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return u=(0,m["default"])(u||{},{reqFormat:"json",resFormat:"json"}),u.urlParams&&(t=t.replace(/:([\w\-]+)/g,function(e,t){return encodeURIComponent(u.urlParams[t])})),this.logger&&this.logger.info("start",e.toUpperCase(),t,u),r=(0,h["default"])({},u.headers),(0,y["default"])(u.files)&&(r["Content-Type"]=r["Content-Type"]||this._contentType(u.reqFormat)),r.Accept=r.Accept||this._contentType(u.resFormat),u.requestId&&(r["Request-ID"]=u.requestId),a=new k["default"](function(n,a){var s=C["default"][e](t).use(i._prefixBaseUrl).set(r).query(u.query||{});(0,y["default"])(u.files)?s=s.send(u.data||{}):(s=(0,d["default"])(u.data,function(e,t,n){return e.field(n,String(t))},s),s=(0,d["default"])(u.files,function(e,t,n,r){return e.attach(n,t,o(t,"attachment-"+r))},s),s=s.send()),i._key&&i._secret&&(s=s.auth(i._key,i._secret)),s.end(function(r,o){if(r)return i.logger&&i.logger.info("error",e.toUpperCase(),t,r),401==r.status&&a(new U["default"].WrongCredentialsError),void a(r);switch(u.resFormat){case"json":var s=o.body||{};"reply"in s&&(s=s.reply);var c={data:s,headers:o.headers,getHeader:function(e){return o.headers[e.toLowerCase()]},status:o.status};Object.defineProperty(c,"_origData",{get:function(){return o.body}}),i.logger&&i.logger.info("success",e.toUpperCase(),t,c),n(c);break;default:i.logger&&i.logger.info("success",e.toUpperCase(),t,o.text?o.text.substr(0,80)+"...":"[null]"),n(o.text)}})}),n.abrupt("return",a);case 9:case"end":return n.stop()}},n,this)}));return function(e,n){return t.apply(this,arguments)}}()}),!function(){var e=D.prototype.get,t=(0,R.decorator)(e);D.prototype.get=function(n){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return r.reusePromise?t.call(this,n,r):e.call(this,n,r)}}(),t["default"]=D,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),u=r(i),s=n(6),c=r(s),f=n(10),l=r(f),d=n(31),p=r(d),y=n(1),g=r(y),h=n(2),v=r(h),m=function(){function e(t){var n=t.name,r=t.level;if((0,g["default"])(this,e),null==arguments[0]||"string"!=typeof arguments[0].name||"string"!=typeof arguments[0].level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ name: string;\n  level: string;\n}\n\nGot:\n"+a(arguments[0]));if(null==arguments[0]||"string"!=typeof arguments[0].name||"string"!=typeof arguments[0].level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ name: string;\n  level: string;\n}\n\nGot:\n"+o(arguments[0]));this.name=n,this.level=r}return(0,v["default"])(e,[{key:"setLevel",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));this.level=e}}]),e}(),b=["debug","log","info","warn","error"],w=b.reduce(function(e,t,n){return e[t]=n,e},{});b.forEach(function(e){var t=w[e];m.prototype[e]=function(){for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];t<w[this.level]||(r=["["+this.name+"]"].concat((0,p["default"])(r)),Function.prototype.apply.call(console[e],console,r))}}),t["default"]=m,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,p["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,p["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f=n(7),l=r(f),d=n(6),p=r(d),y=n(10),g=r(y),h=n(11),v=r(h),m=n(9),b=r(m),w=n(8),E=r(w),x=n(3),_=r(x),k=n(1),I=r(k),T=n(2),O=r(T),j=n(5),A=r(j),M=n(4),G=r(M),V=n(21),z=r(V),C=(u=(0,V.recoverFromNotFound)(),s=(0,V.recoverFromNotFound)({httpStatusCodes:[404,403]}),c=function(e){function t(){return(0,I["default"])(this,t),(0,A["default"])(this,(0,_["default"])(t).apply(this,arguments))}return(0,G["default"])(t,e),(0,O["default"])(t,[{key:"create",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,E["default"])(b["default"].mark(function n(e){var t,r,o,a,i,u,s,c=e.name,f=e.avatarFile,l=e.replayHistory,d=void 0===l?!0:l,p=e.memberIds,y=void 0===p?[]:p,g=e.organizationId;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},r={name:c,replay_history:d,members:y.join(",")},o={},f&&(o.avatar=f),g&&(t["TT-X-Organization-Key"]=g),e.next=7,this.httpClient.post("/group",{headers:t,data:r,files:o});case 7:return a=e.sent,i=a.getHeader("TT-X-Group-Token"),u=a.getHeader("TT-X-Group-Avatar"),s={id:i,avatarUrl:u,name:c,memberIds:y,organizationId:g},e.abrupt("return",s);case 12:case"end":return e.stop()}},n,this)}));return e}()},{key:"update",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,E["default"])(b["default"].mark(function n(e,t){var r,o,a,i,u=t.name,s=void 0===u?void 0:u,c=t.avatarFile,f=void 0===c?void 0:c,l=t.replayHistory,d=void 0===l?void 0:l,p=t.memberIds;return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={},o={},"undefined"!=typeof s&&(r.name=s),"undefined"!=typeof p&&(r.members=p.join(",")),"undefined"!=typeof d&&(r.replay_history=d),f&&(o.avatar=f),t.next=8,this.httpClient.post("/group/:id",{urlParams:{id:e},data:r,files:o});case 8:return a=t.sent,i=a.getHeader("TT-X-Group-Avatar"),t.abrupt("return",{id:e,avatarUrl:i});case 11:case"end":return t.stop()}},n,this)}));return e}()},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,E["default"])(b["default"].mark(function n(e){var t;return b["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){n.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return n.next=6,this.httpClient.get("/group/:id",{urlParams:{id:e}});case 6:return t=n.sent,n.abrupt("return",t.data);case 8:case"end":return n.stop()}},n,this)}));return e}()},{key:"destroy",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,E["default"])(b["default"].mark(function n(e){return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return t.next=6,this.httpClient.del("/group/:id",{urlParams:{id:e}});case 6:return t.abrupt("return",!0);case 7:case"end":return t.stop()}},n,this)}));return e}()},{key:"addMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,E["default"])(b["default"].mark(function n(e,t){return b["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){n.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(t));case 4:if("string"==typeof e){n.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){n.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(t));case 8:return n.next=10,this.httpClient.post("/group/:id/members",{urlParams:{id:e},data:{members:t}});case 10:case"end":return n.stop()}},n,this)}));return e}()},{key:"removeMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,E["default"])(b["default"].mark(function n(e,t){return b["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){n.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(t));case 4:if("string"==typeof e){n.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){n.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(t));case 8:return n.next=10,this.httpClient.post("/group/:id/members/remove",{urlParams:{id:e},data:{members:t}});case 10:case"end":return n.stop()}},n,this)}));return e}()}]),t}(z["default"]),o(c.prototype,"find",[u],(0,v["default"])(c.prototype,"find"),c.prototype),o(c.prototype,"destroy",[s],(0,v["default"])(c.prototype,"destroy"),c.prototype),c);t["default"]=C,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,c["default"])(e);if(!Array.isArray(e)){var a=(0,u["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,c["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,c["default"])(e);if(!Array.isArray(e)){var o=(0,u["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,c["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(6),u=r(i),s=n(10),c=r(s),f=n(9),l=r(f),d=n(7),p=r(d),y=n(20),g=r(y),h=n(8),v=r(h),m=n(3),b=r(m),w=n(1),E=r(w),x=n(2),_=r(x),k=n(5),I=r(k),T=n(4),O=r(T),j=n(21),A=r(j),M=function(e){function t(){return(0,E["default"])(this,t),(0,I["default"])(this,(0,b["default"])(t).apply(this,arguments))}return(0,O["default"])(t,e),(0,_["default"])(t,[{key:"send",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,v["default"])(l["default"].mark(function n(e){var t,r,i,u,s=e.counterPartyId,c=e.body,f=e.senderOrganizationId,d=e.recipientOrganizationId,y=e.attachment,h=e.metadata,v=e.priority,m=e.ttl,b=e.dor,w=e.localId,E=arguments;return l["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==E[0]||"string"!=typeof E[0].counterPartyId||"string"!=typeof E[0].body||"string"!=typeof E[0].senderOrganizationId||"string"!=typeof E[0].recipientOrganizationId||!(null==E[0].attachment||E[0].attachment instanceof Object||null==E[0].attachment||"string"==typeof E[0].attachment)||!(null==E[0].metadata||E[0].metadata instanceof Object)||null!=E[0].priority&&"number"!=typeof E[0].priority||null!=E[0].ttl&&"number"!=typeof E[0].ttl||null!=E[0].dor&&"boolean"!=typeof E[0].dor||"string"!=typeof E[0].localId)){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ counterPartyId: string;\n  body: string;\n  senderOrganizationId: string;\n  recipientOrganizationId: string;\n  attachment: ?Object | ?string;\n  metadata: ?Object;\n  priority: ?number;\n  ttl: ?number;\n  dor: ?bool;\n  localId: string;\n}\n\nGot:\n"+a(E[0]));case 2:if(!(null==E[0]||"string"!=typeof E[0].counterPartyId||"string"!=typeof E[0].body||"string"!=typeof E[0].senderOrganizationId||"string"!=typeof E[0].recipientOrganizationId||!(null==E[0].attachment||E[0].attachment instanceof Object||null==E[0].attachment||"string"==typeof E[0].attachment)||!(null==E[0].metadata||E[0].metadata instanceof Object)||null!=E[0].priority&&"number"!=typeof E[0].priority||null!=E[0].ttl&&"number"!=typeof E[0].ttl||null!=E[0].dor&&"boolean"!=typeof E[0].dor||"string"!=typeof E[0].localId)){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ counterPartyId: string;\n  body: string;\n  senderOrganizationId: string;\n  recipientOrganizationId: string;\n  attachment: ?Object | ?string;\n  metadata: ?Object;\n  priority: ?number;\n  ttl: ?number;\n  dor: ?bool;\n  localId: string;\n}\n\nGot:\n"+o(E[0]));case 4:return d||(d=f),t={recipient:s,body:c},r={},h&&(t.data=h.map(function(e){return(0,g["default"])({},e,{payload:(0,p["default"])(e.payload)})})),f&&(t.sender_organization=f),d&&(t.recipient_organization=d),"undefined"!=typeof v&&(t.priority=v),y&&(r.attachment=y),m&&(t.ttl=m),b&&(t.dor=b),e.next=16,this.httpClient.post("/message",{data:t,files:r,requestId:w});case 16:return i=e.sent,u={serverId:i.getHeader("TT-X-Message-Id"),ttl:+i.getHeader("TT-X-Msg-Ttl")},e.abrupt("return",u);case 19:case"end":return e.stop()}},n,this)}));return e}()},{key:"destroy",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,v["default"])(l["default"].mark(function n(e){return l["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return t.prev=4,t.next=7,this.httpClient.del("/message/:id",{urlParams:{id:e}});case 7:return t.abrupt("return",!0);case 10:return t.prev=10,t.t0=t["catch"](4),t.abrupt("return",!1);case 13:case"end":return t.stop()}},n,this,[[4,10]])}));return e}()},{key:"startTyping",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,v["default"])(l["default"].mark(function n(e){return l["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return t.next=6,this.httpClient.post("/message/typing",{data:{recipient:e}});case 6:case"end":return t.stop()}},n,this)}));return e}()},{key:"stopTyping",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,v["default"])(l["default"].mark(function n(e){return l["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return t.next=6,this.httpClient.del("/message/typing/:recipientId",{urlParams:{recipientId:e}});case 6:case"end":return t.stop()}},n,this)}));return e}()},{key:"forward",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,v["default"])(l["default"].mark(function n(e,t,r){var i,u,s,c=r.senderOrganizationId,f=r.recipientOrganizationId,d=r.priority,p=r.localId,y=arguments;return l["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(!(null==y[2]||null!=y[2].senderOrganizationId&&"string"!=typeof y[2].senderOrganizationId||null!=y[2].recipientOrganizationId&&"string"!=typeof y[2].recipientOrganizationId||null!=y[2].priority&&"number"!=typeof y[2].priority||"string"!=typeof y[2].localId)){n.next=6;break}throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ senderOrganizationId: ?string;\n  recipientOrganizationId: ?string;\n  priority: ?number;\n  localId: string;\n}\n\nGot:\n"+a(y[2]));case 6:if("string"==typeof e){n.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 8:if("string"==typeof t){n.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 10:if(!(null==y[2]||null!=y[2].senderOrganizationId&&"string"!=typeof y[2].senderOrganizationId||null!=y[2].recipientOrganizationId&&"string"!=typeof y[2].recipientOrganizationId||null!=y[2].priority&&"number"!=typeof y[2].priority||"string"!=typeof y[2].localId)){n.next=12;break}throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ senderOrganizationId: ?string;\n  recipientOrganizationId: ?string;\n  priority: ?number;\n  localId: string;\n}\n\nGot:\n"+o(y[2]));case 12:return f||(f=c),i={recipient:t},c&&(i.sender_organization=c),f&&(i.recipient_organization=f),"undefined"!=typeof d&&(i.priority=d),n.next=19,this.httpClient.post("/message/:id/forward",{urlParams:{id:e},data:i,requestId:p});case 19:return u=n.sent,s={serverId:u.getHeader("TT-X-Message-Id")},n.abrupt("return",s);case 22:case"end":return n.stop()}},n,this)}));return e}()}]),t}(A["default"]);t["default"]=M,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+a(e[n],t)+";";
}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),u=r(i),s=n(6),c=r(s),f=n(10),l=r(f),d=n(164),p=r(d),y=n(9),g=r(y),h=n(8),v=r(h),m=n(3),b=r(m),w=n(1),E=r(w),x=n(2),_=r(x),k=n(5),I=r(k),T=n(4),O=r(T),j=n(21),A=r(j),M=function(e){function t(){return(0,E["default"])(this,t),(0,I["default"])(this,(0,b["default"])(t).apply(this,arguments))}return(0,O["default"])(t,e),(0,_["default"])(t,[{key:"update",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,v["default"])(g["default"].mark(function n(e,t,r){return g["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if(t instanceof Object){n.next=4;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(t));case 4:if("string"==typeof r){n.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof e){n.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 8:if(t instanceof Object){n.next=10;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(t));case 10:if("string"==typeof r){n.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:return n.next=14,this.httpClient.post("/metadata/:id",{urlParams:{id:e},data:t,headers:{"TT-X-Organization-Key":r}});case 14:case"end":return n.stop()}},n,this)}));return e}()},{key:"find",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,v["default"])(g["default"].mark(function n(e,t){var r;return g["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if("string"==typeof e){n.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 8:return n.next=10,this.httpClient.get("/metadata/:id",{urlParams:{id:e},headers:{"TT-X-Organization-Key":t}});case 10:return r=n.sent,n.abrupt("return",r.data);case 12:case"end":return n.stop()}},n,this)}));return e}()},{key:"findMulti",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,v["default"])(g["default"].mark(function n(e,t){var r,i;return g["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){n.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){n.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+o(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 8:return n.next=10,this.httpClient.post("/metadata_bulk",{data:{entities:e},headers:{"TT-X-Organization-Key":t}});case 10:return r=n.sent,i=(0,p["default"])(e,r.data),n.abrupt("return",i);case 13:case"end":return n.stop()}},n,this)}));return e}()}]),t}(A["default"]);t["default"]=M,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,b["default"])(e);if(!Array.isArray(e)){var o=(0,v["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,g["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,b["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,b["default"])(e);if(!Array.isArray(e)){var o=(0,v["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,g["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,b["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f,l,d,p,y=n(7),g=r(y),h=n(6),v=r(h),m=n(10),b=r(m),w=n(11),E=r(w),x=n(9),_=r(x),k=n(8),I=r(k),T=n(3),O=r(T),j=n(1),A=r(j),M=n(2),G=r(M),V=n(5),z=r(V),C=n(4),S=r(C),P=n(21),q=r(P),U=(u=(0,P.recoverFromNotFound)(),s=(0,P.recoverFromNotFound)(),c=(0,P.recoverFromNotFound)(),f=(0,P.recoverFromNotFound)(),l=(0,P.recoverFromNotFound)(),d=(0,P.recoverFromNotFound)(),p=function(e){function t(){return(0,A["default"])(this,t),(0,z["default"])(this,(0,O["default"])(t).apply(this,arguments))}return(0,S["default"])(t,e),(0,G["default"])(t,[{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,I["default"])(_["default"].mark(function n(){var e;return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.httpClient.get("/mute");case 2:return e=t.sent,t.abrupt("return",e.data);case 4:case"end":return t.stop()}},n,this)}));return e}()},{key:"unmuteAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,I["default"])(_["default"].mark(function n(){return _["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.del("/mute");case 2:case"end":return e.stop()}},n,this)}));return e}()},{key:"muteUser",value:function(){function e(e,n,r,o){return t.apply(this,arguments)}var t=(0,I["default"])(_["default"].mark(function n(e,t,r){var o=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],u=o.recipientOrganizationId,s=void 0===u?r:u;return _["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("number"==typeof t){n.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(t));case 4:if("string"==typeof r){n.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e){n.next=8;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 8:if("number"==typeof t){n.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(t));case 10:if("string"==typeof r){n.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return n.next=14,this.httpClient.post("/mute/p2p",{data:{sender_token:e,sender_organization:r,receiver_organization:s,duration:t.toString()}});case 14:case"end":return n.stop()}},n,this)}));return e}()},{key:"unmuteUser",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,I["default"])(_["default"].mark(function n(e,t){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=r.recipientOrganizationId,u=void 0===o?t:o;return _["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if("string"==typeof e){n.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:return n.next=10,this.httpClient.del("/mute/p2p",{headers:{"TT-X-Sender-Token":e,"TT-X-Sender-Organization":t,"TT-X-Receiver-Organization":u}});case 10:case"end":return n.stop()}},n,this)}));return e}()},{key:"muteGroup",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,I["default"])(_["default"].mark(function n(e,t,r){return _["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("number"==typeof t){n.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(t));case 4:if("string"==typeof r){n.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e){n.next=8;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 8:if("number"==typeof t){n.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(t));case 10:if("string"==typeof r){n.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return n.next=14,this.httpClient.post("/mute/group/:groupId",{urlParams:{groupId:e},data:{duration:t.toString(),receiver_organization:r}});case 14:case"end":return n.stop()}},n,this)}));return e}()},{key:"unmuteGroup",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,I["default"])(_["default"].mark(function n(e,t){return _["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if("string"==typeof e){n.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:return n.next=10,this.httpClient.del("/mute/group/:groupId",{urlParams:{groupId:e},headers:{"TT-X-Receiver-Organization":t}});case 10:case"end":return n.stop()}},n,this)}));return e}()},{key:"muteOrganization",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,I["default"])(_["default"].mark(function n(e,t){return _["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("number"==typeof t){n.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(t));case 4:if("string"==typeof e){n.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("number"==typeof t){n.next=8;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(t));case 8:return n.next=10,this.httpClient.post("/mute/organization/:organizationId",{urlParams:{organizationId:e},data:{duration:t.toString(),receiver_organization:e}});case 10:case"end":return n.stop()}},n,this)}));return e}()},{key:"unmuteOrganization",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,I["default"])(_["default"].mark(function n(e){return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return t.next=6,this.httpClient.del("/mute/organization/:organizationId",{urlParams:{organizationId:e},headers:{"TT-X-Receiver-Organization":e}});case 6:case"end":return t.stop()}},n,this)}));return e}()}]),t}(q["default"]),o(p.prototype,"muteUser",[u],(0,E["default"])(p.prototype,"muteUser"),p.prototype),o(p.prototype,"unmuteUser",[s],(0,E["default"])(p.prototype,"unmuteUser"),p.prototype),o(p.prototype,"muteGroup",[c],(0,E["default"])(p.prototype,"muteGroup"),p.prototype),o(p.prototype,"unmuteGroup",[f],(0,E["default"])(p.prototype,"unmuteGroup"),p.prototype),o(p.prototype,"muteOrganization",[l],(0,E["default"])(p.prototype,"muteOrganization"),p.prototype),o(p.prototype,"unmuteOrganization",[d],(0,E["default"])(p.prototype,"unmuteOrganization"),p.prototype),p);t["default"]=U,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,p["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,p["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f=n(7),l=r(f),d=n(6),p=r(d),y=n(10),g=r(y),h=n(11),v=r(h),m=n(9),b=r(m),w=n(8),E=r(w),x=n(3),_=r(x),k=n(1),I=r(k),T=n(2),O=r(T),j=n(5),A=r(j),M=n(4),G=r(M),V=n(21),z=r(V),C=(u=(0,V.recoverFromNotFound)(),s=(0,V.recoverFromNotFound)(),c=function(e){function t(){return(0,I["default"])(this,t),(0,A["default"])(this,(0,_["default"])(t).apply(this,arguments))}return(0,G["default"])(t,e),(0,O["default"])(t,[{key:"find",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,E["default"])(b["default"].mark(function n(e,t){var r;return b["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if("string"==typeof e){n.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:return n.next=10,this.httpClient.get("/user/:userId/organization/:id",{urlParams:{userId:e,id:t}});case 10:return r=n.sent,n.abrupt("return",r.data);case 12:case"end":return n.stop()}},n,this)}));return e}()},{key:"findAllOfUser",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,E["default"])(b["default"].mark(function n(e){var t;return b["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){n.next=4;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return n.next=6,this.httpClient.get("/user/:userId/organization",{urlParams:{userId:e}});case 6:return t=n.sent,n.abrupt("return",t.data);case 8:case"end":return n.stop()}},n,this)}));return e}()}]),t}(z["default"]),o(c.prototype,"find",[u],(0,v["default"])(c.prototype,"find"),c.prototype),o(c.prototype,"findAllOfUser",[s],(0,v["default"])(c.prototype,"findAllOfUser"),c.prototype),c);t["default"]=C,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),u=r(i),s=n(6),c=r(s),f=n(10),l=r(f),d=n(145),p=r(d),y=n(9),g=r(y),h=n(8),v=r(h),m=n(3),b=r(m),w=n(1),E=r(w),x=n(2),_=r(x),k=n(5),I=r(k),T=n(4),O=r(T),j=n(21),A=r(j),M=["user","distributionList"],G=function(e){function t(){return(0,E["default"])(this,t),(0,I["default"])(this,(0,b["default"])(t).apply(this,arguments))}return(0,O["default"])(t,e),(0,_["default"])(t,[{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,v["default"])(g["default"].mark(function n(){var e;return g["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.httpClient.get("/roster");case 2:return e=t.sent,t.abrupt("return",e.data);case 4:case"end":return t.stop()}},n,this)}));return e}()},{key:"add",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,v["default"])(g["default"].mark(function n(e,t,r){var i,u;return g["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if("string"==typeof r){n.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof e){n.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 8:if("string"==typeof t){n.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 10:if("string"==typeof r){n.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:if((0,p["default"])(M,e)){n.next=14;break}return n.abrupt("return");case 14:return i={},r&&(i["TT-X-Organization-Key"]=r),u=this.host.typeNSByModelName(e),n.next=19,this.httpClient.post("/roster",{headers:i,data:{entity:t,type:u}});case 19:case"end":return n.stop()}},n,this)}));return e}()},{key:"remove",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,v["default"])(g["default"].mark(function n(e,t,r){var i,u;return g["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if("string"==typeof r){n.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof e){n.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 8:if("string"==typeof t){n.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 10:if("string"==typeof r){n.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:if((0,p["default"])(M,e)){n.next=14;break}return n.abrupt("return");case 14:return i={},r&&(i["TT-X-Organization-Key"]=r),u=this.host.typeNSByModelName(e),n.next=19,this.httpClient.del("/roster/:counterPartyId",{headers:i,urlParams:{counterPartyId:t},data:{type:u}});case 19:case"end":return n.stop()}},n,this)}));return e}()}]),t}(A["default"]);t["default"]=G,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var o=(0,d["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,y["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var o=(0,d["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,y["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c=n(7),f=r(c),l=n(6),d=r(l),p=n(10),y=r(p),g=n(11),h=r(g),v=n(9),m=r(v),b=n(8),w=r(b),E=n(3),x=r(E),_=n(1),k=r(_),I=n(2),T=r(I),O=n(5),j=r(O),A=n(4),M=r(A),G=n(21),V=r(G),z=(u=(0,G.recoverFromNotFound)(),s=function(e){function t(){return(0,k["default"])(this,t),(0,j["default"])(this,(0,x["default"])(t).apply(this,arguments))}return(0,M["default"])(t,e),(0,T["default"])(t,[{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,w["default"])(m["default"].mark(function n(e){var t;return m["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){n.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return n.next=6,this.httpClient.get("/user/:id",{urlParams:{id:e}});case 6:return t=n.sent,n.abrupt("return",t.data);case 8:case"end":return n.stop()}},n,this)}));return e}()}]),t}(V["default"]),o(s.prototype,"find",[u],(0,h["default"])(s.prototype,"find"),s.prototype),s);t["default"]=z,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Roster:n(77),Users:n(78),Groups:n(72),Organizations:n(76),Messages:n(73),Metadata:n(74),Mute:n(75)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(3),u=r(i),s=n(1),c=r(s),f=n(5),l=r(f),d=n(4),p=r(d),y=(a=o=function(e){function t(e,n,r){(0,c["default"])(this,t);var o=(0,l["default"])(this,(0,u["default"])(t).call(this,r));return o.code=t.CODE,o.resource=e,o.id=n,o}return(0,p["default"])(t,e),t}(Error),o.CODE="not-found",a);t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(3),u=r(i),s=n(1),c=r(s),f=n(5),l=r(f),d=n(4),p=r(d),y=(a=o=function(e){function t(){var e;(0,c["default"])(this,t);for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var a=(0,l["default"])(this,(e=(0,u["default"])(t)).call.apply(e,[this].concat(r)));
return a.code=t.CODE,a}return(0,p["default"])(t,e),t}(Error),o.CODE="not-signed-in",a);t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(3),u=r(i),s=n(1),c=r(s),f=n(5),l=r(f),d=n(4),p=r(d),y=(a=o=function(e){function t(e,n,r){var o=arguments.length<=3||void 0===arguments[3]?"can't perform action "+r+" on "+(e.name||e)+" #"+n:arguments[3];(0,c["default"])(this,t);var a=(0,l["default"])(this,(0,u["default"])(t).call(this,o));return a.code=t.CODE,a.resource=e,a.action=r,a.id=n,a}return(0,p["default"])(t,e),t}(Error),o.CODE="permission-denied",a);t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(3),u=r(i),s=n(1),c=r(s),f=n(2),l=r(f),d=n(5),p=r(d),y=n(4),g=r(y),h=(a=o=function(e){function t(e){return(0,c["default"])(this,t),(0,p["default"])(this,(0,u["default"])(t).call(this,"method"+(e?" "+e:"")+" not supported in target node"))}return(0,g["default"])(t,e),(0,l["default"])(t,null,[{key:"raise",value:function(e){throw new this(e)}}]),t}(Error),o.CODE="target-not-supported",a);t["default"]=h,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(3),u=r(i),s=n(1),c=r(s),f=n(5),l=r(f),d=n(4),p=r(d),y=(a=o=function(e){function t(){var e;(0,c["default"])(this,t);for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var a=(0,l["default"])(this,(e=(0,u["default"])(t)).call.apply(e,[this].concat(r)));return a.code=t.CODE,a}return(0,p["default"])(t,e),t}(Error),o.CODE="wrong-credentials",a);t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(44),a=r(o);t["default"]=function(e){var t=e.defineModel("conversation",{instanceEvents:!0,transientAttrs:["messages","timeline","lastMessage","unreadCount","unreadMessages","lastEventMessageSortNumber","_counterPartyAddedOnServer"],defaultValues:{lastEventMessageSortNumber:0,messages:[],timeline:[],unreadMessages:[],unreadCount:0},computed:{counterParty:{enumerable:!0,get:function(){return this.counterPartyType&&this.counterPartyId?e.store.get(this.counterPartyType,this.counterPartyId):null},set:function(e){if(e)switch(e.$entityType){case"user":case"group":this.counterPartyId=e.id,this.counterPartyType=e.$entityType;break;default:throw new Error("unsupported counterPartyType '"+e.$entityType+"'")}else this.counterPartyId=null,this.counterPartyType=null}},lastMessageId:{enumerable:!0,get:function(){return(0,a["default"])(this.lastMessage,"id")}},muteSettings:{enumerable:!0,get:function(){return e.host.mute.getByConversationId(this.id)}},isMuted:{enumerable:!0,get:function(){return!!this.muteSettings}}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}});return t};var i=n(34);r(i),e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=n(18),a=r(o),i=n(27),u=r(i),s=n(1),c=r(s),f=n(2),l=r(f),d=function(){function e(t,n,r,o){var i=this;(0,c["default"])(this,e),this.id=t,this.type=n,this.data=r,o&&!function(){var e=o._origData,t=(0,u["default"])(o,["_origData"]);Object.defineProperty(i,"_origData",{get:function(){return e}}),(0,a["default"])(i,t)}()}return(0,l["default"])(e,null,[{key:"is",value:function(e){return e instanceof this}}]),e}();t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(44),a=r(o);t["default"]=function(e,t){function n(n){var r;e.ensureEntityOrCreateTemporaryAndFind("user",{id:n,displayName:"Loading..."},{onlyPlaceholder:!0,finder:(r=t.host.users).find.bind(r)})}function r(e){e.memberIds&&e.memberIds.forEach(n)}function o(e){e&&e.forEach(n)}var i=e.defineModel("group",{replaceKeys:{organizationKey:"organizationId",members:"memberIds",avatar:"avatarUrl",displayName:"name",numMembers:"__memberCount",createdTime:"createdAt"},transientAttrs:["__memberCount"],defaultValues:{memberIds:[],memberCount:0,groupType:s.GroupType.GROUP},validate:function(){f["default"].notEmpty("groupType",this.groupType)},__extractGroupTypeFromAttrs:function(e){return"tigertext:entity:list"==(e.type||e.xmlns)?s.GroupType.DISTRIBUTION_LIST:e.isPublic?s.GroupType.ROOM:null},parseAttrs:function(e){var t=this.__extractGroupTypeFromAttrs(e);return t&&(e.groupType=t),"createdAt"in e&&(e.createdAt=new Date(e.createdAt)),e},beforeCreateInstance:function(e){o(e.memberIds)},computed:{memberCount:{enumerable:!0,get:function(){return this.memberIds&&this.memberIds.length||this.__memberCount||0}},metadata:{enumerable:!0,get:function(){var t=e.store.get("metadata",this.id+":"+this.organizationId);return t?t.data:null}},members:{enumerable:!0,get:function(){return this.memberIds?this.memberIds.map(function(t){return e.store.get("user",t)}):[]}},conversation:{enumerable:!0,get:function(){return t.host.conversations.get("group",this.id,this.organizationId)}},conversationId:{enumerable:!0,get:function(){return(0,a["default"])(t.host.conversations.get("group",this.id,this.organizationId),"id")}},displayName:{configurable:!0,enumerable:!0,get:function(){return this.name}}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}});return(0,u["default"])(e,i,{before:function(e,t,n){t&&r(t)},after:function(e,t){r(e)}}),i};var i=n(35),u=r(i),s=n(25),c=n(26),f=r(c);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){var t=e.defineModel("message",{replaceKeys:{messageId:"id",clientId:"id",senderToken:"senderId",sender:"senderId",recipientToken:"recipientId",recipient:"recipientId",senderOrganization:"senderOrganizationId",recipientOrganization:"recipientOrganizationId",groupToken:"groupId",originalSender:"originalSenderId",originalTimestamp:"originalForwardedMessageCreatedAt",status:"recipientStatus",data:"metadata",createdTime:"createdAt"},defaultValues:{recipientStatus:o.MessageRecipientStatus.NEW,senderStatus:o.MessageRecipientStatus.NEW,sortNumber:0,messageType:o.MessageType.USER_SENT},fields:{id:{type:"string"},senderStatus:{type:"enum","enum":o.MessageSenderStatus,require:!0},recipientStatus:{type:"enum","enum":o.MessageRecipientStatus,require:!0},direction:{type:"enum","enum":o.MessageDirection,require:!0},priority:{type:"enum","enum":o.MessagePriority},counterPartyId:{type:"string",require:!0},counterPartyType:{type:"enum",values:["user","group"],require:!0},createdAt:{type:Date,require:!0}},parseAttrs:function(e){if(e.recipientStatus&&(e.recipientStatus=o.MessageRecipientStatus.resolve(e.recipientStatus)),"attachmentName"in e){var t=e.attachmentName;delete e.attachmentName,Array.isArray(e.attachments)&&e.attachments.length>0&&t&&(e.attachments[0].name=t)}if(Array.isArray(e.attachments)&&e.attachments.forEach(function(e,t){return e.id=""+(t+1)}),"priority"in e&&(e.priority=o.MessagePriority.resolve(e.priority)),"createdAt"in e&&"string"==typeof e.createdAt&&(e.createdAt=new Date(e.createdAt)),"ttl"in e&&e.createdAt){var n=(0,i["default"])(e.createdAt).add(e.ttl,"minute").toDate().getTime();e.expiresAt=n}return e},relations:{belongsTo:{sender:{type:"user",foreignKey:"senderId"},recipient:{type:"user",foreignKey:"recipientId"},originalSender:{type:"user",foreignKey:"originalSenderId"},senderOrganization:{type:"organization",foreignKey:"senderOrganizationId"},recipientOrganization:{type:"organization",foreignKey:"recipientOrganizationId"},group:{type:"group",foreignKey:"groupId"},conversation:{type:"conversation",foreignKey:"conversationId"}},hasMany:{statusesPerRecipient:{type:"messageStatusPerRecipient",foreignKey:"messageId"}}},computed:{counterParty:{enumerable:!0,get:function(){return this.counterPartyType&&this.counterPartyId?e.store.get(this.counterPartyType,this.counterPartyId):null},set:function(e){if(e){switch(e.$entityType){case"user":this.recipientId=e.id;break;case"group":this.groupId=e.id;break;default:throw new Error("unsupported counterPartyType '"+e.$entityType+"'")}this.counterPartyId=e.id,this.counterPartyType=e.$entityType}else this.counterPartyId=null,this.counterPartyType=null}}}});return t};var o=n(25),a=n(48),i=r(a);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){var t=e.defineModel("messageStatusPerRecipient",{replaceKeys:{accountId:"userId",timestamp:"createdAt"},defaultValues:{status:a["default"].NEW},fields:{userId:{type:String,require:!0},messageId:{type:String,require:!0},recipientStatus:{type:"enum","enum":a["default"],require:!0},createdAt:{type:Date,require:!0}},parseAttrs:function(e){return e.status&&(e.status=a["default"].resolve(e.status)),e},relations:{belongsTo:{message:{type:"message",foreignKey:"messageId"},user:{type:"user",foreignKey:"userId"}}}});return t};var o=n(34),a=r(o);e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){var n=e.defineModel("metadata",{fields:{entityType:{type:"string",required:!0},entityId:{type:"string",required:!0},organizationId:{type:"string",required:!0}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}},parseAttrs:function(e,t){return e.data=t.data,e}});return n},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){var n=e.defineModel("organization",{instanceEvents:!0,replaceKeys:{members:"memberCount"},fields:{},transientAttrs:["conversations","unreadCount"],defaultValues:{conversations:[]}});return(0,a["default"])(e,n,{before:function(e,t,n){},after:function(e,t){}}),n};var o=n(35),a=r(o);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=n(1),a=r(o),i=n(2),u=r(i),s=function(){function e(t,n){(0,a["default"])(this,e),this.id="searchResult:"+n+":"+t.id,this.entityType=t.$entityType,this.entityId=t.id,this.entity=t,this.organizationId=n}return(0,u["default"])(e,null,[{key:"is",value:function(e){return e instanceof this}}]),e}();t["default"]=s,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){var n=e.defineModel("user",{transientAttrs:[],replaceKeys:{avatar:"avatarUrl"},defaultValues:{},computed:{metadataByOrganizationId:{enumerable:!0,get:function(){var t;return(t=(t=(t=e.store.getAll("metadata"),c["default"]).call(t,{entityId:this.id}),l["default"]).call(t,"organizationId"),p["default"]).call(t,"data")}},presence:{enumerable:!0,get:function(){return e.host.presence.get(this.id)||u["default"].UNKNOWN}}}});return(0,a["default"])(e,n,{before:function(e,t,n){},after:function(e,t){}}),n};var o=n(35),a=r(o),i=n(50),u=r(i),s=n(28),c=r(s),f=n(131),l=r(f),d=n(132),p=r(d);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),a=r(o),i=new a["default"](["GROUP","ROOM","DISTRIBUTION_LIST"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),a=r(o),i=new a["default"](["INCOMING","OUTGOING"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),o=new r.ServerValueEnum({LOW:{serverValue:-1},NORMAL:{serverValue:0},HIGH:{serverValue:1}},{defaultValue:"NORMAL"});t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),a=r(o),i=new a["default"](["SENDING","SENT","FAILED","NEW","NA"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),a=r(o),i=new a["default"](["USER_SENT","GROUP_MEMBERSHIP_CHANGE"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={User:n(93),Group:n(87),Organization:n(91),Message:n(88),MessageStatusPerRecipient:n(89),Conversation:n(85),Metadata:n(90)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,m["default"])(e);if(!Array.isArray(e)){var o=(0,h["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,m["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,m["default"])(e);if(!Array.isArray(e)){var o=(0,h["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,m["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f,l,d,p=n(7),y=r(p),g=n(6),h=r(g),v=n(10),m=r(v),b=n(11),w=r(b),E=n(39),x=r(E),_=n(24),k=r(_),I=n(151),T=r(I),O=n(42),j=r(O),A=n(46),M=r(A),G=n(27),V=r(G),z=n(9),C=r(z),S=n(15),P=r(S),q=n(8),U=r(q),N=n(47),$=r(N),R=n(3),F=r(R),D=n(1),B=r(D),L=n(2),K=r(L),Z=n(5),W=r(Z),H=n(4),X=r(H),Y=n(12),Q=r(Y),J=n(16),ee=n(57),te=r(ee),ne=n(68),re=r(ne),oe=n(23),ae=r(oe),ie=n(13),ue=n(25),se=n(126),ce=r(se),fe=n(26),le=r(fe),de=n(28),pe=r(de),ye=n(41),ge=r(ye),he=n(14),ve=new te["default"].MD5,me=(u=(0,J.decorator)(),s=(0,J.decorator)(),c=(0,J.decorator)(),f=(0,J.decorator)(),(0,ie.classWithPrivateMethods)((d=function(e){function t(){var e;(0,B["default"])(this,t);for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var a=(0,W["default"])(this,(e=(0,F["default"])(t)).call.apply(e,[this].concat(r)));return a._throtelled__flushConversationsToReload=a.config.conversationReloadDelay?a._throtelled__flushConversationsToReload=(0,$["default"])(a.__flushConversationsToReload,a.config.conversationReloadDelay,{leading:!1}):a.__flushConversationsToReload,a}return(0,X["default"])(t,e),(0,K["default"])(t,[{key:"mounted",value:function(){this._fetched=!1,this.host.on("message:sending",this._onMessageSending),this.host.on("message:sent",this._onMessageSent),this.host.models.Message.on("afterInject",this._onMessageChange),this.host.models.Message.on("afterEject",this._onMessageChange),this.host.models.Group.on("afterEject",this._onGroupDelete),this.__queuedConversationsToReload=[]}},{key:"dispose",value:function(){this._fetched=!1,this.host.removeListener("message:sending",this._onMessageSending),this.host.removeListener("message:sent",this._onMessageSent),this.host.models.Message.off("afterInject",this._onMessageChange),this.host.models.Message.off("afterEject",this._onMessageChange),this.host.models.Group.off("afterEject",this._onGroupDelete),this.__queuedConversationsToReload=null,this._throtelled__flushConversationsToReload.cancel&&this._throtelled__flushConversationsToReload.cancel()}},{key:"findAll",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,U["default"])(C["default"].mark(function n(){var e,t,r=this,o=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return C["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(o=(0,P["default"])(o,{includeMutes:!0}),!this._fetched){n.next=3;break}return n.abrupt("return",this.getAll());case 3:return n.next=5,this.host.api.roster.findAll();case 5:if(e=n.sent,t=e.map(function(e){var t=r.host.injectModel(e);delete t.$temporary;var n=e.organization_key;return{counterParty:t,organizationId:n}}).map(function(e){var t=e.counterParty,n=e.organizationId,o=r.ensureConversation(t.$entityType,t.id,n);return o._counterPartyAddedOnServer=!0,o}),!o.includeMutes){n.next=10;break}return n.next=10,this.host.mute.findAll();case 10:return this._fetched=!0,n.abrupt("return",t);case 12:case"end":return n.stop()}},n,this)}));return e}()},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,U["default"])(C["default"].mark(function n(e){var t;return C["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){n.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:if(t=this.getById(e),!t){n.next=7;break}return n.abrupt("return",t);case 7:return n.next=9,this.findAll();case 9:return n.abrupt("return",this.getById(e));case 10:case"end":return n.stop()}},n,this)}));return e}()},{key:"refetch",value:function(){function e(){return t.apply(this,arguments)}var t=(0,U["default"])(C["default"].mark(function n(){return C["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._fetched=!1,e.abrupt("return",this.findAll());case 2:case"end":return e.stop()}},n,this)}));return e}()},{key:"add",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,U["default"])(C["default"].mark(function n(e,t,r){var o,u,s;return C["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if("string"==typeof r){n.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e){n.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 8:if("string"==typeof t){n.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 10:if("string"==typeof r){n.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return o={},r&&(o["TT-X-Organization-Key"]=r),u=this.host.typeNSByModelName(e),s=this.ensureConversation(e,t,r),n.prev=16,n.next=19,this.host.api.roster.add(e,t,r);case 19:n.next=24;break;case 21:n.prev=21,n.t0=n["catch"](16),this.logger.warn("can't add "+t+" "+u,n.t0);case 24:s._counterPartyAddedOnServer=!0;case 25:case"end":return n.stop()}},n,this,[[16,21]])}));return e}()},{key:"remove",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,U["default"])(C["default"].mark(function n(e,t,r){var o,u;return C["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if("string"==typeof r){n.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e){n.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 8:if("string"==typeof t){n.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 10:if("string"==typeof r){n.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return o={},r&&(o["TT-X-Organization-Key"]=r),u=this.host.typeNSByModelName(e),n.prev=15,n.next=18,this.host.api.roster.remove(e,t,r);case 18:this.ejectConversation(e,t,r),n.next=24;break;case 21:n.prev=21,n.t0=n["catch"](15),this.logger.warn("can't remove "+t+" "+u);case 24:case"end":return n.stop()}},n,this,[[15,21]])}));return e}()},{key:"ensureConversation",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=this.getConversationKey(e,t,n),o=this.get(e,t,n);return o?(this.__ensureEntities(o),o):(o=this.host.models.Conversation.createInstance({id:r,counterPartyType:e,counterPartyId:t,organizationId:n,_origIndex:this.host.models.Conversation.getAll().length}),this.__ensureEntities(o),this.host.models.Conversation.inject(o),this.__notifyOrganizationChange(o.organizationId),o)}},{key:"ejectConversation",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=this.get(e,t,n);return r&&(this.host.models.Conversation.eject(r),"group"===e&&this.host.models.Group.eject(t),this.__notifyOrganizationChange(r.organizationId)),r}},{key:"reactToIncomingMessageEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.host.getCurrentUser().id,n=this.host.models.Message.parseAttrs(e.data);n.messageType=ue.MessageType.USER_SENT,n.direction=n.senderId==t?ue.MessageDirection.OUTGOING:ue.MessageDirection.INCOMING,n.groupId?(n.counterPartyType="group",n.counterPartyId=n.groupId):n.recipientId&&(n.counterPartyType="user",n.counterPartyId=n.senderId==t?n.recipientId:n.senderId),n.direction==ue.MessageDirection.OUTGOING?n.senderStatus=ue.MessageSenderStatus.SENT:n.senderStatus=ue.MessageSenderStatus.NA;var r=this.host.conversations.ensureConversation(n.counterPartyType,n.counterPartyId,n.recipientOrganizationId);n.conversationId=r.id;var o=this.host.models.Message.createInstance(n);this.__ensureMessageEntities(o),this.host.models.Message.inject(o),this.emit("message",o),this.__addConversationCounterPartyToServerRosterIfShould(r),this.__queueReload(r),r.emit("message",o),this.__notifyOrganizationChange(r.organizationId),o.senderId!=t&&o.recipientStatus!=ue.MessageRecipientStatus.READ&&o.recipientStatus!=ue.MessageRecipientStatus.DELIVERED&&this.host.messages.markAsReceived(o)}},{key:"reactToFriendsEvent",value:function(e){var t=e.data.friend,n=t.action,r=t.organization_id,o=(0,V["default"])(t,["action","organization_id"]),a=r,i=this.host.modelByTypeNS(o.xmlns);if(!i)return void this.logger.error("Class "+o.xmlns+" not found");switch(n){case"add":"group"==i.name&&(o.organizationId=a);var u=this.host.injectModel(o);this.__addedByCounterParty(u,a);break;case"del":this.__removedByCounterParty(i.name,o.token,a);break;default:this.logger.error("friends action not implemented",n,e.data)}}},{key:"_onMessageSending",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.__ensureConversationFromMessage(e);this.__addConversationCounterPartyToServerRosterIfShould(t),this.__reloadConversation(t),this.__notifyOrganizationChange(t.organizationId)}},{key:"_onMessageSent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId);this.__reloadConversation(t),t.emit("message",e)}},{key:"_onMessageChange",value:function(e,t){t.conversation&&this.__queueReload(t.conversation)}},{key:"_onGroupDelete",value:function(e,t){this.ejectConversation("group",t.id,t.organizationId)}},{key:"__queueReload",value:function(e){!this.__queuedConversationsToReload.includes(e)&&this.__queuedConversationsToReload.push(e),this._throtelled__flushConversationsToReload()}},{key:"__flushConversationsToReload",value:function(){var e=this;this.__queuedConversationsToReload.forEach(function(t){return e.__reloadConversation(t)}),this.__queuedConversationsToReload.length=0}},{key:"__reloadConversation",value:function(e){var t,n=(0,M["default"])(e,["messages","timeline","lastMessage","unreadMessages","unreadCount","lastEventMessageSortNumber"]),r={},o=(t=(t=this.host.models.Message.getAll(),pe["default"]).call(t,{conversationId:e.id}),ge["default"]).call(t,["sortNumber"],["asc"]),a=(0,j["default"])(o,{messageType:ue.MessageType.USER_SENT});r.timeline=o,r.messages=a,r.lastMessage=(0,T["default"])(a),r.unreadMessages=a.filter(function(e){return e.direction===ue.MessageDirection.INCOMING&&(e.recipientStatus===ue.MessageRecipientStatus.NEW||e.recipientStatus===ue.MessageRecipientStatus.DELIVERED)}),r.unreadCount=r.unreadMessages.length,r.lastEventMessageSortNumber=r.lastMessage&&r.lastMessage.sortNumber||0;var i=!1;(0,k["default"])(n,function(t,n){(0,re["default"])(t,r[n])||(e[n]=r[n],i=!0)}),i&&(this.host.models.Conversation.inject(e),e.emit("change"),this.emit("change",e))}},{key:"__notifyOrganizationChange",value:function(e){var t=this.host.models.Organization.get(e);t&&t.emit("change")}},{key:"__ensureConversationFromMessage",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId);return t}},{key:"__addConversationCounterPartyToServerRosterIfShould",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));e&&(e._counterPartyAddedOnServer||this.add(e.counterPartyType,e.counterPartyId,e.organizationId))}},{key:"addMembershipChangeLog",value:function(e){var t=this.ensureConversation("group",e.group.id,e.group.organizationId);this.host.models.Message.inject({id:e.id,conversationId:t.id,groupId:e.groupId,sortNumber:e.sortNumber,messageType:ue.MessageType.GROUP_MEMBERSHIP_CHANGE,senderId:e.actorId,recipient:this.host.getCurrentUser(),direction:ue.MessageDirection.INCOMING,groupMembersChange:{action:e.action,members:e.members,memberIds:e.memberIds},body:this.__generateGroupMembershipChangeBody(e),createdAt:e.createdAt}),this.__reloadConversation(t)}},{key:"__generateGroupMembershipChangeBody",value:function(e){var t,n;this.__ACTION_TEXT=this.__ACTION_TEXT||(t={},(0,x["default"])(t,"ADD","added"),(0,x["default"])(t,"REMOVE","removed"),(0,x["default"])(t,"LEAVE","left"),(0,x["default"])(t,"JOIN","joined"),t),this.__ACTION_PREPOSITION=this.__ACTION_PREPOSITION||(n={},(0,x["default"])(n,"ADD","to"),(0,x["default"])(n,"REMOVE","from"),n);var r=this.__ACTION_TEXT[e.action],o=this.__ACTION_PREPOSITION[e.action]||"",a=null;return"ADD"!==e.action&&"REMOVE"!==e.action||(a=(0,ce["default"])(e.members.filter(Boolean).map(function(e){return e.displayName}))),[e.actor.displayName,r,a,o,"this group"].filter(Boolean).join(" ")}},{key:"getMessageConversationKey",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if(e.groupId)return this.conversationHashForGroupId(e.groupId);
var t=e.senderId==this.host.getCurrentUser().id?e.recipientId:e.senderId;return this.conversationHashForUserMessage(t,e.senderOrganizationId,e.recipientOrganizationId)}},{key:"getConversationKey",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?n:arguments[3];if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(n));if(null!=r&&"string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(r));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(n));if(null!=r&&"string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(r));switch(e){case"user":return this.conversationHashForUserMessage(t,n,r);case"group":return this.conversationHashForGroupId(t);default:throw new Error("type "+e+" not supported in conversation")}}},{key:"conversationHashForUserMessage",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?t:arguments[2];if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(n));var r=[e,t,n].join(":");return ve.b64(r)}},{key:"conversationHashForGroupId",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return ve.b64(e)}},{key:"looksLikeConversationId",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return/^[a-zA-Z0-9\/+=]{24}$/.test(e)}},{key:"findConversationWithUser",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,U["default"])(C["default"].mark(function n(e,t){return C["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if("string"==typeof e){n.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:return n.abrupt("return",this.get(this.host.models.User.name,e,t));case 9:case"end":return n.stop()}},n,this)}));return e}()},{key:"findConversationWithGroup",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,U["default"])(C["default"].mark(function n(e,t){return C["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if("string"==typeof e){n.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:return n.abrupt("return",this.get(this.host.models.Group.name,e,t));case 9:case"end":return n.stop()}},n,this)}));return e}()},{key:"findAllGroupConversationsWithMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,U["default"])(C["default"].mark(function n(e,t){var r,o=this;return C["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){n.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){n.next=6;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:return e=(0,he.arrayWrap)(e).map(this._resolveModelId.bind(this)),n.next=11,this.host.groups.findAllWithSpecificMembers(e,t);case 11:return r=n.sent,n.abrupt("return",r.map(function(e){return o.get(o.host.models.Group.name,e.id,t)}));case 13:case"end":return n.stop()}},n,this)}));return e}()},{key:"getWithGroup",value:function(e,t){var n=t.createIfNotFound,r=void 0===n?!1:n,o=t.organizationId;if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(null==arguments[1]||null!=arguments[1].createIfNotFound&&"boolean"!=typeof arguments[1].createIfNotFound||null!=arguments[1].organizationId&&"string"!=typeof arguments[1].organizationId)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{ createIfNotFound: ?bool;\n  organizationId: ?string;\n}\n\nGot:\n"+i(arguments[1]));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if(null==arguments[1]||null!=arguments[1].createIfNotFound&&"boolean"!=typeof arguments[1].createIfNotFound||null!=arguments[1].organizationId&&"string"!=typeof arguments[1].organizationId)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{ createIfNotFound: ?bool;\n  organizationId: ?string;\n}\n\nGot:\n"+a(arguments[1]));e=this._resolveModelId(e);var u=this.conversationHashForGroupId(e),s=this.getById(u);if(!s&&r){var c=this.host.groups.getById(e);c?o=c.organizationId:le["default"].notEmpty("organizationId",o,"required when using createIfNotFound"),s=this.ensureConversation("group",e,o)}return s||null}},{key:"getWithUser",value:function(e,t,n){var r=n.createIfNotFound,o=void 0===r?!1:r;if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));if(null==arguments[2]||null!=arguments[2].createIfNotFound&&"boolean"!=typeof arguments[2].createIfNotFound)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ createIfNotFound: ?bool\n}\n\nGot:\n"+i(arguments[2]));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));if(null==arguments[2]||null!=arguments[2].createIfNotFound&&"boolean"!=typeof arguments[2].createIfNotFound)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ createIfNotFound: ?bool\n}\n\nGot:\n"+a(arguments[2]));e=this._resolveModelId(e),t=this._resolveModelId(t);var u=this.conversationHashForUserMessage(e,t),s=this.getById(u);return!s&&o&&(s=this.ensureConversation("user",e,t)),s||null}},{key:"get",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=this.getConversationKey(e,t,n),o=this.host.models.Conversation.get(r);return o||null}},{key:"getAll",value:function(){return this.host.models.Conversation.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Conversation.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Conversation.getMulti(e)}},{key:"__addedByCounterParty",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));this.ensureConversation(e.$entityType,e.id,t)}},{key:"__removedByCounterParty",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));this.ejectConversation(e,t,n)}},{key:"__ensureEntities",value:function(e){var t,n,r=this;this.host.models.Organization.ensureEntityOrCreateTemporaryAndFind({id:e.organizationId,name:"Loading..."},{finder:(t=this.host.organizations).find.bind(t),onMissing:function(){r.logger.info("org "+e.organizationId+" not found, created temporary org"),e.$loadingOrganization=!0},onLoad:function(t){r.logger.info("org "+e.organizationId+" loaded"),e.$loadingOrganization=!1}});var o={id:e.counterPartyId},a=void 0;switch(e.counterPartyType){case"user":o.displayName="Loading...",a=(n=this.host.users).find.bind(n);break;case"group":o.displayName="Loading group...",o.organizationId=e.organizationId,a=(n=this.host.groups).find.bind(n);break;default:throw new Error("unsupported counterPartyType",e.counterPartyType)}this.host.store.store.models[e.counterPartyType].ensureEntityOrCreateTemporaryAndFind(o,{finder:a,onMissing:function(){r.logger.info("entry "+e.counterPartyId+" not found, created temporary on org "+e.organizationId),e.$loadingCounterParty=!0},onLoad:function(t){e.$loadingCounterParty=!1,r.__fireChange("update",e)}}),this.__fireChange("add",e)}},{key:"__ensureMessageEntities",value:function(e){var t,n=this,r=this.host.getCurrentUser().id,o=e.senderId==r?e.recipientId:e.senderId;o&&this.host.models.User.ensureEntityOrCreateTemporaryAndFind({id:o,displayName:"Loading..."},{finder:(t=this.host.users).find.bind(t),onlyPlaceholder:!!e.groupId,onMissing:function(){n.logger.info("message otherUser "+o+" not found, created temporary"),e.$loadingOtherUser=!0},onLoad:function(t){e.$loadingOtherUser=!1,n.__fireChange("update",e.conversation)}})}},{key:"__fireChange",value:function(e,t){}}]),t}(Q["default"]),o(d.prototype,"findAll",[u],(0,w["default"])(d.prototype,"findAll"),d.prototype),o(d.prototype,"find",[s],(0,w["default"])(d.prototype,"find"),d.prototype),o(d.prototype,"add",[c],(0,w["default"])(d.prototype,"add"),d.prototype),o(d.prototype,"remove",[f],(0,w["default"])(d.prototype,"remove"),d.prototype),o(d.prototype,"_onMessageSending",[ie.privateMethod,ae["default"]],(0,w["default"])(d.prototype,"_onMessageSending"),d.prototype),o(d.prototype,"_onMessageSent",[ie.privateMethod,ae["default"]],(0,w["default"])(d.prototype,"_onMessageSent"),d.prototype),o(d.prototype,"_onMessageChange",[ie.privateMethod,ae["default"]],(0,w["default"])(d.prototype,"_onMessageChange"),d.prototype),o(d.prototype,"_onGroupDelete",[ie.privateMethod,ae["default"]],(0,w["default"])(d.prototype,"_onGroupDelete"),d.prototype),o(d.prototype,"__queueReload",[ie.privateMethod],(0,w["default"])(d.prototype,"__queueReload"),d.prototype),o(d.prototype,"__flushConversationsToReload",[ie.privateMethod,ae["default"]],(0,w["default"])(d.prototype,"__flushConversationsToReload"),d.prototype),o(d.prototype,"__reloadConversation",[ie.privateMethod],(0,w["default"])(d.prototype,"__reloadConversation"),d.prototype),o(d.prototype,"__notifyOrganizationChange",[ie.privateMethod],(0,w["default"])(d.prototype,"__notifyOrganizationChange"),d.prototype),o(d.prototype,"__ensureConversationFromMessage",[ie.privateMethod],(0,w["default"])(d.prototype,"__ensureConversationFromMessage"),d.prototype),o(d.prototype,"__addConversationCounterPartyToServerRosterIfShould",[ie.privateMethod],(0,w["default"])(d.prototype,"__addConversationCounterPartyToServerRosterIfShould"),d.prototype),o(d.prototype,"__generateGroupMembershipChangeBody",[ie.privateMethod],(0,w["default"])(d.prototype,"__generateGroupMembershipChangeBody"),d.prototype),o(d.prototype,"__addedByCounterParty",[ie.privateMethod],(0,w["default"])(d.prototype,"__addedByCounterParty"),d.prototype),o(d.prototype,"__removedByCounterParty",[ie.privateMethod],(0,w["default"])(d.prototype,"__removedByCounterParty"),d.prototype),o(d.prototype,"__ensureEntities",[ie.privateMethod],(0,w["default"])(d.prototype,"__ensureEntities"),d.prototype),o(d.prototype,"__ensureMessageEntities",[ie.privateMethod],(0,w["default"])(d.prototype,"__ensureMessageEntities"),d.prototype),o(d.prototype,"__fireChange",[ie.privateMethod],(0,w["default"])(d.prototype,"__fireChange"),d.prototype),l=d))||l);t["default"]=me,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=n(24),a=r(o),i=n(39),u=r(i),s=n(27),c=r(s),f=n(3),l=r(f),d=n(1),p=r(d),y=n(2),g=r(y),h=n(5),v=r(h),m=n(4),b=r(m),w=n(12),E=r(w),x=n(66),_=function(e){function t(e,n){var r;(0,p["default"])(this,t);var o=(0,v["default"])(this,(0,l["default"])(t).call(this,e,n));o.EVENTS=(r={},(0,u["default"])(r,"client_advisory",function(e){switch(e.data.advisory.name){case"replay_start":this.host.reactToAdvisoryEvent("replayStart",{replayMessageCount:e.data.advisory.replay_message_count});break;case"replay_stop":this.host.reactToAdvisoryEvent("replayStop")}}),(0,u["default"])(r,"message|group_message",function(e){this.host.conversations.reactToIncomingMessageEvent(e)}),(0,u["default"])(r,"message:status|group:message:status",function(e){this.host.messages.reactToMessageStatusEvent(e)}),(0,u["default"])(r,"friends",function(e){this.host.conversations.reactToFriendsEvent(e)}),(0,u["default"])(r,"presence",function(e){this.host.presence.reactToPresenceEvent(e)}),(0,u["default"])(r,"bang",function(e){this.host.groups.reactToBangEvent(e)}),(0,u["default"])(r,"update",function(e){var t=e.data,n=t.type,r=(0,c["default"])(t,["type"]);this.host.injectModel(r,n)}),(0,u["default"])(r,"account:settings",function(e){var t=this;e.data.services.forEach(function(n){switch(n.xmlns){case"tigertext:iq:update:account":var r=n.account||e.data.token;t.host.users.refresh(r);break;case"tigertext:iq:update:org_settings":t.host.organizations.refreshAll();break;default:t.logger.warn("unhandled account:settings service type "+n.xmlns)}})}),(0,u["default"])(r,"message:is_typing",function(e){this.host.typingStatus.reactToIsTypingEvent(e)}),(0,u["default"])(r,"push:credentials",function(e){}),(0,u["default"])(r,"remote_wipe",function(e){this.host.wipe()}),(0,u["default"])(r,"validated",function(e){this.logger.warn("validated not implemented")}),(0,u["default"])(r,"msg:metadata_update",function(e){this.logger.warn("msg:metadata_update not implemented")}),(0,u["default"])(r,"conversation_mute",function(e){this.host.mute.reactToMuteEvent(e)}),(0,u["default"])(r,"reconnect",function(e){this.host.events.reconnect()}),(0,u["default"])(r,"push:credentials",x.noop),(0,u["default"])(r,"sse:heartbeat",x.noop),r);var i=[];return(0,a["default"])(o.EVENTS,function(e,t){t.includes("|")&&(i.push(t),t.split("|").forEach(function(t){return o.EVENTS[t]=e}))}),i.forEach(function(e){return delete o.EVENTS[e]}),o}return(0,b["default"])(t,e),(0,g["default"])(t,[{key:"emit",value:function(e){this.EVENTS[e.type]?this.EVENTS[e.type].call(this,e):this.logger.error("unhandled event: "+e.type,e.data)}}]),t}(E["default"]);t["default"]=_,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a,i,u=n(11),s=r(u),c=n(31),f=r(c),l=n(6),d=r(l),p=n(9),y=r(p),g=n(19),h=r(g),v=n(63),m=r(v),b=n(8),w=r(b),E=n(47),x=r(E),_=n(3),k=r(_),I=n(1),T=r(I),O=n(2),j=r(O),A=n(5),M=r(A),G=n(4),V=r(G),z=n(12),C=r(z),S=n(124),P=r(S),q=n(13),U=n(51),N=n(133),$=r(N),R=n(58),F=r(R),D=n(29),B=r(D),L=n(128),K=r(L),Z=n(14),W={isTyping:"is-typing",multiOrg:"multi-org",noOfflineMessages:"no-offline-messages",autoDeliver:"auto-deliver",hidden:"hidden",closeAfterMessages:"close-after-messages"},H=(0,q.classWithPrivateMethods)((i=function(e){function t(e,n){(0,T["default"])(this,t);var r=(0,M["default"])(this,(0,k["default"])(t).call(this,e,n));return r._throtelled_flushQueuedAcks=(0,x["default"])(r._flushQueuedAcks.bind(r),r.config.flushAckInterval,{leading:!1}),r}return(0,V["default"])(t,e),(0,j["default"])(t,[{key:"mounted",value:function(){this._queuedAcks=[]}},{key:"dispose",value:function(){this._queuedAcks=null,this._throtelled_flushQueuedAcks.cancel&&this._throtelled_flushQueuedAcks.cancel()}},{key:"connect",value:function(){function e(){return t.apply(this,arguments)}var t=(0,w["default"])(y["default"].mark(function n(){var e,t,r,o=this;return y["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.host.requireUser(),!this.eventSource){n.next=4;break}return this.logger.warn("already connected"),n.abrupt("return");case 4:return t=this.config.baseUrl+"/events",this.logger.info("connecting events"),r=(e=(e=(e=(e=this.config.events,$["default"]).call(e,m["default"]),F["default"]).call(e),B["default"]).call(e,function(e){return W[e]}),K["default"]).call(e).join(","),this.eventSource=new P["default"](t,{headers:{Authorization:this.httpClient.getAuthHeader(),"TT-X-Features":r}}),n.abrupt("return",new h["default"](function(e,t){var n=void 0;o.eventSource.addEventListener("open",function(){o.logger.info("open"),n=!0,e()}),o.eventSource.addEventListener("message",o._onEvent.bind(o)),o.eventSource.addEventListener("error",function(e){n||t(),o._onError(e)}),o.eventSource.addEventListener("close",function(){o.logger.info("close")})}));case 9:case"end":return n.stop()}},n,this)}));return e}()},{key:"disconnect",value:function(){this.eventSource&&this.eventSource.close(),this.eventSource=null}},{key:"reconnect",value:function(){this.eventSource&&this.disconnect(),this.connect()}},{key:"_onEvent",value:function(e){var t=this,n=e.data;if(n.includes("\n"))return void n.split("\n").forEach(function(e){return t._onEvent({data:e})});var r=n;try{n=JSON.parse(r)}catch(o){throw this.logger.error("error parsing ",r),o}var a=n.event_id,i=(0,d["default"])(n.event)[0],u=i.replace("tigertext:iq:",""),s=n.event[i];this.logger.info("incoming",u,s);var c=new U.Event(a,u,s,{_origData:r});try{this.host.eventRouter.emit(c),this.emit("event",c),this.config.autoAckSuccessfullyHandledEvents&&this.__queueAck(a)}catch(o){throw this.logger.error("error in event "+u,o,o.stack,{data:s}),o}}},{key:"_onError",value:function(e){var t=this;this.logger.warn("error",e,e.message||"",e.status||""),this.disconnect(),this.config.eventsAutoReconnect&&setTimeout(function(){t.connect()},this.config.eventsAutoReconnectDelay)}},{key:"__queueAck",value:function(e){var t;e=(0,Z.arrayWrap)(e),(t=this._queuedAcks).push.apply(t,(0,f["default"])(e)),e.length>=this.config.flushAckMaxEvents?(this.logger.log("reached "+this.config.flushAckMaxEvents+" -- flushing"),this._flushQueuedAcks()):this._throtelled_flushQueuedAcks()}},{key:"_flushQueuedAcks",value:function(){this._queuedAcks.length>0&&(this.ack(this._queuedAcks),this._queuedAcks.length=0)}},{key:"ack",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,w["default"])(y["default"].mark(function n(e){return y["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.host.requireUser(),e=(0,Z.arrayWrap)(e),this.logger.log("ack",e),t.prev=3,t.next=6,this.httpClient.post("/events/ack",{data:{events:e}});case 6:t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](3),this.logger.warn("some events not acked",e);case 11:case"end":return t.stop()}},n,this,[[3,8]])}));return e}()}]),t}(C["default"]),o(i.prototype,"_onEvent",[q.privateMethod],(0,s["default"])(i.prototype,"_onEvent"),i.prototype),o(i.prototype,"_onError",[q.privateMethod],(0,s["default"])(i.prototype,"_onError"),i.prototype),o(i.prototype,"__queueAck",[q.privateMethod],(0,s["default"])(i.prototype,"__queueAck"),i.prototype),o(i.prototype,"_flushQueuedAcks",[q.privateMethod],(0,s["default"])(i.prototype,"_flushQueuedAcks"),i.prototype),a=i))||a;t["default"]=H,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,v["default"])(e);if(!Array.isArray(e)){var o=(0,g["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,v["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,v["default"])(e);if(!Array.isArray(e)){var o=(0,g["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,v["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f,l,d=n(7),p=r(d),y=n(6),g=r(y),h=n(10),v=r(h),m=n(11),b=r(m),w=n(163),E=r(w),x=n(42),_=r(x),k=n(19),I=r(k),T=n(31),O=r(T),j=n(15),A=r(j),M=n(20),G=r(M),V=n(9),z=r(V),C=n(8),S=r(C),P=n(3),q=r(P),U=n(1),N=r(U),$=n(2),R=r($),F=n(5),D=r(F),B=n(4),L=r(B),K=n(12),Z=r(K),W=n(17),H=r(W),X=n(16),Y=n(13),Q=n(29),J=r(Q),ee=n(40),te=r(ee),ne=n(59),re=r(ne),oe=n(14),ae=(u=(0,X.decorator)(),s=(0,X.decorator)(),c=(0,X.decorator)(),(0,Y.classWithPrivateMethods)((l=function(e){function t(){return(0,N["default"])(this,t),(0,D["default"])(this,(0,q["default"])(t).apply(this,arguments))}return(0,L["default"])(t,e),(0,R["default"])(t,[{key:"mounted",value:function(){this._fetched=!1}},{key:"dispose",value:function(){this._fetched=!1}},{key:"create",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,S["default"])(z["default"].mark(function n(e){var t,r,o=e.organizationId,a=e.name,i=e.avatarFile,u=e.replayHistory,s=void 0===u?!0:u,c=e.memberIds,f=void 0===c?[]:c,l=e.metadata;return z["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),o){e.next=3;break}throw new H["default"].ValidationError("organizationId","required");case 3:return f=f.map(this._resolveModelId.bind(this)),f.includes(this.host.getCurrentUser().id)||f.unshift(this.host.getCurrentUser().id),e.next=7,this.host.api.groups.create({name:a,avatarFile:i,replayHistory:s,memberIds:f,organizationId:o});case 7:if(t=e.sent,r=this.host.models.Group.inject(t),!l){e.next=12;break}return e.next=12,this.host.metadata.update(r.id,l,o);case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}},n,this)}));return e}()},{key:"update",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,S["default"])(z["default"].mark(function n(e,t){var r,o,u,s=t.name,c=t.avatarFile,f=t.replayHistory,l=t.memberIds,d=t.metadata;return z["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),e=this._resolveModelId(e),r={},"undefined"!=typeof s&&(r.name=s),"undefined"!=typeof f&&(r.replayHistory=f),"undefined"!=typeof l&&(r.memberIds=l),t.next=12,this.host.api.groups.update(e,{name:s,avatarFile:c,replayHistory:f,memberIds:l});case 12:if(o=t.sent,"undefined"!=typeof o.avatarUrl&&(r.avatarUrl=o.avatarUrl),u=this.host.models.Group.inject((0,G["default"])({id:e},r)),!d){t.next=18;break}return t.next=18,this.host.metadata.update(e,d,u.organizationId);case 18:return t.abrupt("return",u);case 19:case"end":return t.stop()}},n,this)}));return e}()},{key:"find",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,S["default"])(z["default"].mark(function n(e){var t,r,o,u=this,s=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return z["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){n.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:if(s=(0,A["default"])(s,{ignoreNotFound:!1,bypassCache:!1,includeMembers:!1,includeMetadata:!1}),this.host.requireUser(),t=null,s.bypassCache){n.next=11;break}if(t=this.host.models.Group.get(e),!t){n.next=11;break}return n.abrupt("return",t);case 11:return n.next=13,this.host.api.groups.find(e);case 13:if(r=n.sent,!r){n.next=19;break}t=this.host.models.Group.inject(r),delete t.$temporary,n.next=21;break;case 19:if(s.ignoreNotFound){n.next=21;break}throw new H["default"].NotFoundError(this.host.models.Group.name,e);case 21:if(!t){n.next=28;break}if(o=[],s.includeMetadata&&o.push(this.host.metadata.find(e,t.organizationId)),s.includeMembers&&o.push.apply(o,(0,O["default"])(t.memberIds.map(function(e){return u.host.users.find(e,{ignoreNotFound:!0})}))),!(o.length>0)){n.next=28;break}return n.next=28,I["default"].all(o);case 28:return n.abrupt("return",t);case 29:case"end":return n.stop()}},n,this)}));return e}()},{key:"findAll",
value:function(){function e(e){return t.apply(this,arguments)}var t=(0,S["default"])(z["default"].mark(function n(){var e,t,r,o,a,i,u=this,s=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],c=s.includeMembers,f=void 0===c?!1:c,l=s.includeMetadata,d=void 0===l?!1:l;return z["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._fetched){n.next=2;break}return n.abrupt("return",this.getAll());case 2:if(e=this.host.models.Organization.getAll(),0!=e.length){n.next=7;break}return n.next=6,this.host.organizations.findAll();case 6:e=n.sent;case 7:return n.next=9,this.host.search.query({types:["group"],organizationIds:e.map(function(e){return e.id}),query:{displayName:""},includeMetadata:d});case 9:if(t=n.sent,r=t.map(function(e){return e.entity}),!f){n.next=18;break}if(a=[],i=(o=(o=J["default"].call(r,"memberIds"),te["default"]).call(o),re["default"]).call(o),a.push.apply(a,(0,O["default"])(i.map(function(e){return u.host.users.find(e,{ignoreNotFound:!0})}))),!(a.length>0)){n.next=18;break}return n.next=18,I["default"].all(a);case 18:return this._fetched=!0,n.abrupt("return",r);case 20:case"end":return n.stop()}},n,this)}));return e}()},{key:"findAllWithSpecificMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,S["default"])(z["default"].mark(function n(e,t){var r;return z["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){n.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(e));case 2:if("string"==typeof t||t instanceof Object){n.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 4:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){n.next=6;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(e));case 6:if("string"==typeof t||t instanceof Object){n.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:if(t=this._resolveModelId(t),e=(0,oe.arrayWrap)(e).map(this._resolveModelId.bind(this)),!e.includes(this.host.currentUserId)&&e.push(this.host.currentUserId),r=this.__findAllLocalWithSpecificMembers(e,t),0!==r.length){n.next=16;break}return n.next=15,this.findAll();case 15:r=this.__findAllLocalWithSpecificMembers(e,t);case 16:return n.abrupt("return",r);case 17:case"end":return n.stop()}},n,this)}));return e}()},{key:"ensureMembers",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,S["default"])(z["default"].mark(function n(e){var t=this;return z["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));case 2:if(e instanceof Object){n.next=4;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));case 4:e.memberIds.forEach(function(e){var n;t.host.models.User.ensureEntityOrCreateTemporaryAndFind({id:e,displayName:"Loading..."},{finder:(n=t.host.users).find.bind(n)})});case 5:case"end":return n.stop()}},n,this)}));return e}()},{key:"getAll",value:function(){return this.host.models.Group.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Group.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Group.getMulti(e)}},{key:"__findAllLocalWithSpecificMembers",value:function(e,t){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));var n=this.host.models.Group.getAll(),r=(0,_["default"])(n,function(n){return n.organizationId==t&&0==(0,E["default"])(n.memberIds,e).length});return r}},{key:"destroy",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,S["default"])(z["default"].mark(function n(e){var t;return z["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){n.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),e=this._resolveModelId(e),n.next=8,this.host.api.groups.destroy(e);case 8:if(t=n.sent){n.next=11;break}throw new H["default"].NotFoundError(this.host.models.Group.name,e);case 11:return this.host.models.Group.eject(e),n.abrupt("return",null);case 13:case"end":return n.stop()}},n,this)}));return e}()},{key:"findAllMemberIds",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,S["default"])(z["default"].mark(function n(e){var t;return z["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){n.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),e=this._resolveModelId(e),n.next=8,this.httpClient.get("/group/:id/members",{urlParams:{id:e}});case 8:return t=n.sent,n.abrupt("return",t.data);case 10:case"end":return n.stop()}},n,this)}));return e}()},{key:"addMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,S["default"])(z["default"].mark(function n(e,t){return z["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){n.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(t));case 4:if("string"==typeof e||e instanceof Object){n.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){n.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(t));case 8:return this.host.requireUser(),e=this._resolveModelId(e),t=(0,oe.arrayWrap)(t).map(this._resolveModelId.bind(this)),n.next=13,this.host.api.groups.addMembers(e,t);case 13:case"end":return n.stop()}},n,this)}));return e}()},{key:"removeMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,S["default"])(z["default"].mark(function n(e,t){return z["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){n.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(t));case 4:if("string"==typeof e||e instanceof Object){n.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){n.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(t));case 8:return this.host.requireUser(),e=this._resolveModelId(e),t=(0,oe.arrayWrap)(t).map(this._resolveModelId.bind(this)),n.next=13,this.host.api.groups.removeMembers(e,t);case 13:case"end":return n.stop()}},n,this)}));return e}()},{key:"addMember",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,S["default"])(z["default"].mark(function n(e,t){return z["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof t||t instanceof Object){n.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 4:if("string"==typeof e||e instanceof Object){n.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof t||t instanceof Object){n.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:return n.abrupt("return",this.addMembers(e,[t]));case 9:case"end":return n.stop()}},n,this)}));return e}()},{key:"removeMember",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,S["default"])(z["default"].mark(function n(e,t){return z["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof t||t instanceof Object){n.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 4:if("string"==typeof e||e instanceof Object){n.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof t||t instanceof Object){n.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:return n.abrupt("return",this.removeMembers(e,[t]));case 9:case"end":return n.stop()}},n,this)}));return e}()},{key:"join",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,S["default"])(z["default"].mark(function n(e){return z["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return t.abrupt("return",this.addMembers(e,[this.host.currentUserId]));case 5:case"end":return t.stop()}},n,this)}));return e}()},{key:"leave",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,S["default"])(z["default"].mark(function n(e){var t;return z["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){n.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:if(e=this._resolveModelId(e),t=this.getById(e)){n.next=8;break}return n.abrupt("return");case 8:return n.next=10,this.host.conversations.remove("group",e,t.organizationId);case 10:case"end":return n.stop()}},n,this)}));return e}()},{key:"reactToBangEvent",value:function(e){switch(e.data.event){case"added":this.__addedToGroup(e);break;case"removed":this.__removedFromGroup(e)}}},{key:"__addedToGroup",value:function(e){var t=e.data.caller_entity,n=e.data.subject_entity,r=e.data.target_entity;if(t&&t.token&&r&&r.token&&n&&n.token){var o=this.host.injectModel(t),a=this.host.injectModel(n),i=this.host.models.Group.get(r.token);if(i){var u=a.id===o.id?"JOIN":"ADD",s={id:e.id,sortNumber:+e.data.sort_number,createdAt:new Date(e.data.created_on),action:u,actor:o,actorId:o.id,group:i,groupId:i.id,members:[a],memberIds:[a.id]};this.host.conversations.addMembershipChangeLog(s),i.memberIds.includes(a.id)||(this.host.models.Group.touch(i),this.emit("membership:change",s))}}}},{key:"__removedFromGroup",value:function(e){var t=e.data.caller_entity,n=e.data.subject_entity,r=e.data.target_entity;if(t&&t.token&&r&&r.token&&n&&n.token){var o=this.host.injectModel(t),a=this.host.models.Group.get(r.token);if(a&&a.memberIds){var i=this.host.injectModel(n),u=i.id===o.id?"LEAVE":"REMOVE",s={id:e.id,sortNumber:+e.data.sort_number,createdAt:new Date(e.data.created_on),action:u,actor:o,actorId:o.id,group:a,groupId:a.id,members:[i],memberIds:[i.id]};this.host.conversations.addMembershipChangeLog(s),a.memberIds.includes(i.id)&&this.emit("membership:change",s)}}}}]),t}(Z["default"]),o(l.prototype,"find",[u],(0,b["default"])(l.prototype,"find"),l.prototype),o(l.prototype,"findAll",[s],(0,b["default"])(l.prototype,"findAll"),l.prototype),o(l.prototype,"findAllWithSpecificMembers",[c],(0,b["default"])(l.prototype,"findAllWithSpecificMembers"),l.prototype),o(l.prototype,"__findAllLocalWithSpecificMembers",[Y.privateMethod],(0,b["default"])(l.prototype,"__findAllLocalWithSpecificMembers"),l.prototype),o(l.prototype,"__addedToGroup",[Y.privateMethod],(0,b["default"])(l.prototype,"__addedToGroup"),l.prototype),o(l.prototype,"__removedFromGroup",[Y.privateMethod],(0,b["default"])(l.prototype,"__removedFromGroup"),l.prototype),f=l))||f);t["default"]=ae,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,C["default"])(e);if(!Array.isArray(e)){var o=(0,m["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,h["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,C["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,C["default"])(e);if(!Array.isArray(e)){var o=(0,m["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,h["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,C["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f,l,d,p,y,g=n(7),h=r(g),v=n(6),m=r(v),b=n(11),w=r(b),E=n(62),x=r(E),_=n(161),k=r(_),I=n(65),T=r(I),O=n(43),j=r(O),A=n(46),M=r(A),G=n(19),V=r(G),z=n(10),C=r(z),S=n(18),P=r(S),q=n(45),U=r(q),N=n(144),$=r(N),R=n(37),F=r(R),D=n(38),B=r(D),L=n(27),K=r(L),Z=n(20),W=r(Z),H=n(9),X=r(H),Y=n(8),Q=r(Y),J=n(47),ee=r(J),te=n(3),ne=r(te),re=n(1),oe=r(re),ae=n(2),ie=r(ae),ue=n(5),se=r(ue),ce=n(4),fe=r(ce),le=n(12),de=r(le),pe=n(48),ye=r(pe),ge=n(16),he=n(13),ve=n(166),me=r(ve),be=n(25),we=n(26),Ee=r(we),xe=n(17),_e=r(xe),ke=n(23),Ie=r(ke),Te=n(41),Oe=r(Te),je=n(130),Ae=r(je),Me=n(129),Ge=r(Me),Ve=n(29),ze=r(Ve),Ce=n(59),Se=r(Ce),Pe=n(28),qe=r(Pe),Ue=n(14),Ne=["user","group","conversation"],$e=(u=(0,ge.decorator)(),s=(0,ge.decorator)(),c=(0,ge.decorator)({memoize:!0}),f=(0,ge.decorator)({memoize:!0}),l=(0,ge.decorator)(),d=(0,ge.decorator)(),(0,he.classWithPrivateMethods)((y=function(e){function t(){var e;(0,oe["default"])(this,t);for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var a=(0,se["default"])(this,(e=(0,ne["default"])(t)).call.apply(e,[this].concat(r)));return a._throtelled_flushQueueMessageStatuses=a.config.flushSetMessageStatusInterval?(0,ee["default"])(a.__flushQueueMessageStatuses,a.config.flushSetMessageStatusInterval,{leading:!1}):a.__flushQueueMessageStatuses,a}return(0,fe["default"])(t,e),(0,ie["default"])(t,[{key:"mounted",value:function(){this._queuedMessageStatuses={deliveredIds:[],readIds:[]},this.host.on("tick",this.deleteExpiredMessages)}},{key:"dispose",value:function(){this._queuedMessageStatuses=null,this.downloadAttachmentBlobAndURL&&ge.decorator.clear(this.downloadAttachmentBlobAndURL),this.downloadAttachmentURL&&ge.decorator.clear(this.downloadAttachmentURL),this._throtelled_flushQueueMessageStatuses.cancel&&this._throtelled_flushQueueMessageStatuses.cancel(),this.host.off("tick",this.deleteExpiredMessages)}},{key:"send",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e,t){var r,o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if(null==o||o instanceof Object){n.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+i(o));case 6:if("string"==typeof e||e instanceof Object){n.next=8;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("string"==typeof t){n.next=10;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 10:if(null==o||o instanceof Object){n.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+a(o));case 12:return n.next=14,this.__resolveRecipientEntity(e);case 14:if(r=n.sent,!r){n.next=24;break}n.t0=r.$entityType,n.next="user"===n.t0?19:"group"===n.t0?20:"conversation"===n.t0?21:22;break;case 19:return n.abrupt("return",this.sendToUser(r.id,t,o));case 20:return n.abrupt("return",this.sendToGroup(r.id,t,o));case 21:return n.abrupt("return",this.sendToConversation(r.id,t,o));case 22:n.next=25;break;case 24:return n.abrupt("return",this.sendToUser(e,t,o));case 25:case"end":return n.stop()}},n,this)}));return e}()},{key:"sendToConversation",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e,t){var r,o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if(null==o||o instanceof Object){n.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+i(o));case 6:if("string"==typeof e||e instanceof Object){n.next=8;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("string"==typeof t){n.next=10;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 10:if(null==o||o instanceof Object){n.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+a(o));case 12:e=this._resolveModelIdWithTypes(e,"conversation"),r=this.host.conversations.getById(e),r||Ee["default"].raise("conversationId","not-found","Conversation not found"),n.t0=r.counterPartyType,n.next="user"===n.t0?18:"group"===n.t0?19:20;break;case 18:return n.abrupt("return",this.sendToUser(r.counterPartyId,t,(0,W["default"])({},o,{organizationId:r.organizationId})));case 19:return n.abrupt("return",this.sendToGroup(r.counterPartyId,t,(0,W["default"])({},o,{organizationId:r.organizationId})));case 20:case"end":return n.stop()}},n,this)}));return e}()},{key:"sendToUser",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e,t){var r,o=arguments.length<=2||void 0===arguments[2]?{options:{}}:arguments[2],u=o.organizationId,s=o.senderOrganizationId,c=o.recipientOrganizationId,f=(0,K["default"])(o,["organizationId","senderOrganizationId","recipientOrganizationId"]);return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if("string"==typeof e||e instanceof Object){n.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if(e=this._resolveModelIdWithTypes(e,"user"),u?(s&&Ee["default"].raise("senderOrganizationId","invalid","Cannot set senderOrganizationId if organizationId is set"),c&&Ee["default"].raise("recipientOrganizationId","invalid","Cannot set recipientOrganizationId if organizationId is set"),s=c=u):s?c||(c=s):this.host.config.defaultOrganizationId?s=c=this.host.config.defaultOrganizationId:Ee["default"].raise("senderOrganizationId or organizationId","required","Message is sent in the context of an organization. Provide `senderOrganizationId` or `organizationId` or set a default one with client.setDefaultOrganization(...)"),this.host.users.getById(e)){n.next=23;break}return n.prev=11,n.next=14,this.host.users.find(e);case 14:r=n.sent,e=r.id,n.next=23;break;case 18:if(n.prev=18,n.t0=n["catch"](11),n.t0.code===_e["default"].NotFoundError.CODE){n.next=22;break}throw n.t0;case 22:return n.abrupt("return",this.__sendToUnknownUser(e,t,(0,W["default"])({organizationId:u,senderOrganizationId:s,recipientOrganizationId:c},f)));case 23:return n.abrupt("return",this.__send("user",e,t,(0,W["default"])({senderOrganizationId:s,recipientOrganizationId:c},f)));case 24:case"end":return n.stop()}},n,this,[[11,18]])}));return e}()},{key:"__resolveRecipientEntity",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e){var t,r,o,u,s,c,f,l,d=this;return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){n.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:if(t=void 0,"string"!=typeof e){n.next=11;break}if(t=this._resolveEntity(e,Ne),!t){n.next=9;break}return n.abrupt("return",t);case 9:n.next=14;break;case 11:return t=e,Ee["default"].oneOf("entity",t.$entityType,Ne),n.abrupt("return",t);case 14:if(r=[(0,Q["default"])(X["default"].mark(function p(){return X["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d.host.users.find(e));case 1:case"end":return t.stop()}},p,d)})),(0,Q["default"])(X["default"].mark(function y(){return X["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d.host.groups.find(e));case 1:case"end":return t.stop()}},y,d)}))],this.host.conversations.looksLikeConversationId(e)&&r.unshift((0,Q["default"])(X["default"].mark(function g(){return X["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d.host.conversations.find(e));case 1:case"end":return t.stop()}},g,d)}))),r&&("function"==typeof r[B["default"]]||Array.isArray(r))){n.next=18;break}throw new TypeError("Expected resolvers to be iterable, got "+a(r));case 18:if(r&&("function"==typeof r[B["default"]]||Array.isArray(r))){n.next=20;break}throw new TypeError("Expected resolvers to be iterable, got "+i(r));case 20:o=!0,u=!1,s=void 0,n.prev=23,c=(0,F["default"])(r);case 25:if(o=(f=c.next()).done){n.next=42;break}return l=f.value,n.prev=27,n.next=30,l();case 30:if(t=n.sent,!t){n.next=33;break}return n.abrupt("return",t);case 33:n.next=39;break;case 35:if(n.prev=35,n.t0=n["catch"](27),n.t0.code===_e["default"].NotFoundError.CODE){n.next=39;break}throw n.t0;case 39:o=!0,n.next=25;break;case 42:n.next=48;break;case 44:n.prev=44,n.t1=n["catch"](23),u=!0,s=n.t1;case 48:n.prev=48,n.prev=49,!o&&c["return"]&&c["return"]();case 51:if(n.prev=51,!u){n.next=54;break}throw s;case 54:return n.finish(51);case 55:return n.finish(48);case 56:return n.abrupt("return",null);case 57:case"end":return n.stop()}},n,this,[[23,44,48,56],[27,35],[49,,51,55]])}));return e}()},{key:"__sendToUnknownUser",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e,t){var r,o,u,s,c,f,l=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],d=l.organizationId,p=l.senderOrganizationId,y=void 0===p?d:p,g=l.recipientOrganizationId,h=void 0===g?y:g,v=(0,K["default"])(l,["organizationId","senderOrganizationId","recipientOrganizationId"]);return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if("string"==typeof e||e instanceof Object){n.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:return r=me["default"].v4(),o=this.__getNextSortNumber(),v=this.__normalizeSendOptions(v,y),n.next=13,this.host.api.messages.send({localId:r,counterPartyId:e,body:t,senderOrganizationId:y,recipientOrganizationId:h,attachment:(0,$["default"])(v.attachmentFiles),priority:"undefined"!=typeof v.priority?be.MessagePriority.toServer(v.priority):void 0,metadata:v.metadata,ttl:v.ttl,dor:v.dor});case 13:return u=n.sent,n.next=16,this.host.users.find(e);case 16:return s=n.sent,c=this.host.conversations.ensureConversation("user",s.id,y),f=this.host.models.Message.inject({id:u.serverId,conversationId:c.id,counterParty:s,messageType:be.MessageType.USER_SENT,body:t,senderOrganizationId:y,recipientOrganizationId:h,sortNumber:o,createdAt:new Date,senderId:this.host.getCurrentUser().id,direction:be.MessageDirection.OUTGOING,senderStatus:be.MessageSenderStatus.SENT,recipientStatus:be.MessageRecipientStatus.NEW,serverId:null,metadata:v.metadata,priority:v.priority,ttl:u.ttl,dor:v.dor}),v.attachmentFiles&&this.__setLocalMessageAttachments(f,v.attachmentFiles),this.host.emit("message:sending",f),this.host.emit("message:sent",f),n.abrupt("return",f);case 23:case"end":return n.stop()}},n,this)}));return e}()},{key:"sendToGroup",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e,t){var r,o=arguments.length<=2||void 0===arguments[2]?{options:{}}:arguments[2],u=o.organizationId,s=(0,K["default"])(o,["organizationId"]);return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if("string"==typeof e||e instanceof Object){n.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:return e=this._resolveModelIdWithTypes(e,"group"),r=this.host.models.Group.get(e),u=r?r.organizationId:this.__ensureOrganization(u),
n.abrupt("return",this.__send("group",e,t,(0,W["default"])({senderOrganizationId:u},s)));case 12:case"end":return n.stop()}},n,this)}));return e}()},{key:"sendToNewGroup",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e,t){var r,o=this,u=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=u.organizationId,c=u.groupName,f=u.groupMetadata,l=(0,K["default"])(u,["organizationId","groupName","groupMetadata"]);return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){n.next=2;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){n.next=6;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+a(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:return e=e.map(function(e){return o._resolveModelIdWithTypes(e,"user")}),0==e.length&&Ee["default"].raise("userIds","required"),s=this.__ensureOrganization(s),n.next=13,this.__prepareGroupForUsers(s,e,c,{groupMetadata:f});case 13:return r=n.sent,n.abrupt("return",this.sendToGroup(r,t,(0,W["default"])({organizationId:s},l)));case 15:case"end":return n.stop()}},n,this)}));return e}()},{key:"__normalizeSendOptions",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.metadata,n=e.attachmentFiles,r=e.attachmentFile,o=e.priority,u=e.ttl,s=e.dor,c=arguments[1];if("string"!=typeof c)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(c));if("string"!=typeof c)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(c));return t&&(t=this.__normalizeMetadata(t)),n=this.__validateAttachments(n||r),"undefined"==typeof u&&(u=this.host.organizations.getSettingValue(c,"ttl")||-1),{metadata:t,attachmentFiles:n,priority:o,ttl:u,dor:s}}},{key:"__ensureOrganization",value:function(e){return e?e:this.host.config.defaultOrganizationId?this.host.config.defaultOrganizationId:void Ee["default"].raise("organizationId","required","Message is sent in the context of an organization. Provide `organizationId` or set a default one with client.setDefaultOrganization(...)")}},{key:"__validateAttachments",value:function(e){return e=(0,Ue.arrayWrap)(e),!(0,U["default"])(e)&&e.length>1&&Ee["default"].raise("attachmentFiles","invalid","currently only a single attachment is supported"),e}},{key:"__normalizeMetadata",value:function(e){return e?(0,Ue.arrayWrap)(e).map(function(e){return(0,W["default"])({mimetype:"application/json"},e)}):null}},{key:"__getNextSortNumber",value:function(){var e,t=(e=(e=this.host.models.Message.getAll(),Oe["default"]).call(e,["sortNumber"],["desc"]),Ae["default"]).call(e),n=t?t.sortNumber:0,r=n+1e-6;return r}},{key:"__send",value:function(){function e(e,n,r,o){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e,t,r,o){var u,s,c,f,l,d=o.senderOrganizationId,p=o.recipientOrganizationId,y=void 0===p?d:p,g=(0,K["default"])(o,["senderOrganizationId","recipientOrganizationId"]),h=arguments;return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if("string"==typeof r){n.next=6;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if(null!=h[3]&&"string"==typeof h[3].senderOrganizationId&&(null==h[3].recipientOrganizationId||"string"==typeof h[3].recipientOrganizationId)&&(null==h[3].options||h[3].options instanceof Object)){n.next=8;break}throw new TypeError("Value of argument 3 violates contract.\n\nExpected:\n{ senderOrganizationId: string;\n  recipientOrganizationId: ?string;\n  options: ?Object;\n}\n\nGot:\n"+i(h[3]));case 8:if("string"==typeof e){n.next=10;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 10:if("string"==typeof t){n.next=12;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 12:if("string"==typeof r){n.next=14;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 14:if(null!=h[3]&&"string"==typeof h[3].senderOrganizationId&&(null==h[3].recipientOrganizationId||"string"==typeof h[3].recipientOrganizationId)&&(null==h[3].options||h[3].options instanceof Object)){n.next=16;break}throw new TypeError("Value of argument 3 violates contract.\n\nExpected:\n{ senderOrganizationId: string;\n  recipientOrganizationId: ?string;\n  options: ?Object;\n}\n\nGot:\n"+a(h[3]));case 16:return this.host.requireUser(),Ee["default"].oneOf("counterPartyType",e,["user","group"]),Ee["default"].notEmpty("counterPartyId",t),u=this.__getNextSortNumber(),g=this.__normalizeSendOptions(g,d),s=this.host.conversations.ensureConversation(e,t,d),c=this.host.models.Message.createInstance({id:me["default"].v4(),conversationId:s.id,messageType:be.MessageType.USER_SENT,counterPartyId:t,counterPartyType:e,body:r,senderOrganizationId:d,recipientOrganizationId:y,sortNumber:u,createdAt:new Date,senderId:this.host.getCurrentUser().id,direction:be.MessageDirection.OUTGOING,senderStatus:be.MessageSenderStatus.SENDING,$synced:!1,serverId:null,metadata:g.metadata,priority:g.priority,dor:g.dor,ttl:g.ttl}),g.attachmentFiles&&this.__setLocalMessageAttachments(c,g.attachmentFiles),"group"==e?(c.groupId=t,c.recipientStatus=be.MessageRecipientStatus.NA):(c.recipientId=t,c.recipientStatus=be.MessageRecipientStatus.NEW),this.host.models.Message.inject(c),this.host.emit("message:sending",c),n.next=29,this.host.api.messages.send({localId:c.id,counterPartyId:t,body:r,senderOrganizationId:d,recipientOrganizationId:y,attachment:(0,$["default"])(g.attachmentFiles),priority:"undefined"!=typeof g.priority?be.MessagePriority.toServer(g.priority):void 0,metadata:g.metadata,ttl:g.ttl,dor:g.dor});case 29:if(f=n.sent,(0,P["default"])(c,{serverId:f.serverId,ttl:f.ttl,senderStatus:be.MessageSenderStatus.SENT,$synced:!0}),"group"!=e){n.next=37;break}if(c.group&&!c.group.$temporary){n.next=35;break}return n.next=35,this.host.groups.find(c.groupId,{includeMembers:!0,bypassCache:!0});case 35:n.next=43;break;case 37:if(c.recipient&&!c.recipient.$temporary){n.next=43;break}return n.next=40,this.host.users.find(c.recipientId,{bypassCache:!0});case 40:l=n.sent,c.recipientId=l.id,c.counterPartyId=l.id;case 43:return this.host.models.Message.inject(c),this.host.emit("message:sent",c),n.abrupt("return",c);case 46:case"end":return n.stop()}},n,this)}));return e}()},{key:"__setLocalMessageAttachments",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!Array.isArray(t)||!t.every(function(e){return"string"==typeof e||e instanceof Object}))throw new TypeError('Value of argument "attachmentFiles" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if(!Array.isArray(t)||!t.every(function(e){return"string"==typeof e||e instanceof Object}))throw new TypeError('Value of argument "attachmentFiles" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+a(t));e.attachments=t.map(this.__generateAttachmentDescriptor.bind(this))}},{key:"__generateAttachmentDescriptor",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "attachment" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "attachment" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));var t="local:"+me["default"].v4();"string"==typeof e||e instanceof Buffer||Ee["default"].raise("attachment","invalid","attachment (string or Buffer) is invalid");var r=void 0,o=void 0,u=void 0,s=n(56),c=n(67),f=n(165),l=n(55);if("string"==typeof e)r=s.statSync(e).size,o=f.lookup(e),u=c.basename(e);else{var d=l(e);if(d){var p=d.ext,y=d.mime;u="attachment."+p,o=y}r=e.byteLength}var g={id:t,localPath:"string"==typeof e?e:null,localFile:e instanceof Buffer?e:null,name:u,size:r,contentType:o,isLocal:!0};return g}},{key:"__prepareGroupForUsers",value:function(){function e(e,n,r,o){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e,t,r,o){var a,i,u=this,s=o.groupMetadata;return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=[this.host.getCurrentUser()].concat(t.map(function(e){return u.host.models.User.get(e)}).filter(Boolean)),r||(r=a.map(function(e){return e.displayName}).filter(Boolean).join(", ")||"Group"),n.next=4,this.host.groups.create({organizationId:e,name:r,replayHistory:!0,memberIds:t,metadata:s});case 4:return i=n.sent,n.abrupt("return",i);case 6:case"end":return n.stop()}},n,this)}));return e}()},{key:"onMessageRecalled",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));this.host.requireUser();var t=this._getMessageByServerId(e);t&&this._deleteLocalMessage(t)}},{key:"_deleteLocalMessage",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));this.host.models.Message.eject(e)}},{key:"recall",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e){var t,r;return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){n.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),t=(0,Ue.arrayWrap)(e),r=t.map(this.__recallSingle.bind(this)),n.next=9,V["default"].all(r);case 9:case"end":return n.stop()}},n,this)}));return e}()},{key:"__recallSingle",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e){var t;return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){n.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:if(t=this._resolveMessage(e),!t){n.next=17;break}if(t.senderId==this.host.getCurrentUser().id){n.next=8;break}throw new _e["default"].PermissionDeniedError(t,t.serverId,"recall");case 8:if(t.$synced!==!1){n.next=12;break}this._deleteLocalMessage(t),n.next=15;break;case 12:return n.next=14,this.host.api.messages.destroy(t.serverId);case 14:this._deleteLocalMessage(t);case 15:n.next=19;break;case 17:return n.next=19,this.host.api.messages.destroy(e);case 19:case"end":return n.stop()}},n,this)}));return e}()},{key:"forward",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e,t,r){var o,u,s,c=r.organizationId,f=r.senderOrganizationId,l=void 0===f?c:f,d=r.recipientOrganizationId,p=void 0===d?l:d,y=r.priority,g=r.retrieveMessage,h=void 0===g?!1:g,v=arguments;return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof t||t instanceof Object){n.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 4:if(!(null==v[2]||null!=v[2].senderOrganizationId&&"string"!=typeof v[2].senderOrganizationId||null!=v[2].recipientOrganizationId&&"string"!=typeof v[2].recipientOrganizationId||null!=v[2].priority&&"number"!=typeof v[2].priority||null!=v[2].retrieveMessage&&"boolean"!=typeof v[2].retrieveMessage)){n.next=6;break}throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ senderOrganizationId: ?string;\n  recipientOrganizationId: ?string;\n  priority: ?number;\n  retrieveMessage: ?bool;\n}\n\nGot:\n"+i(v[2]));case 6:if("string"==typeof e||e instanceof Object){n.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("string"==typeof t||t instanceof Object){n.next=10;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 10:if(!(null==v[2]||null!=v[2].senderOrganizationId&&"string"!=typeof v[2].senderOrganizationId||null!=v[2].recipientOrganizationId&&"string"!=typeof v[2].recipientOrganizationId||null!=v[2].priority&&"number"!=typeof v[2].priority||null!=v[2].retrieveMessage&&"boolean"!=typeof v[2].retrieveMessage)){n.next=12;break}throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ senderOrganizationId: ?string;\n  recipientOrganizationId: ?string;\n  priority: ?number;\n  retrieveMessage: ?bool;\n}\n\nGot:\n"+a(v[2]));case 12:if(this.host.requireUser(),o=this._resolveMessage(e)){n.next=16;break}throw new _e["default"].NotFoundError(this.host.models.Message.name,e);case 16:return n.next=18,this.__resolveRecipientEntity(t);case 18:return u=n.sent,u&&(t="conversation"===u.$entityType?u.counterPartyId:u.serverId),Ee["default"].notEmpty("recipientId",t,"recipientId not found"),n.next=23,this.host.api.messages.forward(o.serverId,t,{localId:me["default"].v4(),senderOrganizationId:l,recipientOrganizationId:p,priority:"undefined"!=typeof y?be.MessagePriority.toServer(y):void 0});case 23:if(s=n.sent,!h){n.next=26;break}return n.abrupt("return",this.find(s.serverId));case 26:return n.abrupt("return",null);case 27:case"end":return n.stop()}},n,this)}));return e}()},{key:"reactToMessageStatusEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=e.data.client_id,n=e.data.is_recalled;n?this.onMessageRecalled(t):this.__setMessageStatusPerRecipientFromServerData(t,(0,M["default"])(e.data,["status","account_id","timestamp"]))&&this.__touchMessage(t)}},{key:"__setMessageStatusPerRecipientFromServerData",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(!(t instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(!(t instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(t));var n=be.MessageRecipientStatus.resolve(t.status),r=t.account_id,o=t.timestamp;return this.setRecipientMessageStatus(e,r,n,o)}},{key:"setRecipientMessageStatus",value:function(e,t,n,r){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if(!(null==r||"string"==typeof r||null==r||r instanceof Date))throw new TypeError('Value of argument "createdAt" violates contract.\n\nExpected:\n?string | ?Date\n\nGot:\n'+i(r));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));if(!(null==r||"string"==typeof r||null==r||r instanceof Date))throw new TypeError('Value of argument "createdAt" violates contract.\n\nExpected:\n?string | ?Date\n\nGot:\n'+a(r));var o=this._getMessageByServerId(e);if(o){n=be.MessageRecipientStatus.resolve(n),this._setSingleUserMessageRecipientMessageStatus(o,n);var u=(0,j["default"])(o.statusesPerRecipient,{userId:t});if(!u||this.__canChangeRecipientStatus(u.status,n)){var s=o.id+":"+t;return this.host.models.MessageStatusPerRecipient.inject({id:s,messageId:o.id,userId:t,status:n,createdAt:r})}}}},{key:"__touchMessage",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));var t=this._resolveMessage(e);this.host.models.Message.touch(t)}},{key:"_resolveMessage",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));return this.host.models.Message.is(e)?e:this.host.models.Message.get(e)||this._getMessageByServerId(e)}},{key:"_getMessageByServerId",value:function(e){var t;if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));return this.host.models.Message.is(e)?e:(t=this.host.models.Message.getAll(),Ge["default"]).call(t,{serverId:e})}},{key:"_setSingleUserMessageRecipientMessageStatus",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));this.__canChangeRecipientStatus(e.recipientStatus,t)&&this.host.models.Message.inject({id:e.id,recipientStatus:t})}},{key:"__canChangeRecipientStatus",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "fromStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "toStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "fromStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "toStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return e===t?!1:e!==be.MessageRecipientStatus.READ||t!=be.MessageRecipientStatus.DELIVERED}},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e){var t,r,o,u,s;return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){n.next=4;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),n.next=7,this.httpClient.get("/message/:id",{urlParams:{id:e}});case 7:return t=n.sent,r=t.data,o=t.data.recipient_token,n.next=12,this.__lookupCounterParty(o);case 12:if(u=n.sent,!u){n.next=17;break}r.counterParty=u,n.next=18;break;case 17:return n.abrupt("return",null);case 18:return s=this.host.models.Message.inject(r),n.next=21,this.findStatusesPerRecipient(s);case 21:return n.abrupt("return",s);case 22:case"end":return n.stop()}},n,this)}));return e}()},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Message.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Message.getMulti(e)}},{key:"__lookupCounterParty",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e){var t,r,o,u,s,c,f,l,d,p,y,g,h,v,m,b;return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){n.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:if(r=[{model:this.host.models.User,finder:(t=this.host.users).find.bind(t)},{model:this.host.models.Group,finder:(t=this.host.groups).find.bind(t)}],r&&("function"==typeof r[B["default"]]||Array.isArray(r))){n.next=7;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+a(r));case 7:if(r&&("function"==typeof r[B["default"]]||Array.isArray(r))){n.next=9;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+i(r));case 9:o=!0,u=!1,s=void 0,n.prev=12,c=(0,F["default"])(r);case 14:if(o=(f=c.next()).done){n.next=22;break}if(l=f.value.model,d=l.get(e),!d){n.next=19;break}return n.abrupt("return",d);case 19:o=!0,n.next=14;break;case 22:n.next=28;break;case 24:n.prev=24,n.t0=n["catch"](12),u=!0,s=n.t0;case 28:n.prev=28,n.prev=29,!o&&c["return"]&&c["return"]();case 31:if(n.prev=31,!u){n.next=34;break}throw s;case 34:return n.finish(31);case 35:return n.finish(28);case 36:if(r&&("function"==typeof r[B["default"]]||Array.isArray(r))){n.next=38;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+a(r));case 38:if(r&&("function"==typeof r[B["default"]]||Array.isArray(r))){n.next=40;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+i(r));case 40:p=!0,y=!1,g=void 0,n.prev=43,h=(0,F["default"])(r);case 45:if(p=(v=h.next()).done){n.next=62;break}return m=v.value.finder,n.prev=47,n.next=50,m(e);case 50:if(b=n.sent,!b){n.next=53;break}return n.abrupt("return",b);case 53:n.next=59;break;case 55:if(n.prev=55,n.t1=n["catch"](47),n.t1.code==_e["default"].NotFoundError.CODE){n.next=59;break}throw n.t1;case 59:p=!0,n.next=45;break;case 62:n.next=68;break;case 64:n.prev=64,n.t2=n["catch"](43),y=!0,g=n.t2;case 68:n.prev=68,n.prev=69,!p&&h["return"]&&h["return"]();case 71:if(n.prev=71,!y){n.next=74;break}throw g;case 74:return n.finish(71);case 75:return n.finish(68);case 76:return n.abrupt("return",null);case 77:case"end":return n.stop()}},n,this,[[12,24,28,36],[29,,31,35],[43,64,68,76],[47,55],[69,,71,75]])}));return e}()},{key:"downloadAttachmentURL",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(t));throw new Error("method not supported in target node")}},{key:"downloadAttachmentBlobAndURL",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e,t){return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof t||"number"==typeof t){n.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(t));case 4:if("string"==typeof e||e instanceof Object){n.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof t||"number"==typeof t){n.next=8;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(t));case 8:n.next=14;break;case 14:throw new Error("method not supported in target node");case 15:case"end":return n.stop()}},n,this)}));return e}()},{key:"downloadAttachmentToFile",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e,t,r){var o;return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof t||"number"==typeof t){n.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(t));case 4:if("string"==typeof r){n.next=6;break}throw new TypeError('Value of argument "dest" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){n.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("string"==typeof t||"number"==typeof t){n.next=10;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(t));case 10:if("string"==typeof r){n.next=12;break}throw new TypeError('Value of argument "dest" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return o=this._resolveMessage(e),t=t.toString(),n.abrupt("return",this.httpClient.downloadToFile("/message/"+o.serverId+"/attachment/"+t,r));case 18:throw new Error("method not supported in target node");case 19:case"end":return n.stop()}},n,this)}));return e}()},{key:"destroy",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e){return X["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),t.next=7,this.httpClient["delete"]("/message/:id",{urlParams:{id:e}});case 7:return t.abrupt("return",null);case 8:case"end":return t.stop()}},n,this)}));return e}()},{key:"getMessageCount",value:function(){return this.host.models.Message.getAll().length}},{key:"getTotalUnreadCount",value:function(){return(0,T["default"])(this.host.models.Conversation.getAll(),"unreadCount")}},{key:"markAsRead",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e){var t,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=r.queue,u=void 0===o?!0:o;return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){n.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){n.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+a(e));case 4:if(e=(t=(t=(t=e,Ue.arrayWrapBound).call(t),ze["default"]).call(t,this._resolveModelId.bind(this)),Se["default"]).call(t),!u){n.next=9;break}return n.abrupt("return",this.__queueMessageStatuses({readIds:e}));case 9:return n.abrupt("return",this.__setMessagesStatus({readIds:e}));case 10:case"end":return n.stop()}},n,this)}));return e}()},{key:"markAsDelivered",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e){var t,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=r.queue,u=void 0===o?!0:o;return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){n.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){n.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+a(e));
case 4:if(e=(t=(t=(t=e,Ue.arrayWrapBound).call(t),ze["default"]).call(t,this._resolveModelId.bind(this)),Se["default"]).call(t),!u){n.next=9;break}return n.abrupt("return",this.__queueMessageStatuses({deliveredIds:e}));case 9:return n.abrupt("return",this.__setMessagesStatus({deliveredIds:e}));case 10:case"end":return n.stop()}},n,this)}));return e}()},{key:"markAsReceived",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(){var e=arguments;return X["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.markAsDelivered.apply(this,e));case 1:case"end":return t.stop()}},n,this)}));return e}()},{key:"__queueMessageStatuses",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e){var t,r=e.deliveredIds,o=e.readIds,u=arguments;return X["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=u[0]&&(null==u[0].deliveredIds||Array.isArray(u[0].deliveredIds)&&u[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(null==u[0].readIds||Array.isArray(u[0].readIds)&&u[0].readIds.every(function(e){return"string"==typeof e}))){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ deliveredIds: ?Array<string>;\n  readIds: ?Array<string>;\n}\n\nGot:\n"+i(u[0]));case 2:if(null!=u[0]&&(null==u[0].deliveredIds||Array.isArray(u[0].deliveredIds)&&u[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(null==u[0].readIds||Array.isArray(u[0].readIds)&&u[0].readIds.every(function(e){return"string"==typeof e}))){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ deliveredIds: ?Array<string>;\n  readIds: ?Array<string>;\n}\n\nGot:\n"+a(u[0]));case 4:if(r&&(this._queuedMessageStatuses.deliveredIds=(0,k["default"])(this._queuedMessageStatuses.deliveredIds,r)),o&&(this._queuedMessageStatuses.readIds=(0,k["default"])(this._queuedMessageStatuses.readIds,o)),t=this._queuedMessageStatuses.deliveredIds.length+this._queuedMessageStatuses.readIds.length,!(t>=this.config.flushMessageMaxCount)){e.next=12;break}return this.logger.log("reached "+this.config.flushMessageMaxCount+" -- flushing"),e.abrupt("return",this.__flushQueueMessageStatuses());case 12:this._throtelled_flushQueueMessageStatuses();case 13:case"end":return e.stop()}},n,this)}));return e}()},{key:"__flushQueueMessageStatuses",value:function(){var e=this._queuedMessageStatuses.deliveredIds.length+this._queuedMessageStatuses.readIds.length;e>0&&(this.__setMessagesStatus(this._queuedMessageStatuses),this._queuedMessageStatuses.deliveredIds=[],this._queuedMessageStatuses.readIds=[])}},{key:"__setMessagesStatus",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e){var t,r,o,a,i=this,u=e.deliveredIds,s=void 0===u?[]:u,c=e.readIds,f=void 0===c?[]:c;return X["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),s=(t=(t=s,ze["default"]).call(t,this._resolveModelId.bind(this)),Se["default"]).call(t),f=(t=(t=f,ze["default"]).call(t,this._resolveModelId.bind(this)),Se["default"]).call(t),r=s.map(this._resolveMessage).filter(Boolean),o=f.map(this._resolveMessage).filter(Boolean),f=(0,x["default"])(f,(t=qe["default"].call(o,function(e){return e.recipientStatus===be.MessageRecipientStatus.READ||e.recipientStatus==be.MessageRecipientStatus.TO_BE_READ}),ze["default"]).call(t,"id")),s=(0,x["default"])(s,f,(t=qe["default"].call(r,function(e){return e.recipientStatus===be.MessageRecipientStatus.DELIVERED||e.recipientStatus===be.MessageRecipientStatus.READ||e.recipientStatus==be.MessageRecipientStatus.TO_BE_READ}),ze["default"]).call(t,"id")),a={},s.length&&(a.delivered=s),f.length&&(a.read=f,o.forEach(function(e){return i.host.models.Message.inject({id:e.id,recipientStatus:be.MessageRecipientStatus.TO_BE_READ})})),!(0,U["default"])(a.delivered)||!(0,U["default"])(a.read)){e.next=12;break}return e.abrupt("return",!1);case 12:return e.next=14,this.httpClient.post("/message/status",{data:a});case 14:f.length&&(a.read=f,o.forEach(function(e){return i.host.models.Message.inject({id:e.id,recipientStatus:be.MessageRecipientStatus.READ})}),this.__checkForDeleteOnReadMessages(o)),s.length&&r.forEach(function(e){return i.host.models.Message.inject({id:e.id,recipientStatus:be.MessageRecipientStatus.DELIVERED})});case 16:case"end":return e.stop()}},n,this)}));return e}()},{key:"__checkForDeleteOnReadMessages",value:function(e){var t=this;if(!Array.isArray(e)||!e.every(function(e){return e instanceof Object}))throw new TypeError('Value of argument "messages" violates contract.\n\nExpected:\nObject[]\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return e instanceof Object}))throw new TypeError('Value of argument "messages" violates contract.\n\nExpected:\nObject[]\n\nGot:\n'+a(e));qe["default"].call(e,{dor:!0}).forEach(function(e){return t.setMessageTTLInMinutes(e,1)})}},{key:"setMessageTTLInMinutes",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("number"!=typeof t)throw new TypeError('Value of argument "ttl" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if("number"!=typeof t)throw new TypeError('Value of argument "ttl" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(t));var n=this._resolveMessage(e);if(n){var r=(0,ye["default"])().add(1,"minute").toDate().getTime();this.host.models.Message.inject({id:n.id,ttl:t,expiresAt:r})}}},{key:"deleteExpiredMessages",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?Date.now():arguments[0];t.getTime&&(t=t.getTime()),this.host.models.Message.getAll().filter(function(e){return e.expiresAt&&e.expiresAt<t}).forEach(function(t){return e.host.models.Message.eject(t)})}},{key:"findStatusesPerRecipient",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,Q["default"])(X["default"].mark(function n(e){var t,r,o,u,s=this;return X["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){n.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:if(this.host.requireUser(),t=this._resolveMessage(e)){n.next=8;break}return n.abrupt("return",null);case 8:return n.next=10,this.httpClient.get("/message/:id/status",{urlParams:{id:t.serverId}});case 10:if(r=n.sent,o=r.data,!o.is_recalled){n.next=15;break}return this.onMessageRecalled(t.serverId),n.abrupt("return");case 15:return u=o.statuses.map(function(e){return s.__setMessageStatusPerRecipientFromServerData(t.serverId,e)}).some(function(e){return e}),u&&this.__touchMessage(t),n.abrupt("return",t.statusesPerRecipient);case 18:case"end":return n.stop()}},n,this)}));return e}()}]),t}(de["default"]),o(y.prototype,"__resolveRecipientEntity",[he.privateMethod],(0,w["default"])(y.prototype,"__resolveRecipientEntity"),y.prototype),o(y.prototype,"__sendToUnknownUser",[he.privateMethod],(0,w["default"])(y.prototype,"__sendToUnknownUser"),y.prototype),o(y.prototype,"__normalizeSendOptions",[he.privateMethod],(0,w["default"])(y.prototype,"__normalizeSendOptions"),y.prototype),o(y.prototype,"__ensureOrganization",[he.privateMethod],(0,w["default"])(y.prototype,"__ensureOrganization"),y.prototype),o(y.prototype,"__validateAttachments",[he.privateMethod],(0,w["default"])(y.prototype,"__validateAttachments"),y.prototype),o(y.prototype,"__normalizeMetadata",[he.privateMethod],(0,w["default"])(y.prototype,"__normalizeMetadata"),y.prototype),o(y.prototype,"__getNextSortNumber",[he.privateMethod],(0,w["default"])(y.prototype,"__getNextSortNumber"),y.prototype),o(y.prototype,"__send",[he.privateMethod],(0,w["default"])(y.prototype,"__send"),y.prototype),o(y.prototype,"__setLocalMessageAttachments",[he.privateMethod],(0,w["default"])(y.prototype,"__setLocalMessageAttachments"),y.prototype),o(y.prototype,"__generateAttachmentDescriptor",[he.privateMethod],(0,w["default"])(y.prototype,"__generateAttachmentDescriptor"),y.prototype),o(y.prototype,"__prepareGroupForUsers",[he.privateMethod,u],(0,w["default"])(y.prototype,"__prepareGroupForUsers"),y.prototype),o(y.prototype,"_deleteLocalMessage",[he.privateMethod],(0,w["default"])(y.prototype,"_deleteLocalMessage"),y.prototype),o(y.prototype,"__recallSingle",[he.privateMethod],(0,w["default"])(y.prototype,"__recallSingle"),y.prototype),o(y.prototype,"__setMessageStatusPerRecipientFromServerData",[he.privateMethod],(0,w["default"])(y.prototype,"__setMessageStatusPerRecipientFromServerData"),y.prototype),o(y.prototype,"__touchMessage",[he.privateMethod],(0,w["default"])(y.prototype,"__touchMessage"),y.prototype),o(y.prototype,"_resolveMessage",[he.privateMethod,Ie["default"]],(0,w["default"])(y.prototype,"_resolveMessage"),y.prototype),o(y.prototype,"_getMessageByServerId",[he.privateMethod],(0,w["default"])(y.prototype,"_getMessageByServerId"),y.prototype),o(y.prototype,"_setSingleUserMessageRecipientMessageStatus",[he.privateMethod],(0,w["default"])(y.prototype,"_setSingleUserMessageRecipientMessageStatus"),y.prototype),o(y.prototype,"__canChangeRecipientStatus",[he.privateMethod],(0,w["default"])(y.prototype,"__canChangeRecipientStatus"),y.prototype),o(y.prototype,"find",[s],(0,w["default"])(y.prototype,"find"),y.prototype),o(y.prototype,"__lookupCounterParty",[he.privateMethod],(0,w["default"])(y.prototype,"__lookupCounterParty"),y.prototype),o(y.prototype,"downloadAttachmentURL",[c],(0,w["default"])(y.prototype,"downloadAttachmentURL"),y.prototype),o(y.prototype,"downloadAttachmentBlobAndURL",[f],(0,w["default"])(y.prototype,"downloadAttachmentBlobAndURL"),y.prototype),o(y.prototype,"destroy",[l],(0,w["default"])(y.prototype,"destroy"),y.prototype),o(y.prototype,"__queueMessageStatuses",[he.privateMethod],(0,w["default"])(y.prototype,"__queueMessageStatuses"),y.prototype),o(y.prototype,"__flushQueueMessageStatuses",[he.privateMethod,Ie["default"]],(0,w["default"])(y.prototype,"__flushQueueMessageStatuses"),y.prototype),o(y.prototype,"__setMessagesStatus",[he.privateMethod],(0,w["default"])(y.prototype,"__setMessagesStatus"),y.prototype),o(y.prototype,"__checkForDeleteOnReadMessages",[he.privateMethod],(0,w["default"])(y.prototype,"__checkForDeleteOnReadMessages"),y.prototype),o(y.prototype,"deleteExpiredMessages",[Ie["default"]],(0,w["default"])(y.prototype,"deleteExpiredMessages"),y.prototype),o(y.prototype,"findStatusesPerRecipient",[d],(0,w["default"])(y.prototype,"findStatusesPerRecipient"),y.prototype),p=y))||p);t["default"]=$e,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h["default"])(e);if(!Array.isArray(e)){var o=(0,F["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h["default"])(e);if(!Array.isArray(e)){var o=(0,F["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f,l,d,p=n(7),y=r(p),g=n(10),h=r(g),v=n(11),m=r(v),b=n(123),w=r(b),E=n(37),x=r(E),_=n(38),k=r(_),I=n(120),T=r(I),O=n(31),j=r(O),A=n(137),M=r(A),G=n(19),V=r(G),z=n(139),C=r(z),S=n(162),P=r(S),q=n(18),U=r(q),N=n(9),$=r(N),R=n(6),F=r(R),D=n(8),B=r(D),L=n(3),K=r(L),Z=n(1),W=r(Z),H=n(2),X=r(H),Y=n(5),Q=r(Y),J=n(4),ee=r(J),te=n(12),ne=r(te),re=n(17),oe=r(re),ae=n(16),ie=n(13),ue=n(14),se=(u=(0,ae.decorator)(),s=(0,ae.decorator)(),(0,ie.classWithPrivateMethods)((d=l=function(e){function t(){return(0,W["default"])(this,t),(0,Q["default"])(this,(0,K["default"])(t).apply(this,arguments))}return(0,ee["default"])(t,e),(0,X["default"])(t,[{key:"fullUpdate",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,B["default"])($["default"].mark(function n(e,t,r){return $["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if(t instanceof Object){n.next=4;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(t));case 4:if("string"==typeof r){n.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){n.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if(t instanceof Object){n.next=10;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(t));case 10:if("string"==typeof r){n.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:if(r){n.next=14;break}throw new oe["default"].ValidationError("organizationId","required");case 14:if(!(this.host.config.maxMetadataKeyCount>0&&(0,F["default"])(t).length>this.host.config.maxMetadataKeyCount)){n.next=16;break}throw new oe["default"].ValidationError("entireData","invalid","Total number of metadata keys is "+(0,F["default"])(t)+" and should not exceed "+this.host.config.maxMetadataKeyCount);case 16:return this.host.requireUser(),e=this._resolveModelId(e),n.prev=18,n.next=21,this.host.api.metadata.update(e,t,r);case 21:return this.__injectMetadata(e,r,t),n.abrupt("return",t);case 25:if(n.prev=25,n.t0=n["catch"](18),!n.t0.response||404!=n.t0.response.status){n.next=31;break}throw new oe["default"].NotFoundError("metadata",e);case 31:throw n.t0;case 32:case"end":return n.stop()}},n,this,[[18,25]])}));return e}()},{key:"update",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,B["default"])($["default"].mark(function n(e,t,r){var o,u;return $["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if(t instanceof Object){n.next=4;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(t));case 4:if("string"==typeof r){n.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){n.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if(t instanceof Object){n.next=10;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(t));case 10:if("string"==typeof r){n.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:if(r){n.next=14;break}throw new oe["default"].ValidationError("organizationId","required");case 14:return n.next=16,this.find(e,r);case 16:return o=n.sent,u=(0,U["default"])({},o,t),n.abrupt("return",this.fullUpdate(e,u,r));case 19:case"end":return n.stop()}},n,this)}));return e}()},{key:"find",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,B["default"])($["default"].mark(function n(e,t){var r;return $["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if("string"==typeof e||e instanceof Object){n.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if(t){n.next=10;break}throw new oe["default"].ValidationError("organizationId","required");case 10:return this.host.requireUser(),e=this._resolveModelId(e),n.prev=12,n.next=15,this.host.api.metadata.find(e,t);case 15:return r=n.sent,this.__injectMetadata(e,t,r),n.abrupt("return",r);case 20:if(n.prev=20,n.t0=n["catch"](12),!n.t0.response||404!=n.t0.response.status){n.next=26;break}throw new oe["default"].NotFoundError("metadata",e);case 26:throw n.t0;case 27:case"end":return n.stop()}},n,this,[[12,20]])}));return e}()},{key:"findMulti",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,B["default"])($["default"].mark(function n(e,t){var r,o,u,s,c=this;return $["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){n.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){n.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+a(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if(t){n.next=10;break}throw new oe["default"].ValidationError("organizationId","required");case 10:return this.host.requireUser(),e=(0,P["default"])((0,ue.arrayWrap)(e).map(this._resolveModelId.bind(this))),r=(0,C["default"])(e,20),o=r.map(function(e){return c.__findMultiPaged(e,t)}),n.next=16,V["default"].all(o);case 16:return u=n.sent,s=M["default"].apply(void 0,[{}].concat((0,j["default"])(u))),n.abrupt("return",s);case 19:case"end":return n.stop()}},n,this)}));return e}()},{key:"__findMultiPaged",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,B["default"])($["default"].mark(function n(e,t){var r,o,u,s,c,f,l,d,p,y,g,h,v,m,b,E;return $["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){n.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){n.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:return n.prev=8,n.next=11,this.host.api.metadata.findMulti(e,t);case 11:if(r=n.sent,l=(0,T["default"])(r),l&&("function"==typeof l[k["default"]]||Array.isArray(l))){n.next=15;break}throw new TypeError("Expected _Object$entries to be iterable, got "+a(l));case 15:if(l&&("function"==typeof l[k["default"]]||Array.isArray(l))){n.next=17;break}throw new TypeError("Expected _Object$entries to be iterable, got "+i(l));case 17:for(o=!0,u=!1,s=void 0,n.prev=20,c=(0,x["default"])(l);!(o=(f=c.next()).done);o=!0)d=(0,w["default"])(f.value,2),p=d[0],y=d[1],y&&this.__injectMetadata(p,t,y);n.next=28;break;case 24:n.prev=24,n.t0=n["catch"](20),u=!0,s=n.t0;case 28:n.prev=28,n.prev=29,!o&&c["return"]&&c["return"]();case 31:if(n.prev=31,!u){n.next=34;break}throw s;case 34:return n.finish(31);case 35:return n.finish(28);case 36:return n.abrupt("return",r);case 39:if(n.prev=39,n.t1=n["catch"](8),!n.t1.response||404!=n.t1.response.status){n.next=84;break}if(g={},e&&("function"==typeof e[k["default"]]||Array.isArray(e))){n.next=45;break}throw new TypeError("Expected ids to be iterable, got "+a(e));case 45:if(e&&("function"==typeof e[k["default"]]||Array.isArray(e))){n.next=47;break}throw new TypeError("Expected ids to be iterable, got "+i(e));case 47:h=!0,v=!1,m=void 0,n.prev=50,b=(0,x["default"])(e);case 52:if(h=(E=b.next()).done){n.next=67;break}return p=E.value,n.prev=54,n.next=57,this.find(p,t);case 57:g[p]=n.sent,n.next=64;break;case 60:if(n.prev=60,n.t2=n["catch"](54),n.t2.code==oe["default"].NotFoundError.CODE){n.next=64;break}throw n.t2;case 64:h=!0,n.next=52;break;case 67:n.next=73;break;case 69:n.prev=69,n.t3=n["catch"](50),v=!0,m=n.t3;case 73:n.prev=73,n.prev=74,!h&&b["return"]&&b["return"]();case 76:if(n.prev=76,!v){n.next=79;break}throw m;case 79:return n.finish(76);case 80:return n.finish(73);case 81:return n.abrupt("return",g);case 84:throw n.t1;case 85:case"end":return n.stop()}},n,this,[[8,39],[20,24,28,36],[29,,31,35],[50,69,73,81],[54,60],[74,,76,80]])}));return e}()},{key:"__injectMetadata",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));var r=e+":"+t;this.host.models.Metadata.inject({id:r,data:n,entityId:e,organizationId:t})}}]),t}(ne["default"]),l.METADTA_TYPES=["user","group"],f=d,o(f.prototype,"find",[u],(0,m["default"])(f.prototype,"find"),f.prototype),o(f.prototype,"findMulti",[s],(0,m["default"])(f.prototype,"findMulti"),f.prototype),o(f.prototype,"__findMultiPaged",[ie.privateMethod],(0,m["default"])(f.prototype,"__findMultiPaged"),f.prototype),o(f.prototype,"__injectMetadata",[ie.privateMethod],(0,m["default"])(f.prototype,"__injectMetadata"),f.prototype),c=f))||c);t["default"]=se,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p["default"])(e);if(!Array.isArray(e)){var o=(0,z["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,p["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p["default"])(e);if(!Array.isArray(e)){var o=(0,z["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,p["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f=n(7),l=r(f),d=n(10),p=r(d),y=n(11),g=r(y),h=n(9),v=r(h),m=n(8),b=r(m),w=n(3),E=r(w),x=n(1),_=r(x),k=n(2),I=r(k),T=n(5),O=r(T),j=n(4),A=r(j),M=n(33),G=r(M),V=n(6),z=r(V),C=n(122),S=r(C),P=n(12),q=r(P),U=n(134),N=r(U),$=n(13),R=n(16),F=n(26),D=r(F),B=n(23),L=r(B),K=n(48),Z=r(K),W={account:"user",group:"group"},H=new S["default"]((0,z["default"])(W)),X=(0,G["default"])(W).concat(["conversation"]),Y=525600,Q=(u=(0,R.decorator)(),(0,$.classWithPrivateMethods)((c=function(e){function t(){return(0,_["default"])(this,t),(0,O["default"])(this,(0,E["default"])(t).apply(this,arguments))}return(0,A["default"])(t,e),(0,I["default"])(t,[{key:"mounted",value:function(){this._muteEntriesByConversationId={},this._fetched=!1}},{key:"dispose",value:function(){this._muteEntriesByConversationId=null,this._fetched=!1}},{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,b["default"])(v["default"].mark(function n(){var e,t;return v["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this._fetched){n.next=6;break}return n.next=3,this.host.api.mute.findAll();case 3:t=n.sent,(e=t.filter(function(e){return H.has(e.sender_type)}).map(this._parseMuteEntry),N["default"]).call(e,this._isExpired).forEach(this._addEntry),this._fetched=!0;case 6:return n.abrupt("return",(0,G["default"])(this._muteEntriesByConversationId));case 7:case"end":return n.stop()}},n,this)}));return e}()},{key:"_parseMuteEntry",value:function(e){var t=+e.mute_duration,n=new Date(1e3*+e.mute_start).getTime(),r=(0,Z["default"])(n).add(t,"minute").toDate().getTime(),o=W[e.sender_type],a=e.caller_organization||e.organization_id,i=e.sender_token,u=this.host.conversations.getConversationKey(o,i,a);return{conversationId:u,durationInMinutes:t,startedAt:n,expiresAt:r,organizationId:a,entityId:i,entityType:o}}},{key:"_isExpired",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "entry" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "entry" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));return e.expiresAt<Date.now()}},{key:"_addEntry",value:function(e){var t=e.conversationId,n=e.entityType,r=e.entityId,o=e.organizationId,a=e.durationInMinutes,i=e.startedAt;t=t||this.host.conversations.getConversationKey(n,r,o),i=i||Date.now();var u=(0,Z["default"])(i).add(a,"minute").toDate().getTime(),s={conversationId:t,durationInMinutes:a,startedAt:i,expiresAt:u,organizationId:o,entityId:r,entityType:n};return this.host.models.Conversation.touch(t),this._muteEntriesByConversationId[t]=s,s}},{key:"_removeEntry",value:function(e){var t=e.conversationId,n=e.entityType,r=e.entityId,o=e.organizationId;t=t||this.host.conversations.getConversationKey(n,r,o),delete this._muteEntriesByConversationId[t],this.host.models.Conversation.touch(t)}},{key:"_removeAllEntries",value:function(){var e=this;(0,G["default"])(this._muteEntriesByConversationId).forEach(function(t){return e._removeEntry(t)})}},{key:"getByConversationId",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));var t=this._muteEntriesByConversationId[e];return t?this._isExpired(t)?(delete this._muteEntriesByConversationId[e],null):t:null}},{key:"unmuteAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,b["default"])(v["default"].mark(function n(){return v["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.mute.unmuteAll();case 2:case"end":return e.stop()}},n,this)}));return e}()},{key:"mute",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,b["default"])(v["default"].mark(function n(e,t,r){var o;return v["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));
case 2:if("number"==typeof t){n.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(t));case 4:if(null==r||"string"==typeof r){n.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){n.next=8;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("number"==typeof t){n.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(t));case 10:if(null==r||"string"==typeof r){n.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(r));case 12:if(o=this._resolveEntity(e,X)){n.next=15;break}throw new Error("entity "+e+" not found");case 15:n.t0=o.$entityType,n.next="conversation"===n.t0?18:"user"===n.t0?19:"group"===n.t0?21:"organization"===n.t0?22:23;break;case 18:return n.abrupt("return",this.mute(o.counterParty,t,o.organizationId));case 19:return D["default"].notEmpty("organizationId",r),n.abrupt("return",this.muteUser(o,t,r));case 21:return n.abrupt("return",this.muteGroup(o,t));case 22:return n.abrupt("return",this.muteOrganization(o,t));case 23:case"end":return n.stop()}},n,this)}));return e}()},{key:"unmute",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,b["default"])(v["default"].mark(function n(e,t){var r;return v["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if(null==t||"string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(t));case 4:if("string"==typeof e||e instanceof Object){n.next=6;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if(null==t||"string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(t));case 8:if(r=this._resolveEntity(e,X)){n.next=11;break}throw new Error("entity "+e+" not found");case 11:n.t0=r.$entityType,n.next="conversation"===n.t0?14:"user"===n.t0?15:"group"===n.t0?17:"organization"===n.t0?18:19;break;case 14:return n.abrupt("return",this.unmute(r.counterParty,r.organizationId));case 15:return D["default"].notEmpty("organizationId",t),n.abrupt("return",this.unmuteUser(r,t));case 17:return n.abrupt("return",this.unmuteGroup(r));case 18:return n.abrupt("return",this.unmuteOrganization(r));case 19:case"end":return n.stop()}},n,this)}));return e}()},{key:"muteUser",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,b["default"])(v["default"].mark(function n(e,t,r){return v["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("number"==typeof t){n.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(t));case 4:if("string"==typeof r||r instanceof Object){n.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){n.next=8;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("number"==typeof t){n.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(t));case 10:if("string"==typeof r||r instanceof Object){n.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(r));case 12:return this.__validateDurationInMinutes(t),e=this._resolveModelIdWithTypes(e,"user"),r=this._resolveModelId(r),n.next=17,this.host.api.mute.muteUser(e,t,r,{recipientOrganizationId:r});case 17:this._addEntry({entityType:"user",entityId:e,organizationId:r,durationInMinutes:t});case 18:case"end":return n.stop()}},n,this)}));return e}()},{key:"unmuteUser",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,b["default"])(v["default"].mark(function n(e,t){return v["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof t||t instanceof Object){n.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 4:if("string"==typeof e||e instanceof Object){n.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof t||t instanceof Object){n.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:return e=this._resolveModelIdWithTypes(e,"user"),t=this._resolveModelId(t),n.next=12,this.host.api.mute.unmuteUser(e,t,{recipientOrganizationId:t});case 12:this._removeEntry({entityType:"user",entityId:e,organizationId:t});case 13:case"end":return n.stop()}},n,this)}));return e}()},{key:"muteGroup",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,b["default"])(v["default"].mark(function n(e,t,r){var o;return v["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("number"==typeof t){n.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(t));case 4:if(null==r||"string"==typeof r||null==r||r instanceof Object){n.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){n.next=8;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("number"==typeof t){n.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(t));case 10:if(null==r||"string"==typeof r||null==r||r instanceof Object){n.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(r));case 12:return this.__validateDurationInMinutes(t),o=this._resolveEntity(e,"group"),o?(e=o.id,r=o.organizationId):r=this._resolveModelId(r),D["default"].notEmpty("organizationId",r),n.next=18,this.host.api.mute.muteGroup(e,t,r);case 18:this._addEntry({entityType:"group",entityId:e,organizationId:r,durationInMinutes:t});case 19:case"end":return n.stop()}},n,this)}));return e}()},{key:"unmuteGroup",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,b["default"])(v["default"].mark(function n(e,t){var r;return v["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if(null==t||"string"==typeof t||null==t||t instanceof Object){n.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+i(t));case 4:if("string"==typeof e||e instanceof Object){n.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if(null==t||"string"==typeof t||null==t||t instanceof Object){n.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(t));case 8:return r=this._resolveEntity(e,"group"),r?(e=r.id,t=r.organizationId):(D["default"].notEmpty("organizationId",t),t=this._resolveModelId(t)),n.next=12,this.host.api.mute.unmuteGroup(e,t);case 12:this._removeEntry({entityType:"group",entityId:e,organizationId:t});case 13:case"end":return n.stop()}},n,this)}));return e}()},{key:"reactToMuteEvent",value:function(e){if(e.data.token==this.host.currentUser.id){var t=e.data.action;if("clear"===t)return void this._removeAllEntries();var n=this._parseMuteEntry(e.data);switch(t){case"add":this._muteEntriesByConversationId[n.conversationId]=n;break;case"del":delete this._muteEntriesByConversationId[n.conversationId]}}}},{key:"__validateDurationInMinutes",value:function(e){if("number"!=typeof e)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(e));if("number"!=typeof e)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(e));(0>e||e>Y||e%1!==0)&&D["default"].raise("durationInMinutes","invalid","should be a positive integer from 1 to "+Y+" (1 year)")}}]),t}(q["default"]),o(c.prototype,"findAll",[u],(0,g["default"])(c.prototype,"findAll"),c.prototype),o(c.prototype,"_parseMuteEntry",[$.privateMethod,L["default"]],(0,g["default"])(c.prototype,"_parseMuteEntry"),c.prototype),o(c.prototype,"_addEntry",[$.privateMethod,L["default"]],(0,g["default"])(c.prototype,"_addEntry"),c.prototype),o(c.prototype,"_removeEntry",[$.privateMethod,L["default"]],(0,g["default"])(c.prototype,"_removeEntry"),c.prototype),o(c.prototype,"_removeAllEntries",[$.privateMethod],(0,g["default"])(c.prototype,"_removeAllEntries"),c.prototype),o(c.prototype,"__validateDurationInMinutes",[$.privateMethod],(0,g["default"])(c.prototype,"__validateDurationInMinutes"),c.prototype),s=c))||s);t["default"]=Q,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h["default"])(e);if(!Array.isArray(e)){var o=(0,y["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h["default"])(e);if(!Array.isArray(e)){var o=(0,y["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f,l=n(7),d=r(l),p=n(6),y=r(p),g=n(10),h=r(g),v=n(11),m=r(v),b=n(24),w=r(b),E=n(65),x=r(E),_=n(46),k=r(_),I=n(43),T=r(I),O=n(15),j=r(O),A=n(160),M=r(A),G=n(42),V=r(G),z=n(20),C=r(z),S=n(9),P=r(S),q=n(8),U=r(q),N=n(3),$=r(N),R=n(1),F=r(R),D=n(2),B=r(D),L=n(5),K=r(L),Z=n(4),W=r(Z),H=n(12),X=r(H),Y=n(16),Q=n(17),J=r(Q),ee=n(28),te=r(ee),ne=n(41),re=r(ne),oe=n(36),ae=r(oe),ie=n(68),ue=r(ie),se=n(23),ce=r(se),fe=n(13),le=(u=(0,Y.decorator)({memoize:!0}),s=(0,Y.decorator)(),(0,fe.classWithPrivateMethods)((f=function(e){function t(){return(0,F["default"])(this,t),(0,K["default"])(this,(0,$["default"])(t).apply(this,arguments))}return(0,W["default"])(t,e),(0,B["default"])(t,[{key:"mounted",value:function(){this.host.models.Conversation.on("afterInject",this._onConversationChange),this.host.models.Conversation.on("afterEject",this._onConversationChange)}},{key:"dispose",value:function(){this.host.models.Conversation.off("afterInject",this._onConversationChange),this.host.models.Conversation.off("afterEject",this._onConversationChange),Y.decorator.clear(this.findAll)}},{key:"create",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,U["default"])(P["default"].mark(function n(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{name:void 0,ttl:void 0,dor:void 0,allowPublicGroups:void 0,pinLock:void 0,settingsRestricted:void 0,autologoutTime:void 0,lifecycleCallback:void 0,groupLifespan:void 0,welcomeEmailSettings:void 0}:arguments[0];return P["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.host.requireUser(),n.abrupt("return",this.httpClient.post("/organization",{data:t}).then(function(n){var r=n.getHeader("TT-X-Organization-Key"),o=e.host.models.Organization.inject({id:r,name:t.name});return o}));case 2:case"end":return n.stop()}},n,this)}));return e}()},{key:"update",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,U["default"])(P["default"].mark(function n(){var e,t=this,r=arguments.length<=0||void 0===arguments[0]?{id:void 0,name:void 0,ttl:void 0,dor:void 0,allowPublicGroups:void 0,pinLock:void 0,settingsRestricted:void 0,autologoutTime:void 0,lifecycleCallback:void 0,groupLifespan:void 0,welcomeEmailSettings:void 0,welcomeEmailLogo:void 0,autoSendWelcomeEmail:void 0}:arguments[0];return P["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.host.requireUser(),e=ae["default"].underscoreObject({name:r.name,ttl:r.ttl,dor:r.dor,allowPublicGroups:r.allowPublicGroups,pinLock:r.pinLock,settingsRestricted:r.settingsRestricted,autologoutTime:r.autologoutTime,lifecycleCallback:r.lifecycleCallback,groupLifespan:r.groupLifespan,welcomeEmailSettings:r.welcomeEmailSettings,welcomeEmailLogo:r.welcomeEmailLogo,autoSendWelcomeEmail:r.autoSendWelcomeEmail}),n.abrupt("return",this.httpClient.post("/organization/:id",{urlParams:{id:r.id},data:e}).then(function(n){var o=t.host.models.Organization.inject((0,C["default"])({id:r.id},e));return o}));case 3:case"end":return n.stop()}},n,this)}));return e}()},{key:"findAll",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,U["default"])(P["default"].mark(function n(){var e,t=this,r=arguments.length<=0||void 0===arguments[0]?{onlyApproved:!1}:arguments[0];return P["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.host.requireUser(),n.next=3,this._findAll();case 3:return e=n.sent,r.onlyApproved&&(e=(0,V["default"])(e,{pending:!1})),e=(0,M["default"])(e,function(e){return e.name.toLowerCase()}),e.forEach(function(e){return t.__reloadConversations(e)}),n.abrupt("return",e);case 8:case"end":return n.stop()}},n,this)}));return e}()},{key:"refreshAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,U["default"])(P["default"].mark(function n(){return P["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._findAll();case 2:case"end":return e.stop()}},n,this)}));return e}()},{key:"_findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,U["default"])(P["default"].mark(function n(){var e,t=this;return P["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.host.api.organizations.findAllOfUser(this.host.getCurrentUser().id);case 2:return e=n.sent,e=e.map(function(e){return t.host.models.Organization.inject(e)}),n.abrupt("return",e);case 5:case"end":return n.stop()}},n,this)}));return e}()},{key:"find",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,U["default"])(P["default"].mark(function n(e){var t,r,o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return P["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){n.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:if(o=(0,j["default"])(o,{ignoreNotFound:!1,bypassCache:!1}),this.host.requireUser(),t=void 0,o.bypassCache){n.next=11;break}if(t=this.host.models.Organization.get(e),!t){n.next=11;break}return n.abrupt("return",t);case 11:return n.next=13,this.host.api.organizations.find(this.host.getCurrentUser().id,e);case 13:if(r=n.sent,!r){n.next=19;break}t=this.host.models.Organization.inject(r),this.__reloadConversations(t),n.next=21;break;case 19:if(o.ignoreNotFound){n.next=21;break}throw new J["default"].NotFoundError(this.host.models.Organization.name,e);case 21:return n.abrupt("return",t);case 22:case"end":return n.stop()}},n,this)}));return e}()},{key:"getSettingValue",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));e=this._resolveModelId(e);var n=this.getById(e);if(!n||!n.settings)return null;var r=(0,T["default"])(n.settings,{name:t});return r?r.value:null}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Organization.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Organization.getMulti(e)}},{key:"_onConversationChange",value:function(e,t){this.__reloadConversations(t.organization)}},{key:"__reloadConversations",value:function(e){var t;if(e){var n=(0,k["default"])(e,["conversations","unreadCount"]),r=(t=(t=this.host.models.Conversation.getAll(),te["default"]).call(t,{organizationId:e.id}),re["default"]).call(t,["lastEventMessageSortNumber","_origIndex"],["desc","asc"]),o=(0,x["default"])(r,function(e){return e.unreadCount}),a={conversations:r,unreadCount:o},i=!1;(0,w["default"])(n,function(t,n){(0,ue["default"])(t,a[n])||(e[n]=a[n],i=!0)}),i&&this.host.models.Organization.inject(e)}}}]),t}(X["default"]),o(f.prototype,"findAll",[u],(0,m["default"])(f.prototype,"findAll"),f.prototype),o(f.prototype,"refreshAll",[Y.decorator],(0,m["default"])(f.prototype,"refreshAll"),f.prototype),o(f.prototype,"_findAll",[fe.privateMethod],(0,m["default"])(f.prototype,"_findAll"),f.prototype),o(f.prototype,"find",[s],(0,m["default"])(f.prototype,"find"),f.prototype),o(f.prototype,"_onConversationChange",[fe.privateMethod,ce["default"]],(0,m["default"])(f.prototype,"_onConversationChange"),f.prototype),o(f.prototype,"__reloadConversations",[fe.privateMethod],(0,m["default"])(f.prototype,"__reloadConversations"),f.prototype),c=f))||c);t["default"]=le,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a=n(3),i=r(a),u=n(1),s=r(u),c=n(2),f=r(c),l=n(5),d=r(l),p=n(4),y=r(p),g=n(12),h=r(g),v=n(25),m=n(13),b=n(23),w=(r(b),(0,m.classWithPrivateMethods)(o=function(e){function t(e,n){return(0,s["default"])(this,t),(0,d["default"])(this,(0,i["default"])(t).call(this,e,n))}return(0,y["default"])(t,e),(0,f["default"])(t,[{key:"mounted",value:function(){this._data={}}},{key:"dispose",value:function(){this._data=null}},{key:"reactToPresenceEvent",value:function(e){this.set(e.data.from,v.PresenceStatus.resolve(e.data.type))}},{key:"set",value:function(e,t){var n=this._data[e]!==t;if(n){var r=this.host.models.User.get(e);this._data[e]=t,this.emit("change",{userId:e,presence:t,user:r})}}},{key:"get",value:function(e){return e==this.host.getCurrentUser().id?v.PresenceStatus.AVAILABLE:this._data[e]||null}}]),t}(h["default"]))||o);t["default"]=w,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a,i,u=n(11),s=r(u),c=n(9),f=r(c),l=n(19),d=r(l),p=n(24),y=r(p),g=n(152),h=r(g),v=n(149),m=r(v),b=n(143),w=r(b),E=n(30),x=r(E),_=n(6),k=r(_),I=n(62),T=r(I),O=n(8),j=r(O),A=n(3),M=r(A),G=n(1),V=r(G),z=n(2),C=r(z),S=n(5),P=r(S),q=n(4),U=r(q),N=n(33),$=r(N),R=n(12),F=r(R),D=n(16),B=n(17),L=r(B),K=n(36),Z=r(K),W=n(51),H=n(14),X={user:"account",distributionList:"distribution_list",group:"group",organization:"organization",room:"public_group"},Y=(0,$["default"])(X),Q=(a=(0,D.decorator)(),i=function(e){function t(){return(0,V["default"])(this,t),(0,P["default"])(this,(0,M["default"])(t).apply(this,arguments))}return(0,U["default"])(t,e),(0,C["default"])(t,[{key:"query",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,j["default"])(f["default"].mark(function n(e){var t,r,o,a,i,u,s=this,c=e.types,l=void 0===c?[]:c,p=e.query,g=void 0===p?{}:p,v=e.continuation,b=void 0===v?null:v,E=e.includeDisabled,_=void 0===E?!1:E,I=e.excludeIds,O=void 0===I?[]:I,j=e.excludeSelf,A=void 0===j?!1:j,M=e.resultsFormat,G=void 0===M?"entities":M,V=e.organizationId,z=void 0===V?null:V,C=e.organizationIds,S=void 0===C?[]:C,P=e.sort,q=void 0===P?[]:P,U=e.includeMetadata,N=void 0===U?!1:U;return f["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=l.length){e.next=2;break}throw new L["default"].ValidationError("types","required","no types specified");case 2:if(l=l.map(function(e){return X[e]}),t=(0,T["default"])(l,Y),!(t.length>0)){e.next=6;break}throw new L["default"].ValidationError("types","invalid","invalid types: "+t.join(", "));case 6:if(z&&(S=[z]),0!=S.length){e.next=9;break}throw new L["default"].ValidationError("organizationIds","invalid","search must be done in a context of an organization");case 9:return"ids"===G&&(G="tokens"),r={type:l,include_disabled:_,directory:S,results_format:G},b&&(r.continuation=b),q&&q.length&&(r.sort=q),O=(0,H.arrayWrap)(O),g&&(0,k["default"])(g).length>0&&(r.bool={must:Z["default"].underscoreObject(g)}),e.next=17,this.httpClient.post("/search",{data:r});case 17:if(o=e.sent,a=o.data.results,i=this.host.currentUser.id,u=(0,x["default"])(a,function(e,t){var n=t.type,r=t.entity,o=t.organization_id;if(0!=(0,k["default"])(r).length){"tigertext:entity:account"===n&&(0,H.replaceKey)(r,"status","account_status");var a=s.host.injectModel(r,n);if(!(O.length&&O.includes(a.id)||A&&a.id===i)){if(!a)return void s.logger.warn("no entity for ",t);var u=new W.SearchResult(a,o);e.push(u)}}},[]),!N){e.next=23;break}return e.delegateYield(f["default"].mark(function n(){var e,t,r;return f["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e=(0,w["default"])(u,"organizationId"),t=(0,m["default"])(u,"entityId"),r=(0,x["default"])(e,function(e,n,r){e.push(s.host.metadata.findMulti((0,h["default"])(n,"entityId"),r).then(function(e){(0,y["default"])(e,function(e,n){return t[n].metadata=e})}))},[]),!(r.length>0)){n.next=6;break}return n.next=6,d["default"].all(r);case 6:case"end":return n.stop()}},n,s)})(),"t0",23);case 23:return e.abrupt("return",u);case 24:case"end":return e.stop()}},n,this)}));return e}()}]),t}(F["default"]),o(i.prototype,"query",[a],(0,s["default"])(i.prototype,"query"),i.prototype),i);t["default"]=Q,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var o=(0,d["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,y["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var o=(0,d["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,y["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c=n(7),f=r(c),l=n(6),d=r(l),p=n(10),y=r(p),g=n(11),h=r(g),v=n(20),m=r(v),b=n(9),w=r(b),E=n(8),x=r(E),_=n(33),k=r(_),I=n(3),T=r(I),O=n(1),j=r(O),A=n(2),M=r(A),G=n(5),V=r(G),z=n(4),C=r(z),S=n(12),P=r(S),q=n(60),U=r(q),N=n(40),$=r(N),R=n(29),F=r(R),D=n(23),B=r(D),L=n(13),K="global",Z=(0,L.classWithPrivateMethods)((s=function(e){function t(){return(0,j["default"])(this,t),(0,V["default"])(this,(0,T["default"])(t).apply(this,arguments))}return(0,C["default"])(t,e),(0,M["default"])(t,[{key:"mounted",value:function(){this._typers={},this._currentUserTyping={},this.host.on("message:sending",this._onMessageSending)}},{key:"dispose",value:function(){var e;(e=(e=(e=(e=this._typers,U["default"]).call(e),F["default"]).call(e,k["default"]),$["default"]).call(e),F["default"]).call(e,"timer").forEach(function(e){return clearTimeout(e)}),(e=(e=this._currentUserTyping,U["default"]).call(e),F["default"]).call(e,"timer").forEach(function(e){return clearTimeout(e)}),this._typers=null,this.host.removeListener("message:sending",this._onMessageSending)}},{key:"reactToIsTypingEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));this.host.requireUser();var t=e.data.sender_token;if(t!==this.host.getCurrentUser().id){var n=e.data.group_token,r=n||K,o="typing"===e.data.status;this._setTypingStatusOfUser(r,t,o)}}},{key:"startTyping",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,x["default"])(w["default"].mark(function n(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];return w["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e||e instanceof Object){n.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){n.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return e=this._resolveModelId(e),this.host.requireUser(),n.next=8,this.host.api.messages.startTyping(e);case 8:e in this._currentUserTyping&&clearTimeout(this._currentUserTyping[e].timer),this._currentUserTyping[e]={},t&&(this._currentUserTyping[e].timer=this._createClearTimerForCurrentUser(e,"number"==typeof t?t:void 0));case 11:case"end":return n.stop()}},n,this)}));return e}()},{key:"stopTyping",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,x["default"])(w["default"].mark(function n(e){return w["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));
case 4:return e=this._resolveModelId(e),this.host.requireUser(),e in this._currentUserTyping&&(clearTimeout(this._currentUserTyping[e].timer),delete this._currentUserTyping[e]),t.next=9,this.host.api.messages.stopTyping(e);case 9:case"end":return t.stop()}},n,this)}));return e}()},{key:"_setTypingStatusOfUser",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("boolean"!=typeof n)throw new TypeError('Value of argument "isTyping" violates contract.\n\nExpected:\nbool\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("boolean"!=typeof n)throw new TypeError('Value of argument "isTyping" violates contract.\n\nExpected:\nbool\n\nGot:\n'+a(n));if(n){this._typers[e]||(this._typers[e]={});var o=t in this._typers[e];if(o&&clearTimeout(this._typers[e][t].timer),this._typers[e][t]={timer:this._createClearTimerForOtherUser(e,t)},o)return}else{if(!this._typers[e]||!this._typers[e][t])return;clearTimeout(this._typers[e][t].timer),delete this._typers[e][t]}var u=(0,m["default"])({userId:t},e!==K?{groupId:e}:null,{isTyping:n,timedOut:r});this.emit("change",u)}},{key:"_createClearTimerForOtherUser",value:function(e,t){var n=this;if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return setTimeout(function(){n.logger.info("auto stop typing for other typer",e,t),n._setTypingStatusOfUser(e,t,!1,!0)},this.host.config.clearTypingStatusTimeout)}},{key:"_createClearTimerForCurrentUser",value:function(e,t){var n=this;if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(null!=t&&"number"!=typeof t)throw new TypeError('Value of argument "timeout" violates contract.\n\nExpected:\n?number\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(null!=t&&"number"!=typeof t)throw new TypeError('Value of argument "timeout" violates contract.\n\nExpected:\n?number\n\nGot:\n'+a(t));return setTimeout(function(){n.logger.info("auto stop typing for current user",e),n.stopTyping(e)},"number"==typeof t?t:this.host.config.clearTypingStatusTimeout)}},{key:"isUserTyping",value:function(e){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(e));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(e));return e=this._resolveModelId(e),this._isUserTypingInContext(K,e)}},{key:"isCurrentUserTyping",value:function(e){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(e));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(e));return e=this._resolveModelId(e),e in this._currentUserTyping}},{key:"isUserTypingInGroup",value:function(e,t){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(e));if(!(t instanceof Object||"string"==typeof t))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(t));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(e));if(!(t instanceof Object||"string"==typeof t))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(t));return t=this._resolveModelId(t),e=this._resolveModelId(e),this._isUserTypingInContext(e,t)}},{key:"_isUserTypingInContext",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return this._typers[e]?t in this._typers[e]:!1}},{key:"_onMessageSending",value:function(e){this.stopTyping(e.counterPartyId)}}]),t}(P["default"]),o(s.prototype,"_setTypingStatusOfUser",[L.privateMethod],(0,h["default"])(s.prototype,"_setTypingStatusOfUser"),s.prototype),o(s.prototype,"_createClearTimerForOtherUser",[L.privateMethod],(0,h["default"])(s.prototype,"_createClearTimerForOtherUser"),s.prototype),o(s.prototype,"_createClearTimerForCurrentUser",[L.privateMethod],(0,h["default"])(s.prototype,"_createClearTimerForCurrentUser"),s.prototype),o(s.prototype,"_isUserTypingInContext",[L.privateMethod],(0,h["default"])(s.prototype,"_isUserTypingInContext"),s.prototype),o(s.prototype,"_onMessageSending",[L.privateMethod,B["default"]],(0,h["default"])(s.prototype,"_onMessageSending"),s.prototype),u=s))||u;t["default"]=Z,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h["default"])(e);if(!Array.isArray(e)){var o=(0,y["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h["default"])(e);if(!Array.isArray(e)){var o=(0,y["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f,l=n(7),d=r(l),p=n(6),y=r(p),g=n(10),h=r(g),v=n(11),m=r(v),b=n(15),w=r(b),E=n(19),x=r(E),_=n(9),k=r(_),I=n(8),T=r(I),O=n(3),j=r(O),A=n(1),M=r(A),G=n(2),V=r(G),z=n(5),C=r(z),S=n(4),P=r(S),q=n(54),U=r(q),N=n(57),$=r(N),R=n(12),F=r(R),D=n(17),B=r(D),L=n(16),K=new $["default"].MD5,Z=(u=(0,L.decorator)(),s=(0,L.decorator)(),c=(0,L.decorator)(),f=function(e){function t(){return(0,M["default"])(this,t),(0,C["default"])(this,(0,j["default"])(t).apply(this,arguments))}return(0,P["default"])(t,e),(0,V["default"])(t,[{key:"signIn",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,T["default"])(k["default"].mark(function n(e,t){var r,o,u,s,c,f=arguments.length<=2||void 0===arguments[2]?{udid:void 0}:arguments[2];return k["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof t){n.next=4;break}throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 4:if("string"==typeof e){n.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof t){n.next=8;break}throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:return r={Authorization:this.getSignInAuthHeader(e,t)},o={user_id:e,password:t,push_routing:this.config.pushAgent,version:this.config.version,device_id:f.udid,metadata:{tt_product_version:"tigerconnect_"+this.config.version,user_agent:global.navigator&&global.navigator.userAgent}},n.next=12,this.httpClient.post("/login",{headers:r,data:o});case 12:return u=n.sent,s=this.host.models.User.inject(u.data.user),c=u.data.auth,n.abrupt("return",{user:s,auth:c});case 16:case"end":return n.stop()}},n,this)}));return e}()},{key:"getSignInAuthHeader",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return this.constructor.getSignInAuthHeader(this.config.productKey,e,t)}},{key:"signUp",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,T["default"])(k["default"].mark(function n(){var e,t,r,o,a,i,u,s,c,f,l,d,p,y,g,h=arguments.length<=0||void 0===arguments[0]?{udid:void 0,email:void 0,password:void 0,countryCode:void 0,version:void 0}:arguments[0];return k["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e=this.config.signUpHashKey,t=this.config.signUpHashSalt,r=h.udid,o=[e,t,r].join(":"),a=K.hex(o),i=[a.substr(0,2),a.substr(a.length-2)].join(""),u=[this.config.productKey,e,t,r,i].join(":"),s=(0,U["default"])(u),c="XMPP-Anonymous "+s,f={Authorization:c},l={primary_email:h.email,unique_id:h.email,password:h.password,push_routing:this.config.pushAgent,product:this.config.productKey,country_code:h.countryCode,device_id:h.udid,version:this.config.version},n.next=13,this.httpClient.post("/signup",{headers:f,data:l});case 13:return d=n.sent,p=this.host.models.User.inject(d.data.user),y=d.data.auth,g={user:p,auth:y},this.host.emit("signUp",g),n.abrupt("return",g);case 19:case"end":return n.stop()}},n,this)}));return e}()},{key:"signOut",value:function(){function e(){return t.apply(this,arguments)}var t=(0,T["default"])(k["default"].mark(function n(){return k["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpClient.post("/logout"));case 1:case"end":return e.stop()}},n,this)}));return e}()},{key:"me",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,T["default"])(k["default"].mark(function n(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return k["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.host.isSignedIn()){t.next=2;break}return t.abrupt("return",x["default"].reject(new B["default"].NotSignedInError));case 2:return t.abrupt("return",this.find(this.host.getCurrentUser().id,e));case 3:case"end":return t.stop()}},n,this)}));return e}()},{key:"find",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,T["default"])(k["default"].mark(function n(e){var t,r,o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return k["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"==typeof e){n.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){n.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:if(o=(0,w["default"])(o,{ignoreNotFound:!1,bypassCache:!1}),this.host.requireUser(),t=null,o.bypassCache){n.next=11;break}if(t=this.host.models.User.get(e),!t||t.$temporary){n.next=11;break}return n.abrupt("return",t);case 11:return n.next=13,this.host.api.users.find(e);case 13:if(r=n.sent,!r){n.next=19;break}t=this.host.models.User.inject(r),delete t.$temporary,n.next=21;break;case 19:if(o.ignoreNotFound){n.next=21;break}throw new B["default"].NotFoundError(this.host.models.User.name,e);case 21:return n.abrupt("return",t);case 22:case"end":return n.stop()}},n,this)}));return e}()},{key:"refresh",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,T["default"])(k["default"].mark(function n(e){return k["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.find(e,{ignoreNotFound:!0,bypassCache:!0});case 2:case"end":return t.stop()}},n,this)}));return e}()},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.User.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.User.getMulti(e)}}],[{key:"getSignInAuthHeader",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=[e,t,n].join(":"),o=(0,U["default"])(r),u="XMPP-Simple "+o;return u}}]),t}(F["default"]),o(f.prototype,"me",[u],(0,m["default"])(f.prototype,"me"),f.prototype),o(f.prototype,"find",[s],(0,m["default"])(f.prototype,"find"),f.prototype),o(f.prototype,"refresh",[c],(0,m["default"])(f.prototype,"refresh"),f.prototype),f);t["default"]=Z,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Users:n(111),EventRouter:n(101),Events:n(102),Messages:n(104),Groups:n(103),Organizations:n(107),Conversations:n(100),Presence:n(108),Metadata:n(105),Search:n(109),TypingStatus:n(110),Mute:n(106)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),u=r(i),s=n(6),c=r(s),f=n(10),l=r(f),d=n(33),p=r(d),y=n(24),g=r(y),h=n(45),v=r(h),m=n(9),b=r(m),w=n(8),E=r(w),x=n(20),_=r(x),k=n(155),I=r(k),T=n(157),O=r(T),j=n(141),A=r(j),M=n(39),G=r(M),V=n(158),z=r(V),C=n(119),S=r(C),P=n(15),q=r(P),U=n(150),N=r(U),$=n(142),R=r($),F=n(30),D=r(F),B=n(18),L=r(B),K=n(140),Z=r(K),W=n(1),H=r(W),X=n(2),Y=r(X),Q=n(63),J=r(Q),ee=n(58),te=r(ee),ne=n(136),re=r(ne),oe=n(29),ae=r(oe),ie=n(135),ue=r(ie),se=n(60),ce=r(se),fe=n(40),le=r(fe),de=n(28),pe=r(de),ye=(n(14),n(32)),ge=r(ye),he=n(115),ve=r(he);ge["default"].prototype.off=ge["default"].prototype.removeListener;var me={idAttribute:"id",parseAttrs:J["default"],relations:{belongsTo:{},hasMany:{}},defaultValues:null,computed:{}},be=function(){function e(t,n){var r,o=this,a=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];(0,H["default"])(this,e),this.options=(0,Z["default"])({},a,me),this.idAttribute=this.options.idAttribute,this.name=n,this.store=t,this.entitiesById={},this.entitiesList=[],this.transientAttrsStore={},this.options.relations&&this.__initRelations(),this.__initTransientAttrs(),(0,L["default"])(this.options.computed,{$entityType:{enumerable:!0,get:function(){return n}},$entityClass:{enumerable:!1,get:function(){return o}}}),this.options.computed=(0,D["default"])(this.options.computed,function(e,t,n){"function"==typeof t?e[n]={get:t,enumerable:!1}:e[n]=t},{}),this._computedKeys=(r=(r=this.options.computed,te["default"]).call(r),re["default"]).call(r,"$entityType","$entityClass","$$transientAttrs"),this._writablePropertyKeys=(r=(r=(r=this.options.computed,ue["default"]).call(r),pe["default"]).call(r,function(e){return e[1].set}),ae["default"]).call(r,R["default"]),this._relationKeys=(r=(r=(r=this.options.relations,ce["default"]).call(r),ae["default"]).call(r,N["default"]),le["default"]).call(r)}return(0,Y["default"])(e,null,[{key:"create",value:function(e,t,n){return new this(e,t,n)}}]),(0,Y["default"])(e,[{key:"__initRelations",value:function(){var e=this,t=(0,D["default"])(this.options.relations.belongsTo,function(t,n,r){t[r]={get:function(){return e.store.get(n.type,this[n.foreignKey])},set:function(t){this[n.foreignKey]=e.store.resolveId(n.type,t)}}},{});(0,L["default"])(this.options.computed,t);var n=(0,D["default"])(this.options.relations.hasMany,function(t,n,r){t[r]={get:function(){var t=this;if(this.$$transientAttrs.relations||(this.$$transientAttrs.relations={},this.$$transientAttrs.relationsCreated={}),this.$$transientAttrs.relations[r])return this.$$transientAttrs.relations[r];var o=e.store.getAll(n.type).filter(function(r){return r[n.foreignKey]==t[e.options.idAttribute]});return this.$$transientAttrs.relations[r]=o,this.$$transientAttrs.relationsCreated[r]=!0,o},set:function(e){}}},{});(0,L["default"])(this.options.computed,n)}},{key:"__initTransientAttrs",value:function(){var e=this,t=this,n={$$transientAttrs:{enumerable:!1,get:function(){var e=this[t.options.idAttribute];return t.transientAttrsStore[e]||(t.transientAttrsStore[e]={})}}},r={};this.options.transientAttrs&&this.options.transientAttrs.forEach(function(t){e.options.defaultValues&&t in e.options.defaultValues&&(r[t]=(0,ve["default"])(e.options.defaultValues[t]),delete e.options.defaultValues[t]),n[t]={get:function(){return t in this.$$transientAttrs?this.$$transientAttrs[t]:t in r?this.$$transientAttrs[t]=r[t]:void 0},set:function(e){this.$$transientAttrs[t]=e}}}),(0,L["default"])(this.options.computed,n)}},{key:"createInstance",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=this;t&&(e=this.parseAttrs(e)),this.options.defaultValues&&(0,q["default"])(e,(0,ve["default"])(this.options.defaultValues));var r={};return this._writablePropertyKeys.forEach(function(t){t in e&&(r[t]=e[t],delete e[t])}),(0,S["default"])(e,this.options.computed),(0,L["default"])(e,r),this.options.instanceEvents&&(0,L["default"])(e,ge["default"].prototype),(0,L["default"])(e,{toPlainObject:function(e){var t=this,r={};n._computedKeys.forEach(function(e){return r[e]=t[e]});var o=(0,L["default"])({},this,r);return delete o.toPlainObject,delete o.setMaxListeners,delete o.emit,delete o.addListener,delete o.on,delete o.once,delete o.removeListener,delete o.removeAllListeners,delete o.listeners,delete o.listenerCount,delete o.off,delete o.toPlainObject,delete o._events,delete o._maxListeners,o}}),this.options.beforeCreateInstance&&this.options.beforeCreateInstance(e),e}},{key:"inject",value:function(e){var t=void 0,n=!0,r=this.is(e);if(r){if(t=e,this.entitiesById[this.resolveId(t)])return this.options.beforeInject&&this.options.beforeInject(t),this.emit("beforeInject",this,t),this.options.afterInject&&this.options.afterInject(t),this.emit("afterInject",this,t),t;n=!1}n&&(e=this.parseAttrs(e));var o=void 0,a=this.resolveId(e);if(!this.isValidId(a))throw new Error("'"+this.options.idAttribute+"' is required");return t=this.entitiesById[a],t?(this.options.beforeInject&&this.options.beforeInject(e),this.emit("beforeInject",this,e),(0,L["default"])(t,e)):(o=!0,t=r?e:this.createInstance(e,!1),this.options.beforeInject&&this.options.beforeInject(e),this.emit("beforeInject",this,e),this.entitiesById[a]=t,this.entitiesList.push(t)),this.__addToHasManyRelationships(t),this.options.afterInject&&this.options.afterInject(t),this.emit("afterInject",this,t),o&&(this.options.afterCreate&&this.options.afterCreate(t),this.emit("afterCreate",this,t)),t}},{key:"eject",value:function(e){e=this.resolveId(e);var t=this.entitiesById[e];t&&(this.__removeFromHasManyRelationships(t),delete this.entitiesById[e],(0,z["default"])(this.entitiesList,t),e in this.transientAttrsStore&&delete this.transientAttrsStore[e],this.emit("afterEject",this,t))}},{key:"touch",value:function(e){e=this.resolveId(e);var t=this.entitiesById[e];t&&this.inject((0,G["default"])({},this.options.idAttribute,e))}},{key:"__addToHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"add")}},{key:"__removeFromHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"remove")}},{key:"__updateRelationsIfNeeded",value:function(e,t){var n=this,r=this.store.getParentRelationshipsOfModel(this.name);r&&r.forEach(function(r){var o=n.store.get(r.parent,e[r.foreignKey]);o&&o.$$transientAttrs.relationsCreated&&o.$$transientAttrs.relationsCreated[r.relationKey]&&("add"==t?o[r.relationKey].includes(e)||o[r.relationKey].push(e):"remove"==t&&(0,z["default"])(o[r.relationKey],e))})}},{key:"ejectAll",value:function(){var e=this;(0,A["default"])(this.entitiesList,function(t){return e.eject(t)})}},{key:"parseAttrs",value:function(e){var t=this,n=(0,O["default"])(e,function(e){return t.store.isEntity(e)||t.store.isEntityArray(e)}),r=(0,I["default"])(e,(0,N["default"])(n)),o=this.options.parseAttrs((0,ve["default"])(r)),a=(0,_["default"])({},o,n);return a}},{key:"get",value:function(e){return this.entitiesById[e]}},{key:"getAll",value:function(){return this.entitiesList}},{key:"getMulti",value:function(e){return e.map(this.get.bind(this))}},{key:"resolveId",value:function(e){return this.isValidId(e)?e:e[this.options.idAttribute]}},{key:"isValidId",value:function(e){return"string"==typeof e||"number"==typeof e}},{key:"is",value:function(e){return e&&e.$entityClass==this}},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,E["default"])(b["default"].mark(function n(e){return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:throw new"not implemented find";case 5:case"end":return t.stop()}},n,this)}));return e}()},{key:"refresh",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,E["default"])(b["default"].mark(function n(e){return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 4:throw e=this.resolveId(e),new"not implemented refresh";case 6:case"end":return t.stop()}},n,this)}));return e}()}]),e}();(0,L["default"])(be.prototype,ge["default"].prototype);var we=function(){function e(){var t=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];(0,H["default"])(this,e),this.options=n,this.models={},this.__relationsOfHasManyByContainedItem={},["inject","get","getAll","filter","resolveId","is","find","refresh"].forEach(function(e){t[e]=function(n){for(var r,o=arguments.length,a=Array(o>1?o-1:0),i=1;o>i;i++)a[i-1]=arguments[i];return(r=t.models[n])[e].apply(r,a)}})}return(0,Y["default"])(e,[{key:"defineModel",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(this.models[e])throw new Error(e+" already defined");n=(0,_["default"])({},this.options,n),this.models[e]=be.create(this,e,n);var r=this.models[e].options.relations.hasMany;return(0,v["default"])(r)||(0,g["default"])(r,function(n,r){t.__relationsOfHasManyByContainedItem[n.type]||(t.__relationsOfHasManyByContainedItem[n.type]=[]),t.__relationsOfHasManyByContainedItem[n.type].push((0,_["default"])({},n,{relationKey:r,parent:e}))}),this.models[e]}},{key:"getParentRelationshipsOfModel",value:function(e){return this.__relationsOfHasManyByContainedItem[e]}},{key:"isEntity",value:function(e){return e&&e.$entityClass&&e.$entityClass.constructor===be}},{key:"isEntityArray",value:function(e){return e&&Array.isArray(e)&&e.some(this.isEntity)}},{key:"clear",value:function(){(0,p["default"])(this.models).forEach(function(e){return e.ejectAll()})}}]),e}();t["default"]=we,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=n(15),a=r(o),i=n(24),u=r(i),s=n(20),c=r(s),f=n(27),l=r(f),d=n(1),p=r(d),y=n(2),g=r(y),h=n(14),v=n(113),m=r(v),b=n(99),w=r(b),E=n(36),x=r(E),_=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=n.logger,o=(0,l["default"])(n,["logger"]);(0,p["default"])(this,e),this.host=t,this.options=o,this.logger=r,this.store=new m["default"]((0,c["default"])({},o,{host:t,logger:r}))}return(0,g["default"])(e,[{key:"defineModels",value:function(){var e=this,t={},n=(0,c["default"])({},this.options,{host:this.host,logger:this.logger});(0,u["default"])(w["default"],function(r,o){t[o]=r(e,n)}),this.models=t}},{key:"defineModel",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t.replaceKeys=t.replaceKeys||{},(0,a["default"])(t.replaceKeys,{token:"id"});var n=(this.store,this.store.defineModel(e,(0,c["default"])({},t,{beforeCreateInstance:function(e){!e[n.idAttribute]||"serverId"in e||(e.serverId=e[n.idAttribute]),t.beforeCreateInstance&&t.beforeCreateInstance(e)},beforeInject:function(e){var r=n.get(e[n.idAttribute]);!r||"serverId"in e||(e.serverId=r.serverId),t.beforeInject&&t.beforeInject(e)},afterInject:function(e){var n=Date.now();e.$lastModified==n&&(n+=1e-5),e.$lastModified=n,t.afterInject&&t.afterInject(e)},parseAttrs:function(e){var n=x["default"].camelizeObject(e);return(0,u["default"])(t.replaceKeys,function(e,t){(0,h.replaceKey)(n,t,e)}),t.parseAttrs&&(n=t.parseAttrs(n,e)),n}})));return n}},{key:"clear",value:function(){this.store.clear()}}]),e}();t["default"]=_,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=r(o),i=function(e){return JSON.parse((0,a["default"])(e))};t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(!function(){var e=new Error('Cannot find module "../package.json"');throw e.code="MODULE_NOT_FOUND",e}()),a=r(o),i=a["default"].version;i=i.replace("-dev",""),t["default"]=i,e.exports=t["default"]},function(e,t,n){function r(e){return n(o(e))}function o(e){return a[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var a={"./node":52,"./node.js":52,"./web":53,"./web.js":53};r.keys=function(){return Object.keys(a);
},r.resolve=o,e.exports=r,r.id=117},function(e,t){e.exports=require("babel-polyfill")},function(e,t){e.exports=require("babel-runtime/core-js/object/define-properties")},function(e,t){e.exports=require("babel-runtime/core-js/object/entries")},function(e,t){e.exports=require("babel-runtime/core-js/object/freeze")},function(e,t){e.exports=require("babel-runtime/core-js/set")},function(e,t){e.exports=require("babel-runtime/helpers/slicedToArray")},function(e,t){e.exports=require("eventsource")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("humanize-list")},function(e,t){e.exports=require("invariant")},function(e,t){e.exports=require("lodash-bound/lib/compact")},function(e,t){e.exports=require("lodash-bound/lib/find")},function(e,t){e.exports=require("lodash-bound/lib/first")},function(e,t){e.exports=require("lodash-bound/lib/keyBy")},function(e,t){e.exports=require("lodash-bound/lib/mapValues")},function(e,t){e.exports=require("lodash-bound/lib/pickBy")},function(e,t){e.exports=require("lodash-bound/lib/reject")},function(e,t){e.exports=require("lodash-bound/lib/toPairs")},function(e,t){e.exports=require("lodash-bound/lib/without")},function(e,t){e.exports=require("lodash/assign")},function(e,t){e.exports=require("lodash/capitalize")},function(e,t){e.exports=require("lodash/chunk")},function(e,t){e.exports=require("lodash/defaultsDeep")},function(e,t){e.exports=require("lodash/eachRight")},function(e,t){e.exports=require("lodash/first")},function(e,t){e.exports=require("lodash/groupBy")},function(e,t){e.exports=require("lodash/head")},function(e,t){e.exports=require("lodash/includes")},function(e,t){e.exports=require("lodash/invert")},function(e,t){e.exports=require("lodash/isArray")},function(e,t){e.exports=require("lodash/isObject")},function(e,t){e.exports=require("lodash/keyBy")},function(e,t){e.exports=require("lodash/keys")},function(e,t){e.exports=require("lodash/last")},function(e,t){e.exports=require("lodash/map")},function(e,t){e.exports=require("lodash/mapKeys")},function(e,t){e.exports=require("lodash/memoize")},function(e,t){e.exports=require("lodash/omit")},function(e,t){e.exports=require("lodash/orderBy")},function(e,t){e.exports=require("lodash/pickBy")},function(e,t){e.exports=require("lodash/pull")},function(e,t){e.exports=require("lodash/reduce")},function(e,t){e.exports=require("lodash/sortBy")},function(e,t){e.exports=require("lodash/union")},function(e,t){e.exports=require("lodash/uniq")},function(e,t){e.exports=require("lodash/xor")},function(e,t){e.exports=require("lodash/zipObject")},function(e,t){e.exports=require("mime")},function(e,t){e.exports=require("node-uuid")},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("superagent-prefix")}]);