module.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),global._babelPolyfill||n(1);var r="node";n(2)("./"+r);var o=n(6);t.Client=o},function(e,t){e.exports=require("babel-polyfill")},function(e,t,n){function r(e){return n(o(e))}function o(e){return a[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var a={"./node":3,"./node.js":3,"./web":4,"./web.js":4};r.keys=function(){return Object.keys(a)},r.resolve=o,e.exports=r,r.id=2},function(e,t,n){"use strict"},function(e,t,n){"use strict";!function(){try{var e=n(5).request().__proto__;e.setNoDelay||(e.setNoDelay=function(){}),e.abort||(e.abort=function(){this.xhr&&this.xhr.abort()})}catch(t){}}()},function(e,t){e.exports=require("http")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p["default"])(e);if(!Array.isArray(e)){var o=(0,I["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,p["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p["default"])(e);if(!Array.isArray(e)){var o=(0,I["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,p["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var u,s,c,f=n(7),l=r(f),d=n(8),p=r(d),y=n(9),g=r(y),h=n(10),v=r(h),m=n(11),b=r(m),w=n(12),E=r(w),x=n(13),_=r(x),k=n(14),I=r(k),T=n(15),O=r(T),j=n(16),A=r(j),M=n(17),G=r(M),V=n(19),z=r(V),C=n(38),S=r(C),P=n(32),U=r(P),N=n(22),$=r(N),R=n(39),q=r(R),D=n(49),F=r(D),B=n(96),L=r(B),K=n(69),Z=r(K),W=n(109),H=r(W),X=(n(62),n(79)),Y=r(X);n(110)(U["default"]);var Q="UpM28mnfW65vJkbqEATtKvxm",J={eventsFeatures:"is-typing,multi-org",autoAckEvents:!0,logLevel:"error",eventsAutoReconnect:!0,flushAckInterval:2e3,flushAckMaxEvents:500,flushSetMessageStatusInterval:1e3,flushMessageMaxCount:500,conversationReloadDelay:200,eventsAutoReconnectDelay:2e3,clearTypingStatusTimeout:15e3,organizationRostersChangeThrottleDelay:500,temporaryEntityDelayBeforeRefreshing:100,enableEnsureEntityWithTemp:!0,enableEnsureEntityFindMissing:!0,consumerOrganizationId:Q,maxMetadataKeyCount:8,pushAgent:"consumer",baseUrl:"https://developer.tigertext.me/v2",productKey:"bc1oOf3DZXbnaNZ2LCWZGvSg",clientVersion:"1.0"},ee=(c=s=function(){function e(){var t=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if((0,O["default"])(this,e),!(null==n||n instanceof Object))throw new TypeError('Value of argument "config" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+i(n));if(!(null==n||n instanceof Object))throw new TypeError('Value of argument "config" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+a(n));this.config=U["default"].defaults(n,J),this.httpClient=new z["default"]({baseUrl:this.config.baseUrl,logger:new G["default"]({name:"HttpClient",level:this.config.logLevel})}),this.enums=Z["default"],this.store=new L["default"](this,{logger:new G["default"]({name:"Store",level:this.config.logLevel})}),this.store.defineModels(),this.models=this.store.models,this.modelsByEntityType=U["default"].mapKeys(this.store.models,function(e,t){return U["default"].snakeCase(t)}),this.allModelEntityTypes=(0,I["default"])(this.modelsByEntityType),this.logger=new G["default"]({name:"TigerConnectClient",level:this.config.logLevel}),this.api={},U["default"].each(q["default"],function(e,n){t.api[U["default"].camelCase(n)]=new e(t,{logger:new G["default"]({name:e.name,level:t.config.logLevel})})}),this._services={},U["default"].each(F["default"],function(e,n){n=U["default"].camelCase(n),t._services[n]=t[n]=new e(t,{logger:new G["default"]({name:e.name,level:t.config.logLevel})})}),U["default"].each(this._services,function(e){return e.mounted&&e.mounted()}),this._listenToEvents(),this._startTicker()}return(0,A["default"])(e,[{key:"_listenToEvents",value:function(){var e=this;this.on("signedIn",function(t,n){e.logger.info("signedIn",t.id)}).on("signedOut",function(){e.reset()}).on("signUp",function(t){var n=t.user,r=t.auth;e.logger.info("signUp",n.id),e._setCurrentUser(n,r)}),this.events.on("event",function(t){return e.emit("event",t)}),this.conversations.on("message",function(t){return e.emit("message",t)}),this.conversations.on("change",function(t){return e.emit("conversation:change",t)}),this.groups.on("membership:change",function(t){return e.emit("group:membership:change",t)}),this.presence.on("change",function(t){return e.emit("presence:change",t)}),this.typingStatus.on("change",function(t){return e.emit("typing:change",t)})}},{key:"_startTicker",value:function(){this.__ticker=setInterval(this._onTick,1e3)}},{key:"_stopTicker",value:function(){clearInterval(this.__ticker)}},{key:"_onTick",value:function(){this.emit("tick")}},{key:"signIn",value:function(){var e=(0,_["default"])(E["default"].mark(function t(e,n){var r,o,a,i=arguments.length<=2||void 0===arguments[2]?{udid:void 0}:arguments[2];return E["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.emit("signingIn"),t.prev=1,t.next=4,this.users.signIn(e,n,i);case 4:return r=t.sent,o=r.user,a=r.auth,this._setCurrentUser(o,a),t.next=10,this.users.me({bypassCache:!0});case 10:return this.emit("signedIn",o,a),t.abrupt("return",{user:o,auth:a});case 14:throw t.prev=14,t.t0=t["catch"](1),t.t0;case 18:case"end":return t.stop()}},t,this,[[1,14]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"signOut",value:function(){var e=(0,_["default"])(E["default"].mark(function t(){var e,n,r=arguments.length<=0||void 0===arguments[0]?{async:!0}:arguments[0],o=r.async,a=void 0===o?!0:o;return E["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isSignedIn()){t.next=2;break}return t.abrupt("return",b["default"].resolve());case 2:if(this.emit("signingOut"),a||"undefined"!=typeof XMLHttpRequest){t.next=5;break}throw new Error("async: false option has to be on the browser.");case 5:if(!a){t.next=16;break}return e=this.users.signOut({async:a}),t.next=9,e;case 9:this._currentUser=null,this._auth=null,this.httpClient.removeAuth(),this.events.disconnect(),this.emit("signedOut"),t.next=22;break;case 16:return n=new XMLHttpRequest,n.open("POST",this.config.baseUrl+"/logout",!1),n.setRequestHeader("Authorization",this.httpClient.getAuthHeader()),n.send(null),this.emit("signedOut"),t.abrupt("return",b["default"].resolve());case 22:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"wipe",value:function(){var e=(0,_["default"])(E["default"].mark(function t(){return E["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signOut();case 2:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"authenticate",value:function(){var e=(0,_["default"])(E["default"].mark(function t(e,n){var r,o,a;return E["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this._setAuth(e,n),t.prev=1,t.next=4,this.httpClient.get("/user");case 4:t.next=25;break;case 6:if(t.prev=6,t.t0=t["catch"](1),r=t.t0.response&&t.t0.response.get("TT_Log_Account_Token")){t.next=11;break}throw new $["default"].WrongCredentialsError;case 11:return t.prev=11,t.next=14,this.users.find(r);case 14:return o=t.sent,a={key:e,secret:n},this._setCurrentUser(o,a),this.emit("signedIn",o,a),t.abrupt("return",o);case 21:throw t.prev=21,t.t1=t["catch"](11),this._removeAuth(),t.t1;case 25:case"end":return t.stop()}},t,this,[[1,6],[11,21]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"_setCurrentUser",value:function(e,t){this._currentUser=e,this._setAuth(t.key,t.secret,t.resource)}},{key:"_setAuth",value:function(e,t,n){this._auth={key:e,secret:t,resource:n},this.httpClient.setAuth(e,t)}},{key:"_removeAuth",value:function(){this._auth=null,this.httpClient.removeAuth()}},{key:"getCurrentUser",value:function(){return this._currentUser||null}},{key:"getAuth",value:function(){return this._auth}},{key:"isSignedIn",value:function(){return null!=this.getAuth()}},{key:"requireUser",value:function(){if(!this.isSignedIn())throw new $["default"].NotSignedInError}},{key:"reactToAdvisoryEvent",value:function(e,t){switch(this.emit("advisory",{type:e,data:t}),e){case"replayStart":this.emit("messages:offline:start",t);break;case"replayStop":this.emit("messages:offline:stop"),this.emit("messages:new:start")}}},{key:"modelByTypeNS",value:function(e){return this.MODEL_BY_TYPE_NS[e]}},{key:"injectModel",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?e.xmlns||e.type:arguments[1],n=this.modelByTypeNS(t);return n?n.inject(e):((0,H["default"])(n,"injectModel: Missing class for "+t),null)}},{key:"getEntity",value:function(e,t){return this.modelsByEntityType[e].get(t)}},{key:"getEntities",value:function(e){var t=this;return e.map(function(e){return t.getEntity(e.type,e.id)})}},{key:"typeNSByModelName",value:function(e){return this.TYPE_NS_BY_MODEL_NAME[e]}},{key:"dispose",value:function(){this._stopTicker(),U["default"].each(this._services,function(e){return e.dispose&&e.dispose()}),this.store&&this.store.clear()}},{key:"reset",value:function(){this.dispose(),U["default"].each(this._services,function(e){return e.mounted&&e.mounted()}),this._startTicker()}},{key:"configure",value:function(e){return(0,v["default"])(this.config,e),this}},{key:"setDefaultOrganization",value:function(e){return this.configure({defaultOrganizationId:e})}},{key:"currentUser",get:function(){return this.getCurrentUser()}},{key:"MODEL_BY_TYPE_NS",get:function(){return this._MODEL_BY_TYPE_NS||(this._MODEL_BY_TYPE_NS={"tigertext:entity:account":this.models.User,"tigertext:entity:group":this.models.Group,"tigertext:entity:list":this.models.Group,"tigertext:iq:message":this.models.Message,"tigertext:iq:group_message":this.models.Message,"tigertext:iq:group:message":this.models.Message}),this._MODEL_BY_TYPE_NS}},{key:"TYPE_NS_BY_MODEL_NAME",get:function(){return this._TYPE_NS_BY_MODEL_NAME||(this._TYPE_NS_BY_MODEL_NAME=U["default"].transform(this.MODEL_BY_TYPE_NS,function(e,t,n){e[t.name]=n,e[U["default"].capitalize(t.name)]=n},{})),this._TYPE_NS_BY_MODEL_NAME}}]),e}(),s.errors=$["default"],s.VERSION="0.1.8",s.CONSUMER_ORGANIZATION_ID=Q,u=c,o(u.prototype,"_onTick",[Y["default"]],(0,g["default"])(u.prototype,"_onTick"),u.prototype),u);(0,v["default"])(ee.prototype,S["default"].prototype),t["default"]=ee,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/helpers/typeof")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-own-property-descriptor")},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("babel-runtime/core-js/object/keys")},function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t){e.exports=require("babel-runtime/helpers/createClass")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),u=r(i),s=n(14),c=r(s),f=n(8),l=r(f),d=n(18),p=r(d),y=n(15),g=r(y),h=n(16),v=r(h),m=function(){function e(t){var n=t.name,r=t.level;if((0,g["default"])(this,e),null==arguments[0]||"string"!=typeof arguments[0].name||"string"!=typeof arguments[0].level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ name: string;\n  level: string;\n}\n\nGot:\n"+a(arguments[0]));if(null==arguments[0]||"string"!=typeof arguments[0].name||"string"!=typeof arguments[0].level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ name: string;\n  level: string;\n}\n\nGot:\n"+o(arguments[0]));this.name=n,this.level=r}return(0,v["default"])(e,[{key:"setLevel",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));this.level=e}}]),e}(),b=["debug","log","info","warn","error"],w=b.reduce(function(e,t,n){return e[t]=n,e},{});b.forEach(function(e){var t=w[e];m.prototype[e]=function(){for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];t<w[this.level]||(r=["["+this.name+"]"].concat((0,p["default"])(r)),Function.prototype.apply.call(console[e],console,r))}}),t["default"]=m,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/helpers/toConsumableArray")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){var t=arguments.length<=1||void 0===arguments[1]?"attachment":arguments[1],r=e.name;if(!r)if("string"==typeof e)r=n(36).basename(e);else if(e instanceof Buffer){var o=T["default"].get(n(37)(e),"ext");r=t+"."+o}return r}Object.defineProperty(t,"__esModule",{value:!0});var a=n(10),i=r(a),u=n(12),s=r(u),c=n(11),f=r(c),l=n(13),d=r(l),p=n(15),y=r(p),g=n(16),h=r(g),v=n(20),m=r(v),b=n(21),w=r(b),E=n(22),x=r(E),_=n(31),k=r(_),I=n(32),T=r(I),O=n(33),j=n(34),A=["get","post","put","patch","del"],M=function(){function e(t){(0,y["default"])(this,e),this.config=t,this.logger=t.logger,this._prefixBaseUrl=(0,k["default"])(this.config.baseUrl)}return(0,h["default"])(e,[{key:"setAuth",value:function(e,t){this._key=e,this._secret=t}},{key:"removeAuth",value:function(){this._key=null,this._secret=null}},{key:"getAuthHeader",value:function(){return this.getAuthHeaderForKeyAndSecret(this._key,this._secret)}},{key:"getAuthHeaderForKeyAndSecret",value:function(e,t){return e&&t?"Basic "+(0,w["default"])(e+":"+t):null}},{key:"_contentType",value:function(e){switch(e){case"json":return"application/json";case"event-stream":return"text/event-stream";case"text":default:return"plain/text"}}},{key:"downloadImageBlob",value:function(){var e=(0,d["default"])(s["default"].mark(function t(e){var n=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("On Node.js use `downloadImageToFile`");case 2:return t.abrupt("return",(0,j.WEB_CODE)(function(){return new f["default"](function(t,r){var o=new XMLHttpRequest,a=n.config.baseUrl+e;o.open("GET",a,!0),o.setRequestHeader("Authorization",n.getAuthHeader()),o.responseType="blob",o.onreadystatechange=function(){4==o.readyState&&(o.status<200||o.status>299?r(new Error("Failed downloading "+a+". Status = "+o.status)):t(o.response))},o.send(null)})}));case 3:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"downloadImageToFile",value:function(){var e=(0,d["default"])(s["default"].mark(function t(e,r){var o=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;break;case 2:return t.abrupt("return",(0,j.NODE_CODE)(function(){return new f["default"](function(t,a){var i=o.config.baseUrl+e;n(35)({url:i,headers:{Authorization:o.getAuthHeader()}},function(e,n){e||n.statusCode<200||n.statusCode>299?a(new Error("Failed downloading "+i+". Status = "+xhr.status)):t()}).pipe(fs.createWriteStream(r))})}));case 3:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"downloadImageAndGetURL",value:function(){var e=(0,d["default"])(s["default"].mark(function t(e){var n,r;return s["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=8;break;case 3:return n=e.sent,r=URL.createObjectURL(n),e.abrupt("return",r);case 8:throw new Error("On Node.js use `downloadImageToFile`");case 9:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();A.forEach(function(e){M.prototype[e]=function(){var t=(0,d["default"])(s["default"].mark(function n(t){var r,a,u=this,c=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return s["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return c=T["default"].defaults(c||{},{reqFormat:"json",resFormat:"json"}),c.urlParams&&(t=t.replace(/:([\w\-]+)/g,function(e,t){return encodeURIComponent(c.urlParams[t])})),this.logger&&this.logger.info("start",e.toUpperCase(),t,c),r=(0,i["default"])({},c.headers),T["default"].isEmpty(c.files)&&(r["Content-Type"]=r["Content-Type"]||this._contentType(c.reqFormat)),r.Accept=r.Accept||this._contentType(c.resFormat),c.requestId&&(r["Request-ID"]=c.requestId),a=new f["default"](function(n,a){var i=m["default"][e](t).use(u._prefixBaseUrl).set(r).query(c.query||{});T["default"].isEmpty(c.files)?i=i.send(c.data||{}):(T["default"].each(c.data,function(e,t){return i=i.field(t,e)}),T["default"].each(c.files,function(e,t,n){return i=i.attach(t,e,o(e,"attachment-"+n))}),i=i.send()),u._key&&u._secret&&(i=i.auth(u._key,u._secret)),i.end(function(r,o){if(r)return u.logger&&u.logger.info("error",e.toUpperCase(),t,r),401==r.status&&a(new x["default"].WrongCredentialsError),void a(r);switch(c.resFormat){case"json":var i=o.body||{};"reply"in i&&(i=i.reply);var s={data:i,headers:o.headers,getHeader:function(e){return o.headers[e.toLowerCase()]},status:o.status};Object.defineProperty(s,"_origData",{get:function(){return o.body}}),u.logger&&u.logger.info("success",e.toUpperCase(),t,s),n(s);break;default:u.logger&&u.logger.info("success",e.toUpperCase(),t,o.text?o.text.substr(0,80)+"...":"[null]"),n(o.text)}})}),n.abrupt("return",a);case 9:case"end":return n.stop()}},n,this)}));return function(e,n){return t.apply(this,arguments)}}()}),!function(){var e=M.prototype.get,t=(0,O.decorator)(e);M.prototype.get=function(n){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return r.reusePromise?t.call(this,n,r):e.call(this,n,r)}}(),t["default"]=M,e.exports=t["default"]},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("btoa")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={NotSignedInError:n(23),WrongCredentialsError:n(27),NotFoundError:n(28),PermissionDeniedError:n(29),ValidationError:n(30)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(24),u=r(i),s=n(15),c=r(s),f=n(25),l=r(f),d=n(26),p=r(d),y=(a=o=function(e){function t(){var e;(0,c["default"])(this,t);for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var a=(0,l["default"])(this,(e=(0,u["default"])(t)).call.apply(e,[this].concat(r)));return a.code=t.CODE,a}return(0,p["default"])(t,e),t}(Error),o.CODE="not-signed-in",a);t["default"]=y,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/object/get-prototype-of")},function(e,t){e.exports=require("babel-runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("babel-runtime/helpers/inherits")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(24),u=r(i),s=n(15),c=r(s),f=n(25),l=r(f),d=n(26),p=r(d),y=(a=o=function(e){function t(){var e;(0,c["default"])(this,t);for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var a=(0,l["default"])(this,(e=(0,u["default"])(t)).call.apply(e,[this].concat(r)));return a.code=t.CODE,a}return(0,p["default"])(t,e),t}(Error),o.CODE="wrong-credentials",a);t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(24),u=r(i),s=n(15),c=r(s),f=n(25),l=r(f),d=n(26),p=r(d),y=(a=o=function(e){function t(e,n,r){(0,c["default"])(this,t);var o=(0,l["default"])(this,(0,u["default"])(t).call(this,r));return o.code=t.CODE,o.resource=e,o.id=n,o}return(0,p["default"])(t,e),t}(Error),o.CODE="not-found",a);t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(24),u=r(i),s=n(15),c=r(s),f=n(25),l=r(f),d=n(26),p=r(d),y=(a=o=function(e){function t(e,n,r){var o=arguments.length<=3||void 0===arguments[3]?"can't perform action "+r+" on "+(e.name||e)+" #"+n:arguments[3];(0,c["default"])(this,t);var a=(0,l["default"])(this,(0,u["default"])(t).call(this,o));return a.code=t.CODE,a.resource=e,a.action=r,a.id=n,a}return(0,p["default"])(t,e),t}(Error),o.CODE="permission-denied",a);t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(24),u=r(i),s=n(15),c=r(s),f=n(25),l=r(f),d=n(26),p=r(d),y=(a=o=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?"invalid":arguments[1],r=arguments.length<=2||void 0===arguments[2]?e+" is "+n:arguments[2];(0,c["default"])(this,t);var o=(0,l["default"])(this,(0,u["default"])(t).call(this,r));return o.code=t.CODE,o.name=e,o.reason=n,o}return(0,p["default"])(t,e),t}(Error),o.CODE="validation",a);t["default"]=y,e.exports=t["default"]},function(e,t){e.exports=require("superagent-prefix")},function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t=(0,f["default"])({memoize:!1},t);var n=function(){for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var a=r,i=["memoized",a],u=p.get(e,a);if(u)return u;if(t.memoize){var c=p.get(e,i);if(c)return s["default"].resolve(c)}var f=function(){p.del(e,a)},l=e.apply(this,r),d=l.then(function(n){return t.memoize&&p.set(e,i,n),f(),n},function(e){throw f(),e});return p.set(e,a,d),d};return n.__reusePromise__origFn=e,n.__reusePromise__clear=function(){o.clear(e)},n}function a(){var e=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0];void 0==e?p.clear():p.del(e.__reusePromise__origFn||e)}function i(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return function(t,n,r){return r.value=o(r.value,e),r}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(11),s=r(u),c=n(10),f=r(c),l=n(7),d=r(l);t["default"]=o,t.clear=a,t.decorator=i;var p=function(){function e(e){return(0,d["default"])(e)}function t(e,t,n){return e[u]==t&&e[s]==n}function n(e,n){for(var r=0,o=f.length;o>r;r++){var a=f[r];if(t(a,e,n))return r}return-1}function r(t,r){var o=e(r),a=n(t,o);return f[a]?f[a][c]:null}function o(t,r,o){var a=e(r),i=n(t,a);if(i>-1)f[i][c]=o;else{var l=[];l[u]=t,l[s]=a,l[c]=o,f.push(l)}return o}function a(t,r){if(void 0===r)for(var o=f.length-1;o>=0;o--){var a=f[o];a[u]==t&&f.splice(o,1)}else{var i=e(r),s=n(t,i);s>-1&&f.splice(s,1)}}function i(){f.length=0}var u=0,s=1,c=2,f=[];return{get:r,set:o,del:a,clear:i}}();i.clear=a,o.clear=a},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WEB_CODE=function(e){return e()},t.NODE_CODE=function(e){return e()}},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("file-type")},function(e,t){e.exports=require("events")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Roster:n(40),Users:n(42),Groups:n(43),Organizations:n(44),Messages:n(45),Metadata:n(47),Mute:n(48)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),u=r(i),s=n(14),c=r(s),f=n(8),l=r(f),d=n(12),p=r(d),y=n(13),g=r(y),h=n(24),v=r(h),m=n(15),b=r(m),w=n(16),E=r(w),x=n(25),_=r(x),k=n(26),I=r(k),T=n(41),O=r(T),j=n(32),A=r(j),M=["user","distributionList"],G=function(e){function t(){return(0,b["default"])(this,t),(0,_["default"])(this,(0,v["default"])(t).apply(this,arguments))}return(0,I["default"])(t,e),(0,E["default"])(t,[{key:"findAll",value:function(){var e=(0,g["default"])(p["default"].mark(function t(){var e;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.httpClient.get("/roster");case 2:return e=t.sent,t.abrupt("return",e.data);case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=(0,g["default"])(p["default"].mark(function t(e,n,r){var i,u;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 10:
if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:if(A["default"].includes(M,e)){t.next=14;break}return t.abrupt("return");case 14:return i={},r&&(i["TT-X-Organization-Key"]=r),u=this.host.typeNSByModelName(e),t.next=19,this.httpClient.post("/roster",{headers:i,data:{entity:n,type:u}});case 19:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,g["default"])(p["default"].mark(function t(e,n,r){var i,u;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:if(A["default"].includes(M,e)){t.next=14;break}return t.abrupt("return");case 14:return i={},r&&(i["TT-X-Organization-Key"]=r),u=this.host.typeNSByModelName(e),t.next=19,this.httpClient.del("/roster/:counterPartyId",{headers:i,urlParams:{counterPartyId:n},data:{type:u}});case 19:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()}]),t}(O["default"]);t["default"]=G,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(){var e=arguments.length<=0||void 0===arguments[0]?{fallbackValue:null,httpStatusCodes:[404]}:arguments[0];return function(t,n,r){var o=r.value;return r.value=function(){var t=(0,s["default"])(i["default"].mark(function n(){var t,r,a,u=arguments;return i["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:for(n.prev=0,t=u.length,r=Array(t),a=0;t>a;a++)r[a]=u[a];return n.next=4,o.call.apply(o,[this].concat(r));case 4:return n.abrupt("return",n.sent);case 7:if(n.prev=7,n.t0=n["catch"](0),!n.t0.response||!e.httpStatusCodes.includes(n.t0.response.status)){n.next=13;break}return n.abrupt("return",e.fallbackValue);case 13:throw n.t0;case 14:case"end":return n.stop()}},n,this,[[0,7]])}));return function(e){return t.apply(this,arguments)}}(),r}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a=n(12),i=r(a),u=n(13),s=r(u),c=n(10),f=r(c),l=n(15),d=r(l);t.recoverFromNotFound=o;var p=n(38),y=r(p),g=function h(e,t){(0,d["default"])(this,h),(0,f["default"])(this,t),this.config=e.config,this.host=e,this.httpClient=e.httpClient};t["default"]=g,(0,f["default"])(g.prototype,y["default"].prototype)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var o=(0,d["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,y["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var o=(0,d["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,y["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c=n(7),f=r(c),l=n(14),d=r(l),p=n(8),y=r(p),g=n(9),h=r(g),v=n(12),m=r(v),b=n(13),w=r(b),E=n(24),x=r(E),_=n(15),k=r(_),I=n(16),T=r(I),O=n(25),j=r(O),A=n(26),M=r(A),G=n(41),V=r(G),z=n(32),C=(r(z),u=(0,G.recoverFromNotFound)(),s=function(e){function t(){return(0,k["default"])(this,t),(0,j["default"])(this,(0,x["default"])(t).apply(this,arguments))}return(0,M["default"])(t,e),(0,T["default"])(t,[{key:"find",value:function(){var e=(0,w["default"])(m["default"].mark(function t(e){var n;return m["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return t.next=6,this.httpClient.get("/user/:id",{urlParams:{id:e}});case 6:return n=t.sent,t.abrupt("return",n.data);case 8:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(V["default"]),o(s.prototype,"find",[u],(0,h["default"])(s.prototype,"find"),s.prototype),s);t["default"]=C,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,p["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,p["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f=n(7),l=r(f),d=n(14),p=r(d),y=n(8),g=r(y),h=n(9),v=r(h),m=n(12),b=r(m),w=n(13),E=r(w),x=n(24),_=r(x),k=n(15),I=r(k),T=n(16),O=r(T),j=n(25),A=r(j),M=n(26),G=r(M),V=n(41),z=r(V),C=n(32),S=(r(C),u=(0,V.recoverFromNotFound)(),s=(0,V.recoverFromNotFound)({httpStatusCodes:[404,403]}),c=function(e){function t(){return(0,I["default"])(this,t),(0,A["default"])(this,(0,_["default"])(t).apply(this,arguments))}return(0,G["default"])(t,e),(0,O["default"])(t,[{key:"create",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e){var n,r,o,a,i,u,s=e.name,c=(e.avatarFile,e.replayHistory),f=void 0===c?!0:c,l=e.memberIds,d=void 0===l?[]:l,p=e.organizationId;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},p&&(n["TT-X-Organization-Key"]=p),r={name:s,replay_history:f,members:d},e.next=5,this.httpClient.post("/group",{headers:n,data:r});case 5:return o=e.sent,a=o.getHeader("TT-X-Group-Token"),i=o.getHeader("TT-X-Group-Avatar"),u={id:a,avatarUrl:i,name:s,memberIds:d,organizationId:p},e.abrupt("return",u);case 10:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e,n){var r,o,a=n.name,i=void 0===a?void 0:a,u=(n.avatarFile,n.replayHistory),s=void 0===u?void 0:u,c=n.memberIds,f=void 0===c?[]:c;return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={},"undefined"!=typeof i&&(r.name=i),"undefined"!=typeof f&&(r.members=f),"undefined"!=typeof s&&(r.replay_history=s),t.next=6,this.httpClient.post("/group/:id",{urlParams:{id:e},data:r});case 6:return o=t.sent,t.abrupt("return",!0);case 8:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e){var n;return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return t.next=6,this.httpClient.get("/group/:id",{urlParams:{id:e}});case 6:return n=t.sent,t.abrupt("return",n.data);case 8:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e){return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return t.next=6,this.httpClient.del("/group/:id",{urlParams:{id:e}});case 6:return t.abrupt("return",!0);case 7:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(z["default"]),o(c.prototype,"find",[u],(0,v["default"])(c.prototype,"find"),c.prototype),o(c.prototype,"destroy",[s],(0,v["default"])(c.prototype,"destroy"),c.prototype),c);t["default"]=S,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,p["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,p["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f=n(7),l=r(f),d=n(14),p=r(d),y=n(8),g=r(y),h=n(9),v=r(h),m=n(12),b=r(m),w=n(13),E=r(w),x=n(24),_=r(x),k=n(15),I=r(k),T=n(16),O=r(T),j=n(25),A=r(j),M=n(26),G=r(M),V=n(41),z=r(V),C=n(32),S=(r(C),u=(0,V.recoverFromNotFound)(),s=(0,V.recoverFromNotFound)(),c=function(e){function t(){return(0,I["default"])(this,t),(0,A["default"])(this,(0,_["default"])(t).apply(this,arguments))}return(0,G["default"])(t,e),(0,O["default"])(t,[{key:"find",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e,n){var r;return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return t.next=10,this.httpClient.get("/user/:userId/organization/:id",{urlParams:{userId:e,id:n}});case 10:return r=t.sent,t.abrupt("return",r.data);case 12:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findAllOfUser",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e){var n;return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return t.next=6,this.httpClient.get("/user/:userId/organization",{urlParams:{userId:e}});case 6:return n=t.sent,t.abrupt("return",n.data);case 8:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(z["default"]),o(c.prototype,"find",[u],(0,v["default"])(c.prototype,"find"),c.prototype),o(c.prototype,"findAllOfUser",[s],(0,v["default"])(c.prototype,"findAllOfUser"),c.prototype),c);t["default"]=S,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,c["default"])(e);if(!Array.isArray(e)){var a=(0,u["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,c["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,c["default"])(e);if(!Array.isArray(e)){var o=(0,u["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,c["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(14),u=r(i),s=n(8),c=r(s),f=n(12),l=r(f),d=n(7),p=r(d),y=n(46),g=r(y),h=n(13),v=r(h),m=n(24),b=r(m),w=n(15),E=r(w),x=n(16),_=r(x),k=n(25),I=r(k),T=n(26),O=r(T),j=n(41),A=r(j),M=function(e){function t(){return(0,E["default"])(this,t),(0,I["default"])(this,(0,b["default"])(t).apply(this,arguments))}return(0,O["default"])(t,e),(0,_["default"])(t,[{key:"send",value:function(){var e=(0,v["default"])(l["default"].mark(function t(e){var n,r,i,u,s=e.counterPartyId,c=e.body,f=e.senderOrganizationId,d=e.recipientOrganizationId,y=e.attachment,h=e.metadata,v=e.priority,m=e.ttl,b=e.dor,w=e.localId,E=arguments;return l["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==E[0]||"string"!=typeof E[0].counterPartyId||"string"!=typeof E[0].body||"string"!=typeof E[0].senderOrganizationId||"string"!=typeof E[0].recipientOrganizationId||!(null==E[0].attachment||E[0].attachment instanceof Object||null==E[0].attachment||"string"==typeof E[0].attachment)||!(null==E[0].metadata||E[0].metadata instanceof Object)||null!=E[0].priority&&"number"!=typeof E[0].priority||null!=E[0].ttl&&"number"!=typeof E[0].ttl||null!=E[0].dor&&"boolean"!=typeof E[0].dor||"string"!=typeof E[0].localId)){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ counterPartyId: string;\n  body: string;\n  senderOrganizationId: string;\n  recipientOrganizationId: string;\n  attachment: ?Object | ?string;\n  metadata: ?Object;\n  priority: ?number;\n  ttl: ?number;\n  dor: ?bool;\n  localId: string;\n}\n\nGot:\n"+a(E[0]));case 2:if(!(null==E[0]||"string"!=typeof E[0].counterPartyId||"string"!=typeof E[0].body||"string"!=typeof E[0].senderOrganizationId||"string"!=typeof E[0].recipientOrganizationId||!(null==E[0].attachment||E[0].attachment instanceof Object||null==E[0].attachment||"string"==typeof E[0].attachment)||!(null==E[0].metadata||E[0].metadata instanceof Object)||null!=E[0].priority&&"number"!=typeof E[0].priority||null!=E[0].ttl&&"number"!=typeof E[0].ttl||null!=E[0].dor&&"boolean"!=typeof E[0].dor||"string"!=typeof E[0].localId)){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ counterPartyId: string;\n  body: string;\n  senderOrganizationId: string;\n  recipientOrganizationId: string;\n  attachment: ?Object | ?string;\n  metadata: ?Object;\n  priority: ?number;\n  ttl: ?number;\n  dor: ?bool;\n  localId: string;\n}\n\nGot:\n"+o(E[0]));case 4:return d||(d=f),n={recipient:s,body:c},r={},h&&(n.data=h.map(function(e){return(0,g["default"])({},e,{payload:(0,p["default"])(e.payload)})})),f&&(n.sender_organization=f),d&&(n.recipient_organization=d),"undefined"!=typeof v&&(n.priority=v),y&&(r.attachment=y),m&&(n.ttl=m),b&&(n.dor=b),e.next=16,this.httpClient.post("/message",{data:n,files:r,requestId:w});case 16:return i=e.sent,u={serverId:i.getHeader("TT-X-Message-Id"),ttl:+i.getHeader("TT-X-Msg-Ttl")},e.abrupt("return",u);case 19:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=(0,v["default"])(l["default"].mark(function t(e){return l["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return t.prev=4,t.next=7,this.httpClient.del("/message/:id",{urlParams:{id:e}});case 7:return t.abrupt("return",!0);case 10:return t.prev=10,t.t0=t["catch"](4),t.abrupt("return",!1);case 13:case"end":return t.stop()}},t,this,[[4,10]])}));return function(t){return e.apply(this,arguments)}}()},{key:"startTyping",value:function(){var e=(0,v["default"])(l["default"].mark(function t(e){return l["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return t.next=6,this.httpClient.post("/message/typing",{data:{recipient:e}});case 6:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"stopTyping",value:function(){var e=(0,v["default"])(l["default"].mark(function t(e){return l["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return t.next=6,this.httpClient.del("/message/typing/:recipientId",{urlParams:{recipientId:e}});case 6:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"forward",value:function(){var e=(0,v["default"])(l["default"].mark(function t(e,n,r){var i,u,s,c=r.senderOrganizationId,f=r.recipientOrganizationId,d=r.priority,p=r.localId,y=arguments;return l["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if(!(null==y[2]||null!=y[2].senderOrganizationId&&"string"!=typeof y[2].senderOrganizationId||null!=y[2].recipientOrganizationId&&"string"!=typeof y[2].recipientOrganizationId||null!=y[2].priority&&"number"!=typeof y[2].priority||"string"!=typeof y[2].localId)){t.next=6;break}throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ senderOrganizationId: ?string;\n  recipientOrganizationId: ?string;\n  priority: ?number;\n  localId: string;\n}\n\nGot:\n"+a(y[2]));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 10:if(!(null==y[2]||null!=y[2].senderOrganizationId&&"string"!=typeof y[2].senderOrganizationId||null!=y[2].recipientOrganizationId&&"string"!=typeof y[2].recipientOrganizationId||null!=y[2].priority&&"number"!=typeof y[2].priority||"string"!=typeof y[2].localId)){t.next=12;break}throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ senderOrganizationId: ?string;\n  recipientOrganizationId: ?string;\n  priority: ?number;\n  localId: string;\n}\n\nGot:\n"+o(y[2]));case 12:return f||(f=c),i={recipient:n},c&&(i.sender_organization=c),f&&(i.recipient_organization=f),"undefined"!=typeof d&&(i.priority=d),t.next=19,this.httpClient.post("/message/:id/forward",{urlParams:{id:e},data:i,requestId:p});case 19:return u=t.sent,s={serverId:u.getHeader("TT-X-Message-Id")},t.abrupt("return",s);case 22:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()}]),t}(A["default"]);t["default"]=M,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/helpers/extends")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),u=r(i),s=n(14),c=r(s),f=n(8),l=r(f),d=n(12),p=r(d),y=n(13),g=r(y),h=n(24),v=r(h),m=n(15),b=r(m),w=n(16),E=r(w),x=n(25),_=r(x),k=n(26),I=r(k),T=n(41),O=r(T),j=n(32),A=r(j),M=function(e){function t(){return(0,b["default"])(this,t),(0,_["default"])(this,(0,v["default"])(t).apply(this,arguments))}return(0,I["default"])(t,e),(0,E["default"])(t,[{key:"update",value:function(){var e=(0,g["default"])(p["default"].mark(function t(e,n,r){return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if(n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 8:if(n instanceof Object){t.next=10;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:return t.next=14,this.httpClient.post("/metadata/:id",{urlParams:{id:e},data:n,headers:{"TT-X-Organization-Key":r}});case 14:case"end":return t.stop();
}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,g["default"])(p["default"].mark(function t(e,n){var r;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return t.next=10,this.httpClient.get("/metadata/:id",{urlParams:{id:e},headers:{"TT-X-Organization-Key":n}});case 10:return r=t.sent,t.abrupt("return",r.data);case 12:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findMulti",value:function(){var e=(0,g["default"])(p["default"].mark(function t(e,n){var r,i;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){t.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return t.next=10,this.httpClient.post("/metadata_bulk",{data:{entities:e},headers:{"TT-X-Organization-Key":n}});case 10:return r=t.sent,i=A["default"].zipObject(e,r.data),t.abrupt("return",i);case 13:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),t}(O["default"]);t["default"]=M,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,b["default"])(e);if(!Array.isArray(e)){var o=(0,v["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,g["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,b["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,b["default"])(e);if(!Array.isArray(e)){var o=(0,v["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,g["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,b["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f,l,d,p,y=n(7),g=r(y),h=n(14),v=r(h),m=n(8),b=r(m),w=n(9),E=r(w),x=n(12),_=r(x),k=n(13),I=r(k),T=n(24),O=r(T),j=n(15),A=r(j),M=n(16),G=r(M),V=n(25),z=r(V),C=n(26),S=r(C),P=n(41),U=r(P),N=(u=(0,P.recoverFromNotFound)(),s=(0,P.recoverFromNotFound)(),c=(0,P.recoverFromNotFound)(),f=(0,P.recoverFromNotFound)(),l=(0,P.recoverFromNotFound)(),d=(0,P.recoverFromNotFound)(),p=function(e){function t(){return(0,A["default"])(this,t),(0,z["default"])(this,(0,O["default"])(t).apply(this,arguments))}return(0,S["default"])(t,e),(0,G["default"])(t,[{key:"findAll",value:function(){var e=(0,I["default"])(_["default"].mark(function t(){var e;return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.httpClient.get("/mute");case 2:return e=t.sent,t.abrupt("return",e.data);case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"unmuteAll",value:function(){var e=(0,I["default"])(_["default"].mark(function t(){return _["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.del("/mute");case 2:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"muteUser",value:function(){var e=(0,I["default"])(_["default"].mark(function t(e,n,r){var o=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],u=o.recipientOrganizationId,s=void 0===u?r:u;return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("number"==typeof n){t.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 8:if("number"==typeof n){t.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return t.next=14,this.httpClient.post("/mute/p2p",{data:{sender_token:e,sender_organization:r,receiver_organization:s,duration:n.toString()}});case 14:case"end":return t.stop()}},t,this)}));return function(t,n,r,o){return e.apply(this,arguments)}}()},{key:"unmuteUser",value:function(){var e=(0,I["default"])(_["default"].mark(function t(e,n){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=r.recipientOrganizationId,u=void 0===o?n:o;return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return t.next=10,this.httpClient.del("/mute/p2p",{headers:{"TT-X-Sender-Token":e,"TT-X-Sender-Organization":n,"TT-X-Receiver-Organization":u}});case 10:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"muteGroup",value:function(){var e=(0,I["default"])(_["default"].mark(function t(e,n,r){return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("number"==typeof n){t.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 8:if("number"==typeof n){t.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return t.next=14,this.httpClient.post("/mute/group/:groupId",{urlParams:{groupId:e},data:{duration:n.toString(),receiver_organization:r}});case 14:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"unmuteGroup",value:function(){var e=(0,I["default"])(_["default"].mark(function t(e,n){return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return t.next=10,this.httpClient.del("/mute/group/:groupId",{urlParams:{groupId:e},headers:{"TT-X-Receiver-Organization":n}});case 10:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"muteOrganization",value:function(){var e=(0,I["default"])(_["default"].mark(function t(e,n){return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("number"==typeof n){t.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("number"==typeof n){t.next=8;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 8:return t.next=10,this.httpClient.post("/mute/organization/:organizationId",{urlParams:{organizationId:e},data:{duration:n.toString(),receiver_organization:e}});case 10:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"unmuteOrganization",value:function(){var e=(0,I["default"])(_["default"].mark(function t(e){return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return t.next=6,this.httpClient.del("/mute/organization/:organizationId",{urlParams:{organizationId:e},headers:{"TT-X-Receiver-Organization":e}});case 6:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(U["default"]),o(p.prototype,"muteUser",[u],(0,E["default"])(p.prototype,"muteUser"),p.prototype),o(p.prototype,"unmuteUser",[s],(0,E["default"])(p.prototype,"unmuteUser"),p.prototype),o(p.prototype,"muteGroup",[c],(0,E["default"])(p.prototype,"muteGroup"),p.prototype),o(p.prototype,"unmuteGroup",[f],(0,E["default"])(p.prototype,"unmuteGroup"),p.prototype),o(p.prototype,"muteOrganization",[l],(0,E["default"])(p.prototype,"muteOrganization"),p.prototype),o(p.prototype,"unmuteOrganization",[d],(0,E["default"])(p.prototype,"unmuteOrganization"),p.prototype),p);t["default"]=N,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Users:n(50),EventRouter:n(56),Events:n(60),Messages:n(66),Groups:n(82),Organizations:n(83),Conversations:n(86),Presence:n(88),Metadata:n(89),Search:n(92),TypingStatus:n(93),Mute:n(94)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h["default"])(e);if(!Array.isArray(e)){var o=(0,y["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h["default"])(e);if(!Array.isArray(e)){var o=(0,y["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f,l=n(7),d=r(l),p=n(14),y=r(p),g=n(8),h=r(g),v=n(9),m=r(v),b=n(11),w=r(b),E=n(12),x=r(E),_=n(13),k=r(_),I=n(24),T=r(I),O=n(15),j=r(O),A=n(16),M=r(A),G=n(25),V=r(G),z=n(26),C=r(z),S=n(21),P=r(S),U=n(32),N=r(U),$=n(51),R=r($),q=n(52),D=r(q),F=n(22),B=r(F),L=n(33),K=new R["default"].MD5,Z=(u=(0,L.decorator)(),s=(0,L.decorator)(),c=(0,L.decorator)(),f=function(e){function t(){return(0,j["default"])(this,t),(0,V["default"])(this,(0,T["default"])(t).apply(this,arguments))}return(0,C["default"])(t,e),(0,M["default"])(t,[{key:"signIn",value:function(){var e=(0,k["default"])(x["default"].mark(function t(e,n){var r,o,u,s,c,f=arguments.length<=2||void 0===arguments[2]?{udid:void 0}:arguments[2];return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return r={Authorization:this.getSignInAuthHeader(e,n)},o={user_id:e,password:n,push_routing:this.config.pushAgent,version:this.config.clientVersion,device_id:f.udid},t.next=12,this.httpClient.post("/login",{headers:r,data:o});case 12:return u=t.sent,s=this.host.models.User.inject(u.data.user),c=u.data.auth,t.abrupt("return",{user:s,auth:c});case 16:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSignInAuthHeader",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return this.constructor.getSignInAuthHeader(this.config.productKey,e,t)}},{key:"signUp",value:function(){var e=(0,k["default"])(x["default"].mark(function t(){var e,n,r,o,a,i,u,s,c,f,l,d,p,y,g,h=arguments.length<=0||void 0===arguments[0]?{udid:void 0,email:void 0,password:void 0,countryCode:void 0,version:void 0}:arguments[0];return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.config.signUpHashKey,n=this.config.signUpHashSalt,r=h.udid,o=[e,n,r].join(":"),a=K.hex(o),i=[a.substr(0,2),a.substr(a.length-2)].join(""),u=[this.config.productKey,e,n,r,i].join(":"),s=(0,P["default"])(u),c="XMPP-Anonymous "+s,f={Authorization:c},l={primary_email:h.email,unique_id:h.email,password:h.password,push_routing:this.config.pushAgent,product:this.config.productKey,country_code:h.countryCode,device_id:h.udid,version:this.config.clientVersion},t.next=13,this.httpClient.post("/signup",{headers:f,data:l});case 13:return d=t.sent,p=this.host.models.User.inject(d.data.user),y=d.data.auth,g={user:p,auth:y},this.host.emit("signUp",g),t.abrupt("return",g);case 19:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"signOut",value:function(){var e=(0,k["default"])(x["default"].mark(function t(){return x["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpClient.post("/logout"));case 1:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"me",value:function(){var e=(0,k["default"])(x["default"].mark(function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.host.isSignedIn()){t.next=2;break}return t.abrupt("return",w["default"].reject(new B["default"].NotSignedInError));case 2:return t.abrupt("return",this.find(this.host.getCurrentUser().id,e));case 3:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,k["default"])(x["default"].mark(function t(e){var n,r,o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:if(o=N["default"].defaults(o,{ignoreNotFound:!1,bypassCache:!1}),this.host.requireUser(),n=null,o.bypassCache){t.next=11;break}if(n=this.host.models.User.get(e),!n||n.$temporary){t.next=11;break}return t.abrupt("return",n);case 11:return t.next=13,this.host.api.users.find(e);case 13:if(r=t.sent,!r){t.next=19;break}n=this.host.models.User.inject(r),delete n.$temporary,t.next=21;break;case 19:if(o.ignoreNotFound){t.next=21;break}throw new B["default"].NotFoundError(this.host.models.User.name,e);case 21:return t.abrupt("return",n);case 22:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=(0,k["default"])(x["default"].mark(function t(e){return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.find(e,{ignoreNotFound:!0,bypassCache:!0});case 2:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.User.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.User.getMulti(e)}}],[{key:"getSignInAuthHeader",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=[e,t,n].join(":"),o=(0,P["default"])(r),u="XMPP-Simple "+o;return u}}]),t}(D["default"]),o(f.prototype,"me",[u],(0,m["default"])(f.prototype,"me"),f.prototype),o(f.prototype,"find",[s],(0,m["default"])(f.prototype,"find"),f.prototype),o(f.prototype,"refresh",[c],(0,m["default"])(f.prototype,"refresh"),f.prototype),f);t["default"]=Z,e.exports=t["default"]},function(e,t){e.exports=require("jshashes")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,g["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,g["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),u=r(i),s=n(14),c=r(s),f=n(53),l=r(f),d=n(54),p=r(d),y=n(8),g=r(y),h=n(10),v=r(h),m=n(15),b=r(m),w=n(16),E=r(w),x=n(38),_=r(x),k=n(55),I=r(k),T=n(32),O=r(T),j=function(){function e(t,n){(0,b["default"])(this,e),(0,v["default"])(this,n),this.host=t,this.config=t.config,this.httpClient=t.httpClient}return(0,E["default"])(e,[{key:"_resolveModelId",value:function(e){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(e));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+o(e));return"string"==typeof e?e:e?e.serverId||e.id||null:null}},{key:"_resolveModelIdWithTypes",value:function(e,t){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(e));if(!("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "allowedEntityTypes" violates contract.\n\nExpected:\nstring | string[]\n\nGot:\n'+a(t));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+o(e));if(!("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "allowedEntityTypes" violates contract.\n\nExpected:\nstring | string[]\n\nGot:\n'+o(t));if(!e)return null;if("string"==typeof e){var n=this._resolveEntity(e);if(!n)return e;e=n}return I["default"].oneOf("thing",e.$entityType,O["default"].arrayWrap(t)),e.serverId||e.id||null}},{key:"_resolveEntity",value:function(e,t){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(e));if(!(null==t||"string"==typeof t||null==t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "types" violates contract.\n\nExpected:\n?string | ?string[]\n\nGot:\n'+a(t));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+o(e));if(!(null==t||"string"==typeof t||null==t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "types" violates contract.\n\nExpected:\n?string | ?string[]\n\nGot:\n'+o(t));if(t||(t=this.host.allModelEntityTypes),t=O["default"].arrayWrap(t),"object"===("undefined"==typeof e?"undefined":(0,g["default"])(e)))return t.includes(e.$entityType)?e:null;if(!t||"function"!=typeof t[p["default"]]&&!Array.isArray(t))throw new TypeError("Expected types to be iterable, got "+o(t));if(!t||"function"!=typeof t[p["default"]]&&!Array.isArray(t))throw new TypeError("Expected types to be iterable, got "+a(t));var n=!0,r=!1,i=void 0;try{for(var u,s=(0,l["default"])(t);!(n=(u=s.next()).done);n=!0){var c=u.value,f=this.host.modelsByEntityType[c].get(e);if(f)return f;if(f=O["default"].find(this.host.modelsByEntityType[c].getAll(),{serverId:e}))return f}}catch(d){r=!0,i=d}finally{try{!n&&s["return"]&&s["return"]()}finally{if(r)throw i}}return null}},{key:"mounted",value:function(){}},{key:"dispose",value:function(){}}]),e}();t["default"]=j,(0,v["default"])(j.prototype,_["default"].prototype),e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/get-iterator")},function(e,t){e.exports=require("babel-runtime/core-js/symbol/iterator")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(14),a=r(o),i=n(30),u=r(i),s={isOneOf:function(e,t,n){return n.includes(t)},isNotEmpty:function(e,t){return!!t},raise:function(e){var t=arguments.length<=1||void 0===arguments[1]?"invalid":arguments[1],n=arguments[2];throw new u["default"](e,t,n)}};(0,a["default"])(s).forEach(function(e){var t=e.replace(/^is([A-Z])/,function(e,t){return t.toLowerCase()}),n=s[e];s[t]=function(e,t,r){for(var o=arguments.length,a=Array(o>3?o-3:0),i=3;o>i;i++)a[i-3]=arguments[i];n.apply(void 0,[e,t,r].concat(a))||s.raise(e,void 0,r)}}),t["default"]=s,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=n(57),a=r(o),i=n(58),u=r(i),s=n(24),c=r(s),f=n(15),l=r(f),d=n(16),p=r(d),y=n(25),g=r(y),h=n(26),v=r(h),m=n(52),b=r(m),w=n(32),E=r(w),x=n(59),_=function(e){function t(e,n){var r;(0,l["default"])(this,t);var o=(0,g["default"])(this,(0,c["default"])(t).call(this,e,n));o.EVENTS=(r={},(0,a["default"])(r,"client_advisory",function(e){switch(e.data.advisory.name){case"replay_start":this.host.reactToAdvisoryEvent("replayStart",{replayMessageCount:e.data.advisory.replay_message_count});break;case"replay_stop":this.host.reactToAdvisoryEvent("replayStop")}}),
(0,a["default"])(r,"message|group_message",function(e){this.host.conversations.reactToIncomingMessageEvent(e)}),(0,a["default"])(r,"message:status|group:message:status",function(e){this.host.messages.reactToMessageStatusEvent(e)}),(0,a["default"])(r,"friends",function(e){this.host.conversations.reactToFriendsEvent(e)}),(0,a["default"])(r,"presence",function(e){this.host.presence.reactToPresenceEvent(e)}),(0,a["default"])(r,"bang",function(e){this.host.groups.reactToBangEvent(e)}),(0,a["default"])(r,"update",function(e){var t=e.data,n=t.type,r=(0,u["default"])(t,["type"]);this.host.injectModel(r,n)}),(0,a["default"])(r,"account:settings",function(e){var t=this;e.data.services.forEach(function(n){switch(n.xmlns){case"tigertext:iq:update:account":var r=n.account||e.data.token;t.host.users.refresh(r);break;case"tigertext:iq:update:org_settings":t.host.organizations.refreshAll();break;default:t.logger.warn("unhandled account:settings service type "+n.xmlns)}})}),(0,a["default"])(r,"message:is_typing",function(e){this.host.typingStatus.reactToIsTypingEvent(e)}),(0,a["default"])(r,"push:credentials",function(e){}),(0,a["default"])(r,"remote_wipe",function(e){this.host.wipe()}),(0,a["default"])(r,"validated",function(e){this.logger.warn("validated not implemented")}),(0,a["default"])(r,"msg:metadata_update",function(e){this.logger.warn("msg:metadata_update not implemented")}),(0,a["default"])(r,"conversation_mute",function(e){this.host.mute.reactToMuteEvent(e)}),(0,a["default"])(r,"reconnect",function(e){this.host.events.reconnect()}),(0,a["default"])(r,"push:credentials",x.noop),(0,a["default"])(r,"sse:heartbeat",x.noop),r);var i=[];return E["default"].each(o.EVENTS,function(e,t){t.includes("|")&&(i.push(t),t.split("|").forEach(function(t){return o.EVENTS[t]=e}))}),i.forEach(function(e){return delete o.EVENTS[e]}),o}return(0,v["default"])(t,e),(0,p["default"])(t,[{key:"emit",value:function(e){this.EVENTS[e.type]?this.EVENTS[e.type].call(this,e):this.logger.error("unhandled event: "+e.type,e.data)}}]),t}(b["default"]);t["default"]=_,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/helpers/defineProperty")},function(e,t){e.exports=require("babel-runtime/helpers/objectWithoutProperties")},function(e,t){e.exports=require("node-noop")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a,i,u=n(9),s=r(u),c=n(18),f=r(c),l=n(14),d=r(l),p=n(12),y=r(p),g=n(11),h=r(g),v=n(13),m=r(v),b=n(24),w=r(b),E=n(15),x=r(E),_=n(16),k=r(_),I=n(25),T=r(I),O=n(26),j=r(O),A=n(52),M=r(A),G=n(61),V=r(G),z=n(32),C=r(z),S=n(62),P=n(63),U=(0,S.classWithPrivateMethods)((i=function(e){function t(e,n){(0,x["default"])(this,t);var r=(0,T["default"])(this,(0,w["default"])(t).call(this,e,n));return r._throtelled_flushQueuedAcks=C["default"].throttle(r._flushQueuedAcks.bind(r),r.config.flushAckInterval,{leading:!1}),r}return(0,j["default"])(t,e),(0,k["default"])(t,[{key:"mounted",value:function(){this._queuedAcks=[],this._statsByEventType={}}},{key:"dispose",value:function(){this._queuedAcks=null,this._statsByEventType=null,this._throtelled_flushQueuedAcks.cancel&&this._throtelled_flushQueuedAcks.cancel()}},{key:"connect",value:function(){var e=(0,m["default"])(y["default"].mark(function t(){var e,n=this;return y["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.host.requireUser(),!this.eventSource){t.next=4;break}return this.logger.warn("already connected"),t.abrupt("return");case 4:return e=this.config.baseUrl+"/events",this.logger.info("connecting events"),this.eventSource=new V["default"](e,{headers:{Authorization:this.httpClient.getAuthHeader(),"TT-X-Features":this.config.eventsFeatures}}),t.abrupt("return",new h["default"](function(e,t){var r=void 0;n.eventSource.addEventListener("open",function(){n.logger.info("open"),r=!0,e()}),n.eventSource.addEventListener("message",n._onEvent.bind(n)),n.eventSource.addEventListener("error",function(e){r||t(),n._onError(e)}),n.eventSource.addEventListener("close",function(){n.logger.info("close")})}));case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){this.eventSource&&this.eventSource.close(),this.eventSource=null}},{key:"reconnect",value:function(){this.eventSource&&this.disconnect(),this.connect()}},{key:"_onEvent",value:function(e){var t=this,n=e.data;if(n.includes("\n"))return void n.split("\n").forEach(function(e){return t._onEvent({data:e})});var r=n;try{n=JSON.parse(r)}catch(o){throw this.logger.error("error parsing ",r),o}var a=n.event_id,i=(0,d["default"])(n.event)[0],u=i.replace("tigertext:iq:",""),s=n.event[i];this._statsByEventType[u]||(this._statsByEventType[u]={count:0}),this._statsByEventType[u].count++,this.logger.info("incoming",u,s);var c=new P.Event(a,u,s,{_origData:r});try{this.host.eventRouter.emit(c),this.emit("event",c),this.config.autoAckEvents&&this.__queueAck(a)}catch(o){throw this.logger.error("error in event "+u,o,o.stack,{data:s}),o}}},{key:"_onError",value:function(e){var t=this;this.logger.warn("error",e,e.message||"",e.status||""),this.disconnect(),this.config.eventsAutoReconnect&&setTimeout(function(){t.connect()},this.config.eventsAutoReconnectDelay)}},{key:"__queueAck",value:function(e){var t;e=C["default"].arrayWrap(e),(t=this._queuedAcks).push.apply(t,(0,f["default"])(e)),e.length>=this.config.flushAckMaxEvents?(this.logger.log("reached "+this.config.flushAckMaxEvents+" -- flushing"),this._flushQueuedAcks()):this._throtelled_flushQueuedAcks()}},{key:"_flushQueuedAcks",value:function(){this._queuedAcks.length>0&&(this.ack(this._queuedAcks),this._queuedAcks.length=0)}},{key:"ack",value:function(){var e=(0,m["default"])(y["default"].mark(function t(e){return y["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.host.requireUser(),e=C["default"].arrayWrap(e),this.logger.log("ack",e),t.prev=3,t.next=6,this.httpClient.post("/events/ack",{data:{events:e}});case 6:t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](3),this.logger.warn("some events not acked",e);case 11:case"end":return t.stop()}},t,this,[[3,8]])}));return function(t){return e.apply(this,arguments)}}()}]),t}(M["default"]),o(i.prototype,"_onEvent",[S.privateMethod],(0,s["default"])(i.prototype,"_onEvent"),i.prototype),o(i.prototype,"_onError",[S.privateMethod],(0,s["default"])(i.prototype,"_onError"),i.prototype),o(i.prototype,"__queueAck",[S.privateMethod],(0,s["default"])(i.prototype,"__queueAck"),i.prototype),o(i.prototype,"_flushQueuedAcks",[S.privateMethod],(0,s["default"])(i.prototype,"_flushQueuedAcks"),i.prototype),a=i))||a;t["default"]=U,e.exports=t["default"]},function(e,t){e.exports=require("eventsource")},function(e,t){e.exports=require("class-private-method-decorator")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Event:n(64),SearchResult:n(65)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=n(10),a=r(o),i=n(58),u=r(i),s=n(15),c=r(s),f=n(16),l=r(f),d=function(){function e(t,n,r,o){var i=this;(0,c["default"])(this,e),this.id=t,this.type=n,this.data=r,o&&!function(){var e=o._origData,t=(0,u["default"])(o,["_origData"]);Object.defineProperty(i,"_origData",{get:function(){return e}}),(0,a["default"])(i,t)}()}return(0,l["default"])(e,null,[{key:"is",value:function(e){return e instanceof this}}]),e}();t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=n(15),a=r(o),i=n(16),u=r(i),s=function(){function e(t,n){(0,a["default"])(this,e),this.id="searchResult:"+n+":"+t.id,this.entityType=t.$entityType,this.entityId=t.id,this.entity=t,this.organizationId=n}return(0,u["default"])(e,null,[{key:"is",value:function(e){return e instanceof this}}]),e}();t["default"]=s,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,b["default"])(e);if(!Array.isArray(e)){var o=(0,v["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,g["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,b["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,b["default"])(e);if(!Array.isArray(e)){var o=(0,v["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,g["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,b["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f,l,d,p,y=n(7),g=r(y),h=n(14),v=r(h),m=n(8),b=r(m),w=n(9),E=r(w),x=n(11),_=r(x),k=n(10),I=r(k),T=n(53),O=r(T),j=n(54),A=r(j),M=n(58),G=r(M),V=n(46),z=r(V),C=n(12),S=r(C),P=n(13),U=r(P),N=n(24),$=r(N),R=n(15),q=r(R),D=n(16),F=r(D),B=n(25),L=r(B),K=n(26),Z=r(K),W=n(52),H=r(W),X=n(32),Y=r(X),Q=n(67),J=r(Q),ee=n(33),te=n(62),ne=n(68),re=r(ne),oe=n(69),ae=n(55),ie=r(ae),ue=n(22),se=r(ue),ce=n(79),fe=r(ce),le=["user","group","conversation"],de=(u=(0,ee.decorator)(),s=(0,ee.decorator)(),c=(0,ee.decorator)({memoize:!0}),f=(0,ee.decorator)(),l=(0,ee.decorator)(),(0,te.classWithPrivateMethods)((p=function(e){function t(){var e;(0,q["default"])(this,t);for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var a=(0,L["default"])(this,(e=(0,$["default"])(t)).call.apply(e,[this].concat(r)));return a._throtelled_flushQueueMessageStatuses=a.config.flushSetMessageStatusInterval?Y["default"].throttle(a.__flushQueueMessageStatuses,a.config.flushSetMessageStatusInterval,{leading:!1}):a.__flushQueueMessageStatuses,a}return(0,Z["default"])(t,e),(0,F["default"])(t,[{key:"mounted",value:function(){this._queuedMessageStatuses={deliveredIds:[],readIds:[]},this.host.on("tick",this.deleteExpiredMessages)}},{key:"dispose",value:function(){this._queuedMessageStatuses=null,ee.decorator.clear(this.downloadAttachmentURL),this._throtelled_flushQueueMessageStatuses.cancel&&this._throtelled_flushQueueMessageStatuses.cancel(),this.host.off("tick",this.deleteExpiredMessages)}},{key:"send",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e,n){var r,o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(null==o||o instanceof Object){t.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+i(o));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if(null==o||o instanceof Object){t.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+a(o));case 12:return t.next=14,this.__resolveRecipientEntity(e);case 14:if(r=t.sent,!r){t.next=24;break}t.t0=r.$entityType,t.next="user"===t.t0?19:"group"===t.t0?20:"conversation"===t.t0?21:22;break;case 19:return t.abrupt("return",this.sendToUser(r.id,n,o));case 20:return t.abrupt("return",this.sendToGroup(r.id,n,o));case 21:return t.abrupt("return",this.sendToConversation(r.id,n,o));case 22:t.next=25;break;case 24:return t.abrupt("return",this.sendToUser(e,n,o));case 25:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendToConversation",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e,n){var r,o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(null==o||o instanceof Object){t.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+i(o));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if(null==o||o instanceof Object){t.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+a(o));case 12:e=this._resolveModelIdWithTypes(e,"conversation"),r=this.host.conversations.getById(e),r||ie["default"].raise("conversationId","not-found","Conversation not found"),t.t0=r.counterPartyType,t.next="user"===t.t0?18:"group"===t.t0?19:20;break;case 18:return t.abrupt("return",this.sendToUser(r.counterPartyId,n,(0,z["default"])({},o,{organizationId:r.organizationId})));case 19:return t.abrupt("return",this.sendToGroup(r.counterPartyId,n,(0,z["default"])({},o,{organizationId:r.organizationId})));case 20:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendToUser",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e,n){var r,o=arguments.length<=2||void 0===arguments[2]?{options:{}}:arguments[2],u=o.organizationId,s=o.senderOrganizationId,c=o.recipientOrganizationId,f=(0,G["default"])(o,["organizationId","senderOrganizationId","recipientOrganizationId"]);return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(e=this._resolveModelIdWithTypes(e,"user"),u?(s&&ie["default"].raise("senderOrganizationId","invalid","Cannot set senderOrganizationId if organizationId is set"),c&&ie["default"].raise("recipientOrganizationId","invalid","Cannot set recipientOrganizationId if organizationId is set"),s=c=u):s?c||(c=s):this.host.config.defaultOrganizationId?s=c=this.host.config.defaultOrganizationId:ie["default"].raise("senderOrganizationId or organizationId","required","Message is sent in the context of an organization. Provide `senderOrganizationId` or `organizationId` or set a default one with client.setDefaultOrganization(...)"),this.host.users.getById(e)){t.next=23;break}return t.prev=11,t.next=14,this.host.users.find(e);case 14:r=t.sent,e=r.id,t.next=23;break;case 18:if(t.prev=18,t.t0=t["catch"](11),t.t0.code===se["default"].NotFoundError.CODE){t.next=22;break}throw t.t0;case 22:return t.abrupt("return",this.__sendToUnknownUser(e,n,(0,z["default"])({organizationId:u,senderOrganizationId:s,recipientOrganizationId:c},f)));case 23:return t.abrupt("return",this.__send("user",e,n,(0,z["default"])({senderOrganizationId:s,recipientOrganizationId:c},f)));case 24:case"end":return t.stop()}},t,this,[[11,18]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"__resolveRecipientEntity",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e){var n,r,o,u,s,c,f,l,d=this;return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:if(n=void 0,"string"!=typeof e){t.next=11;break}if(n=this._resolveEntity(e,le),!n){t.next=9;break}return t.abrupt("return",n);case 9:t.next=14;break;case 11:return n=e,ie["default"].oneOf("entity",n.$entityType,le),t.abrupt("return",n);case 14:if(r=[(0,U["default"])(S["default"].mark(function p(){return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d.host.users.find(e));case 1:case"end":return t.stop()}},p,d)})),(0,U["default"])(S["default"].mark(function y(){return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d.host.groups.find(e));case 1:case"end":return t.stop()}},y,d)}))],this.host.conversations.looksLikeConversationId(e)&&r.unshift((0,U["default"])(S["default"].mark(function g(){return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d.host.conversations.find(e));case 1:case"end":return t.stop()}},g,d)}))),r&&("function"==typeof r[A["default"]]||Array.isArray(r))){t.next=18;break}throw new TypeError("Expected resolvers to be iterable, got "+a(r));case 18:if(r&&("function"==typeof r[A["default"]]||Array.isArray(r))){t.next=20;break}throw new TypeError("Expected resolvers to be iterable, got "+i(r));case 20:o=!0,u=!1,s=void 0,t.prev=23,c=(0,O["default"])(r);case 25:if(o=(f=c.next()).done){t.next=42;break}return l=f.value,t.prev=27,t.next=30,l();case 30:if(n=t.sent,!n){t.next=33;break}return t.abrupt("return",n);case 33:t.next=39;break;case 35:if(t.prev=35,t.t0=t["catch"](27),t.t0.code===se["default"].NotFoundError.CODE){t.next=39;break}throw t.t0;case 39:o=!0,t.next=25;break;case 42:t.next=48;break;case 44:t.prev=44,t.t1=t["catch"](23),u=!0,s=t.t1;case 48:t.prev=48,t.prev=49,!o&&c["return"]&&c["return"]();case 51:if(t.prev=51,!u){t.next=54;break}throw s;case 54:return t.finish(51);case 55:return t.finish(48);case 56:return t.abrupt("return",null);case 57:case"end":return t.stop()}},t,this,[[23,44,48,56],[27,35],[49,,51,55]])}));return function(t){return e.apply(this,arguments)}}()},{key:"__sendToUnknownUser",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e,n){var r,o,u,s,c,f,l=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],d=l.organizationId,p=l.senderOrganizationId,y=void 0===p?d:p,g=l.recipientOrganizationId,h=void 0===g?y:g,v=(0,G["default"])(l,["organizationId","senderOrganizationId","recipientOrganizationId"]);return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return r=re["default"].v4(),o=this.__getNextSortNumber(),v=this.__normalizeSendOptions(v,y),t.next=13,this.host.api.messages.send({localId:r,counterPartyId:e,body:n,senderOrganizationId:y,recipientOrganizationId:h,attachment:Y["default"].head(v.attachmentFiles),priority:"undefined"!=typeof v.priority?oe.MessagePriority.toServer(v.priority):void 0,metadata:v.metadata,ttl:v.ttl,dor:v.dor});case 13:return u=t.sent,t.next=16,this.host.users.find(e);case 16:return s=t.sent,c=this.host.conversations.ensureConversation("user",s.id,y),f=this.host.models.Message.inject({id:u.serverId,conversationId:c.id,counterParty:s,messageType:oe.MessageType.USER_SENT,body:n,senderOrganizationId:y,recipientOrganizationId:h,sortNumber:o,createdAt:new Date,senderId:this.host.getCurrentUser().id,direction:oe.MessageDirection.OUTGOING,senderStatus:oe.MessageSenderStatus.SENT,recipientStatus:oe.MessageRecipientStatus.NEW,serverId:null,metadata:v.metadata,priority:v.priority,ttl:u.ttl,dor:v.dor}),v.attachmentFiles&&this.__setMessageAttachments(f,v.attachmentFiles),this.host.emit("message:sending",f),this.host.emit("message:sent",f),t.abrupt("return",f);case 23:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendToGroup",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e,n){var r,o=arguments.length<=2||void 0===arguments[2]?{options:{}}:arguments[2],u=o.organizationId,s=(0,G["default"])(o,["organizationId"]);return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e=this._resolveModelIdWithTypes(e,"group"),r=this.host.models.Group.get(e),u=r?r.organizationId:this.__ensureOrganization(u),t.abrupt("return",this.__send("group",e,n,(0,z["default"])({senderOrganizationId:u},s)));case 12:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendToNewGroup",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e,n){var r,o=this,u=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=u.organizationId,c=u.groupName,f=u.groupMetadata,l=(0,G["default"])(u,["organizationId","groupName","groupMetadata"]);return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=6;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e=e.map(function(e){return o._resolveModelIdWithTypes(e,"user")}),0==e.length&&ie["default"].raise("userIds","required"),s=this.__ensureOrganization(s),t.next=13,this.__prepareGroupForUsers(s,e,c,{groupMetadata:f});case 13:return r=t.sent,t.abrupt("return",this.sendToGroup(r,n,(0,z["default"])({organizationId:s},l)));case 15:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"__normalizeSendOptions",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.metadata,n=e.attachmentFiles,r=e.attachmentFile,o=e.priority,u=e.ttl,s=e.dor,c=arguments[1];if("string"!=typeof c)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(c));if("string"!=typeof c)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(c));return t&&(t=this.__normalizeMetadata(t)),n=this.__validateAttachments(n||r),"undefined"==typeof u&&(u=this.host.organizations.getSettingValue(c,"ttl")||-1),{metadata:t,attachmentFiles:n,priority:o,ttl:u,dor:s}}},{key:"__ensureOrganization",value:function(e){return e?e:this.host.config.defaultOrganizationId?this.host.config.defaultOrganizationId:void ie["default"].raise("organizationId","required","Message is sent in the context of an organization. Provide `organizationId` or set a default one with client.setDefaultOrganization(...)")}},{key:"__validateAttachments",value:function(e){return e=Y["default"].arrayWrap(e),!Y["default"].isEmpty(e)&&e.length>1&&ie["default"].raise("attachmentFiles","invalid","currently only a single attachment is supported"),e}},{key:"__normalizeMetadata",value:function(e){return e?Y["default"].arrayWrap(e).map(function(e){return(0,z["default"])({mimetype:"application/json"},e)}):null}},{key:"__getNextSortNumber",value:function(){var e=(0,Y["default"])(this.host.models.Message.getAll()).orderBy(["sortNumber"],["desc"]).first(),t=e?e.sortNumber:0,n=t+1e-6;return n}},{key:"__send",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e,n,r,o){var u,s,c,f,l,d=o.senderOrganizationId,p=o.recipientOrganizationId,y=void 0===p?d:p,g=(0,G["default"])(o,["senderOrganizationId","recipientOrganizationId"]),h=arguments;return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if(null!=h[3]&&"string"==typeof h[3].senderOrganizationId&&(null==h[3].recipientOrganizationId||"string"==typeof h[3].recipientOrganizationId)&&(null==h[3].options||h[3].options instanceof Object)){t.next=8;break}throw new TypeError("Value of argument 3 violates contract.\n\nExpected:\n{ senderOrganizationId: string;\n  recipientOrganizationId: ?string;\n  options: ?Object;\n}\n\nGot:\n"+i(h[3]));case 8:if("string"==typeof e){t.next=10;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 10:if("string"==typeof n){t.next=12;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 12:if("string"==typeof r){t.next=14;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 14:if(null!=h[3]&&"string"==typeof h[3].senderOrganizationId&&(null==h[3].recipientOrganizationId||"string"==typeof h[3].recipientOrganizationId)&&(null==h[3].options||h[3].options instanceof Object)){t.next=16;break}throw new TypeError("Value of argument 3 violates contract.\n\nExpected:\n{ senderOrganizationId: string;\n  recipientOrganizationId: ?string;\n  options: ?Object;\n}\n\nGot:\n"+a(h[3]));case 16:return this.host.requireUser(),ie["default"].oneOf("counterPartyType",e,["user","group"]),ie["default"].notEmpty("counterPartyId",n),u=this.__getNextSortNumber(),g=this.__normalizeSendOptions(g,d),s=this.host.conversations.ensureConversation(e,n,d),c=this.host.models.Message.createInstance({id:re["default"].v4(),conversationId:s.id,messageType:oe.MessageType.USER_SENT,counterPartyId:n,counterPartyType:e,body:r,senderOrganizationId:d,recipientOrganizationId:y,sortNumber:u,createdAt:new Date,senderId:this.host.getCurrentUser().id,direction:oe.MessageDirection.OUTGOING,senderStatus:oe.MessageSenderStatus.SENDING,$synced:!1,serverId:null,metadata:g.metadata,priority:g.priority,dor:g.dor,ttl:g.ttl}),g.attachmentFiles&&this.__setMessageAttachments(c,g.attachmentFiles),"group"==e?(c.groupId=n,c.recipientStatus=oe.MessageRecipientStatus.NA):(c.recipientId=n,c.recipientStatus=oe.MessageRecipientStatus.NEW),this.host.models.Message.inject(c),this.host.emit("message:sending",c),t.next=29,this.host.api.messages.send({localId:c.id,counterPartyId:n,body:r,senderOrganizationId:d,recipientOrganizationId:y,attachment:Y["default"].head(g.attachmentFiles),priority:"undefined"!=typeof g.priority?oe.MessagePriority.toServer(g.priority):void 0,metadata:g.metadata,ttl:g.ttl,dor:g.dor});case 29:if(f=t.sent,(0,I["default"])(c,{serverId:f.serverId,ttl:f.ttl,senderStatus:oe.MessageSenderStatus.SENT,$synced:!0}),"group"!=e){t.next=37;break}if(c.group&&!c.group.$temporary){t.next=35;break}return t.next=35,this.host.groups.find(c.groupId,{includeMembers:!0,bypassCache:!0});case 35:t.next=43;break;case 37:if(c.recipient&&!c.recipient.$temporary){t.next=43;break}return t.next=40,this.host.users.find(c.recipientId,{bypassCache:!0});case 40:l=t.sent,c.recipientId=l.id,c.counterPartyId=l.id;case 43:return this.host.models.Message.inject(c),
this.host.emit("message:sent",c),t.abrupt("return",c);case 46:case"end":return t.stop()}},t,this)}));return function(t,n,r,o){return e.apply(this,arguments)}}()},{key:"__setMessageAttachments",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!Array.isArray(t)||!t.every(function(e){return"string"==typeof e||e instanceof Object}))throw new TypeError('Value of argument "attachmentFiles" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if(!Array.isArray(t)||!t.every(function(e){return"string"==typeof e||e instanceof Object}))throw new TypeError('Value of argument "attachmentFiles" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+a(t));e.attachments=t.map(this.__generateAttachmentDescriptor.bind(this))}},{key:"__generateAttachmentDescriptor",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "attachment" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "attachment" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));var t=void 0;"string"==typeof e||e instanceof Buffer||ie["default"].raise("attachment","invalid","attachment (string or Buffer) is invalid");var r=void 0,o=void 0,u=void 0,s=n(80),c=n(36),f=n(81),l=n(37);if("string"==typeof e)r=s.statSync(e).size,o=f.lookup(e),u=c.basename(e);else{var d=l(e);if(d){var p=d.ext,y=d.mime;u="attachment."+p,o=y}r=e.byteLength}return t={localPath:"string"==typeof e?e:null,localFile:e instanceof Buffer?e:null,name:u,size:r,contentType:o}}},{key:"__prepareGroupForUsers",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e,n,r,o){var a,i,u=this,s=o.groupMetadata;return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=[this.host.getCurrentUser()].concat(n.map(function(e){return u.host.models.User.get(e)}).filter(Boolean)),r||(r=a.map(function(e){return e.displayName}).filter(Boolean).join(", ")||"Group"),t.next=4,this.host.groups.create({organizationId:e,name:r,replayHistory:!0,memberIds:n,metadata:s});case 4:return i=t.sent,t.abrupt("return",i);case 6:case"end":return t.stop()}},t,this)}));return function(t,n,r,o){return e.apply(this,arguments)}}()},{key:"onMessageRecalled",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));this.host.requireUser();var t=this._getMessageByServerId(e);t&&this._deleteLocalMessage(t)}},{key:"_deleteLocalMessage",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));this.host.models.Message.eject(e)}},{key:"recall",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e){var n,r;return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),n=Y["default"].arrayWrap(e),r=n.map(this.__recallSingle.bind(this)),t.next=9,_["default"].all(r);case 9:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"__recallSingle",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e){var n;return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:if(n=this._resolveMessage(e),!n){t.next=17;break}if(n.senderId==this.host.getCurrentUser().id){t.next=8;break}throw new se["default"].PermissionDeniedError(n,n.serverId,"recall");case 8:if(n.$synced!==!1){t.next=12;break}this._deleteLocalMessage(n),t.next=15;break;case 12:return t.next=14,this.host.api.messages.destroy(n.serverId);case 14:this._deleteLocalMessage(n);case 15:t.next=19;break;case 17:return t.next=19,this.host.api.messages.destroy(e);case 19:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"forward",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e,n,r){var o,u,s,c=r.organizationId,f=r.senderOrganizationId,l=void 0===f?c:f,d=r.recipientOrganizationId,p=void 0===d?l:d,y=r.priority,g=r.retrieveMessage,h=void 0===g?!1:g,v=arguments;return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if(!(null==v[2]||null!=v[2].senderOrganizationId&&"string"!=typeof v[2].senderOrganizationId||null!=v[2].recipientOrganizationId&&"string"!=typeof v[2].recipientOrganizationId||null!=v[2].priority&&"number"!=typeof v[2].priority||null!=v[2].retrieveMessage&&"boolean"!=typeof v[2].retrieveMessage)){t.next=6;break}throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ senderOrganizationId: ?string;\n  recipientOrganizationId: ?string;\n  priority: ?number;\n  retrieveMessage: ?bool;\n}\n\nGot:\n"+i(v[2]));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("string"==typeof n||n instanceof Object){t.next=10;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 10:if(!(null==v[2]||null!=v[2].senderOrganizationId&&"string"!=typeof v[2].senderOrganizationId||null!=v[2].recipientOrganizationId&&"string"!=typeof v[2].recipientOrganizationId||null!=v[2].priority&&"number"!=typeof v[2].priority||null!=v[2].retrieveMessage&&"boolean"!=typeof v[2].retrieveMessage)){t.next=12;break}throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ senderOrganizationId: ?string;\n  recipientOrganizationId: ?string;\n  priority: ?number;\n  retrieveMessage: ?bool;\n}\n\nGot:\n"+a(v[2]));case 12:if(this.host.requireUser(),o=this._resolveMessage(e)){t.next=16;break}throw new se["default"].NotFoundError(this.host.models.Message.name,e);case 16:return t.next=18,this.__resolveRecipientEntity(n);case 18:return u=t.sent,u&&(n="conversation"===u.$entityType?u.counterPartyId:u.serverId),ie["default"].notEmpty("recipientId",n,"recipientId not found"),t.next=23,this.host.api.messages.forward(o.serverId,n,{localId:re["default"].v4(),senderOrganizationId:l,recipientOrganizationId:p,priority:"undefined"!=typeof y?oe.MessagePriority.toServer(y):void 0});case 23:if(s=t.sent,!h){t.next=26;break}return t.abrupt("return",this.find(s.serverId));case 26:return t.abrupt("return",null);case 27:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"reactToMessageStatusEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=e.data.client_id,n=e.data.is_recalled;n?this.onMessageRecalled(t):this.__setMessageStatusPerRecipientFromServerData(t,Y["default"].pick(e.data,["status","account_id","timestamp"]))&&this.__touchMessage(t)}},{key:"__setMessageStatusPerRecipientFromServerData",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(!(t instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(!(t instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(t));var n=oe.MessageRecipientStatus.resolve(t.status),r=t.account_id,o=t.timestamp;return this.setRecipientMessageStatus(e,r,n,o)}},{key:"setRecipientMessageStatus",value:function(e,t,n,r){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if(!(null==r||"string"==typeof r||null==r||r instanceof Date))throw new TypeError('Value of argument "createdAt" violates contract.\n\nExpected:\n?string | ?Date\n\nGot:\n'+i(r));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));if(!(null==r||"string"==typeof r||null==r||r instanceof Date))throw new TypeError('Value of argument "createdAt" violates contract.\n\nExpected:\n?string | ?Date\n\nGot:\n'+a(r));var o=this._getMessageByServerId(e);if(o){n=oe.MessageRecipientStatus.resolve(n),this._setSingleUserMessageRecipientMessageStatus(o,n);var u=Y["default"].find(o.statusesPerRecipient,{userId:t});if(!u||this.__canChangeRecipientStatus(u.status,n)){var s=o.id+":"+t;return this.host.models.MessageStatusPerRecipient.inject({id:s,messageId:o.id,userId:t,status:n,createdAt:r})}}}},{key:"__touchMessage",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));var t=this._resolveMessage(e);this.host.models.Message.touch(t)}},{key:"_resolveMessage",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));return this.host.models.Message.is(e)?e:this.host.models.Message.get(e)||this._getMessageByServerId(e)}},{key:"_getMessageByServerId",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));return this.host.models.Message.is(e)?e:(0,Y["default"])(this.host.models.Message.getAll()).find({serverId:e})}},{key:"_setSingleUserMessageRecipientMessageStatus",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));this.__canChangeRecipientStatus(e.recipientStatus,t)&&this.host.models.Message.inject({id:e.id,recipientStatus:t})}},{key:"__canChangeRecipientStatus",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "fromStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "toStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "fromStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "toStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return e===t?!1:e!==oe.MessageRecipientStatus.READ||t!=oe.MessageRecipientStatus.DELIVERED}},{key:"find",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e){var n,r,o,u,s;return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),t.next=7,this.httpClient.get("/message/:id",{urlParams:{id:e}});case 7:return n=t.sent,r=n.data,o=n.data.recipient_token,t.next=12,this.__lookupCounterParty(o);case 12:if(u=t.sent,!u){t.next=17;break}r.counterParty=u,t.next=18;break;case 17:return t.abrupt("return",null);case 18:return s=this.host.models.Message.inject(r),t.next=21,this.findStatusesPerRecipient(s);case 21:return t.abrupt("return",s);case 22:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Message.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Message.getMulti(e)}},{key:"__lookupCounterParty",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e){var n,r,o,u,s,c,f,l,d,p,y,g,h,v,m,b;return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:if(r=[{model:this.host.models.User,finder:(n=this.host.users).find.bind(n)},{model:this.host.models.Group,finder:(n=this.host.groups).find.bind(n)}],r&&("function"==typeof r[A["default"]]||Array.isArray(r))){t.next=7;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+a(r));case 7:if(r&&("function"==typeof r[A["default"]]||Array.isArray(r))){t.next=9;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+i(r));case 9:o=!0,u=!1,s=void 0,t.prev=12,c=(0,O["default"])(r);case 14:if(o=(f=c.next()).done){t.next=22;break}if(l=f.value.model,d=l.get(e),!d){t.next=19;break}return t.abrupt("return",d);case 19:o=!0,t.next=14;break;case 22:t.next=28;break;case 24:t.prev=24,t.t0=t["catch"](12),u=!0,s=t.t0;case 28:t.prev=28,t.prev=29,!o&&c["return"]&&c["return"]();case 31:if(t.prev=31,!u){t.next=34;break}throw s;case 34:return t.finish(31);case 35:return t.finish(28);case 36:if(r&&("function"==typeof r[A["default"]]||Array.isArray(r))){t.next=38;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+a(r));case 38:if(r&&("function"==typeof r[A["default"]]||Array.isArray(r))){t.next=40;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+i(r));case 40:p=!0,y=!1,g=void 0,t.prev=43,h=(0,O["default"])(r);case 45:if(p=(v=h.next()).done){t.next=62;break}return m=v.value.finder,t.prev=47,t.next=50,m(e);case 50:if(b=t.sent,!b){t.next=53;break}return t.abrupt("return",b);case 53:t.next=59;break;case 55:if(t.prev=55,t.t1=t["catch"](47),t.t1.code==se["default"].NotFoundError.CODE){t.next=59;break}throw t.t1;case 59:p=!0,t.next=45;break;case 62:t.next=68;break;case 64:t.prev=64,t.t2=t["catch"](43),y=!0,g=t.t2;case 68:t.prev=68,t.prev=69,!p&&h["return"]&&h["return"]();case 71:if(t.prev=71,!y){t.next=74;break}throw g;case 74:return t.finish(71);case 75:return t.finish(68);case 76:return t.abrupt("return",null);case 77:case"end":return t.stop()}},t,this,[[12,24,28,36],[29,,31,35],[43,64,68,76],[47,55],[69,,71,75]])}));return function(t){return e.apply(this,arguments)}}()},{key:"downloadAttachmentURL",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e,n){var r;return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||"number"==typeof n){t.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n||"number"==typeof n){t.next=8;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(n));case 8:t.next=17;break;case 13:return r=t.sent,t.abrupt("return",r);case 17:throw new Error("On Node.js use `downloadImageToFile`");case 18:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"downloadAttachmentToFile",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e,n,r){var o,u;return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||"number"==typeof n){t.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "dest" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("string"==typeof n||"number"==typeof n){t.next=10;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "dest" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return o=this._resolveMessage(e),n=n.toString(),t.next=17,this.httpClient.downloadImageToFile("/message/"+o.serverId+"/attachment/"+n,r);case 17:return u=t.sent,t.abrupt("return",u);case 21:throw new Error("On Node.js use `downloadImageToFile`");case 22:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e){return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),t.next=7,this.httpClient["delete"]("/message/:id",{urlParams:{id:e}});case 7:return t.abrupt("return",null);case 8:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getMessageCount",value:function(){return this.host.models.Message.getAll().length}},{key:"getTotalUnreadCount",value:function(){return Y["default"].sumBy(this.host.models.Conversation.getAll(),"unreadCount")}},{key:"markAsRead",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=n.queue,o=void 0===r?!0:r;return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+a(e));case 4:if(e=(0,Y["default"])(e).chain().arrayWrap().map(this._resolveModelId.bind(this)).uniq().value(),!o){t.next=9;break}return t.abrupt("return",this.__queueMessageStatuses({readIds:e}));case 9:return t.abrupt("return",this.__setMessagesStatus({readIds:e}));case 10:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"markAsDelivered",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=n.queue,o=void 0===r?!0:r;return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+a(e));case 4:if(e=(0,Y["default"])(e).chain().arrayWrap().map(this._resolveModelId.bind(this)).uniq().value(),!o){t.next=9;break}return t.abrupt("return",this.__queueMessageStatuses({deliveredIds:e}));case 9:return t.abrupt("return",this.__setMessagesStatus({deliveredIds:e}));case 10:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"markAsReceived",value:function(){var e=(0,U["default"])(S["default"].mark(function t(){var e=arguments;return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.markAsDelivered.apply(this,e));case 1:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"__queueMessageStatuses",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e){var n,r=e.deliveredIds,o=e.readIds,u=arguments;return S["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=u[0]&&(null==u[0].deliveredIds||Array.isArray(u[0].deliveredIds)&&u[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(null==u[0].readIds||Array.isArray(u[0].readIds)&&u[0].readIds.every(function(e){return"string"==typeof e}))){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ deliveredIds: ?Array<string>;\n  readIds: ?Array<string>;\n}\n\nGot:\n"+i(u[0]));case 2:if(null!=u[0]&&(null==u[0].deliveredIds||Array.isArray(u[0].deliveredIds)&&u[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(null==u[0].readIds||Array.isArray(u[0].readIds)&&u[0].readIds.every(function(e){return"string"==typeof e}))){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ deliveredIds: ?Array<string>;\n  readIds: ?Array<string>;\n}\n\nGot:\n"+a(u[0]));case 4:if(r&&(this._queuedMessageStatuses.deliveredIds=Y["default"].union(this._queuedMessageStatuses.deliveredIds,r)),o&&(this._queuedMessageStatuses.readIds=Y["default"].union(this._queuedMessageStatuses.readIds,o)),n=this._queuedMessageStatuses.deliveredIds.length+this._queuedMessageStatuses.readIds.length,!(n>=this.config.flushMessageMaxCount)){e.next=12;break}return this.logger.log("reached "+this.config.flushMessageMaxCount+" -- flushing"),e.abrupt("return",this.__flushQueueMessageStatuses());case 12:this._throtelled_flushQueueMessageStatuses();case 13:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"__flushQueueMessageStatuses",value:function(){var e=this._queuedMessageStatuses.deliveredIds.length+this._queuedMessageStatuses.readIds.length;e>0&&(this.__setMessagesStatus(this._queuedMessageStatuses),this._queuedMessageStatuses.deliveredIds=[],this._queuedMessageStatuses.readIds=[])}},{key:"__setMessagesStatus",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e){var n,r,o,a=this,i=e.deliveredIds,u=void 0===i?[]:i,s=e.readIds,c=void 0===s?[]:s;return S["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),u=(0,Y["default"])(u).chain().map(this._resolveModelId.bind(this)).uniq().value(),c=(0,Y["default"])(c).chain().map(this._resolveModelId.bind(this)).uniq().value(),n=u.map(this._resolveMessage).filter(Boolean),r=c.map(this._resolveMessage).filter(Boolean),c=Y["default"].difference(c,(0,Y["default"])(r).filter(function(e){return e.recipientStatus===oe.MessageRecipientStatus.READ||e.recipientStatus==oe.MessageRecipientStatus.TO_BE_READ}).map("id").value()),u=Y["default"].difference(u,c,(0,Y["default"])(n).filter(function(e){return e.recipientStatus===oe.MessageRecipientStatus.DELIVERED||e.recipientStatus===oe.MessageRecipientStatus.READ||e.recipientStatus==oe.MessageRecipientStatus.TO_BE_READ}).map("id").value()),o={},u.length&&(o.delivered=u),c.length&&(o.read=c,r.forEach(function(e){return a.host.models.Message.inject({id:e.id,recipientStatus:oe.MessageRecipientStatus.TO_BE_READ})})),!Y["default"].isEmpty(o.delivered)||!Y["default"].isEmpty(o.read)){e.next=12;break}return e.abrupt("return",!1);case 12:return e.next=14,this.httpClient.post("/message/status",{data:o});case 14:c.length&&(o.read=c,r.forEach(function(e){return a.host.models.Message.inject({id:e.id,recipientStatus:oe.MessageRecipientStatus.READ})}),this.__checkForDeleteOnReadMessages(r)),u.length&&n.forEach(function(e){return a.host.models.Message.inject({id:e.id,recipientStatus:oe.MessageRecipientStatus.DELIVERED})});case 16:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"__checkForDeleteOnReadMessages",value:function(e){var t=this;if(!Array.isArray(e)||!e.every(function(e){return e instanceof Object}))throw new TypeError('Value of argument "messages" violates contract.\n\nExpected:\nObject[]\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return e instanceof Object}))throw new TypeError('Value of argument "messages" violates contract.\n\nExpected:\nObject[]\n\nGot:\n'+a(e));(0,Y["default"])(e).filter({dor:!0}).each(function(e){return t.setMessageTTLInMinutes(e,1)})}},{key:"setMessageTTLInMinutes",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("number"!=typeof t)throw new TypeError('Value of argument "ttl" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if("number"!=typeof t)throw new TypeError('Value of argument "ttl" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(t));var n=this._resolveMessage(e);if(n){var r=(0,J["default"])().add(1,"minute").toDate().getTime();this.host.models.Message.inject({id:n.id,ttl:t,expiresAt:r})}}},{key:"deleteExpiredMessages",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?Date.now():arguments[0];t.getTime&&(t=t.getTime()),this.host.models.Message.getAll().filter(function(e){return e.expiresAt&&e.expiresAt<t}).forEach(function(t){return e.host.models.Message.eject(t)})}},{key:"findStatusesPerRecipient",value:function(){var e=(0,U["default"])(S["default"].mark(function t(e){var n,r,o,u,s=this;return S["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:if(this.host.requireUser(),n=this._resolveMessage(e)){t.next=8;break}return t.abrupt("return",null);case 8:t.t0=n.counterPartyType,t.next="group"===t.t0?11:"user"===t.t0?21:23;break;case 11:return t.next=13,this.httpClient.get("/message/:id/status",{urlParams:{id:n.serverId}});case 13:if(r=t.sent,o=r.data,!o.is_recalled){t.next=18;break}return this.onMessageRecalled(n.serverId),t.abrupt("return");case 18:return u=o.statuses.map(function(e){return s.__setMessageStatusPerRecipientFromServerData(n.serverId,e)}).some(function(e){return e}),u&&this.__touchMessage(n),t.abrupt("break",23);case 21:return this.setRecipientMessageStatus(n.serverId,n.counterPartyId,n.recipientStatus,null)&&this.__touchMessage(n),t.abrupt("break",23);case 23:return t.abrupt("return",n.statusesPerRecipient);case 24:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(H["default"]),o(p.prototype,"__resolveRecipientEntity",[te.privateMethod],(0,E["default"])(p.prototype,"__resolveRecipientEntity"),p.prototype),o(p.prototype,"__sendToUnknownUser",[te.privateMethod],(0,E["default"])(p.prototype,"__sendToUnknownUser"),p.prototype),o(p.prototype,"__normalizeSendOptions",[te.privateMethod],(0,E["default"])(p.prototype,"__normalizeSendOptions"),p.prototype),
o(p.prototype,"__ensureOrganization",[te.privateMethod],(0,E["default"])(p.prototype,"__ensureOrganization"),p.prototype),o(p.prototype,"__validateAttachments",[te.privateMethod],(0,E["default"])(p.prototype,"__validateAttachments"),p.prototype),o(p.prototype,"__normalizeMetadata",[te.privateMethod],(0,E["default"])(p.prototype,"__normalizeMetadata"),p.prototype),o(p.prototype,"__getNextSortNumber",[te.privateMethod],(0,E["default"])(p.prototype,"__getNextSortNumber"),p.prototype),o(p.prototype,"__send",[te.privateMethod],(0,E["default"])(p.prototype,"__send"),p.prototype),o(p.prototype,"__setMessageAttachments",[te.privateMethod],(0,E["default"])(p.prototype,"__setMessageAttachments"),p.prototype),o(p.prototype,"__generateAttachmentDescriptor",[te.privateMethod],(0,E["default"])(p.prototype,"__generateAttachmentDescriptor"),p.prototype),o(p.prototype,"__prepareGroupForUsers",[te.privateMethod,u],(0,E["default"])(p.prototype,"__prepareGroupForUsers"),p.prototype),o(p.prototype,"_deleteLocalMessage",[te.privateMethod],(0,E["default"])(p.prototype,"_deleteLocalMessage"),p.prototype),o(p.prototype,"__recallSingle",[te.privateMethod],(0,E["default"])(p.prototype,"__recallSingle"),p.prototype),o(p.prototype,"__setMessageStatusPerRecipientFromServerData",[te.privateMethod],(0,E["default"])(p.prototype,"__setMessageStatusPerRecipientFromServerData"),p.prototype),o(p.prototype,"__touchMessage",[te.privateMethod],(0,E["default"])(p.prototype,"__touchMessage"),p.prototype),o(p.prototype,"_resolveMessage",[te.privateMethod,fe["default"]],(0,E["default"])(p.prototype,"_resolveMessage"),p.prototype),o(p.prototype,"_getMessageByServerId",[te.privateMethod],(0,E["default"])(p.prototype,"_getMessageByServerId"),p.prototype),o(p.prototype,"_setSingleUserMessageRecipientMessageStatus",[te.privateMethod],(0,E["default"])(p.prototype,"_setSingleUserMessageRecipientMessageStatus"),p.prototype),o(p.prototype,"__canChangeRecipientStatus",[te.privateMethod],(0,E["default"])(p.prototype,"__canChangeRecipientStatus"),p.prototype),o(p.prototype,"find",[s],(0,E["default"])(p.prototype,"find"),p.prototype),o(p.prototype,"__lookupCounterParty",[te.privateMethod],(0,E["default"])(p.prototype,"__lookupCounterParty"),p.prototype),o(p.prototype,"downloadAttachmentURL",[c],(0,E["default"])(p.prototype,"downloadAttachmentURL"),p.prototype),o(p.prototype,"destroy",[f],(0,E["default"])(p.prototype,"destroy"),p.prototype),o(p.prototype,"__queueMessageStatuses",[te.privateMethod],(0,E["default"])(p.prototype,"__queueMessageStatuses"),p.prototype),o(p.prototype,"__flushQueueMessageStatuses",[te.privateMethod,fe["default"]],(0,E["default"])(p.prototype,"__flushQueueMessageStatuses"),p.prototype),o(p.prototype,"__setMessagesStatus",[te.privateMethod],(0,E["default"])(p.prototype,"__setMessagesStatus"),p.prototype),o(p.prototype,"__checkForDeleteOnReadMessages",[te.privateMethod],(0,E["default"])(p.prototype,"__checkForDeleteOnReadMessages"),p.prototype),o(p.prototype,"deleteExpiredMessages",[fe["default"]],(0,E["default"])(p.prototype,"deleteExpiredMessages"),p.prototype),o(p.prototype,"findStatusesPerRecipient",[l],(0,E["default"])(p.prototype,"findStatusesPerRecipient"),p.prototype),d=p))||d);t["default"]=de,e.exports=t["default"]},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("node-uuid")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={MessageRecipientStatus:n(70),MessageSenderStatus:n(73),MessageDirection:n(74),PresenceStatus:n(75),GroupType:n(76),MessageType:n(77),MessagePriority:n(78)},e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(71),o=new r.ServerValueEnum({READ:{serverValue:"Read"},TO_BE_READ:{serverValue:"ToBeRead"},DELIVERED:{serverValue:"Delivered"},RECEIVED_ON_CLIENT:{serverValue:"ReceivedOnClient"},NEW:{serverValue:"New"},NA:{key:"NA"}});t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ServerValueEnum=t["default"]=void 0;var o=n(24),a=r(o),i=n(25),u=r(i),s=n(26),c=r(s),f=n(72),l=r(f),d=n(46),p=r(d),y=n(15),g=r(y),h=n(16),v=r(h),m=n(32),b=r(m),w=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];(0,g["default"])(this,e),Array.isArray(t)&&(t=t.reduce(function(e,t){return e[t]={},e},{})),this.keys=[],this.entries=[],this.entriesByKey={},this.defaultValue=n.defaultValue||null;for(var r in t){this[r]=r;var o=(0,p["default"])({key:r},t[r]);this.entriesByKey[r]=o,this.entries.push(o),this.keys.push(r)}(0,l["default"])(this.keys),(0,l["default"])(this.entries),(0,l["default"])(this.entriesByKey)}return(0,v["default"])(e,[{key:"resolve",value:function(e){return e||this.defaultValue}},{key:"isValid",value:function(e){return!!this.entriesByKey[e]}}]),e}();t["default"]=w,t.ServerValueEnum=function(e){function t(){return(0,g["default"])(this,t),(0,u["default"])(this,(0,a["default"])(t).apply(this,arguments))}return(0,c["default"])(t,e),(0,v["default"])(t,[{key:"mapEnumKeyToServerValue",value:function(){return this._mapEnumKeyToServerValue||(this._mapEnumKeyToServerValue=b["default"].transform(this.entries,function(e,t){return e[t.key]=t.serverValue},{}))}},{key:"mapServerValueToEnumKey",value:function(){return this._mapServerValueToEnumKey||(this._mapServerValueToEnumKey=b["default"].invert(this.mapEnumKeyToServerValue()))}},{key:"fromServer",value:function(e){return this.mapServerValueToEnumKey()[e]}},{key:"toServer",value:function(e){return this.mapEnumKeyToServerValue()[e]||this.mapServerValueToEnumKey()[e]}},{key:"resolve",value:function(e){return(this.isValid(e)?e:this.fromServer(e))||this.defaultValue}}]),t}(w)},function(e,t){e.exports=require("babel-runtime/core-js/object/freeze")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(71),a=r(o),i=new a["default"](["SENDING","SENT","FAILED","NEW","NA"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(71),a=r(o),i=new a["default"](["INCOMING","OUTGOING"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(71),o=new r.ServerValueEnum({UNKNOWN:{serverValue:"unknown"},AVAILABLE:{serverValue:"available"},UNAVAILABLE:{serverValue:"unavailable"}});t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(71),a=r(o),i=new a["default"](["GROUP","ROOM","DISTRIBUTION_LIST"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(71),a=r(o),i=new a["default"](["USER_SENT","GROUP_MEMBERSHIP_CHANGE"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(71),o=new r.ServerValueEnum({LOW:{serverValue:-1},NORMAL:{serverValue:0},HIGH:{serverValue:1}},{defaultValue:"NORMAL"});t["default"]=o,e.exports=t["default"]},function(e,t){e.exports=require("autobind-decorator")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("mime")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,v["default"])(e);if(!Array.isArray(e)){var o=(0,g["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,v["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,v["default"])(e);if(!Array.isArray(e)){var o=(0,g["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,v["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f,l,d=n(7),p=r(d),y=n(14),g=r(y),h=n(8),v=r(h),m=n(9),b=r(m),w=n(46),E=r(w),x=n(11),_=r(x),k=n(18),I=r(k),T=n(12),O=r(T),j=n(13),A=r(j),M=n(24),G=r(M),V=n(15),z=r(V),C=n(16),S=r(C),P=n(25),U=r(P),N=n(26),$=r(N),R=n(52),q=r(R),D=n(22),F=r(D),B=n(32),L=r(B),K=n(33),Z=n(62),W=(u=(0,K.decorator)(),s=(0,K.decorator)(),c=(0,K.decorator)(),(0,Z.classWithPrivateMethods)((l=function(e){function t(){return(0,z["default"])(this,t),(0,U["default"])(this,(0,G["default"])(t).apply(this,arguments))}return(0,$["default"])(t,e),(0,S["default"])(t,[{key:"mounted",value:function(){this._fetched=!1}},{key:"dispose",value:function(){this._fetched=!1}},{key:"create",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e){var n,r,o=e.organizationId,a=e.name,i=e.avatarFile,u=e.replayHistory,s=void 0===u?!0:u,c=e.memberIds,f=void 0===c?[]:c,l=e.metadata;return O["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),o){e.next=3;break}throw new F["default"].ValidationError("organizationId","required");case 3:return f=f.map(this._resolveModelId.bind(this)),f.includes(this.host.getCurrentUser().id)||f.unshift(this.host.getCurrentUser().id),e.next=7,this.host.api.groups.create({name:a,avatarFile:i,replayHistory:s,memberIds:f,organizationId:o});case 7:if(n=e.sent,r=this.host.models.Group.inject(n),!l){e.next=12;break}return e.next=12,this.host.metadata.update(r.id,l,o);case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e,n){var r,o=n.name,u=n.avatarFile,s=n.replayHistory,c=n.memberIds,f=n.metadata;return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),e=this._resolveModelId(e),c.includes(this.host.getCurrentUser().id)||c.unshift(this.host.getCurrentUser().id),t.next=9,this.host.api.groups.update(e,{name:o,avatarFile:u,replayHistory:s,memberIds:c});case 9:if(r=this.host.models.Group.inject({id:e,name:o,replayHistory:s,memberIds:c}),!f){t.next=13;break}return t.next=13,this.host.metadata.update(e,f,r.organizationId);case 13:return t.abrupt("return",r);case 14:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e){var n,r,o,u=this,s=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:if(s=L["default"].defaults(s,{ignoreNotFound:!1,bypassCache:!1,includeMembers:!1,includeMetadata:!1}),this.host.requireUser(),n=null,s.bypassCache){t.next=11;break}if(n=this.host.models.Group.get(e),!n){t.next=11;break}return t.abrupt("return",n);case 11:return t.next=13,this.host.api.groups.find(e);case 13:if(r=t.sent,!r){t.next=19;break}n=this.host.models.Group.inject(r),delete n.$temporary,t.next=21;break;case 19:if(s.ignoreNotFound){t.next=21;break}throw new F["default"].NotFoundError(this.host.models.Group.name,e);case 21:if(!n){t.next=28;break}if(o=[],s.includeMetadata&&o.push(this.host.metadata.find(e,n.organizationId)),s.includeMembers&&o.push.apply(o,(0,I["default"])(n.memberIds.map(function(e){return u.host.users.find(e,{ignoreNotFound:!0})}))),!(o.length>0)){t.next=28;break}return t.next=28,_["default"].all(o);case 28:return t.abrupt("return",n);case 29:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findAll",value:function(){var e=(0,A["default"])(O["default"].mark(function t(){var e,n,r,o,a,i=this,u=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],s=u.includeMembers,c=void 0===s?!1:s,f=u.includeMetadata,l=void 0===f?!1:f;return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._fetched){t.next=2;break}return t.abrupt("return",this.getAll());case 2:if(e=this.host.models.Organization.getAll(),0!=e.length){t.next=7;break}return t.next=6,this.host.organizations.findAll();case 6:e=t.sent;case 7:return t.next=9,this.host.search.query({types:["group"],organizationIds:e.map(function(e){return e.id}),query:{displayName:""},includeMetadata:l});case 9:if(n=t.sent,r=n.map(function(e){return e.entity}),!c){t.next=18;break}if(o=[],a=(0,L["default"])(r).map("memberIds").flatten().uniq().value(),o.push.apply(o,(0,I["default"])(a.map(function(e){return i.host.users.find(e,{ignoreNotFound:!0})}))),!(o.length>0)){t.next=18;break}return t.next=18,_["default"].all(o);case 18:return this._fetched=!0,t.abrupt("return",r);case 20:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findAllWithSpecificMembers",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e,n){var r;return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(e));case 2:if("string"==typeof n||n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=6;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(e));case 6:if("string"==typeof n||n instanceof Object){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:if(n=this._resolveModelId(n),e=L["default"].arrayWrap(e).map(this._resolveModelId.bind(this)),L["default"].contain(e,this.host.getCurrentUser().id),r=this.__findAllLocalWithSpecificMembers(e,n),0!==r.length){t.next=16;break}return t.next=15,this.findAll();case 15:r=this.__findAllLocalWithSpecificMembers(e,n);case 16:return t.abrupt("return",r);case 17:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"ensureMembers",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e){var n=this;return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));case 2:if(e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));case 4:e.memberIds.forEach(function(e){var t;n.host.models.User.ensureEntityOrCreateTemporaryAndFind({id:e,displayName:"Loading..."},{finder:(t=n.host.users).find.bind(t)})});case 5:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAll",value:function(){return this.host.models.Group.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Group.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Group.getMulti(e)}},{key:"__findAllLocalWithSpecificMembers",value:function(e,t){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));var n=this.host.models.Group.getAll(),r=L["default"].filter(n,function(n){return n.organizationId==t&&0==L["default"].xor(n.memberIds,e).length});return r}},{key:"destroy",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e){var n;return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),e=this._resolveModelId(e),t.next=8,this.host.api.groups.destroy(e);case 8:if(n=t.sent){t.next=11;break}throw new F["default"].NotFoundError(this.host.models.Group.name,e);case 11:return this.host.models.Group.eject(e),t.abrupt("return",null);case 13:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findAllMemberIds",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e){var n;return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),e=this._resolveModelId(e),t.next=8,this.httpClient.get("/group/:id/members",{urlParams:{id:e}});case 8:return n=t.sent,t.abrupt("return",n.data);case 10:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addMembers",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e,n){return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){t.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(n));case 8:return this.host.requireUser(),e=this._resolveModelId(e),n=L["default"].arrayWrap(n).map(this._resolveModelId.bind(this)),t.next=13,this.httpClient.post("/group/:id/members",{urlParams:{id:e},data:{members:n}});case 13:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeMembers",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e,n){return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){t.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(n));case 8:return this.host.requireUser(),e=this._resolveModelId(e),n=L["default"].arrayWrap(n).map(this._resolveModelId.bind(this)),t.next=13,this.httpClient.post("/group/:id/members/remove",{urlParams:{id:e},data:{members:n}});case 13:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"addMember",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e,n){return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n||n instanceof Object){t.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:return t.abrupt("return",this.addMembers(e,[n]));case 9:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeMember",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e,n){return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n||n instanceof Object){t.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:return t.abrupt("return",this.removeMembers(e,[n]));case 9:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"reactToBangEvent",value:function(e){switch(e.data.event){case"added":this.__addedToGroup(e);break;case"removed":this.__removedFromGroup(e)}}},{key:"__addedToGroup",value:function(e){var t=e.data.caller_entity,n=e.data.subject_entity,r=e.data.target_entity;if(t&&t.token&&r&&r.token&&n&&n.token){var o=this.host.injectModel(t),a=this.host.injectModel(n),i=this.host.injectModel((0,E["default"])({organizationId:e.data.organization_id},r)),u=!1;[o.id,a.id].forEach(function(e){i.memberIds.includes(e)||(u=!0,i.memberIds=[].concat((0,I["default"])(i.memberIds),[e]))});var s=a.id===o.id?"JOIN":"ADD";u&&(this.host.models.Group.inject(i),this.emit("membership:change",{id:e.id,sortNumber:+e.data.sort_number,createdAt:new Date(e.data.created_on),action:s,actor:o,actorId:o.id,group:i,groupId:i.id,members:[a],memberIds:[a.id]}))}}},{key:"__removedFromGroup",value:function(e){var t=e.data.caller_entity,n=e.data.subject_entity,r=e.data.target_entity;if(t&&t.token&&r&&r.token&&n&&n.token){var o=this.host.injectModel(t),a=this.host.models.Group.get(r.token);if(a&&a.memberIds){var i=this.host.injectModel(n);if(a.memberIds.includes(i.id)){a.memberIds=L["default"].pull(a.memberIds,i.id);var u=i.id===o.id?"LEAVE":"REMOVE";this.emit("membership:change",{id:e.id,sortNumber:+e.data.sort_number,createdAt:new Date(e.data.created_on),action:u,actor:o,actorId:o.id,group:a,groupId:a.id,members:[i],memberIds:[i.id]})}}}}}]),t}(q["default"]),o(l.prototype,"find",[u],(0,b["default"])(l.prototype,"find"),l.prototype),o(l.prototype,"findAll",[s],(0,b["default"])(l.prototype,"findAll"),l.prototype),o(l.prototype,"findAllWithSpecificMembers",[c],(0,b["default"])(l.prototype,"findAllWithSpecificMembers"),l.prototype),o(l.prototype,"__findAllLocalWithSpecificMembers",[Z.privateMethod],(0,b["default"])(l.prototype,"__findAllLocalWithSpecificMembers"),l.prototype),o(l.prototype,"__addedToGroup",[Z.privateMethod],(0,b["default"])(l.prototype,"__addedToGroup"),l.prototype),o(l.prototype,"__removedFromGroup",[Z.privateMethod],(0,b["default"])(l.prototype,"__removedFromGroup"),l.prototype),f=l))||f);t["default"]=W,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h["default"])(e);if(!Array.isArray(e)){var o=(0,y["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h["default"])(e);if(!Array.isArray(e)){var o=(0,y["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f,l=n(7),d=r(l),p=n(14),y=r(p),g=n(8),h=r(g),v=n(9),m=r(v),b=n(46),w=r(b),E=n(12),x=r(E),_=n(13),k=r(_),I=n(24),T=r(I),O=n(15),j=r(O),A=n(16),M=r(A),G=n(25),V=r(G),z=n(26),C=r(z),S=n(52),P=r(S),U=n(33),N=n(22),$=r(N),R=n(32),q=r(R),D=n(84),F=r(D),B=n(85),L=r(B),K=n(79),Z=r(K),W=n(62),H=(u=(0,U.decorator)({memoize:!0}),s=(0,U.decorator)(),(0,W.classWithPrivateMethods)((f=function(e){function t(){return(0,j["default"])(this,t),(0,V["default"])(this,(0,T["default"])(t).apply(this,arguments))}return(0,C["default"])(t,e),(0,M["default"])(t,[{key:"mounted",value:function(){this.host.models.Conversation.on("afterInject",this._onConversationChange),this.host.models.Conversation.on("afterEject",this._onConversationChange)}},{key:"dispose",value:function(){this.host.models.Conversation.off("afterInject",this._onConversationChange),this.host.models.Conversation.off("afterEject",this._onConversationChange),
U.decorator.clear(this.findAll)}},{key:"create",value:function(){var e=(0,k["default"])(x["default"].mark(function t(){var e=this,n=arguments.length<=0||void 0===arguments[0]?{name:void 0,ttl:void 0,dor:void 0,allowPublicGroups:void 0,pinLock:void 0,settingsRestricted:void 0,autologoutTime:void 0,lifecycleCallback:void 0,groupLifespan:void 0,welcomeEmailSettings:void 0}:arguments[0];return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.host.requireUser(),t.abrupt("return",this.httpClient.post("/organization",{data:n}).then(function(t){var r=t.getHeader("TT-X-Organization-Key"),o=e.host.models.Organization.inject({id:r,name:n.name});return o}));case 2:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,k["default"])(x["default"].mark(function t(){var e,n=this,r=arguments.length<=0||void 0===arguments[0]?{id:void 0,name:void 0,ttl:void 0,dor:void 0,allowPublicGroups:void 0,pinLock:void 0,settingsRestricted:void 0,autologoutTime:void 0,lifecycleCallback:void 0,groupLifespan:void 0,welcomeEmailSettings:void 0,welcomeEmailLogo:void 0,autoSendWelcomeEmail:void 0}:arguments[0];return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.host.requireUser(),e=F["default"].underscoreObject({name:r.name,ttl:r.ttl,dor:r.dor,allowPublicGroups:r.allowPublicGroups,pinLock:r.pinLock,settingsRestricted:r.settingsRestricted,autologoutTime:r.autologoutTime,lifecycleCallback:r.lifecycleCallback,groupLifespan:r.groupLifespan,welcomeEmailSettings:r.welcomeEmailSettings,welcomeEmailLogo:r.welcomeEmailLogo,autoSendWelcomeEmail:r.autoSendWelcomeEmail}),t.abrupt("return",this.httpClient.post("/organization/:id",{urlParams:{id:r.id},data:e}).then(function(t){var o=n.host.models.Organization.inject((0,w["default"])({id:r.id},e));return o}));case 3:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findAll",value:function(){var e=(0,k["default"])(x["default"].mark(function t(){var e,n=this,r=arguments.length<=0||void 0===arguments[0]?{onlyApproved:!1}:arguments[0];return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.host.requireUser(),t.next=3,this._findAll();case 3:return e=t.sent,r.onlyApproved&&(e=q["default"].filter(e,{pending:!1})),e=q["default"].sortBy(e,function(e){return e.name.toLowerCase()}),e.forEach(function(e){return n.__reloadConversations(e)}),t.abrupt("return",e);case 8:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAll",value:function(){var e=(0,k["default"])(x["default"].mark(function t(){return x["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._findAll();case 2:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_findAll",value:function(){var e=(0,k["default"])(x["default"].mark(function t(){var e,n=this;return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.host.api.organizations.findAllOfUser(this.host.getCurrentUser().id);case 2:return e=t.sent,e=e.map(function(e){return n.host.models.Organization.inject(e)}),t.abrupt("return",e);case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,k["default"])(x["default"].mark(function t(e){var n,r,o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:if(o=q["default"].defaults(o,{ignoreNotFound:!1,bypassCache:!1}),this.host.requireUser(),n=void 0,o.bypassCache){t.next=11;break}if(n=this.host.models.Organization.get(e),!n){t.next=11;break}return t.abrupt("return",n);case 11:return t.next=13,this.host.api.organizations.find(this.host.getCurrentUser().id,e);case 13:if(r=t.sent,!r){t.next=19;break}n=this.host.models.Organization.inject(r),this.__reloadConversations(n),t.next=21;break;case 19:if(o.ignoreNotFound){t.next=21;break}throw new $["default"].NotFoundError(this.host.models.Organization.name,e);case 21:return t.abrupt("return",n);case 22:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSettingValue",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));e=this._resolveModelId(e);var n=this.getById(e);if(!n||!n.settings)return null;var r=q["default"].find(n.settings,{name:t});return r?r.value:null}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Organization.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Organization.getMulti(e)}},{key:"_onConversationChange",value:function(e,t){this.__reloadConversations(t.organization)}},{key:"__reloadConversations",value:function(e){if(e){var t=q["default"].pick(e,["conversations","unreadCount"]),n=(0,q["default"])(this.host.models.Conversation.getAll()).filter({organizationId:e.id}).orderBy(["lastEventMessageSortNumber","_origIndex"],["desc","asc"]).value(),r=q["default"].sumBy(n,function(e){return e.unreadCount}),o={conversations:n,unreadCount:r},a=!1;q["default"].each(t,function(t,n){(0,L["default"])(t,o[n])||(e[n]=o[n],a=!0)}),a&&this.host.models.Organization.inject(e)}}}]),t}(P["default"]),o(f.prototype,"findAll",[u],(0,m["default"])(f.prototype,"findAll"),f.prototype),o(f.prototype,"refreshAll",[U.decorator],(0,m["default"])(f.prototype,"refreshAll"),f.prototype),o(f.prototype,"_findAll",[W.privateMethod],(0,m["default"])(f.prototype,"_findAll"),f.prototype),o(f.prototype,"find",[s],(0,m["default"])(f.prototype,"find"),f.prototype),o(f.prototype,"_onConversationChange",[W.privateMethod,Z["default"]],(0,m["default"])(f.prototype,"_onConversationChange"),f.prototype),o(f.prototype,"__reloadConversations",[W.privateMethod],(0,m["default"])(f.prototype,"__reloadConversations"),f.prototype),c=f))||c);t["default"]=H,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){return u["default"].isArray(e)?e.map(function(e){return o(e,t)}):u["default"].isObject(e)?u["default"].transform(e,function(e,n,r){e[t(r)]=o(n,t)},{}):e}Object.defineProperty(t,"__esModule",{value:!0});var a=n(14),i=(r(a),n(32)),u=r(i),s={camelizeKey:u["default"].memoize(u["default"].camelCase),underscoreKey:u["default"].memoize(u["default"].snakeCase),camelizeObject:function(e){return o(e,s.camelizeKey)},underscoreObject:function(e){return o(e,s.underscoreKey)}};t["default"]=s,e.exports=t["default"]},function(e,t){e.exports=require("shallowequal")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,m["default"])(e);if(!Array.isArray(e)){var o=(0,h["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,m["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,m["default"])(e);if(!Array.isArray(e)){var o=(0,h["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,m["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f,l,d,p=n(7),y=r(p),g=n(14),h=r(g),v=n(8),m=r(v),b=n(9),w=r(b),E=n(57),x=r(E),_=n(58),k=r(_),I=n(12),T=r(I),O=n(13),j=r(O),A=n(24),M=r(A),G=n(15),V=r(G),z=n(16),C=r(z),S=n(25),P=r(S),U=n(26),N=r(U),$=n(52),R=r($),q=n(33),D=n(32),F=r(D),B=n(51),L=r(B),K=n(85),Z=r(K),W=n(79),H=r(W),X=n(62),Y=n(69),Q=n(87),J=r(Q),ee=new L["default"].MD5,te=(u=(0,q.decorator)(),s=(0,q.decorator)(),c=(0,q.decorator)(),f=(0,q.decorator)(),(0,X.classWithPrivateMethods)((d=function(e){function t(){var e;(0,V["default"])(this,t);for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var a=(0,P["default"])(this,(e=(0,M["default"])(t)).call.apply(e,[this].concat(r)));return a._throtelled__flushConversationsToReload=a.config.conversationReloadDelay?a._throtelled__flushConversationsToReload=F["default"].throttle(a.__flushConversationsToReload,a.config.conversationReloadDelay,{leading:!1}):a.__flushConversationsToReload,a}return(0,N["default"])(t,e),(0,C["default"])(t,[{key:"mounted",value:function(){this._fetched=!1,this.host.on("message:sending",this._onMessageSending),this.host.on("message:sent",this._onMessageSent),this.host.groups.on("membership:change",this._onGroupMembershipChange),this.host.models.Message.on("afterInject",this._onMessageChange),this.host.models.Message.on("afterEject",this._onMessageChange),this.host.models.Group.on("afterEject",this._onGroupDelete),this.__queuedConversationsToReload=[]}},{key:"dispose",value:function(){this._fetched=!1,this.host.removeListener("message:sending",this._onMessageSending),this.host.removeListener("message:sent",this._onMessageSent),this.host.groups.removeListener("membership:change",this._onGroupMembershipChange),this.host.models.Message.off("afterInject",this._onMessageChange),this.host.models.Message.off("afterEject",this._onMessageChange),this.host.models.Group.off("afterEject",this._onGroupDelete),this.__queuedConversationsToReload=null,this._throtelled__flushConversationsToReload.cancel&&this._throtelled__flushConversationsToReload.cancel()}},{key:"findAll",value:function(){var e=(0,j["default"])(T["default"].mark(function t(){var e,n,r=this,o=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return T["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=F["default"].defaults(o,{includeMutes:!0}),!this._fetched){t.next=3;break}return t.abrupt("return",this.getAll());case 3:return t.next=5,this.host.api.roster.findAll();case 5:if(e=t.sent,n=e.map(function(e){var t=r.host.injectModel(e);delete t.$temporary;var n=e.organization_key;return{counterParty:t,organizationId:n}}).map(function(e){var t=e.counterParty,n=e.organizationId,o=r.ensureConversation(t.$entityType,t.id,n);return o._counterPartyAddedOnServer=!0,o}),!o.includeMutes){t.next=10;break}return t.next=10,this.host.mute.findAll();case 10:return this._fetched=!0,t.abrupt("return",n);case 12:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,j["default"])(T["default"].mark(function t(e){var n;return T["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:if(n=this.getById(e),!n){t.next=7;break}return t.abrupt("return",n);case 7:return t.next=9,this.findAll();case 9:return t.abrupt("return",this.getById(e));case 10:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"refetch",value:function(){var e=(0,j["default"])(T["default"].mark(function t(){return T["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._fetched=!1,e.abrupt("return",this.findAll());case 2:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=(0,j["default"])(T["default"].mark(function t(e,n,r){var o,u,s;return T["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return o={},r&&(o["TT-X-Organization-Key"]=r),u=this.host.typeNSByModelName(e),s=this.ensureConversation(e,n,r),t.prev=16,t.next=19,this.host.api.roster.add(e,n,r);case 19:t.next=24;break;case 21:t.prev=21,t.t0=t["catch"](16),this.logger.warn("can't add "+n+" "+u);case 24:s._counterPartyAddedOnServer=!0;case 25:case"end":return t.stop()}},t,this,[[16,21]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,j["default"])(T["default"].mark(function t(e,n,r){var o,u;return T["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return o={},r&&(o["TT-X-Organization-Key"]=r),u=this.host.typeNSByModelName(e),t.prev=15,t.next=18,this.host.api.roster.remove(e,n,r);case 18:this.ejectConversation(e,n,r),t.next=24;break;case 21:t.prev=21,t.t0=t["catch"](15),this.logger.warn("can't remove "+n+" "+u);case 24:case"end":return t.stop()}},t,this,[[15,21]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"ensureConversation",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=this.getConversationKey(e,t,n),o=this.get(e,t,n);return o?(this.__ensureEntities(o),o):(o=this.host.models.Conversation.createInstance({id:r,counterPartyType:e,counterPartyId:t,organizationId:n,_origIndex:this.host.models.Conversation.getAll().length}),this.__ensureEntities(o),this.host.models.Conversation.inject(o),this.__notifyOrganizationChange(o.organizationId),o)}},{key:"ejectConversation",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=this.get(e,t,n);return r&&(this.host.models.Conversation.eject(r),this.__notifyOrganizationChange(r.organizationId)),r}},{key:"reactToIncomingMessageEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.host.getCurrentUser().id,n=this.host.models.Message.parseAttrs(e.data);n.messageType=Y.MessageType.USER_SENT,n.direction=n.senderId==t?Y.MessageDirection.OUTGOING:Y.MessageDirection.INCOMING,n.groupId?(n.counterPartyType="group",n.counterPartyId=n.groupId):n.recipientId&&(n.counterPartyType="user",n.counterPartyId=n.senderId==t?n.recipientId:n.senderId),n.direction==Y.MessageDirection.OUTGOING?n.senderStatus=Y.MessageSenderStatus.SENT:n.senderStatus=Y.MessageSenderStatus.NA;var r=this.host.conversations.ensureConversation(n.counterPartyType,n.counterPartyId,n.recipientOrganizationId);n.conversationId=r.id;var o=this.host.models.Message.createInstance(n);this.__ensureMessageEntities(o),this.host.models.Message.inject(o),this.emit("message",o),this.__addConversationCounterPartyToServerRosterIfShould(r),this.__queueReload(r),r.emit("message",o),this.__notifyOrganizationChange(r.organizationId),o.senderId!=t&&o.recipientStatus!=Y.MessageRecipientStatus.READ&&o.recipientStatus!=Y.MessageRecipientStatus.DELIVERED&&this.host.messages.markAsReceived(o)}},{key:"reactToFriendsEvent",value:function(e){var t=e.data.friend,n=t.action,r=t.organization_id,o=(0,k["default"])(t,["action","organization_id"]),a=r,i=this.host.modelByTypeNS(o.xmlns);if(!i)return void this.logger.error("Class "+o.xmlns+" not found");switch(n){case"add":"group"==i.name&&(o.organizationId=a);var u=this.host.injectModel(o);this.__addedByCounterParty(u,a);break;case"del":this.__removedByCounterParty(i.name,o.token,a);break;default:this.logger.error("friends action not implemented",n,e.data)}}},{key:"_onMessageSending",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.__ensureConversationFromMessage(e);this.__addConversationCounterPartyToServerRosterIfShould(t),this.__reloadConversation(t),this.__notifyOrganizationChange(t.organizationId)}},{key:"_onMessageSent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId);this.__reloadConversation(t),t.emit("message",e)}},{key:"_onMessageChange",value:function(e,t){t.conversation&&this.__queueReload(t.conversation)}},{key:"_onGroupDelete",value:function(e,t){this.ejectConversation("group",t.id,t.organizationId)}},{key:"__queueReload",value:function(e){F["default"].contain(this.__queuedConversationsToReload,e),this._throtelled__flushConversationsToReload()}},{key:"__flushConversationsToReload",value:function(){var e=this;this.__queuedConversationsToReload.forEach(function(t){return e.__reloadConversation(t)}),this.__queuedConversationsToReload.length=0}},{key:"__reloadConversation",value:function(e){var t=F["default"].pick(e,["messages","timeline","lastMessage","unreadMessages","unreadCount","lastEventMessageSortNumber"]),n={},r=(0,F["default"])(this.host.models.Message.getAll()).filter({conversationId:e.id}).orderBy(["sortNumber"],["asc"]).value(),o=F["default"].filter(r,{messageType:Y.MessageType.USER_SENT});n.timeline=r,n.messages=o,n.lastMessage=F["default"].last(o),n.unreadMessages=o.filter(function(e){return e.direction===Y.MessageDirection.INCOMING&&(e.recipientStatus===Y.MessageRecipientStatus.NEW||e.recipientStatus===Y.MessageRecipientStatus.DELIVERED)}),n.unreadCount=n.unreadMessages.length,n.lastEventMessageSortNumber=n.lastMessage&&n.lastMessage.sortNumber||0;var a=!1;F["default"].each(t,function(t,r){(0,Z["default"])(t,n[r])||(e[r]=n[r],a=!0)}),a&&(this.host.models.Conversation.inject(e),e.emit("change"),this.emit("change",e))}},{key:"__notifyOrganizationChange",value:function(e){var t=this.host.models.Organization.get(e);t&&t.emit("change")}},{key:"__ensureConversationFromMessage",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId);return t}},{key:"__addConversationCounterPartyToServerRosterIfShould",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));e&&(e._counterPartyAddedOnServer||this.add(e.counterPartyType,e.counterPartyId,e.organizationId))}},{key:"_onGroupMembershipChange",value:function(e){var t=this.ensureConversation("group",e.group.id,e.group.organizationId);this.host.models.Message.inject({id:e.id,conversationId:t.id,groupId:e.groupId,sortNumber:e.sortNumber,messageType:Y.MessageType.GROUP_MEMBERSHIP_CHANGE,senderId:e.actorId,recipient:this.host.getCurrentUser(),direction:Y.MessageDirection.INCOMING,groupMembersChange:{action:e.action,members:e.members,memberIds:e.memberIds},body:this.__generateGroupMembershipChangeBody(e),createdAt:e.createdAt}),this.__reloadConversation(t)}},{key:"__generateGroupMembershipChangeBody",value:function(e){var t,n;this.__ACTION_TEXT=this.__ACTION_TEXT||(t={},(0,x["default"])(t,"ADD","added"),(0,x["default"])(t,"REMOVE","removed"),(0,x["default"])(t,"LEAVE","left"),(0,x["default"])(t,"JOIN","joined"),t),this.__ACTION_PREPOSITION=this.__ACTION_PREPOSITION||(n={},(0,x["default"])(n,"ADD","to"),(0,x["default"])(n,"REMOVE","from"),n);var r=this.__ACTION_TEXT[e.action],o=this.__ACTION_PREPOSITION[e.action]||"",a=null;return"ADD"!==e.action&&"REMOVE"!==e.action||(a=(0,J["default"])(e.members.filter(Boolean).map(function(e){return e.displayName}))),[e.actor.displayName,r,a,o,"this group"].filter(Boolean).join(" ")}},{key:"getMessageConversationKey",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if(e.groupId)return this.conversationHashForGroupId(e.groupId);var t=e.senderId==this.host.getCurrentUser().id?e.recipientId:e.senderId;return this.conversationHashForUserMessage(t,e.senderOrganizationId,e.recipientOrganizationId)}},{key:"getConversationKey",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?n:arguments[3];if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(n));if(null!=r&&"string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(r));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(n));if(null!=r&&"string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(r));switch(e){case"user":return this.conversationHashForUserMessage(t,n,r);case"group":return this.conversationHashForGroupId(t);default:throw new Error("type "+e+" not supported in conversation")}}},{key:"conversationHashForUserMessage",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?t:arguments[2];if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(n));var r=[e,t,n].join(":");return ee.b64(r)}},{key:"conversationHashForGroupId",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return ee.b64(e)}},{key:"looksLikeConversationId",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return/^[a-zA-Z0-9\/+=]{24}$/.test(e)}},{key:"findConversationWithUser",value:function(){var e=(0,j["default"])(T["default"].mark(function t(e,n){return T["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return t.abrupt("return",this.get(this.host.models.User.name,e,n));case 9:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findConversationWithGroup",value:function(){var e=(0,j["default"])(T["default"].mark(function t(e,n){return T["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return t.abrupt("return",this.get(this.host.models.Group.name,e,n));case 9:
case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findAllGroupConversationsWithMembers",value:function(){var e=(0,j["default"])(T["default"].mark(function t(e,n){var r,o=this;return T["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=6;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e=F["default"].arrayWrap(e).map(this._resolveModelId.bind(this)),t.next=11,this.host.groups.findAllWithSpecificMembers(e,n);case 11:return r=t.sent,t.abrupt("return",r.map(function(e){return o.get(o.host.models.Group.name,e.id,n)}));case 13:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getWithGroup",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));e=this._resolveModelId(e);var t=this.conversationHashForGroupId(e);return this.getById(t)||null}},{key:"getWithUser",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));e=this._resolveModelId(e),t=this._resolveModelId(t);var n=this.conversationHashForUserMessage(e,t);return this.getById(n)||null}},{key:"get",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=this.getConversationKey(e,t,n),o=this.host.models.Conversation.get(r);return o||null}},{key:"getAll",value:function(){return this.host.models.Conversation.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Conversation.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Conversation.getMulti(e)}},{key:"__addedByCounterParty",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));this.ensureConversation(e.$entityType,e.id,t)}},{key:"__removedByCounterParty",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));this.ejectConversation(e,t,n)}},{key:"__ensureEntities",value:function(e){var t,n,r=this;this.host.models.Organization.ensureEntityOrCreateTemporaryAndFind({id:e.organizationId,name:"Loading..."},{finder:(t=this.host.organizations).find.bind(t),onMissing:function(){r.logger.info("org "+e.organizationId+" not found, created temporary org"),e.$loadingOrganization=!0},onLoad:function(t){r.logger.info("org "+e.organizationId+" loaded"),e.$loadingOrganization=!1}});var o={id:e.counterPartyId},a=void 0;switch(e.counterPartyType){case"user":o.displayName="Loading...",a=(n=this.host.users).find.bind(n);break;case"group":o.displayName="Loading group...",o.organizationId=e.organizationId,a=(n=this.host.groups).find.bind(n);break;default:throw new Error("unsupported counterPartyType",e.counterPartyType)}this.host.store.store.models[e.counterPartyType].ensureEntityOrCreateTemporaryAndFind(o,{finder:a,onMissing:function(){r.logger.info("entry "+e.counterPartyId+" not found, created temporary on org "+e.organizationId),e.$loadingCounterParty=!0},onLoad:function(t){e.$loadingCounterParty=!1,r.__fireChange("update",e)}}),this.__fireChange("add",e)}},{key:"__ensureMessageEntities",value:function(e){var t,n=this,r=this.host.getCurrentUser().id,o=e.senderId==r?e.recipientId:e.senderId;o&&this.host.models.User.ensureEntityOrCreateTemporaryAndFind({id:o,displayName:"Loading..."},{finder:(t=this.host.users).find.bind(t),onlyPlaceholder:!!e.groupId,onMissing:function(){n.logger.info("message otherUser "+o+" not found, created temporary"),e.$loadingOtherUser=!0},onLoad:function(t){e.$loadingOtherUser=!1,n.__fireChange("update",e.conversation)}})}},{key:"__fireChange",value:function(e,t){}}]),t}(R["default"]),o(d.prototype,"findAll",[u],(0,w["default"])(d.prototype,"findAll"),d.prototype),o(d.prototype,"find",[s],(0,w["default"])(d.prototype,"find"),d.prototype),o(d.prototype,"add",[c],(0,w["default"])(d.prototype,"add"),d.prototype),o(d.prototype,"remove",[f],(0,w["default"])(d.prototype,"remove"),d.prototype),o(d.prototype,"_onMessageSending",[X.privateMethod,H["default"]],(0,w["default"])(d.prototype,"_onMessageSending"),d.prototype),o(d.prototype,"_onMessageSent",[X.privateMethod,H["default"]],(0,w["default"])(d.prototype,"_onMessageSent"),d.prototype),o(d.prototype,"_onMessageChange",[X.privateMethod,H["default"]],(0,w["default"])(d.prototype,"_onMessageChange"),d.prototype),o(d.prototype,"_onGroupDelete",[X.privateMethod,H["default"]],(0,w["default"])(d.prototype,"_onGroupDelete"),d.prototype),o(d.prototype,"__queueReload",[X.privateMethod],(0,w["default"])(d.prototype,"__queueReload"),d.prototype),o(d.prototype,"__flushConversationsToReload",[X.privateMethod,H["default"]],(0,w["default"])(d.prototype,"__flushConversationsToReload"),d.prototype),o(d.prototype,"__reloadConversation",[X.privateMethod],(0,w["default"])(d.prototype,"__reloadConversation"),d.prototype),o(d.prototype,"__notifyOrganizationChange",[X.privateMethod],(0,w["default"])(d.prototype,"__notifyOrganizationChange"),d.prototype),o(d.prototype,"__ensureConversationFromMessage",[X.privateMethod],(0,w["default"])(d.prototype,"__ensureConversationFromMessage"),d.prototype),o(d.prototype,"__addConversationCounterPartyToServerRosterIfShould",[X.privateMethod],(0,w["default"])(d.prototype,"__addConversationCounterPartyToServerRosterIfShould"),d.prototype),o(d.prototype,"_onGroupMembershipChange",[X.privateMethod,H["default"]],(0,w["default"])(d.prototype,"_onGroupMembershipChange"),d.prototype),o(d.prototype,"__generateGroupMembershipChangeBody",[X.privateMethod],(0,w["default"])(d.prototype,"__generateGroupMembershipChangeBody"),d.prototype),o(d.prototype,"__addedByCounterParty",[X.privateMethod],(0,w["default"])(d.prototype,"__addedByCounterParty"),d.prototype),o(d.prototype,"__removedByCounterParty",[X.privateMethod],(0,w["default"])(d.prototype,"__removedByCounterParty"),d.prototype),o(d.prototype,"__ensureEntities",[X.privateMethod],(0,w["default"])(d.prototype,"__ensureEntities"),d.prototype),o(d.prototype,"__ensureMessageEntities",[X.privateMethod],(0,w["default"])(d.prototype,"__ensureMessageEntities"),d.prototype),o(d.prototype,"__fireChange",[X.privateMethod],(0,w["default"])(d.prototype,"__fireChange"),d.prototype),l=d))||l);t["default"]=te,e.exports=t["default"]},function(e,t){e.exports=require("humanize-list")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a=n(24),i=r(a),u=n(15),s=r(u),c=n(16),f=r(c),l=n(25),d=r(l),p=n(26),y=r(p),g=n(52),h=r(g),v=n(32),m=(r(v),n(69)),b=n(62),w=n(79),E=(r(w),(0,b.classWithPrivateMethods)(o=function(e){function t(e,n){return(0,s["default"])(this,t),(0,d["default"])(this,(0,i["default"])(t).call(this,e,n))}return(0,y["default"])(t,e),(0,f["default"])(t,[{key:"mounted",value:function(){this._data={}}},{key:"dispose",value:function(){this._data=null}},{key:"reactToPresenceEvent",value:function(e){this.set(e.data.from,m.PresenceStatus.resolve(e.data.type))}},{key:"set",value:function(e,t){var n=this._data[e]!==t;if(n){var r=this.host.models.User.get(e);this._data[e]=t,this.emit("change",{userId:e,presence:t,user:r})}}},{key:"get",value:function(e){return e==this.host.getCurrentUser().id?m.PresenceStatus.AVAILABLE:this._data[e]||null}}]),t}(h["default"]))||o);t["default"]=E,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h["default"])(e);if(!Array.isArray(e)){var o=(0,P["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h["default"])(e);if(!Array.isArray(e)){var o=(0,P["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f,l,d,p=n(7),y=r(p),g=n(8),h=r(g),v=n(9),m=r(v),b=n(90),w=r(b),E=n(53),x=r(E),_=n(54),k=r(_),I=n(91),T=r(I),O=n(18),j=r(O),A=n(11),M=r(A),G=n(10),V=r(G),z=n(12),C=r(z),S=n(14),P=r(S),U=n(13),N=r(U),$=n(24),R=r($),q=n(15),D=r(q),F=n(16),B=r(F),L=n(25),K=r(L),Z=n(26),W=r(Z),H=n(52),X=r(H),Y=n(32),Q=r(Y),J=n(22),ee=r(J),te=n(33),ne=n(62),re=(u=(0,te.decorator)(),s=(0,te.decorator)(),(0,ne.classWithPrivateMethods)((d=l=function(e){function t(){return(0,D["default"])(this,t),(0,K["default"])(this,(0,R["default"])(t).apply(this,arguments))}return(0,W["default"])(t,e),(0,B["default"])(t,[{key:"fullUpdate",value:function(){var e=(0,N["default"])(C["default"].mark(function t(e,n,r){return C["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if(n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if(n instanceof Object){t.next=10;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:if(r){t.next=14;break}throw new ee["default"].ValidationError("organizationId","required");case 14:if(!(this.host.config.maxMetadataKeyCount>0&&(0,P["default"])(n).length>this.host.config.maxMetadataKeyCount)){t.next=16;break}throw new ee["default"].ValidationError("entireData","invalid","Total number of metadata keys is "+(0,P["default"])(n)+" and should not exceed "+this.host.config.maxMetadataKeyCount);case 16:return this.host.requireUser(),e=this._resolveModelId(e),t.prev=18,t.next=21,this.host.api.metadata.update(e,n,r);case 21:return this.__injectMetadata(e,r,n),t.abrupt("return",n);case 25:if(t.prev=25,t.t0=t["catch"](18),!t.t0.response||404!=t.t0.response.status){t.next=31;break}throw new ee["default"].NotFoundError("metadata",e);case 31:throw t.t0;case 32:case"end":return t.stop()}},t,this,[[18,25]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,N["default"])(C["default"].mark(function t(e,n,r){var o,u;return C["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if(n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if(n instanceof Object){t.next=10;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:if(r){t.next=14;break}throw new ee["default"].ValidationError("organizationId","required");case 14:return t.next=16,this.find(e,r);case 16:return o=t.sent,u=(0,V["default"])({},o,n),t.abrupt("return",this.fullUpdate(e,u,r));case 19:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,N["default"])(C["default"].mark(function t(e,n){var r;return C["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(n){t.next=10;break}throw new ee["default"].ValidationError("organizationId","required");case 10:return this.host.requireUser(),e=this._resolveModelId(e),t.prev=12,t.next=15,this.host.api.metadata.find(e,n);case 15:return r=t.sent,this.__injectMetadata(e,n,r),t.abrupt("return",r);case 20:if(t.prev=20,t.t0=t["catch"](12),!t.t0.response||404!=t.t0.response.status){t.next=26;break}throw new ee["default"].NotFoundError("metadata",e);case 26:throw t.t0;case 27:case"end":return t.stop()}},t,this,[[12,20]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findMulti",value:function(){var e=(0,N["default"])(C["default"].mark(function t(e,n){var r,o,u,s,c=this;return C["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(n){t.next=10;break}throw new ee["default"].ValidationError("organizationId","required");case 10:return this.host.requireUser(),e=Q["default"].uniq(Q["default"].arrayWrap(e).map(this._resolveModelId.bind(this))),r=Q["default"].chunk(e,20),o=r.map(function(e){return c.__findMultiPaged(e,n)}),t.next=16,M["default"].all(o);case 16:return u=t.sent,s=Q["default"].assign.apply(Q["default"],[{}].concat((0,j["default"])(u))),t.abrupt("return",s);case 19:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"__findMultiPaged",value:function(){var e=(0,N["default"])(C["default"].mark(function t(e,n){var r,o,u,s,c,f,l,d,p,y,g,h,v,m,b,E;return C["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){t.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return t.prev=8,t.next=11,this.host.api.metadata.findMulti(e,n);case 11:if(r=t.sent,l=(0,T["default"])(r),l&&("function"==typeof l[k["default"]]||Array.isArray(l))){t.next=15;break}throw new TypeError("Expected _Object$entries to be iterable, got "+a(l));case 15:if(l&&("function"==typeof l[k["default"]]||Array.isArray(l))){t.next=17;break}throw new TypeError("Expected _Object$entries to be iterable, got "+i(l));case 17:for(o=!0,u=!1,s=void 0,t.prev=20,c=(0,x["default"])(l);!(o=(f=c.next()).done);o=!0)d=(0,w["default"])(f.value,2),p=d[0],y=d[1],y&&this.__injectMetadata(p,n,y);t.next=28;break;case 24:t.prev=24,t.t0=t["catch"](20),u=!0,s=t.t0;case 28:t.prev=28,t.prev=29,!o&&c["return"]&&c["return"]();case 31:if(t.prev=31,!u){t.next=34;break}throw s;case 34:return t.finish(31);case 35:return t.finish(28);case 36:return t.abrupt("return",r);case 39:if(t.prev=39,t.t1=t["catch"](8),!t.t1.response||404!=t.t1.response.status){t.next=84;break}if(g={},e&&("function"==typeof e[k["default"]]||Array.isArray(e))){t.next=45;break}throw new TypeError("Expected ids to be iterable, got "+a(e));case 45:if(e&&("function"==typeof e[k["default"]]||Array.isArray(e))){t.next=47;break}throw new TypeError("Expected ids to be iterable, got "+i(e));case 47:h=!0,v=!1,m=void 0,t.prev=50,b=(0,x["default"])(e);case 52:if(h=(E=b.next()).done){t.next=67;break}return p=E.value,t.prev=54,t.next=57,this.find(p,n);case 57:g[p]=t.sent,t.next=64;break;case 60:if(t.prev=60,t.t2=t["catch"](54),t.t2.code==ee["default"].NotFoundError.CODE){t.next=64;break}throw t.t2;case 64:h=!0,t.next=52;break;case 67:t.next=73;break;case 69:t.prev=69,t.t3=t["catch"](50),v=!0,m=t.t3;case 73:t.prev=73,t.prev=74,!h&&b["return"]&&b["return"]();case 76:if(t.prev=76,!v){t.next=79;break}throw m;case 79:return t.finish(76);case 80:return t.finish(73);case 81:return t.abrupt("return",g);case 84:throw t.t1;case 85:case"end":return t.stop()}},t,this,[[8,39],[20,24,28,36],[29,,31,35],[50,69,73,81],[54,60],[74,,76,80]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"__injectMetadata",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));var r=e+":"+t;this.host.models.Metadata.inject({id:r,data:n,entityId:e,organizationId:t})}}]),t}(X["default"]),l.METADTA_TYPES=["user","group"],f=d,o(f.prototype,"find",[u],(0,m["default"])(f.prototype,"find"),f.prototype),o(f.prototype,"findMulti",[s],(0,m["default"])(f.prototype,"findMulti"),f.prototype),o(f.prototype,"__findMultiPaged",[ne.privateMethod],(0,m["default"])(f.prototype,"__findMultiPaged"),f.prototype),o(f.prototype,"__injectMetadata",[ne.privateMethod],(0,m["default"])(f.prototype,"__injectMetadata"),f.prototype),c=f))||c);t["default"]=re,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/helpers/slicedToArray")},function(e,t){e.exports=require("babel-runtime/core-js/object/entries")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a,i,u=n(9),s=r(u),c=n(12),f=r(c),l=n(11),d=r(l),p=n(14),y=r(p),g=n(13),h=r(g),v=n(24),m=r(v),b=n(15),w=r(b),E=n(16),x=r(E),_=n(25),k=r(_),I=n(26),T=r(I),O=n(52),j=r(O),A=n(33),M=n(22),G=r(M),V=n(32),z=r(V),C=n(84),S=r(C),P=n(63),U={user:"account",distributionList:"distribution_list",group:"group",organization:"organization"},N=z["default"].values(U),$=(a=(0,A.decorator)(),i=function(e){function t(){return(0,w["default"])(this,t),(0,k["default"])(this,(0,m["default"])(t).apply(this,arguments))}return(0,T["default"])(t,e),(0,x["default"])(t,[{key:"query",value:function(){var e=(0,h["default"])(f["default"].mark(function t(e){var n,r,o,a,i,u=this,s=e.types,c=void 0===s?[]:s,l=e.query,p=void 0===l?{}:l,g=e.continuation,h=void 0===g?null:g,v=e.includeDisabled,m=void 0===v?!1:v,b=e.excludeTokens,w=void 0===b?[]:b,E=e.resultsFormat,x=void 0===E?"entities":E,_=e.organizationId,k=void 0===_?null:_,I=e.organizationIds,T=void 0===I?[]:I,O=e.sort,j=void 0===O?[]:O,A=e.includeMetadata,M=void 0===A?!1:A;return f["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=c.length){e.next=2;break}throw new G["default"].ValidationError("types","required","no types specified");case 2:if(c=c.map(function(e){return U[e]}),n=z["default"].difference(c,N),!(n.length>0)){e.next=6;break}throw new G["default"].ValidationError("types","invalid","invalid types: "+n.join(", "));case 6:if(k&&(T=[k]),0!=T.length){e.next=9;break}throw new G["default"].ValidationError("organizationIds","invalid","search must be done in a context of an organization");case 9:return"ids"===x&&(x="tokens"),r={type:c,include_disabled:m,directory:T,results_format:x},h&&(r.continuation=h),j&&j.length&&(r.sort=j),w=z["default"].arrayWrap(w),p&&(0,y["default"])(p).length>0&&(r.bool={must:S["default"].underscoreObject(p)}),e.next=17,this.httpClient.post("/search",{data:r});case 17:if(o=e.sent,a=o.data.results,i=z["default"].eachWithObject(a,function(e,t){var n=e.type,r=e.entity,o=e.organization_id;if(0!=(0,y["default"])(r).length){"tigertext:entity:account"===n&&z["default"].replaceKey(r,"status","account_status");var a=u.host.injectModel(r,n);if(!w.length||!w.includes(a.id)){if(!a)return void u.logger.warn("no entity for ",e);var i=new P.SearchResult(a,o);t.push(i)}}},[]),!M){e.next=22;break}return e.delegateYield(f["default"].mark(function t(){var e,n,r;return f["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=z["default"].groupBy(i,"organizationId"),n=z["default"].keyBy(i,"entityId"),r=z["default"].transform(e,function(e,t,r){e.push(u.host.metadata.findMulti(z["default"].map(t,"entityId"),r).then(function(e){z["default"].each(e,function(e,t){return n[t].metadata=e})}))},[]),!(r.length>0)){t.next=6;break}return t.next=6,d["default"].all(r);case 6:case"end":return t.stop()}},t,u)})(),"t0",22);case 22:return e.abrupt("return",i);case 23:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(j["default"]),o(i.prototype,"query",[a],(0,s["default"])(i.prototype,"query"),i.prototype),i);t["default"]=$,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var o=(0,d["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,y["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var o=(0,d["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,
y["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c=n(7),f=r(c),l=n(14),d=r(l),p=n(8),y=r(p),g=n(9),h=r(g),v=n(46),m=r(v),b=n(12),w=r(b),E=n(13),x=r(E),_=n(24),k=r(_),I=n(15),T=r(I),O=n(16),j=r(O),A=n(25),M=r(A),G=n(26),V=r(G),z=n(52),C=r(z),S=n(32),P=r(S),U=n(79),N=r(U),$=n(62),R="global",q=(0,$.classWithPrivateMethods)((s=function(e){function t(){return(0,T["default"])(this,t),(0,M["default"])(this,(0,k["default"])(t).apply(this,arguments))}return(0,V["default"])(t,e),(0,j["default"])(t,[{key:"mounted",value:function(){this._typers={},this._currentUserTyping={},this.host.on("message:sending",this._onMessageSending)}},{key:"dispose",value:function(){(0,P["default"])(this._typers).values().map(P["default"].values).flatten().map("timer").each(function(e){return clearTimeout(e)}),(0,P["default"])(this._currentUserTyping).values().map("timer").each(function(e){return clearTimeout(e)}),this._typers=null,this.host.removeListener("message:sending",this._onMessageSending)}},{key:"reactToIsTypingEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));this.host.requireUser();var t=e.data.sender_token;if(t!==this.host.getCurrentUser().id){var n=e.data.group_token,r=n||R,o="typing"===e.data.status;this._setTypingStatusOfUser(r,t,o)}}},{key:"startTyping",value:function(){var e=(0,x["default"])(w["default"].mark(function t(e){var n=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];return w["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return e=this._resolveModelId(e),this.host.requireUser(),t.next=8,this.host.api.messages.startTyping(e);case 8:e in this._currentUserTyping&&clearTimeout(this._currentUserTyping[e].timer),this._currentUserTyping[e]={},n&&(this._currentUserTyping[e].timer=this._createClearTimerForCurrentUser(e,"number"==typeof n?n:void 0));case 11:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopTyping",value:function(){var e=(0,x["default"])(w["default"].mark(function t(e){return w["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return e=this._resolveModelId(e),this.host.requireUser(),e in this._currentUserTyping&&(clearTimeout(this._currentUserTyping[e].timer),delete this._currentUserTyping[e]),t.next=9,this.host.api.messages.stopTyping(e);case 9:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_setTypingStatusOfUser",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("boolean"!=typeof n)throw new TypeError('Value of argument "isTyping" violates contract.\n\nExpected:\nbool\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("boolean"!=typeof n)throw new TypeError('Value of argument "isTyping" violates contract.\n\nExpected:\nbool\n\nGot:\n'+a(n));if(n){this._typers[e]||(this._typers[e]={});var o=t in this._typers[e];if(o&&clearTimeout(this._typers[e][t].timer),this._typers[e][t]={timer:this._createClearTimerForOtherUser(e,t)},o)return}else{if(!this._typers[e]||!this._typers[e][t])return;clearTimeout(this._typers[e][t].timer),delete this._typers[e][t]}var u=(0,m["default"])({userId:t},e!==R?{groupId:e}:null,{isTyping:n,timedOut:r});this.emit("change",u)}},{key:"_createClearTimerForOtherUser",value:function(e,t){var n=this;if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return setTimeout(function(){n.logger.info("auto stop typing for other typer",e,t),n._setTypingStatusOfUser(e,t,!1,!0)},this.host.config.clearTypingStatusTimeout)}},{key:"_createClearTimerForCurrentUser",value:function(e,t){var n=this;if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(null!=t&&"number"!=typeof t)throw new TypeError('Value of argument "timeout" violates contract.\n\nExpected:\n?number\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(null!=t&&"number"!=typeof t)throw new TypeError('Value of argument "timeout" violates contract.\n\nExpected:\n?number\n\nGot:\n'+a(t));return setTimeout(function(){n.logger.info("auto stop typing for current user",e),n.stopTyping(e)},"number"==typeof t?t:this.host.config.clearTypingStatusTimeout)}},{key:"isUserTyping",value:function(e){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(e));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(e));return e=this._resolveModelId(e),this._isUserTypingInContext(R,e)}},{key:"isCurrentUserTyping",value:function(e){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(e));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(e));return e=this._resolveModelId(e),e in this._currentUserTyping}},{key:"isUserTypingInGroup",value:function(e,t){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(e));if(!(t instanceof Object||"string"==typeof t))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(t));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(e));if(!(t instanceof Object||"string"==typeof t))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(t));return t=this._resolveModelId(t),e=this._resolveModelId(e),this._isUserTypingInContext(e,t)}},{key:"_isUserTypingInContext",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return this._typers[e]?t in this._typers[e]:!1}},{key:"_onMessageSending",value:function(e){this.stopTyping(e.counterPartyId)}}]),t}(C["default"]),o(s.prototype,"_setTypingStatusOfUser",[$.privateMethod],(0,h["default"])(s.prototype,"_setTypingStatusOfUser"),s.prototype),o(s.prototype,"_createClearTimerForOtherUser",[$.privateMethod],(0,h["default"])(s.prototype,"_createClearTimerForOtherUser"),s.prototype),o(s.prototype,"_createClearTimerForCurrentUser",[$.privateMethod],(0,h["default"])(s.prototype,"_createClearTimerForCurrentUser"),s.prototype),o(s.prototype,"_isUserTypingInContext",[$.privateMethod],(0,h["default"])(s.prototype,"_isUserTypingInContext"),s.prototype),o(s.prototype,"_onMessageSending",[$.privateMethod,N["default"]],(0,h["default"])(s.prototype,"_onMessageSending"),s.prototype),u=s))||u;t["default"]=q,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,p["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g["default"])(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,p["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g["default"])(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u,s,c,f=n(7),l=r(f),d=n(14),p=r(d),y=n(8),g=r(y),h=n(9),v=r(h),m=n(12),b=r(m),w=n(13),E=r(w),x=n(24),_=r(x),k=n(15),I=r(k),T=n(16),O=r(T),j=n(25),A=r(j),M=n(26),G=r(M),V=n(95),z=r(V),C=n(52),S=r(C),P=n(32),U=r(P),N=n(62),$=n(33),R=n(55),q=r(R),D=n(79),F=r(D),B=n(67),L=r(B),K={account:"user",group:"group"},Z=new z["default"](U["default"].keys(K)),W=(0,U["default"])(K).values().push("conversation").value(),H=525600,X=(u=(0,$.decorator)(),(0,N.classWithPrivateMethods)((c=function(e){function t(){return(0,I["default"])(this,t),(0,A["default"])(this,(0,_["default"])(t).apply(this,arguments))}return(0,G["default"])(t,e),(0,O["default"])(t,[{key:"mounted",value:function(){this._muteEntriesByConversationId={},this._fetched=!1}},{key:"dispose",value:function(){this._muteEntriesByConversationId=null,this._fetched=!1}},{key:"findAll",value:function(){var e=(0,E["default"])(b["default"].mark(function t(){var e;return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this._fetched){t.next=6;break}return t.next=3,this.host.api.mute.findAll();case 3:e=t.sent,(0,U["default"])(e).filter(function(e){return Z.has(e.sender_type)}).map(this._parseMuteEntry).reject(this._isExpired).each(this._addEntry),this._fetched=!0;case 6:return t.abrupt("return",U["default"].values(this._muteEntriesByConversationId));case 7:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_parseMuteEntry",value:function(e){var t=+e.mute_duration,n=new Date(1e3*+e.mute_start).getTime(),r=(0,L["default"])(n).add(t,"minute").toDate().getTime(),o=K[e.sender_type],a=e.caller_organization||e.organization_id,i=e.sender_token,u=this.host.conversations.getConversationKey(o,i,a);return{conversationId:u,durationInMinutes:t,startedAt:n,expiresAt:r,organizationId:a,entityId:i,entityType:o}}},{key:"_isExpired",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "entry" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "entry" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));return e.expiresAt<Date.now()}},{key:"_addEntry",value:function(e){var t=e.conversationId,n=e.entityType,r=e.entityId,o=e.organizationId,a=e.durationInMinutes,i=e.startedAt;t=t||this.host.conversations.getConversationKey(n,r,o),i=i||Date.now();var u=(0,L["default"])(i).add(a,"minute").toDate().getTime(),s={conversationId:t,durationInMinutes:a,startedAt:i,expiresAt:u,organizationId:o,entityId:r,entityType:n};return this.host.models.Conversation.touch(t),this._muteEntriesByConversationId[t]=s,s}},{key:"_removeEntry",value:function(e){var t=e.conversationId,n=e.entityType,r=e.entityId,o=e.organizationId;t=t||this.host.conversations.getConversationKey(n,r,o),delete this._muteEntriesByConversationId[t],this.host.models.Conversation.touch(t)}},{key:"_removeAllEntries",value:function(){var e=this;(0,U["default"])(this._muteEntriesByConversationId).values().each(function(t){return e._removeEntry(t)})}},{key:"getByConversationId",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));var t=this._muteEntriesByConversationId[e];return t?this._isExpired(t)?(delete this._muteEntriesByConversationId[e],null):t:null}},{key:"unmuteAll",value:function(){var e=(0,E["default"])(b["default"].mark(function t(){return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.mute.unmuteAll();case 2:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"mute",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e,n,r){var o;return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("number"==typeof n){t.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if(null==r||"string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("number"==typeof n){t.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if(null==r||"string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(r));case 12:if(o=this._resolveEntity(e,W)){t.next=15;break}throw new Error("entity "+e+" not found");case 15:t.t0=o.$entityType,t.next="conversation"===t.t0?18:"user"===t.t0?19:"group"===t.t0?21:"organization"===t.t0?22:23;break;case 18:return t.abrupt("return",this.mute(o.counterParty,n,o.organizationId));case 19:return q["default"].notEmpty("organizationId",r),t.abrupt("return",this.muteUser(o,n,r));case 21:return t.abrupt("return",this.muteGroup(o,n));case 22:return t.abrupt("return",this.muteOrganization(o,n));case 23:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"unmute",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e,n){var r;return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if(null==n||"string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if(null==n||"string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(n));case 8:if(r=this._resolveEntity(e,W)){t.next=11;break}throw new Error("entity "+e+" not found");case 11:t.t0=r.$entityType,t.next="conversation"===t.t0?14:"user"===t.t0?15:"group"===t.t0?17:"organization"===t.t0?18:19;break;case 14:return t.abrupt("return",this.unmute(r.counterParty,r.organizationId));case 15:return q["default"].notEmpty("organizationId",n),t.abrupt("return",this.unmuteUser(r,n));case 17:return t.abrupt("return",this.unmuteGroup(r));case 18:return t.abrupt("return",this.unmuteOrganization(r));case 19:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"muteUser",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e,n,r){return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("number"==typeof n){t.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if("string"==typeof r||r instanceof Object){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("number"==typeof n){t.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if("string"==typeof r||r instanceof Object){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(r));case 12:return this.__validateDurationInMinutes(n),e=this._resolveModelIdWithTypes(e,"user"),r=this._resolveModelId(r),t.next=17,this.host.api.mute.muteUser(e,n,r,{recipientOrganizationId:r});case 17:this._addEntry({entityType:"user",entityId:e,organizationId:r,durationInMinutes:n});case 18:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"unmuteUser",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e,n){return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n||n instanceof Object){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:return e=this._resolveModelIdWithTypes(e,"user"),n=this._resolveModelId(n),t.next=12,this.host.api.mute.unmuteUser(e,n,{recipientOrganizationId:n});case 12:this._removeEntry({entityType:"user",entityId:e,organizationId:n});case 13:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"muteGroup",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e,n,r){var o;return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("number"==typeof n){t.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if(null==r||"string"==typeof r||null==r||r instanceof Object){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("number"==typeof n){t.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if(null==r||"string"==typeof r||null==r||r instanceof Object){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(r));case 12:return this.__validateDurationInMinutes(n),o=this._resolveEntity(e,"group"),o?(e=o.id,r=o.organizationId):r=this._resolveModelId(r),q["default"].notEmpty("organizationId",r),t.next=18,this.host.api.mute.muteGroup(e,n,r);case 18:this._addEntry({entityType:"group",entityId:e,organizationId:r,durationInMinutes:n});case 19:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"unmuteGroup",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e,n){var r;return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if(null==n||"string"==typeof n||null==n||n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if(null==n||"string"==typeof n||null==n||n instanceof Object){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(n));case 8:return r=this._resolveEntity(e,"group"),r?(e=r.id,n=r.organizationId):(q["default"].notEmpty("organizationId",n),n=this._resolveModelId(n)),t.next=12,this.host.api.mute.unmuteGroup(e,n);case 12:this._removeEntry({entityType:"group",entityId:e,organizationId:n});case 13:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"reactToMuteEvent",value:function(e){if(e.data.token==this.host.currentUser.id){var t=e.data.action;if("clear"===t)return void this._removeAllEntries();var n=this._parseMuteEntry(e.data);switch(t){case"add":this._muteEntriesByConversationId[n.conversationId]=n;break;case"del":delete this._muteEntriesByConversationId[n.conversationId]}}}},{key:"__validateDurationInMinutes",value:function(e){if("number"!=typeof e)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(e));if("number"!=typeof e)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(e));(0>e||e>H||e%1!==0)&&q["default"].raise("durationInMinutes","invalid","should be a positive integer from 1 to "+H+" (1 year)")}}]),t}(S["default"]),o(c.prototype,"findAll",[u],(0,v["default"])(c.prototype,"findAll"),c.prototype),o(c.prototype,"_parseMuteEntry",[N.privateMethod,F["default"]],(0,v["default"])(c.prototype,"_parseMuteEntry"),c.prototype),o(c.prototype,"_addEntry",[N.privateMethod,F["default"]],(0,v["default"])(c.prototype,"_addEntry"),c.prototype),o(c.prototype,"_removeEntry",[N.privateMethod,F["default"]],(0,v["default"])(c.prototype,"_removeEntry"),c.prototype),o(c.prototype,"_removeAllEntries",[N.privateMethod],(0,v["default"])(c.prototype,"_removeAllEntries"),c.prototype),o(c.prototype,"__validateDurationInMinutes",[N.privateMethod],(0,v["default"])(c.prototype,"__validateDurationInMinutes"),c.prototype),s=c))||s);t["default"]=X,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/set")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=n(46),a=r(o),i=n(58),u=r(i),s=n(15),c=r(s),f=n(16),l=r(f),d=n(32),p=r(d),y=n(97),g=r(y),h=n(100),v=r(h),m=n(84),b=r(m),w=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=n.logger,o=(0,u["default"])(n,["logger"]);(0,c["default"])(this,e),this.host=t,this.options=o,this.logger=r,this.store=new g["default"]((0,a["default"])({},o,{host:t,logger:r}))}return(0,l["default"])(e,[{key:"defineModels",value:function(){var e=this,t={},n=(0,a["default"])({},this.options,{host:this.host,logger:this.logger});p["default"].each(v["default"],function(r,o){t[o]=r(e,n)}),this.models=t}},{key:"defineModel",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t.replaceKeys=t.replaceKeys||{},p["default"].defaults(t.replaceKeys,{token:"id"});var n=(this.store,this.store.defineModel(e,(0,a["default"])({},t,{beforeCreateInstance:function(e){!e[n.idAttribute]||"serverId"in e||(e.serverId=e[n.idAttribute]),t.beforeCreateInstance&&t.beforeCreateInstance(e)},beforeInject:function(e){var r=n.get(e[n.idAttribute]);!r||"serverId"in e||(e.serverId=r.serverId),t.beforeInject&&t.beforeInject(e)},afterInject:function(e){var n=Date.now();e.$lastModified==n&&(n+=1e-5),e.$lastModified=n,t.afterInject&&t.afterInject(e)},parseAttrs:function(e){var n=b["default"].camelizeObject(e);return p["default"].each(t.replaceKeys,function(e,t){p["default"].replaceKey(n,t,e)}),t.parseAttrs&&(n=t.parseAttrs(n,e)),n}})));return n}},{key:"clear",value:function(){this.store.clear()}}]),e}();t["default"]=w,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,l["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),u=r(i),s=n(14),c=r(s),f=n(8),l=r(f),d=n(12),p=r(d),y=n(13),g=r(y),h=n(46),v=r(h),m=n(57),b=r(m),w=n(98),E=r(w),x=n(10),_=r(x),k=n(15),I=r(k),T=n(16),O=r(T),j=n(32),A=r(j),M=n(38),G=r(M),V=n(99),z=r(V);G["default"].prototype.off=G["default"].prototype.removeListener;var C={idAttribute:"id",parseAttrs:A["default"].identity,relations:{belongsTo:{},hasMany:{}},defaultValues:null,computed:{}},S=function(){function e(t,n){var r=this,o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];(0,I["default"])(this,e),this.options=A["default"].defaultsDeep({},o,C),this.idAttribute=this.options.idAttribute,this.name=n,this.store=t,this.entitiesById={},this.entitiesList=[],this.transientAttrsStore={},this.options.relations&&this.__initRelations(),this.__initTransientAttrs(),(0,_["default"])(this.options.computed,{$entityType:{enumerable:!0,get:function(){return n}},$entityClass:{enumerable:!1,get:function(){return r}}}),this.options.computed=A["default"].transform(this.options.computed,function(e,t,n){"function"==typeof t?e[n]={get:t,enumerable:!1}:e[n]=t},{}),this._computedKeys=(0,A["default"])(this.options.computed).keys().without("$entityType","$entityClass","$$transientAttrs").value(),this._writablePropertyKeys=(0,A["default"])(this.options.computed).toPairs().filter(function(e){return e[1].set}).map(A["default"].first).value(),this._relationKeys=(0,A["default"])(this.options.relations).values().map(A["default"].keys).flatten().value();
}return(0,O["default"])(e,null,[{key:"create",value:function(e,t,n){return new this(e,t,n)}}]),(0,O["default"])(e,[{key:"__initRelations",value:function(){var e=this,t=A["default"].transform(this.options.relations.belongsTo,function(t,n,r){t[r]={get:function(){return e.store.get(n.type,this[n.foreignKey])},set:function(t){this[n.foreignKey]=e.store.resolveId(n.type,t)}}},{});(0,_["default"])(this.options.computed,t);var n=A["default"].transform(this.options.relations.hasMany,function(t,n,r){t[r]={get:function(){var t=this;if(this.$$transientAttrs.relations||(this.$$transientAttrs.relations={},this.$$transientAttrs.relationsCreated={}),this.$$transientAttrs.relations[r])return this.$$transientAttrs.relations[r];var o=e.store.getAll(n.type).filter(function(r){return r[n.foreignKey]==t[e.options.idAttribute]});return this.$$transientAttrs.relations[r]=o,this.$$transientAttrs.relationsCreated[r]=!0,o},set:function(e){}}},{});(0,_["default"])(this.options.computed,n)}},{key:"__initTransientAttrs",value:function(){var e=this,t=this,n={$$transientAttrs:{enumerable:!1,get:function(){var e=this[t.options.idAttribute];return t.transientAttrsStore[e]||(t.transientAttrsStore[e]={})}}},r={};this.options.transientAttrs&&this.options.transientAttrs.forEach(function(t){e.options.defaultValues&&t in e.options.defaultValues&&(r[t]=(0,z["default"])(e.options.defaultValues[t]),delete e.options.defaultValues[t]),n[t]={get:function(){return t in this.$$transientAttrs?this.$$transientAttrs[t]:t in r?this.$$transientAttrs[t]=r[t]:void 0},set:function(e){this.$$transientAttrs[t]=e}}}),(0,_["default"])(this.options.computed,n)}},{key:"createInstance",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=this;t&&(e=this.parseAttrs(e)),this.options.defaultValues&&A["default"].defaults(e,(0,z["default"])(this.options.defaultValues));var r={};return this._writablePropertyKeys.forEach(function(t){t in e&&(r[t]=e[t],delete e[t])}),(0,E["default"])(e,this.options.computed),(0,_["default"])(e,r),this.options.instanceEvents&&(0,_["default"])(e,G["default"].prototype),(0,_["default"])(e,{toPlainObject:function(e){var t=this,r={};n._computedKeys.forEach(function(e){return r[e]=t[e]});var o=(0,_["default"])({},this,r);return delete o.toPlainObject,delete o.setMaxListeners,delete o.emit,delete o.addListener,delete o.on,delete o.once,delete o.removeListener,delete o.removeAllListeners,delete o.listeners,delete o.listenerCount,delete o.off,delete o.toPlainObject,delete o._events,delete o._maxListeners,o}}),this.options.beforeCreateInstance&&this.options.beforeCreateInstance(e),e}},{key:"inject",value:function(e){var t=void 0,n=!0,r=this.is(e);if(r){if(t=e,this.entitiesById[this.resolveId(t)])return this.options.beforeInject&&this.options.beforeInject(t),this.emit("beforeInject",this,t),this.options.afterInject&&this.options.afterInject(t),this.emit("afterInject",this,t),t;n=!1}n&&(e=this.parseAttrs(e));var o=void 0,a=this.resolveId(e);if(!this.isValidId(a))throw new Error("'"+this.options.idAttribute+"' is required");return t=this.entitiesById[a],t?(this.options.beforeInject&&this.options.beforeInject(e),this.emit("beforeInject",this,e),(0,_["default"])(t,e)):(o=!0,t=r?e:this.createInstance(e,!1),this.options.beforeInject&&this.options.beforeInject(e),this.emit("beforeInject",this,e),this.entitiesById[a]=t,this.entitiesList.push(t)),this.__addToHasManyRelationships(t),this.options.afterInject&&this.options.afterInject(t),this.emit("afterInject",this,t),o&&(this.options.afterCreate&&this.options.afterCreate(t),this.emit("afterCreate",this,t)),t}},{key:"eject",value:function(e){e=this.resolveId(e);var t=this.entitiesById[e];t&&(this.__removeFromHasManyRelationships(t),delete this.entitiesById[e],A["default"].pull(this.entitiesList,t),e in this.transientAttrsStore&&delete this.transientAttrsStore[e],this.emit("afterEject",this,t))}},{key:"touch",value:function(e){e=this.resolveId(e);var t=this.entitiesById[e];t&&this.inject((0,b["default"])({},this.options.idAttribute,e))}},{key:"__addToHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"add")}},{key:"__removeFromHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"remove")}},{key:"__updateRelationsIfNeeded",value:function(e,t){var n=this,r=this.store.getParentRelationshipsOfModel(this.name);r&&r.forEach(function(r){var o=n.store.get(r.parent,e[r.foreignKey]);o&&o.$$transientAttrs.relationsCreated&&o.$$transientAttrs.relationsCreated[r.relationKey]&&("add"==t?o[r.relationKey].includes(e)||o[r.relationKey].push(e):"remove"==t&&A["default"].pull(o[r.relationKey],e))})}},{key:"ejectAll",value:function(){var e=this;A["default"].eachRight(this.entitiesList,function(t){return e.eject(t)})}},{key:"parseAttrs",value:function(e){var t=this,n=A["default"].pickBy(e,function(e){return t.store.isEntity(e)||t.store.isEntityArray(e)}),r=A["default"].omit(e,A["default"].keys(n)),o=this.options.parseAttrs((0,z["default"])(r)),a=(0,v["default"])({},o,n);return a}},{key:"get",value:function(e){return this.entitiesById[e]}},{key:"getAll",value:function(){return this.entitiesList}},{key:"getMulti",value:function(e){return e.map(this.get.bind(this))}},{key:"resolveId",value:function(e){return this.isValidId(e)?e:e[this.options.idAttribute]}},{key:"isValidId",value:function(e){return"string"==typeof e||"number"==typeof e}},{key:"is",value:function(e){return e&&e.$entityClass==this}},{key:"find",value:function(){var e=(0,g["default"])(p["default"].mark(function t(e){return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:throw new"not implemented find";case 5:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=(0,g["default"])(p["default"].mark(function t(e){return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 4:throw e=this.resolveId(e),new"not implemented refresh";case 6:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();(0,_["default"])(S.prototype,G["default"].prototype);var P=function(){function e(){var t=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];(0,I["default"])(this,e),this.options=n,this.models={},this.__relationsOfHasManyByContainedItem={},["inject","get","getAll","filter","resolveId","is","find","refresh"].forEach(function(e){t[e]=function(n){for(var r,o=arguments.length,a=Array(o>1?o-1:0),i=1;o>i;i++)a[i-1]=arguments[i];return(r=t.models[n])[e].apply(r,a)}})}return(0,O["default"])(e,[{key:"defineModel",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(this.models[e])throw new Error(e+" already defined");n=(0,v["default"])({},this.options,n),this.models[e]=S.create(this,e,n);var r=this.models[e].options.relations.hasMany;return A["default"].isEmpty(r)||A["default"].each(r,function(n,r){t.__relationsOfHasManyByContainedItem[n.type]||(t.__relationsOfHasManyByContainedItem[n.type]=[]),t.__relationsOfHasManyByContainedItem[n.type].push((0,v["default"])({},n,{relationKey:r,parent:e}))}),this.models[e]}},{key:"getParentRelationshipsOfModel",value:function(e){return this.__relationsOfHasManyByContainedItem[e]}},{key:"isEntity",value:function(e){return e&&e.$entityClass&&e.$entityClass.constructor===S}},{key:"isEntityArray",value:function(e){return e&&Array.isArray(e)&&e.some(this.isEntity)}},{key:"clear",value:function(){(0,A["default"])(this.models).values().forEach(function(e){return e.ejectAll()})}}]),e}();t["default"]=P,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/object/define-properties")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=r(o),i=function(e){return JSON.parse((0,a["default"])(e))};t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={User:n(101),Group:n(103),Organization:n(104),Message:n(105),MessageStatusPerRecipient:n(106),Conversation:n(107),Metadata:n(108)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){var n=e.defineModel("user",{transientAttrs:[],replaceKeys:{avatar:"avatarUrl"},defaultValues:{},computed:{metadataByOrganizationId:{enumerable:!0,get:function(){return(0,a["default"])(e.store.getAll("metadata")).filter({entityId:this.id}).keyBy("organizationId").mapValues("data").value()}},presence:{enumerable:!0,get:function(){return e.host.presence.get(this.id)||c["default"].UNKNOWN}}}});return(0,u["default"])(e,n,{before:function(e,t,n){},after:function(e,t){}}),n};var o=n(32),a=r(o),i=n(102),u=r(i),s=n(75),c=r(s);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){var r=n.before,o=n.after;if(null==arguments[2]||null!=arguments[2].before&&"function"!=typeof arguments[2].before||null!=arguments[2].after&&"function"!=typeof arguments[2].after)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ before: ?Function;\n  after: ?Function;\n}\n\nGot:\n"+i(arguments[2]));if(null==arguments[2]||null!=arguments[2].before&&"function"!=typeof arguments[2].before||null!=arguments[2].after&&"function"!=typeof arguments[2].after)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ before: ?Function;\n  after: ?Function;\n}\n\nGot:\n"+a(arguments[2]));e.ensureEntityOrCreateTemporaryAndFind||(e.ensureEntityOrCreateTemporaryAndFind=function(t,n){function r(){var n=this;if(e.host.config.enableEnsureEntityFindMissing&&!w[E(s)]){var r=function(){var r=(0,h["default"])(y["default"].mark(function i(){return y["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(s.$temporary){n.next=3;break}return e.logger.info("entity "+t+":"+u+" was already updated elsewhere"),n.abrupt("return");case 3:return n.next=5,a();case 5:delete w[E(s)];case 6:case"end":return n.stop()}},i,n)})),o=n;return function(){return r.apply(o,arguments)}}(),a=function(){var e=(0,h["default"])(y["default"].mark(function r(){return y["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.finder(u,{bypassCache:!0});case 3:delete s.$temporary,i.after(s,o),o.onLoad(s),e.next=13;break;case 8:e.prev=8,e.t0=e["catch"](0),e.next=12;break;case 12:o.onLoad(null);case 13:case"end":return e.stop()}},r,n,[[0,8]])})),t=n;return function(){return e.apply(t,arguments)}}();e.host.config.temporaryEntityDelayBeforeRefreshing?w[E(s)]=setTimeout(r,e.host.config.temporaryEntityDelayBeforeRefreshing):a()}}var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(e.host.config.enableEnsureEntityWithTemp||e.host.config.enableEnsureEntityFindMissing){if(o=m["default"].defaults(o,{onLoad:b.noop,onExists:b.noop,onMissing:b.noop,onlyPlaceholder:!1}),!o.finder)throw new Error("finder is missing in ensureEntityOrCreateTemporaryAndFind call");var a=e.store.models[t],i=a.__addEnsureEntityOrCreateTemporaryAndFind__config,u=n[a.idAttribute],s=e.store.get(t,u);if(i.before(n,s,o),s)i.after(s,o),s.$temporary?o.onlyPlaceholder||r():o.onExists(s);else{if(o.onMissing(),s=e.store.inject(t,n),Object.defineProperty(s,"$temporary",{value:!0,configurable:!0}),o.onlyPlaceholder)return s;r()}return s}}),t.__addEnsureEntityOrCreateTemporaryAndFind__config={before:r||b.noop,after:o||b.noop},t.ensureEntityOrCreateTemporaryAndFind=function(n,r){return e.ensureEntityOrCreateTemporaryAndFind(t.name,n,r)}}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,f["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var c=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof c?"undefined":(0,d["default"])(c))?c.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,f["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var c=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof c?"undefined":(0,d["default"])(c))?c.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var u=n(7),s=r(u),c=n(14),f=r(c),l=n(8),d=r(l),p=n(12),y=r(p),g=n(13),h=r(g);t["default"]=o;var v=n(32),m=r(v),b=n(59),w={},E=function(e){return e.$entityType+":"+e.id};e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){function n(n){var r;e.ensureEntityOrCreateTemporaryAndFind("user",{id:n,displayName:"Loading..."},{onlyPlaceholder:!0,finder:(r=t.host.users).find.bind(r)})}function r(e){e.memberIds&&e.memberIds.forEach(n)}function o(e){e&&e.forEach(n)}var u=e.defineModel("group",{replaceKeys:{organizationKey:"organizationId",members:"memberIds",avatar:"avatarUrl",displayName:"name",numMembers:"__memberCount",createdTime:"createdAt"},transientAttrs:["__memberCount"],defaultValues:{memberIds:[],memberCount:0,groupType:i.GroupType.GROUP},validate:function(){s["default"].notEmpty("groupType",this.groupType)},__extractGroupTypeFromAttrs:function(e){return"tigertext:entity:list"==(e.type||e.xmlns)?i.GroupType.DISTRIBUTION_LIST:e.isPublic?i.GroupType.ROOM:null},parseAttrs:function(e){var t=this.__extractGroupTypeFromAttrs(e);return t&&(e.groupType=t),"createdAt"in e&&(e.createdAt=new Date(e.createdAt)),e},beforeCreateInstance:function(e){o(e.memberIds)},computed:{memberCount:{enumerable:!0,get:function(){return this.memberIds&&this.memberIds.length||this.__memberCount||0}},metadata:{enumerable:!0,get:function(){var t=e.store.get("metadata",this.id+":"+this.organizationId);return t?t.data:null}},members:{enumerable:!0,get:function(){return this.memberIds.map(function(t){return e.store.get("user",t)})}},conversation:{enumerable:!0,get:function(){return t.host.conversations.get("group",this.id,this.organizationId)}},displayName:{configurable:!0,enumerable:!0,get:function(){return this.name}}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}});return(0,a["default"])(e,u,{before:function(e,t,n){t&&r(t)},after:function(e,t){r(e)}}),u};var o=n(102),a=r(o),i=n(69),u=n(55),s=r(u);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){var n=e.defineModel("organization",{instanceEvents:!0,replaceKeys:{members:"memberCount"},fields:{},transientAttrs:["conversations","unreadCount"],defaultValues:{conversations:[]}});return(0,i["default"])(e,n,{before:function(e,t,n){},after:function(e,t){}}),n};var o=n(32),a=(r(o),n(102)),i=r(a);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){var t=e.defineModel("message",{replaceKeys:{messageId:"id",clientId:"id",senderToken:"senderId",sender:"senderId",recipientToken:"recipientId",recipient:"recipientId",senderOrganization:"senderOrganizationId",recipientOrganization:"recipientOrganizationId",groupToken:"groupId",originalSender:"originalSenderId",originalTimestamp:"originalForwardedMessageCreatedAt",status:"recipientStatus",data:"metadata",createdTime:"createdAt"},defaultValues:{recipientStatus:o.MessageRecipientStatus.NEW,senderStatus:o.MessageRecipientStatus.NEW,sortNumber:0,messageType:o.MessageType.USER_SENT},fields:{id:{type:"string"},senderStatus:{type:"enum","enum":o.MessageSenderStatus,require:!0},recipientStatus:{type:"enum","enum":o.MessageRecipientStatus,require:!0},direction:{type:"enum","enum":o.MessageDirection,require:!0},priority:{type:"enum","enum":o.MessagePriority},counterPartyId:{type:"string",require:!0},counterPartyType:{type:"enum",values:["user","group"],require:!0},createdAt:{type:Date,require:!0}},parseAttrs:function(e){if(e.recipientStatus&&(e.recipientStatus=o.MessageRecipientStatus.resolve(e.recipientStatus)),"attachmentName"in e){var t=e.attachmentName;delete e.attachmentName,Array.isArray(e.attachments)&&e.attachments.length>0&&t&&(e.attachments[0].name=t)}if(Array.isArray(e.attachments)&&e.attachments.forEach(function(e,t){return e.id=""+(t+1)}),"priority"in e&&(e.priority=o.MessagePriority.resolve(e.priority)),"createdAt"in e&&"string"==typeof e.createdAt&&(e.createdAt=new Date(e.createdAt)),"ttl"in e&&e.createdAt){var n=(0,i["default"])(e.createdAt).add(e.ttl,"minute").toDate().getTime();e.expiresAt=n}return e},relations:{belongsTo:{sender:{type:"user",foreignKey:"senderId"},recipient:{type:"user",foreignKey:"recipientId"},originalSender:{type:"user",foreignKey:"originalSenderId"},senderOrganization:{type:"organization",foreignKey:"senderOrganizationId"},recipientOrganization:{type:"organization",foreignKey:"recipientOrganizationId"},group:{type:"group",foreignKey:"groupId"},conversation:{type:"conversation",foreignKey:"conversationId"}},hasMany:{statusesPerRecipient:{type:"messageStatusPerRecipient",foreignKey:"messageId"}}},computed:{counterParty:{enumerable:!0,get:function(){return this.counterPartyType&&this.counterPartyId?e.store.get(this.counterPartyType,this.counterPartyId):null},set:function(e){if(e){switch(e.$entityType){case"user":this.recipientId=e.id;break;case"group":this.groupId=e.id;break;default:throw new Error("unsupported counterPartyType '"+e.$entityType+"'")}this.counterPartyId=e.id,this.counterPartyType=e.$entityType}else this.counterPartyId=null,this.counterPartyType=null}}}});return t};var o=n(69),a=n(67),i=r(a);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){var t=e.defineModel("messageStatusPerRecipient",{replaceKeys:{accountId:"userId",timestamp:"createdAt"},defaultValues:{status:a["default"].NEW},fields:{userId:{type:String,require:!0},messageId:{type:String,require:!0},recipientStatus:{type:"enum","enum":a["default"],require:!0},createdAt:{type:Date,require:!0}},parseAttrs:function(e){return e.status&&(e.status=a["default"].resolve(e.status)),e},relations:{belongsTo:{message:{type:"message",foreignKey:"messageId"},user:{type:"user",foreignKey:"userId"}}}});return t};var o=n(70),a=r(o);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){var t=e.defineModel("conversation",{instanceEvents:!0,transientAttrs:["messages","timeline","lastMessage","unreadCount","unreadMessages","lastEventMessageSortNumber","_counterPartyAddedOnServer"],defaultValues:{lastEventMessageSortNumber:0,messages:[],timeline:[],unreadMessages:[],unreadCount:0},computed:{counterParty:{enumerable:!0,get:function(){return this.counterPartyType&&this.counterPartyId?e.store.get(this.counterPartyType,this.counterPartyId):null},set:function(e){if(e)switch(e.$entityType){case"user":case"group":this.counterPartyId=e.id,this.counterPartyType=e.$entityType;break;default:throw new Error("unsupported counterPartyType '"+e.$entityType+"'")}else this.counterPartyId=null,this.counterPartyType=null}},muteSettings:{enumerable:!0,get:function(){return e.host.mute.getByConversationId(this.id)}},isMuted:{enumerable:!0,get:function(){return!!this.muteSettings}}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}});return t};var o=n(32),a=(r(o),n(70));r(a),e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){var n=e.defineModel("metadata",{fields:{entityType:{type:"string",required:!0},entityId:{type:"string",required:!0},organizationId:{type:"string",required:!0}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}},parseAttrs:function(e,t){return e.data=t.data,e}});return n},e.exports=t["default"]},function(e,t){e.exports=require("invariant")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(10),a=r(o),i=n(14),u=r(i);t["default"]=function(e){function t(t,n){return e.includes(t,n)||t.push(n),t}e.__tigerconnectJsUtilsEnhanced||(e.__tigerconnectJsUtilsEnhanced=!0,e.mixin({arrayWrap:function(e){return Array.isArray(e)?e:void 0!=e&&null!=e?[e]:[]},eachWithObject:function(t,n,r){return Array.isArray(t)?t.forEach(function(e,o){return n(e,r,o,t)}):e.each(t,function(e,o,a){return n(e,o,r,a,t)}),r},contain:function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];return r.forEach(function(n){return t(e,n)}),e},count:function(t){var n=arguments.length<=1||void 0===arguments[1]?e.identity:arguments[1];return t.reduce(function(e,t){return e+(n(t)?1:0)},0)},replaceKey:function(e,t,n){!(n in e)&&t in e&&(e[n]=e[t],delete e[t])},replaceObject:function(t,n){var r=(0,u["default"])(t),o=(0,u["default"])(n),i=e.difference(r,o);(0,a["default"])(t,n),i.forEach(function(e){return delete t[e]})}}))},e.exports=t["default"]}]);