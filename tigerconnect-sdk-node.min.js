module.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),global._babelPolyfill||n(1);var r="node";n(2)("./"+r);var o=n(6);t.Client=o},function(e,t){e.exports=require("babel-polyfill")},function(e,t,n){function r(e){return n(o(e))}function o(e){return a[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var a={"./node":3,"./node.js":3,"./web":4,"./web.js":4};r.keys=function(){return Object.keys(a)},r.resolve=o,e.exports=r,r.id=2},function(e,t,n){"use strict"},function(e,t,n){"use strict";!function(){try{var e=n(5).request().__proto__;e.setNoDelay||(e.setNoDelay=function(){}),e.abort||(e.abort=function(){this.xhr&&this.xhr.abort()})}catch(t){}}()},function(e,t){e.exports=require("http")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p["default"])(e);if(!Array.isArray(e)){var a=(0,d["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,c["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,p["default"])(u))?u.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p["default"])(e);if(!Array.isArray(e)){var o=(0,d["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,c["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,p["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var i,s,u=n(7),c=r(u),f=n(8),d=r(f),l=n(9),p=r(l),y=n(10),h=r(y),g=n(11),v=r(g),m=n(12),b=r(m),w=n(13),E=r(w),_=n(14),x=r(_),k=n(15),j=r(k),I=n(16),O=r(I),T=n(18),A=r(T),M=n(37),G=r(M),V=n(31),C=r(V),z=n(21),S=r(z),P=n(38),N=r(P),R=n(47),U=r(R),q=n(90),$=r(q),D=n(63),F=r(D),B=n(105),L=r(B);n(58),n(106)(C["default"]);var K="UpM28mnfW65vJkbqEATtKvxm",Z={eventsFeatures:"is-typing,multi-org",autoAckEvents:!0,logLevel:"error",eventsAutoReconnect:!0,flushAckInterval:2e3,flushAckMaxEvents:500,flushSetMessageStatusInterval:1e3,flushMessageMaxCount:500,conversationReloadDelay:200,eventsAutoReconnectDelay:2e3,clearTypingStatusAfter:15e3,organizationRostersChangeThrottleDelay:500,temporaryEntityDelayBeforeRefreshing:100,enableEnsureEntityWithTemp:!0,enableEnsureEntityFindMissing:!0,consumerOrganizationId:K,maxMetadataKeyCount:8,pushAgent:"consumer",baseUrl:"https://developer.tigertext.me/v2",productKey:"bc1oOf3DZXbnaNZ2LCWZGvSg",clientVersion:"1.0"},W=(s=i=function(){function e(){var t=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if((0,x["default"])(this,e),!(null==n||n instanceof Object))throw new TypeError('Value of argument "config" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+a(n));if(!(null==n||n instanceof Object))throw new TypeError('Value of argument "config" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+o(n));this.config=C["default"].defaults(n,Z),this.httpClient=new A["default"]({baseUrl:this.config.baseUrl,logger:new O["default"]({name:"HttpClient",level:this.config.logLevel})}),this.enums=F["default"],this.store=new $["default"](this,{logger:new O["default"]({name:"Store",level:this.config.logLevel})}),this.store.defineModels(),this.models=this.store.models,this.modelsByEntityType=C["default"].mapKeys(this.store.models,function(e,t){return C["default"].snakeCase(t)}),this.logger=new O["default"]({name:"TigerConnectClient",level:this.config.logLevel}),this.api={},C["default"].each(N["default"],function(e,n){t.api[C["default"].camelCase(n)]=new e(t,{logger:new O["default"]({name:e.name,level:t.config.logLevel})})}),this._services={},C["default"].each(U["default"],function(e,n){n=C["default"].camelCase(n),t._services[n]=t[n]=new e(t,{logger:new O["default"]({name:e.name,level:t.config.logLevel})})}),C["default"].each(this._services,function(e){return e.mounted&&e.mounted()}),this._listenToEvents()}return(0,j["default"])(e,[{key:"_listenToEvents",value:function(){var e=this;this.on("signedIn",function(t,n){e.logger.info("signedIn",t.id)}).on("signedOut",function(){e.reset()}).on("signUp",function(t){var n=t.user,r=t.auth;e.logger.info("signUp",n.id),e._setCurrentUser(n,r)}),this.events.on("event",function(t){return e.emit("event",t)}),this.conversations.on("message",function(t){return e.emit("message",t)}),this.conversations.on("change",function(t){return e.emit("conversation:change",t)}),this.groups.on("membership:change",function(t){return e.emit("group:membership:change",t)}),this.typingStatus.on("change",function(t){return e.emit("typing:change",t)})}},{key:"signIn",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e,n){var r,o,a,i=arguments.length<=2||void 0===arguments[2]?{udid:void 0}:arguments[2];return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.emit("signingIn"),t.prev=1,t.next=4,this.users.signIn(e,n,i);case 4:return r=t.sent,o=r.user,a=r.auth,this._setCurrentUser(o,a),t.next=10,this.users.me({bypassCache:!0});case 10:return this.emit("signedIn",o,a),t.abrupt("return",{user:o,auth:a});case 14:throw t.prev=14,t.t0=t["catch"](1),t.t0;case 18:case"end":return t.stop()}},t,this,[[1,14]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"signOut",value:function(){var e=(0,E["default"])(b["default"].mark(function t(){var e,n,r=arguments.length<=0||void 0===arguments[0]?{async:!0}:arguments[0],o=r.async,a=void 0===o?!0:o;return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isSignedIn()){t.next=2;break}return t.abrupt("return",v["default"].resolve());case 2:if(this.emit("signingOut"),a||"undefined"!=typeof XMLHttpRequest){t.next=5;break}throw new Error("async: false option has to be on the browser.");case 5:if(!a){t.next=16;break}return e=this.users.signOut({async:a}),t.next=9,e;case 9:this._currentUser=null,this._auth=null,this.httpClient.removeAuth(),this.events.disconnect(),this.emit("signedOut"),t.next=22;break;case 16:return n=new XMLHttpRequest,n.open("POST",this.config.baseUrl+"/logout",!1),n.setRequestHeader("Authorization",this.httpClient.getAuthHeader()),n.send(null),this.emit("signedOut"),t.abrupt("return",v["default"].resolve());case 22:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"wipe",value:function(){var e=(0,E["default"])(b["default"].mark(function t(){return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signOut();case 2:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"authenticate",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e,n){var r,o,a;return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this._setAuth(e,n),t.prev=1,t.next=4,this.httpClient.get("/user");case 4:t.next=25;break;case 6:if(t.prev=6,t.t0=t["catch"](1),r=t.t0.response&&t.t0.response.get("TT_Log_Account_Token")){t.next=11;break}throw new S["default"].WrongCredentialsError;case 11:return t.prev=11,t.next=14,this.users.find(r);case 14:return o=t.sent,a={key:e,secret:n},this._setCurrentUser(o,a),this.emit("signedIn",o,a),t.abrupt("return",o);case 21:throw t.prev=21,t.t1=t["catch"](11),this._removeAuth(),t.t1;case 25:case"end":return t.stop()}},t,this,[[1,6],[11,21]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"_setCurrentUser",value:function(e,t){this._currentUser=e,this._setAuth(t.key,t.secret,t.resource)}},{key:"_setAuth",value:function(e,t,n){this._auth={key:e,secret:t,resource:n},this.httpClient.setAuth(e,t)}},{key:"_removeAuth",value:function(){this._auth=null,this.httpClient.removeAuth()}},{key:"getCurrentUser",value:function(){return this._currentUser||null}},{key:"getAuth",value:function(){return this._auth}},{key:"isSignedIn",value:function(){return null!=this.getAuth()}},{key:"requireUser",value:function(){if(!this.isSignedIn())throw new S["default"].NotSignedInError}},{key:"reactToAdvisoryEvent",value:function(e,t){switch(this.emit("advisory",{type:e,data:t}),e){case"replayStart":this.emit("messages:offline:start",t);break;case"replayStop":this.emit("messages:offline:stop"),this.emit("messages:new:start")}}},{key:"modelByTypeNS",value:function(e){return this.MODEL_BY_TYPE_NS[e]}},{key:"injectModel",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?e.xmlns||e.type:arguments[1],n=this.modelByTypeNS(t);return n?n.inject(e):((0,L["default"])(n,"injectModel: Missing class for "+t),null)}},{key:"getEntity",value:function(e,t){return this.modelsByEntityType[e].get(t)}},{key:"getEntities",value:function(e){var t=this;return e.map(function(e){return t.getEntity(e.type,e.id)})}},{key:"typeNSByModelName",value:function(e){return this.TYPE_NS_BY_MODEL_NAME[e]}},{key:"reset",value:function(){this.emit("reset"),C["default"].each(this._services,function(e){e.dispose&&e.dispose(),e.mounted&&e.mounted()}),this.store&&this.store.clear()}},{key:"configure",value:function(e){return(0,h["default"])(this.config,e),this}},{key:"setDefaultOrganization",value:function(e){return this.configure({defaultOrganizationId:e})}},{key:"MODEL_BY_TYPE_NS",get:function(){return this._MODEL_BY_TYPE_NS||(this._MODEL_BY_TYPE_NS={"tigertext:entity:account":this.models.User,"tigertext:entity:group":this.models.Group,"tigertext:entity:list":this.models.Group,"tigertext:iq:message":this.models.Message,"tigertext:iq:group_message":this.models.Message,"tigertext:iq:group:message":this.models.Message}),this._MODEL_BY_TYPE_NS}},{key:"TYPE_NS_BY_MODEL_NAME",get:function(){return this._TYPE_NS_BY_MODEL_NAME||(this._TYPE_NS_BY_MODEL_NAME=C["default"].reduce(this.MODEL_BY_TYPE_NS,function(e,t,n){return e[t.name]=n,e[C["default"].capitalize(t.name)]=n,e},{})),this._TYPE_NS_BY_MODEL_NAME}}]),e}(),i.errors=S["default"],i.VERSION="0.1.7",i.CONSUMER_ORGANIZATION_ID=K,s);(0,h["default"])(W.prototype,G["default"].prototype),t["default"]=W,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/core-js/object/keys")},function(e,t){e.exports=require("babel-runtime/helpers/typeof")},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t){e.exports=require("babel-runtime/helpers/createClass")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),s=r(i),u=n(8),c=r(u),f=n(9),d=r(f),l=n(17),p=r(l),y=n(14),h=r(y),g=n(15),v=r(g),m=function(){function e(t){var n=t.name,r=t.level;if((0,h["default"])(this,e),null==arguments[0]||"string"!=typeof arguments[0].name||"string"!=typeof arguments[0].level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ name: string;\n  level: string;\n}\n\nGot:\n"+a(arguments[0]));if(null==arguments[0]||"string"!=typeof arguments[0].name||"string"!=typeof arguments[0].level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ name: string;\n  level: string;\n}\n\nGot:\n"+o(arguments[0]));this.name=n,this.level=r}return(0,v["default"])(e,[{key:"setLevel",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));this.level=e}}]),e}(),b=["debug","log","info","warn","error"],w=b.reduce(function(e,t,n){return e[t]=n,e},{});b.forEach(function(e){var t=w[e];m.prototype[e]=function(){for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];t<w[this.level]||(r=["["+this.name+"]"].concat((0,p["default"])(r)),Function.prototype.apply.call(console[e],console,r))}}),t["default"]=m,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/helpers/toConsumableArray")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){var t=arguments.length<=1||void 0===arguments[1]?"attachment":arguments[1],r=e.name;if(!r)if("string"==typeof e)r=n(35).basename(e);else if(e instanceof Buffer){var o=I["default"].get(n(36)(e),"ext");r=t+"."+o}return r}Object.defineProperty(t,"__esModule",{value:!0});var a=n(10),i=r(a),s=n(12),u=r(s),c=n(11),f=r(c),d=n(13),l=r(d),p=n(14),y=r(p),h=n(15),g=r(h),v=n(19),m=r(v),b=n(20),w=r(b),E=n(21),_=r(E),x=n(30),k=r(x),j=n(31),I=r(j),O=n(32),T=n(33),A=["get","post","put","patch","del"],M=function(){function e(t){(0,y["default"])(this,e),this.config=t,this.logger=t.logger,this._prefixBaseUrl=(0,k["default"])(this.config.baseUrl)}return(0,g["default"])(e,[{key:"setAuth",value:function(e,t){this._key=e,this._secret=t}},{key:"removeAuth",value:function(){this._key=null,this._secret=null}},{key:"getAuthHeader",value:function(){return this.getAuthHeaderForKeyAndSecret(this._key,this._secret)}},{key:"getAuthHeaderForKeyAndSecret",value:function(e,t){return e&&t?"Basic "+(0,w["default"])(e+":"+t):null}},{key:"_contentType",value:function(e){switch(e){case"json":return"application/json";case"event-stream":return"text/event-stream";case"text":default:return"plain/text"}}},{key:"downloadImageBlob",value:function(){var e=(0,l["default"])(u["default"].mark(function t(e){var n=this;return u["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("On Node.js use `downloadImageToFile`");case 2:return t.abrupt("return",(0,T.WEB_CODE)(function(){return new f["default"](function(t,r){var o=new XMLHttpRequest,a=n.config.baseUrl+e;o.open("GET",a,!0),o.setRequestHeader("Authorization",n.getAuthHeader()),o.responseType="blob",o.onreadystatechange=function(){4==o.readyState&&(o.status<200||o.status>299?r(new Error("Failed downloading "+a+". Status = "+o.status)):t(o.response))},o.send(null)})}));case 3:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"downloadImageToFile",value:function(){var e=(0,l["default"])(u["default"].mark(function t(e,r){var o=this;return u["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;break;case 2:return t.abrupt("return",(0,T.NODE_CODE)(function(){return new f["default"](function(t,a){var i=o.config.baseUrl+e;n(34)({url:i,headers:{Authorization:o.getAuthHeader()}},function(e,n){e||n.statusCode<200||n.statusCode>299?a(new Error("Failed downloading "+i+". Status = "+xhr.status)):t()}).pipe(fs.createWriteStream(r))})}));case 3:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"downloadImageAndGetURL",value:function(){var e=(0,l["default"])(u["default"].mark(function t(e){var n,r;return u["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=8;break;case 3:return n=e.sent,r=URL.createObjectURL(n),e.abrupt("return",r);case 8:throw new Error("On Node.js use `downloadImageToFile`");case 9:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();A.forEach(function(e){M.prototype[e]=function(){var t=(0,l["default"])(u["default"].mark(function n(t){var r,a,s=this,c=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return c=I["default"].defaults(c||{},{reqFormat:"json",resFormat:"json"}),c.urlParams&&(t=t.replace(/:([\w\-]+)/g,function(e,t){return encodeURIComponent(c.urlParams[t])})),this.logger&&this.logger.info("start",e.toUpperCase(),t,c),r=(0,i["default"])({},c.headers),I["default"].isEmpty(c.files)&&(r["Content-Type"]=r["Content-Type"]||this._contentType(c.reqFormat)),r.Accept=r.Accept||this._contentType(c.resFormat),c.requestId&&(r["Request-ID"]=c.requestId),a=new f["default"](function(n,a){var i=m["default"][e](t).use(s._prefixBaseUrl).set(r).query(c.query||{});I["default"].isEmpty(c.files)?i=i.send(c.data||{}):(I["default"].each(c.data,function(e,t){return i=i.field(t,e)}),I["default"].each(c.files,function(e,t,n){return i=i.attach(t,e,o(e,"attachment-"+n))}),i=i.send()),s._key&&s._secret&&(i=i.auth(s._key,s._secret)),i.end(function(r,o){if(r)return s.logger&&s.logger.info("error",e.toUpperCase(),t,r),401==r.status&&a(new _["default"].WrongCredentialsError),void a(r);switch(c.resFormat){case"json":var i=o.body||{};"reply"in i&&(i=i.reply);var u={data:i,headers:o.headers,getHeader:function(e){return o.headers[e.toLowerCase()]},status:o.status};Object.defineProperty(u,"_origData",{get:function(){return o.body}}),s.logger&&s.logger.info("success",e.toUpperCase(),t,u),n(u);break;default:s.logger&&s.logger.info("success",e.toUpperCase(),t,o.text?o.text.substr(0,80)+"...":"[null]"),n(o.text)}})}),n.abrupt("return",a);case 9:case"end":return n.stop()}},n,this)}));return function(e,n){return t.apply(this,arguments)}}()}),!function(){var e=M.prototype.get,t=(0,O.decorator)(e);M.prototype.get=function(n){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return r.reusePromise?t.call(this,n,r):e.call(this,n,r)}}(),t["default"]=M,e.exports=t["default"]},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("btoa")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={NotSignedInError:n(22),WrongCredentialsError:n(26),NotFoundError:n(27),PermissionDeniedError:n(28),ValidationError:n(29)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(23),s=r(i),u=n(14),c=r(u),f=n(24),d=r(f),l=n(25),p=r(l),y=(a=o=function(e){function t(){var e;(0,c["default"])(this,t);for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var a=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(r)));return a.code=t.CODE,a}return(0,p["default"])(t,e),t}(Error),o.CODE="not-signed-in",a);t["default"]=y,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/object/get-prototype-of")},function(e,t){e.exports=require("babel-runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("babel-runtime/helpers/inherits")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(23),s=r(i),u=n(14),c=r(u),f=n(24),d=r(f),l=n(25),p=r(l),y=(a=o=function(e){function t(){var e;(0,c["default"])(this,t);for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var a=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(r)));return a.code=t.CODE,a}return(0,p["default"])(t,e),t}(Error),o.CODE="wrong-credentials",a);t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(23),s=r(i),u=n(14),c=r(u),f=n(24),d=r(f),l=n(25),p=r(l),y=(a=o=function(e){function t(e,n,r){(0,c["default"])(this,t);var o=(0,d["default"])(this,(0,s["default"])(t).call(this,r));return o.code=t.CODE,o.resource=e,o.id=n,o}return(0,p["default"])(t,e),t}(Error),o.CODE="not-found",a);t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(23),s=r(i),u=n(14),c=r(u),f=n(24),d=r(f),l=n(25),p=r(l),y=(a=o=function(e){function t(e,n,r){var o=arguments.length<=3||void 0===arguments[3]?"can't perform action "+r+" on "+(e.name||e)+" #"+n:arguments[3];(0,c["default"])(this,t);var a=(0,d["default"])(this,(0,s["default"])(t).call(this,o));return a.code=t.CODE,a.resource=e,a.action=r,a.id=n,a}return(0,p["default"])(t,e),t}(Error),o.CODE="permission-denied",a);t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,a,i=n(23),s=r(i),u=n(14),c=r(u),f=n(24),d=r(f),l=n(25),p=r(l),y=(a=o=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?"invalid":arguments[1],r=arguments.length<=2||void 0===arguments[2]?e+" is "+n:arguments[2];(0,c["default"])(this,t);var o=(0,d["default"])(this,(0,s["default"])(t).call(this,r));return o.code=t.CODE,o.name=e,o.reason=n,o}return(0,p["default"])(t,e),t}(Error),o.CODE="validation",a);t["default"]=y,e.exports=t["default"]},function(e,t){e.exports=require("superagent-prefix")},function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t=(0,f["default"])({memoize:!1},t);var n=function(){for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var a=r,i=["memoized",a],s=p.get(e,a);if(s)return s;if(t.memoize){var c=p.get(e,i);if(c)return u["default"].resolve(c)}var f=function(){p.del(e,a)},d=e.apply(this,r),l=d.then(function(n){return t.memoize&&p.set(e,i,n),f(),n},function(e){throw f(),e});return p.set(e,a,l),l};return n.__reusePromise__origFn=e,n.__reusePromise__clear=function(){o.clear(e)},n}function a(){var e=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0];void 0==e?p.clear():p.del(e.__reusePromise__origFn||e)}function i(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return function(t,n,r){return r.value=o(r.value,e),r}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(11),u=r(s),c=n(10),f=r(c),d=n(7),l=r(d);t["default"]=o,t.clear=a,t.decorator=i;var p=function(){function e(e){return(0,l["default"])(e)}function t(e,t,n){return e[s]==t&&e[u]==n}function n(e,n){for(var r=0,o=f.length;o>r;r++){var a=f[r];if(t(a,e,n))return r}return-1}function r(t,r){var o=e(r),a=n(t,o);return f[a]?f[a][c]:null}function o(t,r,o){var a=e(r),i=n(t,a);if(i>-1)f[i][c]=o;else{var d=[];d[s]=t,d[u]=a,d[c]=o,f.push(d)}return o}function a(t,r){if(void 0===r)for(var o=f.length-1;o>=0;o--){var a=f[o];a[s]==t&&f.splice(o,1)}else{var i=e(r),u=n(t,i);u>-1&&f.splice(u,1)}}function i(){f.length=0}var s=0,u=1,c=2,f=[];return{get:r,set:o,del:a,clear:i}}();i.clear=a,o.clear=a},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WEB_CODE=function(e){return e()},t.NODE_CODE=function(e){return e()}},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("file-type")},function(e,t){e.exports=require("events")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Roster:n(39),Users:n(41),Groups:n(42),Organizations:n(43),Messages:n(44),Metadata:n(46)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),s=r(i),u=n(8),c=r(u),f=n(9),d=r(f),l=n(12),p=r(l),y=n(13),h=r(y),g=n(23),v=r(g),m=n(14),b=r(m),w=n(15),E=r(w),_=n(24),x=r(_),k=n(25),j=r(k),I=n(40),O=r(I),T=n(31),A=r(T),M=["user","distributionList"],G=function(e){function t(){return(0,b["default"])(this,t),(0,x["default"])(this,(0,v["default"])(t).apply(this,arguments))}return(0,j["default"])(t,e),(0,E["default"])(t,[{key:"findAll",value:function(){var e=(0,h["default"])(p["default"].mark(function t(){var e;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.httpClient.get("/roster");case 2:return e=t.sent,t.abrupt("return",e.data);case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=(0,h["default"])(p["default"].mark(function t(e,n,r){var i,s;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:if(A["default"].includes(M,e)){t.next=14;break}return t.abrupt("return");case 14:return i={},r&&(i["TT-X-Organization-Key"]=r),s=this.host.typeNSByModelName(e),t.next=19,this.httpClient.post("/roster",{headers:i,data:{entity:n,type:s}});case 19:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,h["default"])(p["default"].mark(function t(e,n,r){var i,s;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));
case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:if(A["default"].includes(M,e)){t.next=14;break}return t.abrupt("return");case 14:return i={},r&&(i["TT-X-Organization-Key"]=r),s=this.host.typeNSByModelName(e),t.next=19,this.httpClient.del("/roster/:counterPartyId",{headers:i,urlParams:{counterPartyId:n},data:{type:s}});case 19:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()}]),t}(O["default"]);t["default"]=G,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=n(10),a=r(o),i=n(14),s=r(i),u=n(37),c=r(u),f=function d(e,t){(0,s["default"])(this,d),(0,a["default"])(this,t),this.config=e.config,this.host=e,this.httpClient=e.httpClient};t["default"]=f,(0,a["default"])(f.prototype,c["default"].prototype),e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),s=r(i),u=n(8),c=r(u),f=n(9),d=r(f),l=n(12),p=r(l),y=n(13),h=r(y),g=n(23),v=r(g),m=n(14),b=r(m),w=n(15),E=r(w),_=n(24),x=r(_),k=n(25),j=r(k),I=n(40),O=r(I),T=n(31),A=(r(T),function(e){function t(){return(0,b["default"])(this,t),(0,x["default"])(this,(0,v["default"])(t).apply(this,arguments))}return(0,j["default"])(t,e),(0,E["default"])(t,[{key:"find",value:function(){var e=(0,h["default"])(p["default"].mark(function t(e){var n;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return t.prev=4,t.next=7,this.httpClient.get("/user/:id",{urlParams:{id:e}});case 7:return n=t.sent,t.abrupt("return",n.data);case 11:if(t.prev=11,t.t0=t["catch"](4),!t.t0.response||404!=t.t0.response.status){t.next=17;break}return t.abrupt("return",null);case 17:throw t.t0;case 18:case"end":return t.stop()}},t,this,[[4,11]])}));return function(t){return e.apply(this,arguments)}}()}]),t}(O["default"]));t["default"]=A,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),s=r(i),u=n(8),c=r(u),f=n(9),d=r(f),l=n(12),p=r(l),y=n(13),h=r(y),g=n(23),v=r(g),m=n(14),b=r(m),w=n(15),E=r(w),_=n(24),x=r(_),k=n(25),j=r(k),I=n(40),O=r(I),T=n(31),A=(r(T),function(e){function t(){return(0,b["default"])(this,t),(0,x["default"])(this,(0,v["default"])(t).apply(this,arguments))}return(0,j["default"])(t,e),(0,E["default"])(t,[{key:"create",value:function(){var e=(0,h["default"])(p["default"].mark(function t(e){var n,r,o,a,i,s,u=e.name,c=(e.avatarFile,e.replayHistory),f=void 0===c?!0:c,d=e.memberIds,l=void 0===d?[]:d,y=e.organizationId;return p["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},y&&(n["TT-X-Organization-Key"]=y),r={name:u,replay_history:f,members:l},e.next=5,this.httpClient.post("/group",{headers:n,data:r});case 5:return o=e.sent,a=o.getHeader("TT-X-Group-Token"),i=o.getHeader("TT-X-Group-Avatar"),s={id:a,avatarUrl:i,name:u,memberIds:l,organizationId:y},e.abrupt("return",s);case 10:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,h["default"])(p["default"].mark(function t(e,n){var r,o,a=n.name,i=void 0===a?void 0:a,s=(n.avatarFile,n.replayHistory),u=void 0===s?void 0:s,c=n.memberIds,f=void 0===c?[]:c;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={},"undefined"!=typeof i&&(r.name=i),"undefined"!=typeof f&&(r.members=f),"undefined"!=typeof u&&(r.replay_history=u),t.next=6,this.httpClient.post("/group/:id",{urlParams:{id:e},data:r});case 6:return o=t.sent,t.abrupt("return",!0);case 8:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,h["default"])(p["default"].mark(function t(e){var n;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return t.prev=4,t.next=7,this.httpClient.get("/group/:id",{urlParams:{id:e}});case 7:return n=t.sent,t.abrupt("return",n.data);case 11:if(t.prev=11,t.t0=t["catch"](4),!t.t0.response||404!=t.t0.response.status){t.next=17;break}return t.abrupt("return",null);case 17:throw t.t0;case 18:case"end":return t.stop()}},t,this,[[4,11]])}));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=(0,h["default"])(p["default"].mark(function t(e){return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return t.prev=4,t.next=7,this.httpClient.del("/group/:id",{urlParams:{id:e}});case 7:return t.abrupt("return",!0);case 10:if(t.prev=10,t.t0=t["catch"](4),!t.t0.response||404!=t.t0.response.status&&403!=t.t0.response.status){t.next=16;break}return t.abrupt("return",!1);case 16:throw t.t0;case 17:case"end":return t.stop()}},t,this,[[4,10]])}));return function(t){return e.apply(this,arguments)}}()}]),t}(O["default"]));t["default"]=A,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),s=r(i),u=n(8),c=r(u),f=n(9),d=r(f),l=n(12),p=r(l),y=n(13),h=r(y),g=n(23),v=r(g),m=n(14),b=r(m),w=n(15),E=r(w),_=n(24),x=r(_),k=n(25),j=r(k),I=n(40),O=r(I),T=n(31),A=(r(T),function(e){function t(){return(0,b["default"])(this,t),(0,x["default"])(this,(0,v["default"])(t).apply(this,arguments))}return(0,j["default"])(t,e),(0,E["default"])(t,[{key:"find",value:function(){var e=(0,h["default"])(p["default"].mark(function t(e,n){var r;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return t.prev=8,t.next=11,this.httpClient.get("/user/:userId/organization/:id",{urlParams:{userId:e,id:n}});case 11:return r=t.sent,t.abrupt("return",r.data);case 15:if(t.prev=15,t.t0=t["catch"](8),!t.t0.response||404!=t.t0.response.status){t.next=21;break}return t.abrupt("return",null);case 21:throw t.t0;case 22:case"end":return t.stop()}},t,this,[[8,15]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findAllOfUser",value:function(){var e=(0,h["default"])(p["default"].mark(function t(e){var n;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return t.prev=4,t.next=7,this.httpClient.get("/user/:userId/organization",{urlParams:{userId:e}});case 7:return n=t.sent,t.abrupt("return",n.data);case 11:if(t.prev=11,t.t0=t["catch"](4),!t.t0.response||404!=t.t0.response.status){t.next=17;break}return t.abrupt("return",null);case 17:throw t.t0;case 18:case"end":return t.stop()}},t,this,[[4,11]])}));return function(t){return e.apply(this,arguments)}}()}]),t}(O["default"]));t["default"]=A,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,c["default"])(e);if(!Array.isArray(e)){var a=(0,s["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,c["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,c["default"])(e);if(!Array.isArray(e)){var o=(0,s["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,c["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(8),s=r(i),u=n(9),c=r(u),f=n(12),d=r(f),l=n(7),p=r(l),y=n(45),h=r(y),g=n(13),v=r(g),m=n(23),b=r(m),w=n(14),E=r(w),_=n(15),x=r(_),k=n(24),j=r(k),I=n(25),O=r(I),T=n(40),A=r(T),M=function(e){function t(){return(0,E["default"])(this,t),(0,j["default"])(this,(0,b["default"])(t).apply(this,arguments))}return(0,O["default"])(t,e),(0,x["default"])(t,[{key:"send",value:function(){var e=(0,v["default"])(d["default"].mark(function t(e){var n,r,i,s,u=e.counterPartyId,c=e.body,f=e.senderOrganizationId,l=e.recipientOrganizationId,y=e.attachment,g=e.metadata,v=e.localId,m=arguments;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=m[0]&&"string"==typeof m[0].counterPartyId&&"string"==typeof m[0].body&&"string"==typeof m[0].senderOrganizationId&&"string"==typeof m[0].recipientOrganizationId&&(null==m[0].attachment||m[0].attachment instanceof Object||null==m[0].attachment||"string"==typeof m[0].attachment)&&(null==m[0].metadata||m[0].metadata instanceof Object)&&"string"==typeof m[0].localId){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ counterPartyId: string;\n  body: string;\n  senderOrganizationId: string;\n  recipientOrganizationId: string;\n  attachment: ?Object | ?string;\n  metadata: ?Object;\n  localId: string;\n}\n\nGot:\n"+a(m[0]));case 2:if(null!=m[0]&&"string"==typeof m[0].counterPartyId&&"string"==typeof m[0].body&&"string"==typeof m[0].senderOrganizationId&&"string"==typeof m[0].recipientOrganizationId&&(null==m[0].attachment||m[0].attachment instanceof Object||null==m[0].attachment||"string"==typeof m[0].attachment)&&(null==m[0].metadata||m[0].metadata instanceof Object)&&"string"==typeof m[0].localId){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ counterPartyId: string;\n  body: string;\n  senderOrganizationId: string;\n  recipientOrganizationId: string;\n  attachment: ?Object | ?string;\n  metadata: ?Object;\n  localId: string;\n}\n\nGot:\n"+o(m[0]));case 4:return l||(l=f),n={recipient:u,body:c},g&&(n.data=g.map(function(e){return(0,h["default"])({},e,{payload:(0,p["default"])(e.payload)})})),f&&(n.sender_organization=f),l&&(n.recipient_organization=l),r={},y&&(r.attachment=y),e.next=13,this.httpClient.post("/message",{data:n,files:r,requestId:v});case 13:return i=e.sent,s={serverId:i.getHeader("TT-X-Message-Id"),ttl:i.getHeader("TT-X-Msg-Ttl")},e.abrupt("return",s);case 16:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=(0,v["default"])(d["default"].mark(function t(e){return d["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return t.prev=4,t.next=7,this.httpClient.del("/message/:id",{urlParams:{id:e}});case 7:return t.abrupt("return",!0);case 10:return t.prev=10,t.t0=t["catch"](4),t.abrupt("return",!1);case 13:case"end":return t.stop()}},t,this,[[4,10]])}));return function(t){return e.apply(this,arguments)}}()},{key:"startTyping",value:function(){var e=(0,v["default"])(d["default"].mark(function t(e){return d["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return t.next=6,this.httpClient.post("/message/typing",{data:{recipient:e}});case 6:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"stopTyping",value:function(){var e=(0,v["default"])(d["default"].mark(function t(e){return d["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return t.next=6,this.httpClient.del("/message/typing/:recipientId",{urlParams:{recipientId:e}});case 6:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(A["default"]);t["default"]=M,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/helpers/extends")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),s=r(i),u=n(8),c=r(u),f=n(9),d=r(f),l=n(12),p=r(l),y=n(13),h=r(y),g=n(23),v=r(g),m=n(14),b=r(m),w=n(15),E=r(w),_=n(24),x=r(_),k=n(25),j=r(k),I=n(40),O=r(I),T=n(31),A=r(T),M=function(e){function t(){return(0,b["default"])(this,t),(0,x["default"])(this,(0,v["default"])(t).apply(this,arguments))}return(0,j["default"])(t,e),(0,E["default"])(t,[{key:"update",value:function(){var e=(0,h["default"])(p["default"].mark(function t(e,n,r){return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if(n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 8:if(n instanceof Object){t.next=10;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:return t.next=14,this.httpClient.post("/metadata/:id",{urlParams:{id:e},data:n,headers:{"TT-X-Organization-Key":r}});case 14:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,h["default"])(p["default"].mark(function t(e,n){var r;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return t.next=10,this.httpClient.get("/metadata/:id",{urlParams:{id:e},headers:{"TT-X-Organization-Key":n}});case 10:return r=t.sent,t.abrupt("return",r.data);case 12:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findMulti",value:function(){var e=(0,h["default"])(p["default"].mark(function t(e,n){var r,i;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){t.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return t.next=10,this.httpClient.post("/metadata_bulk",{data:{entities:e},headers:{"TT-X-Organization-Key":n}});case 10:return r=t.sent,i=A["default"].zipObject(e,r.data),t.abrupt("return",i);case 13:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),t}(O["default"]);t["default"]=M,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Users:n(48),EventRouter:n(52),Events:n(56),Messages:n(59),Groups:n(76),Organizations:n(77),Conversations:n(80),Presence:n(82),Metadata:n(83),Search:n(86),TypingStatus:n(87)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,y["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,g["default"])(u))?u.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,y["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(s+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+s+"\n"+a+"}":"{\n  "+a+s+"\n"+a+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,g["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var s,u,c,f,d=n(7),l=r(d),p=n(8),y=r(p),h=n(9),g=r(h),v=n(49),m=r(v),b=n(11),w=r(b),E=n(12),_=r(E),x=n(13),k=r(x),j=n(23),I=r(j),O=n(14),T=r(O),A=n(15),M=r(A),G=n(24),V=r(G),C=n(25),z=r(C),S=n(20),P=r(S),N=n(31),R=r(N),U=n(50),q=r(U),$=n(51),D=r($),F=n(21),B=r(F),L=n(32),K=new q["default"].MD5,Z=(s=(0,L.decorator)(),u=(0,L.decorator)(),c=(0,L.decorator)(),f=function(e){function t(){return(0,T["default"])(this,t),(0,V["default"])(this,(0,I["default"])(t).apply(this,arguments))}return(0,z["default"])(t,e),(0,M["default"])(t,[{key:"signIn",value:function(){var e=(0,k["default"])(_["default"].mark(function t(e,n){
var r,o,s,u,c,f=arguments.length<=2||void 0===arguments[2]?{udid:void 0}:arguments[2];return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return r={Authorization:this.getSignInAuthHeader(e,n)},o={user_id:e,password:n,push_routing:this.config.pushAgent,version:this.config.clientVersion,device_id:f.udid},t.next=12,this.httpClient.post("/login",{headers:r,data:o});case 12:return s=t.sent,u=this.host.models.User.inject(s.data.user),c=s.data.auth,t.abrupt("return",{user:u,auth:c});case 16:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSignInAuthHeader",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return this.constructor.getSignInAuthHeader(this.config.productKey,e,t)}},{key:"signUp",value:function(){var e=(0,k["default"])(_["default"].mark(function t(){var e,n,r,o,a,i,s,u,c,f,d,l,p,y,h,g=arguments.length<=0||void 0===arguments[0]?{udid:void 0,email:void 0,password:void 0,countryCode:void 0,version:void 0}:arguments[0];return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.config.signUpHashKey,n=this.config.signUpHashSalt,r=g.udid,o=[e,n,r].join(":"),a=K.hex(o),i=[a.substr(0,2),a.substr(a.length-2)].join(""),s=[this.config.productKey,e,n,r,i].join(":"),u=(0,P["default"])(s),c="XMPP-Anonymous "+u,f={Authorization:c},d={primary_email:g.email,unique_id:g.email,password:g.password,push_routing:this.config.pushAgent,product:this.config.productKey,country_code:g.countryCode,device_id:g.udid,version:this.config.clientVersion},t.next=13,this.httpClient.post("/signup",{headers:f,data:d});case 13:return l=t.sent,p=this.host.models.User.inject(l.data.user),y=l.data.auth,h={user:p,auth:y},this.host.emit("signUp",h),t.abrupt("return",h);case 19:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"signOut",value:function(){var e=(0,k["default"])(_["default"].mark(function t(){return _["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpClient.post("/logout"));case 1:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"me",value:function(){var e=(0,k["default"])(_["default"].mark(function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.host.isSignedIn()){t.next=2;break}return t.abrupt("return",w["default"].reject(new B["default"].NotSignedInError));case 2:return t.abrupt("return",this.find(this.host.getCurrentUser().id,e));case 3:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,k["default"])(_["default"].mark(function t(e){var n,r,o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:if(o=R["default"].defaults(o,{ignoreNotFound:!1,bypassCache:!1}),this.host.requireUser(),n=null,o.bypassCache){t.next=11;break}if(n=this.host.models.User.get(e),!n||n.$temporary){t.next=11;break}return t.abrupt("return",n);case 11:return t.next=13,this.host.api.users.find(e);case 13:if(r=t.sent,!r){t.next=19;break}n=this.host.models.User.inject(r),delete n.$temporary,t.next=21;break;case 19:if(o.ignoreNotFound){t.next=21;break}throw new B["default"].NotFoundError(this.host.models.User.name,e);case 21:return t.abrupt("return",n);case 22:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=(0,k["default"])(_["default"].mark(function t(e){return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.find(e,{ignoreNotFound:!0,bypassCache:!0});case 2:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.User.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.User.getMulti(e)}}],[{key:"getSignInAuthHeader",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=[e,t,n].join(":"),o=(0,P["default"])(r),s="XMPP-Simple "+o;return s}}]),t}(D["default"]),o(f.prototype,"me",[s],(0,m["default"])(f.prototype,"me"),f.prototype),o(f.prototype,"find",[u],(0,m["default"])(f.prototype,"find"),f.prototype),o(f.prototype,"refresh",[c],(0,m["default"])(f.prototype,"refresh"),f.prototype),f);t["default"]=Z,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/object/get-own-property-descriptor")},function(e,t){e.exports=require("jshashes")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=n(10),a=r(o),i=n(14),s=r(i),u=n(15),c=r(u),f=n(37),d=r(f),l=function(){function e(t,n){(0,s["default"])(this,e),(0,a["default"])(this,n),this.host=t,this.config=t.config,this.httpClient=t.httpClient}return(0,c["default"])(e,[{key:"_resolveModelId",value:function(e){return"string"==typeof e?e:e.serverId?e.serverId:e.id?e.id:null}},{key:"_resolveEntity",value:function(e,t){for(var n=0;n<t.length;n++){var r=t[n],o=this.host.modelsByEntityType[r].get(e);if(o)return o}return null}},{key:"_resolveEntityType",value:function(e,t){var n=this._resolveEntity(e,t);return n?n.$entityType:null}},{key:"mounted",value:function(){}},{key:"dispose",value:function(){}}]),e}();t["default"]=l,(0,a["default"])(l.prototype,d["default"].prototype),e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=n(53),a=r(o),i=n(54),s=r(i),u=n(23),c=r(u),f=n(14),d=r(f),l=n(15),p=r(l),y=n(24),h=r(y),g=n(25),v=r(g),m=n(51),b=r(m),w=n(31),E=r(w),_=n(55),x=function(e){function t(e,n){var r;(0,d["default"])(this,t);var o=(0,h["default"])(this,(0,c["default"])(t).call(this,e,n));o.EVENTS=(r={},(0,a["default"])(r,"client_advisory",function(e){switch(e.data.advisory.name){case"replay_start":this.host.reactToAdvisoryEvent("replayStart",{replayMessageCount:e.data.advisory.replay_message_count});break;case"replay_stop":this.host.reactToAdvisoryEvent("replayStop")}}),(0,a["default"])(r,"message|group_message",function(e){this.host.conversations.reactToIncomingMessageEvent(e)}),(0,a["default"])(r,"message:status|group:message:status",function(e){this.host.messages.reactToMessageStatusEvent(e)}),(0,a["default"])(r,"friends",function(e){this.host.conversations.reactToFriendsEvent(e)}),(0,a["default"])(r,"presence",function(e){this.host.presence.reactToPresenceEvent(e)}),(0,a["default"])(r,"bang",function(e){this.host.groups.reactToBangEvent(e)}),(0,a["default"])(r,"update",function(e){var t=e.data,n=t.type,r=(0,s["default"])(t,["type"]);this.host.injectModel(r,n)}),(0,a["default"])(r,"account:settings",function(e){var t=this;e.data.services.forEach(function(n){switch(n.xmlns){case"tigertext:iq:update:account":var r=n.account||e.data.token;t.host.users.refresh(r);break;case"tigertext:iq:update:org_settings":t.host.organizations.refreshAll();break;default:t.logger.warn("unhandled account:settings service type "+n.xmlns)}})}),(0,a["default"])(r,"message:is_typing",function(e){this.host.typingStatus.reactToIsTypingEvent(e)}),(0,a["default"])(r,"push:credentials",function(e){}),(0,a["default"])(r,"remote_wipe",function(e){this.host.wipe()}),(0,a["default"])(r,"validated",function(e){this.logger.warn("validated not implemented")}),(0,a["default"])(r,"msg:metadata_update",function(e){this.logger.warn("msg:metadata_update not implemented")}),(0,a["default"])(r,"conversation_mute",function(e){this.logger.warn("conversation_mute not implemented")}),(0,a["default"])(r,"reconnect",function(e){this.host.events.reconnect()}),(0,a["default"])(r,"push:credentials",_.noop),(0,a["default"])(r,"sse:heartbeat",_.noop),r);var i=[];return E["default"].each(o.EVENTS,function(e,t){t.includes("|")&&(i.push(t),t.split("|").forEach(function(t){return o.EVENTS[t]=e}))}),i.forEach(function(e){return delete o.EVENTS[e]}),o}return(0,v["default"])(t,e),(0,p["default"])(t,[{key:"emit",value:function(e){this.EVENTS[e.type]?this.EVENTS[e.type].call(this,e):this.logger.error("unhandled event: "+e.type,e.data)}}]),t}(b["default"]);t["default"]=x,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/helpers/defineProperty")},function(e,t){e.exports=require("babel-runtime/helpers/objectWithoutProperties")},function(e,t){e.exports=require("node-noop")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a,i,s=n(49),u=r(s),c=n(17),f=r(c),d=n(8),l=r(d),p=n(12),y=r(p),h=n(11),g=r(h),v=n(13),m=r(v),b=n(23),w=r(b),E=n(14),_=r(E),x=n(15),k=r(x),j=n(24),I=r(j),O=n(25),T=r(O),A=n(51),M=r(A),G=n(57),V=r(G),C=n(31),z=r(C),S=n(58),P=(0,S.classWithPrivateMethods)((i=function(e){function t(e,n){(0,_["default"])(this,t);var r=(0,I["default"])(this,(0,w["default"])(t).call(this,e,n));return r._throtelled_flushQueuedAcks=z["default"].throttle(r._flushQueuedAcks.bind(r),r.config.flushAckInterval,{leading:!1}),r}return(0,T["default"])(t,e),(0,k["default"])(t,[{key:"mounted",value:function(){this._queuedAcks=[],this._statsByEventType={}}},{key:"dispose",value:function(){this._queuedAcks=null,this._statsByEventType=null,this._throtelled_flushQueuedAcks.cancel&&this._throtelled_flushQueuedAcks.cancel()}},{key:"connect",value:function(){var e=(0,m["default"])(y["default"].mark(function t(){var e,n=this;return y["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.host.requireUser(),!this.eventSource){t.next=4;break}return this.logger.warn("already connected"),t.abrupt("return");case 4:return e=this.config.baseUrl+"/events",this.logger.info("connecting events"),this.eventSource=new V["default"](e,{headers:{Authorization:this.httpClient.getAuthHeader(),"TT-X-Features":this.config.eventsFeatures}}),t.abrupt("return",new g["default"](function(e,t){var r=void 0;n.eventSource.addEventListener("open",function(){n.logger.info("open"),r=!0,e()}),n.eventSource.addEventListener("message",n._onEvent.bind(n)),n.eventSource.addEventListener("error",function(e){r||t(),n._onError(e)}),n.eventSource.addEventListener("close",function(){n.logger.info("close")})}));case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){this.eventSource&&this.eventSource.close(),this.eventSource=null}},{key:"reconnect",value:function(){this.eventSource&&this.disconnect(),this.connect()}},{key:"_onEvent",value:function(e){var t=this,n=e.data;if(n.includes("\n"))return void n.split("\n").forEach(function(e){return t._onEvent({data:e})});var r=n;try{n=JSON.parse(r)}catch(o){throw this.logger.error("error parsing ",r),o}var a=n.event_id,i=(0,l["default"])(n.event)[0],s=i.replace("tigertext:iq:",""),u=n.event[i];this._statsByEventType[s]||(this._statsByEventType[s]={count:0}),this._statsByEventType[s].count++,this.logger.info("incoming",s,u);var c=new this.host.models.Event(a,s,u,{_origData:r});try{this.host.eventRouter.emit(c),this.emit("event",c),this.config.autoAckEvents&&this.__queueAck(a)}catch(o){throw this.logger.error("error in event "+s,o,o.stack,{data:u}),o}}},{key:"_onError",value:function(e){var t=this;this.logger.warn("error",e,e.message||"",e.status||""),this.disconnect(),this.config.eventsAutoReconnect&&setTimeout(function(){t.connect()},this.config.eventsAutoReconnectDelay)}},{key:"__queueAck",value:function(e){var t;e=z["default"].arrayWrap(e),(t=this._queuedAcks).push.apply(t,(0,f["default"])(e)),e.length>=this.config.flushAckMaxEvents?(this.logger.log("reached "+this.config.flushAckMaxEvents+" -- flushing"),this._flushQueuedAcks()):this._throtelled_flushQueuedAcks()}},{key:"_flushQueuedAcks",value:function(){this._queuedAcks.length>0&&(this.ack(this._queuedAcks),this._queuedAcks.length=0)}},{key:"ack",value:function(){var e=(0,m["default"])(y["default"].mark(function t(e){return y["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.host.requireUser(),e=z["default"].arrayWrap(e),this.logger.log("ack",e),t.prev=3,t.next=6,this.httpClient.post("/events/ack",{data:{events:e}});case 6:t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](3),this.logger.warn("some events not acked",e);case 11:case"end":return t.stop()}},t,this,[[3,8]])}));return function(t){return e.apply(this,arguments)}}()}]),t}(M["default"]),o(i.prototype,"_onEvent",[S.privateMethod],(0,u["default"])(i.prototype,"_onEvent"),i.prototype),o(i.prototype,"_onError",[S.privateMethod],(0,u["default"])(i.prototype,"_onError"),i.prototype),o(i.prototype,"__queueAck",[S.privateMethod],(0,u["default"])(i.prototype,"__queueAck"),i.prototype),o(i.prototype,"_flushQueuedAcks",[S.privateMethod],(0,u["default"])(i.prototype,"_flushQueuedAcks"),i.prototype),a=i))||a;t["default"]=P,e.exports=t["default"]},function(e,t){e.exports=require("eventsource")},function(e,t){e.exports=require("class-private-method-decorator")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,b["default"])(e);if(!Array.isArray(e)){var o=(0,v["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,h["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,b["default"])(u))?u.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,b["default"])(e);if(!Array.isArray(e)){var o=(0,v["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,h["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(s+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+s+"\n"+a+"}":"{\n  "+a+s+"\n"+a+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,b["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var s,u,c,f,d,l,p,y=n(7),h=r(y),g=n(8),v=r(g),m=n(9),b=r(m),w=n(49),E=r(w),_=n(60),x=r(_),k=n(61),j=r(k),I=n(11),O=r(I),T=n(10),A=r(T),M=n(12),G=r(M),V=n(45),C=r(V),z=n(13),S=r(z),P=n(23),N=r(P),R=n(14),U=r(R),q=n(15),$=r(q),D=n(24),F=r(D),B=n(25),L=r(B),K=n(51),Z=r(K),W=n(31),H=r(W),Y=n(32),X=n(58),Q=n(62),J=r(Q),ee=n(63),te=n(72),ne=r(te),re=n(21),oe=r(re),ae=n(73),ie=r(ae),se=(s=(0,Y.decorator)(),u=(0,Y.decorator)(),c=(0,Y.decorator)({memoize:!0}),f=(0,Y.decorator)(),d=(0,Y.decorator)(),(0,X.classWithPrivateMethods)((p=function(e){function t(){var e;(0,U["default"])(this,t);for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var a=(0,F["default"])(this,(e=(0,N["default"])(t)).call.apply(e,[this].concat(r)));return a._throtelled_flushQueueMessageStatuses=a.config.flushSetMessageStatusInterval?H["default"].throttle(a.__flushQueueMessageStatuses,a.config.flushSetMessageStatusInterval,{leading:!1}):a.__flushQueueMessageStatuses,a}return(0,L["default"])(t,e),(0,$["default"])(t,[{key:"mounted",value:function(){this._queuedMessageStatuses={deliveredIds:[],readIds:[]}}},{key:"dispose",value:function(){this._queuedMessageStatuses=null,Y.decorator.clear(this.downloadAttachmentURL)}},{key:"sendToConversation",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e,n){var r,o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(null==o||o instanceof Object){t.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+i(o));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if(null==o||o instanceof Object){t.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+a(o));case 12:e=this._resolveModelId(e),r=this.host.conversations.getById(e),r||ne["default"].raise("conversationId","not-found","Conversation not found"),t.t0=r.counterPartyType,t.next="user"===t.t0?18:"group"===t.t0?19:20;break;case 18:return t.abrupt("return",this.sendToUser(r.counterPartyId,n,(0,C["default"])({},o,{organizationId:r.organizationId})));case 19:return t.abrupt("return",this.sendToGroup(r.counterPartyId,n,(0,C["default"])({},o,{organizationId:r.organizationId})));case 20:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendToUser",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e,n){var r,o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=o.organizationId,u=o.senderOrganizationId,c=o.recipientOrganizationId,f=o.metadata,d=o.attachmentFiles,l=o.attachmentFile;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(s?(u&&ne["default"].raise("senderOrganizationId","invalid","Cannot set senderOrganizationId if organizationId is set"),c&&ne["default"].raise("recipientOrganizationId","invalid","Cannot set recipientOrganizationId if organizationId is set"),u=c=s):u?c||(c=u):this.host.config.defaultOrganizationId?u=c=this.host.config.defaultOrganizationId:ne["default"].raise("senderOrganizationId or organizationId","required","Message is sent in the context of an organization. Provide `senderOrganizationId` or `organizationId` or set a default one with client.setDefaultOrganization(...)"),d=this.__validateAttachments(d||l),e=this._resolveModelId(e),this.host.users.getById(e)){t.next=24;break}return t.prev=12,t.next=15,this.host.users.find(e);case 15:r=t.sent,e=r.id,t.next=24;break;case 19:if(t.prev=19,t.t0=t["catch"](12),t.t0.code===oe["default"].NotFoundError.CODE){t.next=23;break}throw t.t0;case 23:return t.abrupt("return",this.__sendToUnknownUser(e,n,{organizationId:s,senderOrganizationId:u,recipientOrganizationId:c,metadata:f,attachmentFiles:d}));case 24:return t.abrupt("return",this.__send("user",e,n,{senderOrganizationId:u,recipientOrganizationId:c,metadata:f,attachmentFiles:d}));case 25:case"end":return t.stop()}},t,this,[[12,19]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"__sendToUnknownUser",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e,n){var r,o,s,u,c,f,d=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],l=(d.organizationId,d.senderOrganizationId),p=d.recipientOrganizationId,y=d.metadata,h=d.attachmentFiles;return d.attachmentFile,G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return r=J["default"].v4(),y&&(y=this.__normalizeMetadata(y)),p||(p=l),o=this.__getNextSortNumber(),t.next=14,this.host.api.messages.send({counterPartyId:e,body:n,senderOrganizationId:l,recipientOrganizationId:p,metadata:y,localId:r,attachment:h&&h[0]});case 14:return s=t.sent,t.next=17,this.host.users.find(e);case 17:return u=t.sent,c=this.host.conversations.ensureConversation("user",u.id,l),f=this.host.models.Message.inject({id:s.serverId,conversationId:c.id,counterParty:u,messageType:ee.MessageType.USER_SENT,body:n,senderOrganizationId:l,recipientOrganizationId:p,sortNumber:o,createdAt:new Date,senderId:this.host.getCurrentUser().id,direction:ee.MessageDirection.OUTGOING,senderStatus:ee.MessageSenderStatus.SENT,recipientStatus:ee.MessageRecipientStatus.NEW,serverId:null,metadata:y,ttl:s.ttl}),h&&this.__setMessageAttachments(f,h),this.host.emit("message:sending",f),this.host.emit("message:sent",f),t.abrupt("return",f);case 24:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendToGroup",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e,n){var r,o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=o.organizationId,u=o.metadata,c=o.attachmentFiles,f=o.attachmentFile;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e=this._resolveModelId(e),r=this.host.models.Group.get(e),r?s=r.organizationId:s||(this.host.config.defaultOrganizationId?s=this.host.config.defaultOrganizationId:ne["default"].raise("organizationId","required","Message is sent in the context of an organization. Provide `organizationId` or set a default one with client.setDefaultOrganization(...)")),c=this.__validateAttachments(c||f),t.abrupt("return",this.__send("group",e,n,{senderOrganizationId:s,metadata:u,attachmentFiles:c}));case 13:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendToNewGroup",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e,n){var r,o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=o.organizationId,u=o.groupName,c=o.groupMetadata,f=o.metadata,d=o.attachmentFiles,l=o.attachmentFile;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=6;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e=e.map(this._resolveModelId.bind(this)),0==e.length&&ne["default"].raise("userIds","required"),s||(this.host.config.defaultOrganizationId?s=this.host.config.defaultOrganizationId:ne["default"].raise("organizationId","required","Message is sent in the context of an organization. Provide `organizationId` or set a default one with client.setDefaultOrganization(...)")),t.next=13,this.__prepareGroupForUsers(s,e,u,{groupMetadata:c});case 13:return r=t.sent,t.abrupt("return",this.sendToGroup(r,n,{organizationId:s,metadata:f,attachmentFiles:d,attachmentFile:l}));case 15:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"__validateAttachments",value:function(e){return e=H["default"].arrayWrap(e),!H["default"].isEmpty(e)&&e.length>1&&ne["default"].raise("attachmentFiles","invalid","currently only a single attachment is supported"),e}},{key:"__normalizeMetadata",value:function(e){return e?H["default"].arrayWrap(e).map(function(e){return(0,C["default"])({mimetype:"application/json"},e)}):null}},{key:"__getNextSortNumber",value:function(){var e=(0,H["default"])(this.host.models.Message.getAll()).orderBy(["sortNumber"],["desc"]).first(),t=e?e.sortNumber:0,n=t+1e-6;return n}},{key:"__send",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e,n,r,o){var s,u,c,f,d,l=o.senderOrganizationId,p=o.recipientOrganizationId,y=o.metadata,h=o.attachmentFiles,g=arguments;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if(null!=g[3]&&"string"==typeof g[3].senderOrganizationId&&(null==g[3].recipientOrganizationId||"string"==typeof g[3].recipientOrganizationId)&&(null==g[3].metadata||Array.isArray(g[3].metadata)&&g[3].metadata.every(function(e){return e instanceof Object})||null==g[3].metadata||g[3].metadata instanceof Object)&&(null==g[3].attachmentFiles||Array.isArray(g[3].attachmentFiles)&&g[3].attachmentFiles.every(function(e){return"string"==typeof e||e instanceof Object}))){t.next=8;break}throw new TypeError("Value of argument 3 violates contract.\n\nExpected:\n{ senderOrganizationId: string;\n  recipientOrganizationId: ?string;\n  metadata: ?Array<Object> | ?Object;\n  attachmentFiles: ?Array<string | Object>;\n}\n\nGot:\n"+i(g[3]));case 8:if("string"==typeof e){t.next=10;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 10:if("string"==typeof n){t.next=12;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));
case 12:if("string"==typeof r){t.next=14;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 14:if(null!=g[3]&&"string"==typeof g[3].senderOrganizationId&&(null==g[3].recipientOrganizationId||"string"==typeof g[3].recipientOrganizationId)&&(null==g[3].metadata||Array.isArray(g[3].metadata)&&g[3].metadata.every(function(e){return e instanceof Object})||null==g[3].metadata||g[3].metadata instanceof Object)&&(null==g[3].attachmentFiles||Array.isArray(g[3].attachmentFiles)&&g[3].attachmentFiles.every(function(e){return"string"==typeof e||e instanceof Object}))){t.next=16;break}throw new TypeError("Value of argument 3 violates contract.\n\nExpected:\n{ senderOrganizationId: string;\n  recipientOrganizationId: ?string;\n  metadata: ?Array<Object> | ?Object;\n  attachmentFiles: ?Array<string | Object>;\n}\n\nGot:\n"+a(g[3]));case 16:return this.host.requireUser(),ne["default"].oneOf("counterPartyType",e,["user","group"]),ne["default"].notEmpty("counterPartyId",n),y&&(y=this.__normalizeMetadata(y)),p||(p=l),s=this.__getNextSortNumber(),u=this.host.conversations.ensureConversation(e,n,l),c=this.host.models.Message.createInstance({id:J["default"].v4(),conversationId:u.id,messageType:ee.MessageType.USER_SENT,counterPartyId:n,counterPartyType:e,body:r,senderOrganizationId:l,recipientOrganizationId:p,sortNumber:s,createdAt:new Date,senderId:this.host.getCurrentUser().id,direction:ee.MessageDirection.OUTGOING,senderStatus:ee.MessageSenderStatus.SENDING,$synced:!1,serverId:null,metadata:y}),"group"==e?(c.groupId=n,c.recipientStatus=ee.MessageRecipientStatus.NA):(c.recipientId=n,c.recipientStatus=ee.MessageRecipientStatus.NEW),h&&this.__setMessageAttachments(c,h),this.host.models.Message.inject(c),this.host.emit("message:sending",c),t.next=30,this.host.api.messages.send({counterPartyId:n,body:r,senderOrganizationId:l,recipientOrganizationId:p,metadata:y,attachment:h&&h[0],localId:c.id});case 30:if(f=t.sent,(0,A["default"])(c,{serverId:f.serverId,ttl:f.ttl,senderStatus:ee.MessageSenderStatus.SENT,$synced:!0}),"group"!=e){t.next=38;break}if(c.group&&!c.group.$temporary){t.next=36;break}return t.next=36,this.host.groups.find(c.groupId,{includeMembers:!0,bypassCache:!0});case 36:t.next=44;break;case 38:if(c.recipient&&!c.recipient.$temporary){t.next=44;break}return t.next=41,this.host.users.find(c.recipientId,{bypassCache:!0});case 41:d=t.sent,c.recipientId=d.id,c.counterPartyId=d.id;case 44:return this.host.models.Message.inject(c),this.host.emit("message:sent",c),t.abrupt("return",c);case 47:case"end":return t.stop()}},t,this)}));return function(t,n,r,o){return e.apply(this,arguments)}}()},{key:"__setMessageAttachments",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!Array.isArray(t)||!t.every(function(e){return"string"==typeof e||e instanceof Object}))throw new TypeError('Value of argument "attachmentFiles" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if(!Array.isArray(t)||!t.every(function(e){return"string"==typeof e||e instanceof Object}))throw new TypeError('Value of argument "attachmentFiles" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+a(t));e.attachments=t.map(this.__generateAttachmentDescriptor.bind(this))}},{key:"__generateAttachmentDescriptor",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "attachment" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "attachment" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));var t=void 0;"string"==typeof e||e instanceof Buffer||ne["default"].raise("attachment","invalid","attachment (string or Buffer) is invalid");var r=void 0,o=void 0,s=void 0,u=n(74),c=n(35),f=n(75),d=n(36);if("string"==typeof e)r=u.statSync(e).size,o=f.lookup(e),s=c.basename(e);else{var l=d(e);if(l){var p=l.ext,y=l.mime;s="attachment."+p,o=y}r=e.byteLength}return t={localPath:"string"==typeof e?e:null,localFile:e instanceof Buffer?e:null,name:s,size:r,contentType:o}}},{key:"__prepareGroupForUsers",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e,n,r,o){var a,i,s=this,u=o.groupMetadata;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=[this.host.getCurrentUser()].concat(n.map(function(e){return s.host.models.User.get(e)}).filter(Boolean)),r||(r=a.map(function(e){return e.displayName}).filter(Boolean).join(", ")||"Group"),t.next=4,this.host.groups.create({organizationId:e,name:r,replayHistory:!0,memberIds:n,metadata:u});case 4:return i=t.sent,t.abrupt("return",i);case 6:case"end":return t.stop()}},t,this)}));return function(t,n,r,o){return e.apply(this,arguments)}}()},{key:"onMessageRecalled",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));this.host.requireUser();var t=this._getMessageByServerId(e);t&&this._deleteLocalMessage(t)}},{key:"_deleteLocalMessage",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));this.host.models.Message.eject(e)}},{key:"recall",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e){var n,r;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),n=H["default"].arrayWrap(e),r=n.map(this.__recallSingle.bind(this)),t.next=9,O["default"].all(r);case 9:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"__recallSingle",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e){var n;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:if(n=this._resolveMessage(e),!n){t.next=17;break}if(n.senderId==this.host.getCurrentUser().id){t.next=8;break}throw new oe["default"].PermissionDeniedError(n,n.serverId,"recall");case 8:if(n.$synced!==!1){t.next=12;break}this._deleteLocalMessage(n),t.next=15;break;case 12:return t.next=14,this.host.api.messages.destroy(n.serverId);case 14:this._deleteLocalMessage(n);case 15:t.next=19;break;case 17:return t.next=19,this.host.api.messages.destroy(e);case 19:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"reactToMessageStatusEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=e.data.client_id,n=e.data.is_recalled;n?this.onMessageRecalled(t):this.__setMessageStatusPerRecipientFromServerData(t,H["default"].pick(e.data,["status","account_id","timestamp"]))&&this.__touchMessage(t)}},{key:"__setMessageStatusPerRecipientFromServerData",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(!(t instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(!(t instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(t));var n=ee.MessageRecipientStatus.resolve(t.status),r=t.account_id,o=t.timestamp;return this.setRecipientMessageStatus(e,r,n,o)}},{key:"setRecipientMessageStatus",value:function(e,t,n,r){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if(!(null==r||"string"==typeof r||null==r||r instanceof Date))throw new TypeError('Value of argument "createdAt" violates contract.\n\nExpected:\n?string | ?Date\n\nGot:\n'+i(r));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));if(!(null==r||"string"==typeof r||null==r||r instanceof Date))throw new TypeError('Value of argument "createdAt" violates contract.\n\nExpected:\n?string | ?Date\n\nGot:\n'+a(r));var o=this._getMessageByServerId(e);if(o){n=ee.MessageRecipientStatus.resolve(n),this._setSingleUserMessageRecipientMessageStatus(o,n);var s=H["default"].find(o.statusesPerRecipient,{userId:t});if(!s||this.__canChangeRecipientStatus(s.status,n)){var u=o.id+":"+t;return this.host.models.MessageStatusPerRecipient.inject({id:u,messageId:o.id,userId:t,status:n,createdAt:r})}}}},{key:"__touchMessage",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));var t=this._resolveMessage(e);this.host.models.Message.inject({id:t.id})}},{key:"_resolveMessage",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));return this.host.models.Message.is(e)?e:this.host.models.Message.get(e)||this._getMessageByServerId(e)}},{key:"_getMessageByServerId",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));return this.host.models.Message.is(e)?e:(0,H["default"])(this.host.models.Message.getAll()).find({serverId:e})}},{key:"_setSingleUserMessageRecipientMessageStatus",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));this.__canChangeRecipientStatus(e.recipientStatus,t)&&this.host.models.Message.inject({id:e.id,recipientStatus:t})}},{key:"__canChangeRecipientStatus",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "fromStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "toStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "fromStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "toStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return e===t?!1:e!==ee.MessageRecipientStatus.READ||t!=ee.MessageRecipientStatus.DELIVERED}},{key:"find",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e){var n,r,o,s,u;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),t.next=7,this.httpClient.get("/message/:id",{urlParams:{id:e}});case 7:return n=t.sent,r=n.data,o=n.data.recipient_token,t.next=12,this.__lookupCounterParty(o);case 12:if(s=t.sent,!s){t.next=17;break}r.counterParty=s,t.next=18;break;case 17:return t.abrupt("return",null);case 18:return u=this.host.models.Message.inject(r),t.next=21,this.findStatusesPerRecipient(u);case 21:return t.abrupt("return",u);case 22:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Message.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Message.getMulti(e)}},{key:"__lookupCounterParty",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e){var n,r,o,s,u,c,f,d,l,p,y,h,g,v,m,b;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:if(r=[{model:this.host.models.User,finder:(n=this.host.users).find.bind(n)},{model:this.host.models.Group,finder:(n=this.host.groups).find.bind(n)}],r&&("function"==typeof r[j["default"]]||Array.isArray(r))){t.next=7;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+a(r));case 7:if(r&&("function"==typeof r[j["default"]]||Array.isArray(r))){t.next=9;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+i(r));case 9:o=!0,s=!1,u=void 0,t.prev=12,c=(0,x["default"])(r);case 14:if(o=(f=c.next()).done){t.next=22;break}if(d=f.value.model,l=d.get(e),!l){t.next=19;break}return t.abrupt("return",l);case 19:o=!0,t.next=14;break;case 22:t.next=28;break;case 24:t.prev=24,t.t0=t["catch"](12),s=!0,u=t.t0;case 28:t.prev=28,t.prev=29,!o&&c["return"]&&c["return"]();case 31:if(t.prev=31,!s){t.next=34;break}throw u;case 34:return t.finish(31);case 35:return t.finish(28);case 36:if(r&&("function"==typeof r[j["default"]]||Array.isArray(r))){t.next=38;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+a(r));case 38:if(r&&("function"==typeof r[j["default"]]||Array.isArray(r))){t.next=40;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+i(r));case 40:p=!0,y=!1,h=void 0,t.prev=43,g=(0,x["default"])(r);case 45:if(p=(v=g.next()).done){t.next=62;break}return m=v.value.finder,t.prev=47,t.next=50,m(e);case 50:if(b=t.sent,!b){t.next=53;break}return t.abrupt("return",b);case 53:t.next=59;break;case 55:if(t.prev=55,t.t1=t["catch"](47),t.t1.code==oe["default"].NotFoundError.CODE){t.next=59;break}throw t.t1;case 59:p=!0,t.next=45;break;case 62:t.next=68;break;case 64:t.prev=64,t.t2=t["catch"](43),y=!0,h=t.t2;case 68:t.prev=68,t.prev=69,!p&&g["return"]&&g["return"]();case 71:if(t.prev=71,!y){t.next=74;break}throw h;case 74:return t.finish(71);case 75:return t.finish(68);case 76:return t.abrupt("return",null);case 77:case"end":return t.stop()}},t,this,[[12,24,28,36],[29,,31,35],[43,64,68,76],[47,55],[69,,71,75]])}));return function(t){return e.apply(this,arguments)}}()},{key:"downloadAttachmentURL",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e,n){var r;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||"number"==typeof n){t.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n||"number"==typeof n){t.next=8;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(n));case 8:t.next=17;break;case 13:return r=t.sent,t.abrupt("return",r);case 17:throw new Error("On Node.js use `downloadImageToFile`");case 18:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"downloadAttachmentToFile",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e,n,r){var o,s;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||"number"==typeof n){t.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "dest" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if("string"==typeof n||"number"==typeof n){t.next=10;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "dest" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return o=this._resolveMessage(e),n=n.toString(),t.next=17,this.httpClient.downloadImageToFile("/message/"+o.serverId+"/attachment/"+n,r);case 17:return s=t.sent,t.abrupt("return",s);case 21:throw new Error("On Node.js use `downloadImageToFile`");case 22:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e){return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),t.next=7,this.httpClient["delete"]("/message/:id",{urlParams:{id:e}});case 7:return t.abrupt("return",null);case 8:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getMessageCount",value:function(){return this.host.models.Message.getAll().length}},{key:"getTotalUnreadCount",value:function(){return H["default"].sumBy(this.host.models.Conversation.getAll(),"unreadCount")}},{key:"markAsRead",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=n.queue,o=void 0===r?!0:r;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+a(e));case 4:if(e=(0,H["default"])(e).chain().arrayWrap().map(this._resolveModelId.bind(this)).uniq().value(),!o){t.next=9;break}return t.abrupt("return",this.__queueMessageStatuses({readIds:e}));case 9:return t.abrupt("return",this.__setMessagesStatus({readIds:e}));case 10:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"markAsDelivered",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=n.queue,o=void 0===r?!0:r;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+a(e));case 4:if(e=(0,H["default"])(e).chain().arrayWrap().map(this._resolveModelId.bind(this)).uniq().value(),!o){t.next=9;break}return t.abrupt("return",this.__queueMessageStatuses({deliveredIds:e}));case 9:return t.abrupt("return",this.__setMessagesStatus({deliveredIds:e}));case 10:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"markAsReceived",value:function(){var e=(0,S["default"])(G["default"].mark(function t(){var e=arguments;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.markAsDelivered.apply(this,e));case 1:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"__queueMessageStatuses",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e){var n,r=e.deliveredIds,o=e.readIds,s=arguments;return G["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=s[0]&&(null==s[0].deliveredIds||Array.isArray(s[0].deliveredIds)&&s[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(null==s[0].readIds||Array.isArray(s[0].readIds)&&s[0].readIds.every(function(e){return"string"==typeof e}))){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ deliveredIds: ?Array<string>;\n  readIds: ?Array<string>;\n}\n\nGot:\n"+i(s[0]));case 2:if(null!=s[0]&&(null==s[0].deliveredIds||Array.isArray(s[0].deliveredIds)&&s[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(null==s[0].readIds||Array.isArray(s[0].readIds)&&s[0].readIds.every(function(e){return"string"==typeof e}))){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ deliveredIds: ?Array<string>;\n  readIds: ?Array<string>;\n}\n\nGot:\n"+a(s[0]));case 4:if(r&&(this._queuedMessageStatuses.deliveredIds=H["default"].union(this._queuedMessageStatuses.deliveredIds,r)),o&&(this._queuedMessageStatuses.readIds=H["default"].union(this._queuedMessageStatuses.readIds,o)),n=this._queuedMessageStatuses.deliveredIds.length+this._queuedMessageStatuses.readIds.length,!(n>=this.config.flushMessageMaxCount)){e.next=12;break}return this.logger.log("reached "+this.config.flushMessageMaxCount+" -- flushing"),e.abrupt("return",this.__flushQueueMessageStatuses());case 12:this._throtelled_flushQueueMessageStatuses();case 13:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"__flushQueueMessageStatuses",value:function(){var e=this._queuedMessageStatuses.deliveredIds.length+this._queuedMessageStatuses.readIds.length;e>0&&(this.__setMessagesStatus(this._queuedMessageStatuses),this._queuedMessageStatuses.deliveredIds=[],this._queuedMessageStatuses.readIds=[])}},{key:"__setMessagesStatus",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e){var n,r,o,a=this,i=e.deliveredIds,s=void 0===i?[]:i,u=e.readIds,c=void 0===u?[]:u;return G["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),s=(0,H["default"])(s).chain().map(this._resolveModelId.bind(this)).uniq().value(),c=(0,H["default"])(c).chain().map(this._resolveModelId.bind(this)).uniq().value(),n=s.map(this._resolveMessage).filter(Boolean),r=c.map(this._resolveMessage).filter(Boolean),c=H["default"].difference(c,(0,H["default"])(r).filter(function(e){return e.recipientStatus===ee.MessageRecipientStatus.READ||e.recipientStatus==ee.MessageRecipientStatus.TO_BE_READ}).map("id").value()),s=H["default"].difference(s,c,(0,H["default"])(n).filter(function(e){return e.recipientStatus===ee.MessageRecipientStatus.DELIVERED||e.recipientStatus===ee.MessageRecipientStatus.READ||e.recipientStatus==ee.MessageRecipientStatus.TO_BE_READ}).map("id").value()),o={},s.length&&(o.delivered=s),c.length&&(o.read=c,r.forEach(function(e){return a.host.models.Message.inject({id:e.id,recipientStatus:ee.MessageRecipientStatus.TO_BE_READ})})),!H["default"].isEmpty(o.delivered)||!H["default"].isEmpty(o.read)){e.next=12;break}return e.abrupt("return",!1);case 12:return e.next=14,this.httpClient.post("/message/status",{data:o});case 14:c.length&&(o.read=c,r.forEach(function(e){return a.host.models.Message.inject({id:e.id,recipientStatus:ee.MessageRecipientStatus.READ})})),s.length&&n.forEach(function(e){return a.host.models.Message.inject({id:e.id,recipientStatus:ee.MessageRecipientStatus.DELIVERED})});case 16:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findStatusesPerRecipient",value:function(){var e=(0,S["default"])(G["default"].mark(function t(e){var n,r,o,s,u=this;return G["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:if(this.host.requireUser(),n=this._resolveMessage(e)){t.next=8;break}return t.abrupt("return",null);case 8:t.t0=n.counterPartyType,t.next="group"===t.t0?11:"user"===t.t0?21:23;break;case 11:return t.next=13,this.httpClient.get("/message/:id/status",{urlParams:{id:n.serverId}});case 13:if(r=t.sent,o=r.data,!o.is_recalled){t.next=18;break}return this.onMessageRecalled(n.serverId),t.abrupt("return");case 18:return s=o.statuses.map(function(e){return u.__setMessageStatusPerRecipientFromServerData(n.serverId,e)}).some(function(e){return e}),s&&this.__touchMessage(n),t.abrupt("break",23);case 21:return this.setRecipientMessageStatus(n.serverId,n.counterPartyId,n.recipientStatus,null)&&this.__touchMessage(n),t.abrupt("break",23);case 23:return t.abrupt("return",n.statusesPerRecipient);case 24:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(Z["default"]),o(p.prototype,"__sendToUnknownUser",[X.privateMethod],(0,E["default"])(p.prototype,"__sendToUnknownUser"),p.prototype),o(p.prototype,"__validateAttachments",[X.privateMethod],(0,E["default"])(p.prototype,"__validateAttachments"),p.prototype),o(p.prototype,"__normalizeMetadata",[X.privateMethod],(0,E["default"])(p.prototype,"__normalizeMetadata"),p.prototype),o(p.prototype,"__getNextSortNumber",[X.privateMethod],(0,E["default"])(p.prototype,"__getNextSortNumber"),p.prototype),o(p.prototype,"__send",[X.privateMethod],(0,E["default"])(p.prototype,"__send"),p.prototype),o(p.prototype,"__setMessageAttachments",[X.privateMethod],(0,E["default"])(p.prototype,"__setMessageAttachments"),p.prototype),o(p.prototype,"__generateAttachmentDescriptor",[X.privateMethod],(0,E["default"])(p.prototype,"__generateAttachmentDescriptor"),p.prototype),o(p.prototype,"__prepareGroupForUsers",[X.privateMethod,s],(0,E["default"])(p.prototype,"__prepareGroupForUsers"),p.prototype),o(p.prototype,"_deleteLocalMessage",[X.privateMethod],(0,E["default"])(p.prototype,"_deleteLocalMessage"),p.prototype),o(p.prototype,"__recallSingle",[X.privateMethod],(0,E["default"])(p.prototype,"__recallSingle"),p.prototype),o(p.prototype,"__setMessageStatusPerRecipientFromServerData",[X.privateMethod],(0,E["default"])(p.prototype,"__setMessageStatusPerRecipientFromServerData"),p.prototype),o(p.prototype,"__touchMessage",[X.privateMethod],(0,E["default"])(p.prototype,"__touchMessage"),p.prototype),o(p.prototype,"_resolveMessage",[X.privateMethod,ie["default"]],(0,E["default"])(p.prototype,"_resolveMessage"),p.prototype),o(p.prototype,"_getMessageByServerId",[X.privateMethod],(0,E["default"])(p.prototype,"_getMessageByServerId"),p.prototype),o(p.prototype,"_setSingleUserMessageRecipientMessageStatus",[X.privateMethod],(0,E["default"])(p.prototype,"_setSingleUserMessageRecipientMessageStatus"),p.prototype),o(p.prototype,"__canChangeRecipientStatus",[X.privateMethod],(0,E["default"])(p.prototype,"__canChangeRecipientStatus"),p.prototype),o(p.prototype,"find",[u],(0,E["default"])(p.prototype,"find"),p.prototype),o(p.prototype,"__lookupCounterParty",[X.privateMethod],(0,E["default"])(p.prototype,"__lookupCounterParty"),p.prototype),o(p.prototype,"downloadAttachmentURL",[c],(0,E["default"])(p.prototype,"downloadAttachmentURL"),p.prototype),o(p.prototype,"destroy",[f],(0,E["default"])(p.prototype,"destroy"),p.prototype),
o(p.prototype,"__queueMessageStatuses",[X.privateMethod],(0,E["default"])(p.prototype,"__queueMessageStatuses"),p.prototype),o(p.prototype,"__flushQueueMessageStatuses",[X.privateMethod,ie["default"]],(0,E["default"])(p.prototype,"__flushQueueMessageStatuses"),p.prototype),o(p.prototype,"__setMessagesStatus",[X.privateMethod],(0,E["default"])(p.prototype,"__setMessagesStatus"),p.prototype),o(p.prototype,"findStatusesPerRecipient",[d],(0,E["default"])(p.prototype,"findStatusesPerRecipient"),p.prototype),l=p))||l);t["default"]=se,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/get-iterator")},function(e,t){e.exports=require("babel-runtime/core-js/symbol/iterator")},function(e,t){e.exports=require("node-uuid")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={MessageRecipientStatus:n(64),MessageSenderStatus:n(67),MessageDirection:n(68),PresenceStatus:n(69),GroupType:n(70),MessageType:n(71)},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(31),a=r(o),i=n(65),s=r(i),u=new s["default"]({READ:{serverKey:"Read"},TO_BE_READ:{serverKey:"ToBeRead"},DELIVERED:{serverKey:"Delivered"},RECEIVED_ON_CLIENT:{serverKey:"ReceivedOnClient"},NEW:{serverKey:"New"},NA:{key:"NA"}}),c=a["default"].reduce(u.entries,function(e,t){return e[t.key]=t.serverKey,e},{}),f=a["default"].invert(c);u.fromServer=function(e){return f[e]},u.toServer=function(e){return c[e]||f[e]},u.resolve=function(e){return this.isValid(e)?e:this.fromServer(e)},t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=n(66),a=r(o),i=n(45),s=r(i),u=n(14),c=r(u),f=n(15),d=r(f),l=function(){function e(t){(0,c["default"])(this,e),Array.isArray(t)&&(t=t.reduce(function(e,t){return e[t]={},e},{})),this.keys=[],this.entries=[],this.entriesByKey={};for(var n in t){this[n]=n;var r=(0,s["default"])({key:n},t[n]);this.entriesByKey[n]=r,this.entries.push(r),this.keys.push(n)}(0,a["default"])(this.keys),(0,a["default"])(this.entries),(0,a["default"])(this.entriesByKey)}return(0,d["default"])(e,[{key:"resolve",value:function(e){return e}},{key:"isValid",value:function(e){return!!this.entriesByKey[e]}}]),e}();t["default"]=l,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/object/freeze")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(65),a=r(o),i=new a["default"](["SENDING","SENT","FAILED","NEW","NA"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(65),a=r(o),i=new a["default"](["INCOMING","OUTGOING"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(31),a=r(o),i=n(65),s=r(i),u=new s["default"]({UNKNOWN:{serverKey:"unknown"},AVAILABLE:{serverKey:"available"},UNAVAILABLE:{serverKey:"unavailable"}}),c=a["default"].reduce(u.entries,function(e,t){return e[t.key]=t.serverKey,e},{}),f=a["default"].invert(c);u.fromServer=function(e){return f[e]},u.resolve=function(e){return this.isValid(e)?e:this.fromServer(e)},t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(65),a=r(o),i=new a["default"](["GROUP","ROOM","DISTRIBUTION_LIST"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(65),a=r(o),i=new a["default"](["USER_SENT","GROUP_MEMBERSHIP_CHANGE"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),a=r(o),i=n(29),s=r(i),u={isOneOf:function(e,t,n){return n.includes(t)},isNotEmpty:function(e,t){return!!t},raise:function(e){var t=arguments.length<=1||void 0===arguments[1]?"invalid":arguments[1],n=arguments[2];throw new s["default"](e,t,n)}};(0,a["default"])(u).forEach(function(e){var t=e.replace(/^is([A-Z])/,function(e,t){return t.toLowerCase()}),n=u[e];u[t]=function(e,t,r){for(var o=arguments.length,a=Array(o>3?o-3:0),i=3;o>i;i++)a[i-3]=arguments[i];n.apply(void 0,[e,t,r].concat(a))||u.raise(e,void 0,r)}}),t["default"]=u,e.exports=t["default"]},function(e,t){e.exports=require("autobind-decorator")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("mime")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,v["default"])(e);if(!Array.isArray(e)){var o=(0,h["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,v["default"])(u))?u.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,v["default"])(e);if(!Array.isArray(e)){var o=(0,h["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(s+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+s+"\n"+a+"}":"{\n  "+a+s+"\n"+a+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,v["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var s,u,c,f,d,l=n(7),p=r(l),y=n(8),h=r(y),g=n(9),v=r(g),m=n(49),b=r(m),w=n(45),E=r(w),_=n(11),x=r(_),k=n(17),j=r(k),I=n(12),O=r(I),T=n(13),A=r(T),M=n(23),G=r(M),V=n(14),C=r(V),z=n(15),S=r(z),P=n(24),N=r(P),R=n(25),U=r(R),q=n(51),$=r(q),D=n(21),F=r(D),B=n(31),L=r(B),K=n(32),Z=n(58),W=(s=(0,K.decorator)(),u=(0,K.decorator)({memoize:!0}),c=(0,K.decorator)(),(0,Z.classWithPrivateMethods)((d=function(e){function t(){return(0,C["default"])(this,t),(0,N["default"])(this,(0,G["default"])(t).apply(this,arguments))}return(0,U["default"])(t,e),(0,S["default"])(t,[{key:"dispose",value:function(){K.decorator.clear(this.findAll)}},{key:"create",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e){var n,r,o=e.organizationId,a=e.name,i=e.avatarFile,s=e.replayHistory,u=void 0===s?!0:s,c=e.memberIds,f=void 0===c?[]:c,d=e.metadata;return O["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),o){e.next=3;break}throw new F["default"].ValidationError("organizationId","required");case 3:return f=f.map(this._resolveModelId.bind(this)),f.includes(this.host.getCurrentUser().id)||f.unshift(this.host.getCurrentUser().id),e.next=7,this.host.api.groups.create({name:a,avatarFile:i,replayHistory:u,memberIds:f,organizationId:o});case 7:if(n=e.sent,r=this.host.models.Group.inject(n),!d){e.next=12;break}return e.next=12,this.host.metadata.update(r.id,d,o);case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e,n){var r,o=n.name,s=n.avatarFile,u=n.replayHistory,c=n.memberIds,f=n.metadata;return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),e=this._resolveModelId(e),c.includes(this.host.getCurrentUser().id)||c.unshift(this.host.getCurrentUser().id),t.next=9,this.host.api.groups.update(e,{name:o,avatarFile:s,replayHistory:u,memberIds:c});case 9:if(r=this.host.models.Group.inject({id:e,name:o,replayHistory:u,memberIds:c}),!f){t.next=13;break}return t.next=13,this.host.metadata.update(e,f,r.organizationId);case 13:return t.abrupt("return",r);case 14:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e){var n,r,o,s=this,u=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:if(u=L["default"].defaults(u,{ignoreNotFound:!1,bypassCache:!1,includeMembers:!1,includeMetadata:!1}),this.host.requireUser(),n=null,u.bypassCache){t.next=11;break}if(n=this.host.models.Group.get(e),!n){t.next=11;break}return t.abrupt("return",n);case 11:return t.next=13,this.host.api.groups.find(e);case 13:if(r=t.sent,!r){t.next=19;break}n=this.host.models.Group.inject(r),delete n.$temporary,t.next=21;break;case 19:if(u.ignoreNotFound){t.next=21;break}throw new F["default"].NotFoundError(this.host.models.Group.name,e);case 21:if(!n){t.next=28;break}if(o=[],u.includeMetadata&&o.push(this.host.metadata.find(e,n.organizationId)),u.includeMembers&&o.push.apply(o,(0,j["default"])(n.memberIds.map(function(e){return s.host.users.find(e,{ignoreNotFound:!0})}))),!(o.length>0)){t.next=28;break}return t.next=28,x["default"].all(o);case 28:return t.abrupt("return",n);case 29:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findAll",value:function(){var e=(0,A["default"])(O["default"].mark(function t(){var e,n,r,o,a,i=this,s=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],u=s.includeMembers,c=void 0===u?!1:u,f=s.includeMetadata,d=void 0===f?!1:f;return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.host.models.Organization.getAll(),0!=e.length){t.next=5;break}return t.next=4,this.host.organizations.findAll();case 4:e=t.sent;case 5:return t.next=7,this.host.search.query({types:["group"],organizationIds:e.map(function(e){return e.id}),query:{displayName:""},includeMetadata:d});case 7:if(n=t.sent,r=n.map(function(e){return e.entity}),!c){t.next=16;break}if(o=[],a=(0,L["default"])(r).map("memberIds").flatten().uniq().value(),o.push.apply(o,(0,j["default"])(a.map(function(e){return i.host.users.find(e,{ignoreNotFound:!0})}))),!(o.length>0)){t.next=16;break}return t.next=16,x["default"].all(o);case 16:return t.abrupt("return",r);case 17:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findAllWithSpecificMembers",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e,n){var r;return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(e));case 2:if("string"==typeof n||n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=6;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(e));case 6:if("string"==typeof n||n instanceof Object){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:if(n=this._resolveModelId(n),e=L["default"].arrayWrap(e).map(this._resolveModelId.bind(this)),L["default"].contain(e,this.host.getCurrentUser().id),r=this.__findAllLocalWithSpecificMembers(e,n),0!==r.length){t.next=16;break}return t.next=15,this.findAll();case 15:r=this.__findAllLocalWithSpecificMembers(e,n);case 16:return t.abrupt("return",r);case 17:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"ensureMembers",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e){var n=this;return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));case 2:if(e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));case 4:e.memberIds.forEach(function(e){var t;n.host.models.User.ensureEntityOrCreateTemporaryAndFind({id:e,displayName:"Loading..."},{finder:(t=n.host.users).find.bind(t)})});case 5:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Group.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Group.getMulti(e)}},{key:"__findAllLocalWithSpecificMembers",value:function(e,t){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));var n=this.host.models.Group.getAll(),r=L["default"].filter(n,function(n){return n.organizationId==t&&0==L["default"].xor(n.memberIds,e).length});return r}},{key:"destroy",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e){var n;return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),e=this._resolveModelId(e),t.next=8,this.host.api.groups.destroy(e);case 8:if(n=t.sent){t.next=11;break}throw new F["default"].NotFoundError(this.host.models.Group.name,e);case 11:return this.host.models.Group.eject(e),t.abrupt("return",null);case 13:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findAllMemberIds",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e){var n;return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return this.host.requireUser(),e=this._resolveModelId(e),t.next=8,this.httpClient.get("/group/:id/members",{urlParams:{id:e}});case 8:return n=t.sent,t.abrupt("return",n.data);case 10:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addMembers",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e,n){return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){t.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(n));case 8:return this.host.requireUser(),e=this._resolveModelId(e),n=L["default"].arrayWrap(n).map(this._resolveModelId.bind(this)),t.next=13,this.httpClient.post("/group/:id/members",{urlParams:{id:e},data:{members:n}});case 13:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeMembers",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e,n){return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){t.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(n));case 8:return this.host.requireUser(),e=this._resolveModelId(e),n=L["default"].arrayWrap(n).map(this._resolveModelId.bind(this)),t.next=13,this.httpClient.post("/group/:id/members/remove",{urlParams:{id:e},data:{members:n}});case 13:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"addMember",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e,n){return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n||n instanceof Object){t.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:return t.abrupt("return",this.addMembers(e,[n]));case 9:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeMember",value:function(){var e=(0,A["default"])(O["default"].mark(function t(e,n){return O["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n||n instanceof Object){t.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:return t.abrupt("return",this.removeMembers(e,[n]));case 9:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"reactToBangEvent",value:function(e){switch(e.data.event){case"added":this.__addedToGroup(e);break;case"removed":this.__removedFromGroup(e)}}},{key:"__addedToGroup",value:function(e){var t=e.data.caller_entity,n=e.data.subject_entity,r=e.data.target_entity;if(t&&t.token&&r&&r.token&&n&&n.token){var o=this.host.injectModel(t),a=this.host.injectModel(n),i=this.host.injectModel((0,E["default"])({organizationId:e.data.organization_id},r)),s=!1;[o.id,a.id].forEach(function(e){i.memberIds.includes(e)||(s=!0,i.memberIds=[].concat((0,j["default"])(i.memberIds),[e]))}),s&&(this.host.models.Group.inject(i),this.emit("membership:change",{id:e.id,sortNumber:+e.data.sort_number,action:"ADD",actor:o,actorId:o.id,group:i,groupId:i.id,members:[a],memberIds:[a.id]}))}}},{key:"__removedFromGroup",value:function(e){var t=e.data.caller_entity,n=e.data.subject_entity,r=e.data.target_entity;if(t&&t.token&&r&&r.token&&n&&n.token){var o=this.host.injectModel(t),a=this.host.models.Group.get(r.token);if(a&&a.memberIds){var i=this.host.injectModel(n);if(a.memberIds.includes(i.id)){a.memberIds=L["default"].pull(a.memberIds,i.id);var s=i.id===o.id?"LEAVE":"REMOVE";this.emit("membership:change",{id:e.id,sortNumber:+e.data.sort_number,action:s,actor:o,actorId:o.id,group:a,groupId:a.id,members:[i],memberIds:[i.id]})}}}}}]),t}($["default"]),o(d.prototype,"find",[s],(0,b["default"])(d.prototype,"find"),d.prototype),o(d.prototype,"findAll",[u],(0,b["default"])(d.prototype,"findAll"),d.prototype),o(d.prototype,"findAllWithSpecificMembers",[c],(0,b["default"])(d.prototype,"findAllWithSpecificMembers"),d.prototype),o(d.prototype,"__findAllLocalWithSpecificMembers",[Z.privateMethod],(0,b["default"])(d.prototype,"__findAllLocalWithSpecificMembers"),d.prototype),o(d.prototype,"__addedToGroup",[Z.privateMethod],(0,b["default"])(d.prototype,"__addedToGroup"),d.prototype),o(d.prototype,"__removedFromGroup",[Z.privateMethod],(0,b["default"])(d.prototype,"__removedFromGroup"),d.prototype),f=d))||f);t["default"]=W,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,y["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,g["default"])(u))?u.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,y["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(s+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+s+"\n"+a+"}":"{\n  "+a+s+"\n"+a+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,g["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var s,u,c,f,d=n(7),l=r(d),p=n(8),y=r(p),h=n(9),g=r(h),v=n(49),m=r(v),b=n(45),w=r(b),E=n(12),_=r(E),x=n(13),k=r(x),j=n(23),I=r(j),O=n(14),T=r(O),A=n(15),M=r(A),G=n(24),V=r(G),C=n(25),z=r(C),S=n(51),P=r(S),N=n(32),R=n(21),U=r(R),q=n(31),$=r(q),D=n(78),F=r(D),B=n(79),L=r(B),K=n(73),Z=r(K),W=n(58),H=(s=(0,N.decorator)({memoize:!0}),u=(0,N.decorator)(),(0,W.classWithPrivateMethods)((f=function(e){function t(){return(0,T["default"])(this,t),(0,V["default"])(this,(0,I["default"])(t).apply(this,arguments))}return(0,z["default"])(t,e),(0,M["default"])(t,[{key:"mounted",value:function(){this.host.models.Conversation.on("afterInject",this._onConversationChange),this.host.models.Conversation.on("afterEject",this._onConversationChange)}},{key:"dispose",value:function(){this.host.models.Conversation.off("afterInject",this._onConversationChange),this.host.models.Conversation.off("afterEject",this._onConversationChange),N.decorator.clear(this.findAll)}},{key:"create",value:function(){var e=(0,k["default"])(_["default"].mark(function t(){var e=this,n=arguments.length<=0||void 0===arguments[0]?{name:void 0,ttl:void 0,dor:void 0,allowPublicGroups:void 0,pinLock:void 0,settingsRestricted:void 0,autologoutTime:void 0,lifecycleCallback:void 0,groupLifespan:void 0,welcomeEmailSettings:void 0}:arguments[0];return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.host.requireUser(),t.abrupt("return",this.httpClient.post("/organization",{data:n}).then(function(t){var r=t.getHeader("TT-X-Organization-Key"),o=e.host.models.Organization.inject({id:r,name:n.name});return o}));case 2:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,k["default"])(_["default"].mark(function t(){var e,n=this,r=arguments.length<=0||void 0===arguments[0]?{id:void 0,name:void 0,ttl:void 0,dor:void 0,allowPublicGroups:void 0,pinLock:void 0,settingsRestricted:void 0,autologoutTime:void 0,lifecycleCallback:void 0,groupLifespan:void 0,welcomeEmailSettings:void 0,welcomeEmailLogo:void 0,autoSendWelcomeEmail:void 0}:arguments[0];return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.host.requireUser(),e=F["default"].underscoreObject({name:r.name,ttl:r.ttl,dor:r.dor,allowPublicGroups:r.allowPublicGroups,pinLock:r.pinLock,settingsRestricted:r.settingsRestricted,autologoutTime:r.autologoutTime,lifecycleCallback:r.lifecycleCallback,groupLifespan:r.groupLifespan,welcomeEmailSettings:r.welcomeEmailSettings,welcomeEmailLogo:r.welcomeEmailLogo,autoSendWelcomeEmail:r.autoSendWelcomeEmail}),t.abrupt("return",this.httpClient.post("/organization/:id",{urlParams:{id:r.id},data:e}).then(function(t){var o=n.host.models.Organization.inject((0,w["default"])({id:r.id},e));return o}));case 3:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findAll",value:function(){var e=(0,k["default"])(_["default"].mark(function t(){var e,n=this,r=arguments.length<=0||void 0===arguments[0]?{onlyApproved:!1}:arguments[0];return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.host.requireUser(),t.next=3,this._findAll();case 3:return e=t.sent,r.onlyApproved&&(e=$["default"].filter(e,{pending:!1})),e=$["default"].sortBy(e,function(e){return e.name.toLowerCase()}),e.forEach(function(e){return n.__reloadConversations(e)}),t.abrupt("return",e);case 8:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAll",value:function(){var e=(0,k["default"])(_["default"].mark(function t(){return _["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._findAll();case 2:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments);
}}()},{key:"_findAll",value:function(){var e=(0,k["default"])(_["default"].mark(function t(){var e,n=this;return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.host.api.organizations.findAllOfUser(this.host.getCurrentUser().id);case 2:return e=t.sent,e=e.map(function(e){return n.host.models.Organization.inject(e)}),t.abrupt("return",e);case 5:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,k["default"])(_["default"].mark(function t(e){var n,r,o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return _["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:if(o=$["default"].defaults(o,{ignoreNotFound:!1,bypassCache:!1}),this.host.requireUser(),n=void 0,o.bypassCache){t.next=11;break}if(n=this.host.models.Organization.get(e),!n){t.next=11;break}return t.abrupt("return",n);case 11:return t.next=13,this.host.api.organizations.find(this.host.getCurrentUser().id,e);case 13:if(r=t.sent,!r){t.next=19;break}n=this.host.models.Organization.inject(r),this.__reloadConversations(n),t.next=21;break;case 19:if(o.ignoreNotFound){t.next=21;break}throw new U["default"].NotFoundError(this.host.models.Organization.name,e);case 21:return t.abrupt("return",n);case 22:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Organization.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Organization.getMulti(e)}},{key:"_onConversationChange",value:function(e,t){this.__reloadConversations(t.organization)}},{key:"__reloadConversations",value:function(e){if(e){var t=$["default"].pick(e,["conversations","unreadCount"]),n=(0,$["default"])(this.host.models.Conversation.getAll()).filter({organizationId:e.id}).orderBy(["lastEventMessageSortNumber","_origIndex"],["desc","asc"]).value(),r=$["default"].sumBy(n,function(e){return e.unreadCount}),o={conversations:n,unreadCount:r},a=!1;$["default"].each(t,function(t,n){(0,L["default"])(t,o[n])||(e[n]=o[n],a=!0)}),a&&this.host.models.Organization.inject(e)}}}]),t}(P["default"]),o(f.prototype,"findAll",[s],(0,m["default"])(f.prototype,"findAll"),f.prototype),o(f.prototype,"refreshAll",[N.decorator],(0,m["default"])(f.prototype,"refreshAll"),f.prototype),o(f.prototype,"_findAll",[W.privateMethod],(0,m["default"])(f.prototype,"_findAll"),f.prototype),o(f.prototype,"find",[u],(0,m["default"])(f.prototype,"find"),f.prototype),o(f.prototype,"_onConversationChange",[W.privateMethod,Z["default"]],(0,m["default"])(f.prototype,"_onConversationChange"),f.prototype),o(f.prototype,"__reloadConversations",[W.privateMethod],(0,m["default"])(f.prototype,"__reloadConversations"),f.prototype),c=f))||c);t["default"]=H,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){return s["default"].isArray(e)?e.map(function(e){return o(e,t)}):s["default"].isObject(e)?s["default"].transform(e,function(e,n,r){e[t(r)]=o(n,t)},{}):e}Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),i=(r(a),n(31)),s=r(i),u={camelizeKey:s["default"].memoize(s["default"].camelCase),underscoreKey:s["default"].memoize(s["default"].snakeCase),camelizeObject:function(e){return o(e,u.camelizeKey)},underscoreObject:function(e){return o(e,u.underscoreKey)}};t["default"]=u,e.exports=t["default"]},function(e,t){e.exports=require("shallowequal")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,v["default"])(e);if(!Array.isArray(e)){var o=(0,h["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,v["default"])(u))?u.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,v["default"])(e);if(!Array.isArray(e)){var o=(0,h["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(s+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+s+"\n"+a+"}":"{\n  "+a+s+"\n"+a+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,v["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var s,u,c,f,d,l=n(7),p=r(l),y=n(8),h=r(y),g=n(9),v=r(g),m=n(49),b=r(m),w=n(53),E=r(w),_=n(54),x=r(_),k=n(12),j=r(k),I=n(13),O=r(I),T=n(23),A=r(T),M=n(14),G=r(M),V=n(15),C=r(V),z=n(24),S=r(z),P=n(25),N=r(P),R=n(51),U=r(R),q=n(32),$=n(31),D=r($),F=n(50),B=r(F),L=n(79),K=r(L),Z=n(73),W=r(Z),H=n(58),Y=n(63),X=n(81),Q=r(X),J=new B["default"].MD5,ee=(s=(0,q.decorator)(),u=(0,q.decorator)(),c=(0,q.decorator)(),(0,H.classWithPrivateMethods)((d=function(e){function t(){var e;(0,G["default"])(this,t);for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var a=(0,S["default"])(this,(e=(0,A["default"])(t)).call.apply(e,[this].concat(r)));return a._fetched=!1,a._throtelled__flushConversationsToReload=a.config.conversationReloadDelay?a._throtelled__flushConversationsToReload=D["default"].throttle(a.__flushConversationsToReload,a.config.conversationReloadDelay,{leading:!1}):a.__flushConversationsToReload,a}return(0,N["default"])(t,e),(0,C["default"])(t,[{key:"mounted",value:function(){this.host.on("message:sending",this._onMessageSending),this.host.on("message:sent",this._onMessageSent),this.host.groups.on("membership:change",this._onGroupMembershipChange),this.host.models.Message.on("afterInject",this._onMessageChange),this.host.models.Message.on("afterEject",this._onMessageChange),this.host.models.Group.on("afterEject",this._onGroupDelete),this.__queuedConversationsToReload=[]}},{key:"dispose",value:function(){this._fetched=!1,this.host.removeListener("message:sending",this._onMessageSending),this.host.removeListener("message:sent",this._onMessageSent),this.host.groups.removeListener("membership:change",this._onGroupMembershipChange),this.host.models.Message.off("afterInject",this._onMessageChange),this.host.models.Message.off("afterEject",this._onMessageChange),this.host.models.Group.off("afterEject",this._onGroupDelete),this.__queuedConversationsToReload=null,this._throtelled__flushConversationsToReload.cancel&&this._throtelled__flushConversationsToReload.cancel()}},{key:"findAll",value:function(){var e=(0,O["default"])(j["default"].mark(function t(){var e,n,r=this;return j["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._fetched){t.next=2;break}return t.abrupt("return",this.getAll());case 2:return t.next=4,this.host.api.roster.findAll();case 4:return e=t.sent,n=e.map(function(e){var t=r.host.injectModel(e);delete t.$temporary;var n=e.organization_key;return{counterParty:t,organizationId:n}}).map(function(e){var t=e.counterParty,n=e.organizationId,o=r.ensureConversation(t.$entityType,t.id,n);return o._counterPartyAddedOnServer=!0,o}),this._fetched=!0,t.abrupt("return",n);case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"refetch",value:function(){var e=(0,O["default"])(j["default"].mark(function t(){return j["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._fetched=!1,e.abrupt("return",this.findAll());case 2:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=(0,O["default"])(j["default"].mark(function t(e,n,r){var o,s,u;return j["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return o={},r&&(o["TT-X-Organization-Key"]=r),s=this.host.typeNSByModelName(e),u=this.ensureConversation(e,n,r),t.prev=16,t.next=19,this.host.api.roster.add(e,n,r);case 19:t.next=24;break;case 21:t.prev=21,t.t0=t["catch"](16),this.logger.warn("can't add "+n+" "+s);case 24:u._counterPartyAddedOnServer=!0;case 25:case"end":return t.stop()}},t,this,[[16,21]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,O["default"])(j["default"].mark(function t(e,n,r){var o,s;return j["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return o={},r&&(o["TT-X-Organization-Key"]=r),s=this.host.typeNSByModelName(e),t.prev=15,t.next=18,this.host.api.roster.remove(e,n,r);case 18:this.ejectConversation(e,n,r),t.next=24;break;case 21:t.prev=21,t.t0=t["catch"](15),this.logger.warn("can't remove "+n+" "+s);case 24:case"end":return t.stop()}},t,this,[[15,21]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"ensureConversation",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=this.getConversationKey(e,t,n),o=this.get(e,t,n);return o?(this.__ensureEntities(o),o):(o=this.host.models.Conversation.createInstance({id:r,counterPartyType:e,counterPartyId:t,organizationId:n,_origIndex:this.host.models.Conversation.getAll().length}),this.__ensureEntities(o),this.host.models.Conversation.inject(o),this.__notifyOrganizationChange(o.organizationId),o)}},{key:"ejectConversation",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=this.get(e,t,n);return r&&(this.host.models.Conversation.eject(r),this.__notifyOrganizationChange(r.organizationId)),r}},{key:"reactToIncomingMessageEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.host.getCurrentUser().id,n=this.host.models.Message.parseAttrs(e.data);n.messageType=Y.MessageType.USER_SENT,n.direction=n.senderId==t?Y.MessageDirection.OUTGOING:Y.MessageDirection.INCOMING,n.groupId?(n.counterPartyType="group",n.counterPartyId=n.groupId):n.recipientId&&(n.counterPartyType="user",n.counterPartyId=n.senderId==t?n.recipientId:n.senderId),n.direction==Y.MessageDirection.OUTGOING?n.senderStatus=Y.MessageSenderStatus.SENT:n.senderStatus=Y.MessageSenderStatus.NA;var r=this.host.conversations.ensureConversation(n.counterPartyType,n.counterPartyId,n.senderOrganizationId);n.conversationId=r.id;var o=this.host.models.Message.createInstance(n);this.__ensureMessageEntities(o),this.host.models.Message.inject(o),this.emit("message",o),this.__addConversationCounterPartyToServerRosterIfShould(r),this.__queueReload(r),r.emit("message",o),this.__notifyOrganizationChange(r.organizationId),o.senderId!=t&&o.recipientStatus!=Y.MessageRecipientStatus.READ&&o.recipientStatus!=Y.MessageRecipientStatus.DELIVERED&&this.host.messages.markAsReceived(o)}},{key:"reactToFriendsEvent",value:function(e){var t=e.data.friend,n=t.action,r=t.organization_id,o=(0,x["default"])(t,["action","organization_id"]),a=r,i=this.host.modelByTypeNS(o.xmlns);if(!i)return void this.logger.error("Class "+o.xmlns+" not found");switch(n){case"add":"group"==i.name&&(o.organizationId=a);var s=this.host.injectModel(o);this.__addedByCounterParty(s,a);break;case"del":this.__removedByCounterParty(i.name,o.token,a);break;default:this.logger.error("friends action not implemented",n,e.data)}}},{key:"_onMessageSending",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.__ensureConversationFromMessage(e);this.__addConversationCounterPartyToServerRosterIfShould(t),this.__reloadConversation(t),this.__notifyOrganizationChange(t.organizationId)}},{key:"_onMessageSent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId);this.__reloadConversation(t),t.emit("message",e)}},{key:"_onMessageChange",value:function(e,t){t.conversation&&this.__queueReload(t.conversation)}},{key:"_onGroupDelete",value:function(e,t){this.ejectConversation("group",t.id,t.organizationId)}},{key:"__queueReload",value:function(e){D["default"].contain(this.__queuedConversationsToReload,e),this._throtelled__flushConversationsToReload()}},{key:"__flushConversationsToReload",value:function(){var e=this;this.__queuedConversationsToReload.forEach(function(t){return e.__reloadConversation(t)}),this.__queuedConversationsToReload.length=0}},{key:"__reloadConversation",value:function(e){var t=D["default"].pick(e,["messages","timeline","lastMessage","unreadMessages","unreadCount","lastEventMessageSortNumber"]),n={},r=(0,D["default"])(this.host.models.Message.getAll()).filter({conversationId:e.id}).orderBy(["sortNumber"],["asc"]).value(),o=D["default"].filter(r,{messageType:Y.MessageType.USER_SENT});n.timeline=r,n.messages=o,n.lastMessage=D["default"].last(o),n.unreadMessages=o.filter(function(e){return e.direction===Y.MessageDirection.INCOMING&&(e.recipientStatus===Y.MessageRecipientStatus.NEW||e.recipientStatus===Y.MessageRecipientStatus.DELIVERED)}),n.unreadCount=n.unreadMessages.length,n.lastEventMessageSortNumber=n.lastMessage&&n.lastMessage.sortNumber||0;var a=!1;D["default"].each(t,function(t,r){(0,K["default"])(t,n[r])||(e[r]=n[r],a=!0)}),a&&(this.host.models.Conversation.inject(e),e.emit("change"),this.emit("change",e))}},{key:"__notifyOrganizationChange",value:function(e){var t=this.host.models.Organization.get(e);t&&t.emit("change")}},{key:"__ensureConversationFromMessage",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId);return t}},{key:"__addConversationCounterPartyToServerRosterIfShould",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));e&&(e._counterPartyAddedOnServer||this.add(e.counterPartyType,e.counterPartyId,e.organizationId))}},{key:"_onGroupMembershipChange",value:function(e){var t=this.ensureConversation("group",e.group.id,e.group.organizationId);this.host.models.Message.inject({id:e.id,conversationId:t.id,groupId:e.groupId,sortNumber:e.sortNumber,messageType:Y.MessageType.GROUP_MEMBERSHIP_CHANGE,senderId:e.actorId,recipient:this.host.getCurrentUser(),direction:Y.MessageDirection.INCOMING,groupMembersChange:{action:e.action,members:e.members,memberIds:e.memberIds},body:this.__generateGroupMembershipChangeBody(e)}),this.__reloadConversation(t)}},{key:"__generateGroupMembershipChangeBody",value:function(e){var t,n;this.__ACTION_TEXT=this.__ACTION_TEXT||(t={},(0,E["default"])(t,"ADD","added"),(0,E["default"])(t,"REMOVE","removed"),(0,E["default"])(t,"LEAVE","left"),(0,E["default"])(t,"JOIN","joined"),t),this.__ACTION_PREPOSITION=this.__ACTION_PREPOSITION||(n={},(0,E["default"])(n,"ADD","to"),(0,E["default"])(n,"REMOVE","from"),n);var r=this.__ACTION_TEXT[e.action],o=this.__ACTION_PREPOSITION[e.action]||"",a=null;return"ADD"!==e.action&&"REMOVE"!==e.action||(a=(0,Q["default"])(e.members.filter(Boolean).map(function(e){return e.displayName}))),[e.actor.displayName,r,a,o,"this group"].filter(Boolean).join(" ")}},{key:"getMessageConversationKey",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if(e.groupId)return this.conversationHashForGroupId(e.groupId);var t=e.senderId==this.host.getCurrentUser().id?e.recipientId:e.senderId;return this.conversationHashForUserMessage(t,e.senderOrganizationId,e.recipientOrganizationId)}},{key:"getConversationKey",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?n:arguments[3];if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(n));if(null!=r&&"string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(r));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(n));if(null!=r&&"string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(r));switch(e){case"user":return this.conversationHashForUserMessage(t,n,r);case"group":return this.conversationHashForGroupId(t);default:throw new Error("type "+e+" not supported in conversation")}}},{key:"conversationHashForUserMessage",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?t:arguments[2],r=[e,t,n].join(":");return J.b64(r)}},{key:"conversationHashForGroupId",value:function(e){return J.b64(e)}},{key:"findConversationWithUser",value:function(){var e=(0,O["default"])(j["default"].mark(function t(e,n){return j["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return t.abrupt("return",this.get(this.host.models.User.name,e,n));case 9:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findConversationWithGroup",value:function(){var e=(0,O["default"])(j["default"].mark(function t(e,n){return j["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return t.abrupt("return",this.get(this.host.models.Group.name,e,n));case 9:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findAllGroupConversationsWithMembers",value:function(){var e=(0,O["default"])(j["default"].mark(function t(e,n){var r,o=this;return j["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=6;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e=D["default"].arrayWrap(e).map(this._resolveModelId.bind(this)),t.next=11,this.host.groups.findAllWithSpecificMembers(e,n);case 11:return r=t.sent,t.abrupt("return",r.map(function(e){return o.get(o.host.models.Group.name,e.id,n)}));case 13:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getWithGroup",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));e=this._resolveModelId(e);var t=this.conversationHashForGroupId(e);return this.getById(t)||null}},{key:"getWithUser",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));e=this._resolveModelId(e),t=this._resolveModelId(t);var n=this.conversationHashForUserMessage(e,t);return this.getById(n)||null}},{key:"get",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=this.getConversationKey(e,t,n),o=this.host.models.Conversation.get(r);return o||null}},{key:"getAll",value:function(){return this.host.models.Conversation.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Conversation.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Conversation.getMulti(e)}},{key:"__addedByCounterParty",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));this.ensureConversation(e.$entityType,e.id,t)}},{key:"__removedByCounterParty",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));
if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));this.ejectConversation(e,t,n)}},{key:"__ensureEntities",value:function(e){var t,n,r=this;this.host.models.Organization.ensureEntityOrCreateTemporaryAndFind({id:e.organizationId,name:"Loading..."},{finder:(t=this.host.organizations).find.bind(t),onMissing:function(){r.logger.info("org "+e.organizationId+" not found, created temporary org"),e.$loadingOrganization=!0},onLoad:function(t){r.logger.info("org "+e.organizationId+" loaded"),e.$loadingOrganization=!1}});var o={id:e.counterPartyId},a=void 0;switch(e.counterPartyType){case"user":o.displayName="Loading...",a=(n=this.host.users).find.bind(n);break;case"group":o.displayName="Loading group...",o.organizationId=e.organizationId,a=(n=this.host.groups).find.bind(n);break;default:throw new Error("unsupported counterPartyType",e.counterPartyType)}this.host.store.store.models[e.counterPartyType].ensureEntityOrCreateTemporaryAndFind(o,{finder:a,onMissing:function(){r.logger.info("entry "+e.counterPartyId+" not found, created temporary on org "+e.organizationId),e.$loadingCounterParty=!0},onLoad:function(t){e.$loadingCounterParty=!1,r.__fireChange("update",e)}}),this.__fireChange("add",e)}},{key:"__ensureMessageEntities",value:function(e){var t,n=this,r=this.host.getCurrentUser().id,o=e.senderId==r?e.recipientId:e.senderId;o&&this.host.models.User.ensureEntityOrCreateTemporaryAndFind({id:o,displayName:"Loading..."},{finder:(t=this.host.users).find.bind(t),onlyPlaceholder:!!e.groupId,onMissing:function(){n.logger.info("message otherUser "+o+" not found, created temporary"),e.$loadingOtherUser=!0},onLoad:function(t){e.$loadingOtherUser=!1,n.__fireChange("update",e.conversation)}})}},{key:"__fireChange",value:function(e,t){}}]),t}(U["default"]),o(d.prototype,"findAll",[s],(0,b["default"])(d.prototype,"findAll"),d.prototype),o(d.prototype,"add",[u],(0,b["default"])(d.prototype,"add"),d.prototype),o(d.prototype,"remove",[c],(0,b["default"])(d.prototype,"remove"),d.prototype),o(d.prototype,"_onMessageSending",[H.privateMethod,W["default"]],(0,b["default"])(d.prototype,"_onMessageSending"),d.prototype),o(d.prototype,"_onMessageSent",[H.privateMethod,W["default"]],(0,b["default"])(d.prototype,"_onMessageSent"),d.prototype),o(d.prototype,"_onMessageChange",[H.privateMethod,W["default"]],(0,b["default"])(d.prototype,"_onMessageChange"),d.prototype),o(d.prototype,"_onGroupDelete",[H.privateMethod,W["default"]],(0,b["default"])(d.prototype,"_onGroupDelete"),d.prototype),o(d.prototype,"__queueReload",[H.privateMethod],(0,b["default"])(d.prototype,"__queueReload"),d.prototype),o(d.prototype,"__flushConversationsToReload",[H.privateMethod,W["default"]],(0,b["default"])(d.prototype,"__flushConversationsToReload"),d.prototype),o(d.prototype,"__reloadConversation",[H.privateMethod],(0,b["default"])(d.prototype,"__reloadConversation"),d.prototype),o(d.prototype,"__notifyOrganizationChange",[H.privateMethod],(0,b["default"])(d.prototype,"__notifyOrganizationChange"),d.prototype),o(d.prototype,"__ensureConversationFromMessage",[H.privateMethod],(0,b["default"])(d.prototype,"__ensureConversationFromMessage"),d.prototype),o(d.prototype,"__addConversationCounterPartyToServerRosterIfShould",[H.privateMethod],(0,b["default"])(d.prototype,"__addConversationCounterPartyToServerRosterIfShould"),d.prototype),o(d.prototype,"_onGroupMembershipChange",[H.privateMethod,W["default"]],(0,b["default"])(d.prototype,"_onGroupMembershipChange"),d.prototype),o(d.prototype,"__generateGroupMembershipChangeBody",[H.privateMethod],(0,b["default"])(d.prototype,"__generateGroupMembershipChangeBody"),d.prototype),o(d.prototype,"__addedByCounterParty",[H.privateMethod],(0,b["default"])(d.prototype,"__addedByCounterParty"),d.prototype),o(d.prototype,"__removedByCounterParty",[H.privateMethod],(0,b["default"])(d.prototype,"__removedByCounterParty"),d.prototype),o(d.prototype,"__ensureEntities",[H.privateMethod],(0,b["default"])(d.prototype,"__ensureEntities"),d.prototype),o(d.prototype,"__ensureMessageEntities",[H.privateMethod],(0,b["default"])(d.prototype,"__ensureMessageEntities"),d.prototype),o(d.prototype,"__fireChange",[H.privateMethod],(0,b["default"])(d.prototype,"__fireChange"),d.prototype),f=d))||f);t["default"]=ee,e.exports=t["default"]},function(e,t){e.exports=require("humanize-list")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a,i,s=n(49),u=r(s),c=n(23),f=r(c),d=n(14),l=r(d),p=n(15),y=r(p),h=n(24),g=r(h),v=n(25),m=r(v),b=n(51),w=r(b),E=n(31),_=(r(E),n(63)),x=n(58),k=(0,x.classWithPrivateMethods)((i=function(e){function t(e,n){(0,l["default"])(this,t);var r=(0,g["default"])(this,(0,f["default"])(t).call(this,e,n));return r._data={},r.host.models.User.on("beforeInject",function(e,t){return r._onUserInjected(t)}),r}return(0,m["default"])(t,e),(0,y["default"])(t,[{key:"reactToPresenceEvent",value:function(e){this.set(e.data.from,_.PresenceStatus.resolve(e.data.type))}},{key:"set",value:function(e,t){var n=this.host.models.User.get(e);n&&(n.presence=t),this._data[e]=t}},{key:"get",value:function(e){return e==this.host.getCurrentUser().id?_.PresenceStatus.AVAILABLE:this._data[e]}},{key:"_onUserInjected",value:function(e){e.id in this._data&&(e.presence=this._data[e.id])}}]),t}(w["default"]),o(i.prototype,"_onUserInjected",[x.privateMethod],(0,u["default"])(i.prototype,"_onUserInjected"),i.prototype),a=i))||a;t["default"]=k,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,P["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,g["default"])(u))?u.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var o=(0,P["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(s+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+s+"\n"+a+"}":"{\n  "+a+s+"\n"+a+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,g["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var s,u,c,f,d,l,p=n(7),y=r(p),h=n(9),g=r(h),v=n(49),m=r(v),b=n(84),w=r(b),E=n(60),_=r(E),x=n(61),k=r(x),j=n(85),I=r(j),O=n(17),T=r(O),A=n(11),M=r(A),G=n(10),V=r(G),C=n(12),z=r(C),S=n(8),P=r(S),N=n(13),R=r(N),U=n(23),q=r(U),$=n(14),D=r($),F=n(15),B=r(F),L=n(24),K=r(L),Z=n(25),W=r(Z),H=n(51),Y=r(H),X=n(31),Q=r(X),J=n(21),ee=r(J),te=n(32),ne=n(58),re=(s=(0,te.decorator)(),u=(0,te.decorator)(),(0,ne.classWithPrivateMethods)((l=d=function(e){function t(){return(0,D["default"])(this,t),(0,K["default"])(this,(0,q["default"])(t).apply(this,arguments))}return(0,W["default"])(t,e),(0,B["default"])(t,[{key:"fullUpdate",value:function(){var e=(0,R["default"])(z["default"].mark(function t(e,n,r){return z["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if(n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if(n instanceof Object){t.next=10;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:if(r){t.next=14;break}throw new ee["default"].ValidationError("organizationId","required");case 14:if(!(this.host.config.maxMetadataKeyCount>0&&(0,P["default"])(n).length>this.host.config.maxMetadataKeyCount)){t.next=16;break}throw new ee["default"].ValidationError("entireData","invalid","Total number of metadata keys is "+(0,P["default"])(n)+" and should not exceed "+this.host.config.maxMetadataKeyCount);case 16:return this.host.requireUser(),e=this._resolveModelId(e),t.prev=18,t.next=21,this.host.api.metadata.update(e,n,r);case 21:return this.__injectMetadata(e,r,n),t.abrupt("return",n);case 25:if(t.prev=25,t.t0=t["catch"](18),!t.t0.response||404!=t.t0.response.status){t.next=31;break}throw new ee["default"].NotFoundError("metadata",e);case 31:throw t.t0;case 32:case"end":return t.stop()}},t,this,[[18,25]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,R["default"])(z["default"].mark(function t(e,n,r){var o,s;return z["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if(n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 8:if(n instanceof Object){t.next=10;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:if(r){t.next=14;break}throw new ee["default"].ValidationError("organizationId","required");case 14:return t.next=16,this.find(e,r);case 16:return o=t.sent,s=(0,V["default"])({},o,n),t.abrupt("return",this.fullUpdate(e,s,r));case 19:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,R["default"])(z["default"].mark(function t(e,n){var r;return z["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(n){t.next=10;break}throw new ee["default"].ValidationError("organizationId","required");case 10:return this.host.requireUser(),e=this._resolveModelId(e),t.prev=12,t.next=15,this.host.api.metadata.find(e,n);case 15:return r=t.sent,this.__injectMetadata(e,n,r),t.abrupt("return",r);case 20:if(t.prev=20,t.t0=t["catch"](12),!t.t0.response||404!=t.t0.response.status){t.next=26;break}throw new ee["default"].NotFoundError("metadata",e);case 26:throw t.t0;case 27:case"end":return t.stop()}},t,this,[[12,20]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findMulti",value:function(){var e=(0,R["default"])(z["default"].mark(function t(e,n){var r,o,s,u,c=this;return z["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(n){t.next=10;break}throw new ee["default"].ValidationError("organizationId","required");case 10:return this.host.requireUser(),e=Q["default"].uniq(Q["default"].arrayWrap(e).map(this._resolveModelId.bind(this))),r=Q["default"].chunk(e,20),o=r.map(function(e){return c.__findMultiPaged(e,n)}),t.next=16,M["default"].all(o);case 16:return s=t.sent,u=Q["default"].assign.apply(Q["default"],[{}].concat((0,T["default"])(s))),t.abrupt("return",u);case 19:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"__findMultiPaged",value:function(){var e=(0,R["default"])(z["default"].mark(function t(e,n){var r,o,s,u,c,f,d,l,p,y,h,g,v,m,b,E;return z["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){t.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return t.prev=8,t.next=11,this.host.api.metadata.findMulti(e,n);case 11:if(r=t.sent,d=(0,I["default"])(r),d&&("function"==typeof d[k["default"]]||Array.isArray(d))){t.next=15;break}throw new TypeError("Expected _Object$entries to be iterable, got "+a(d));case 15:if(d&&("function"==typeof d[k["default"]]||Array.isArray(d))){t.next=17;break}throw new TypeError("Expected _Object$entries to be iterable, got "+i(d));case 17:for(o=!0,s=!1,u=void 0,t.prev=20,c=(0,_["default"])(d);!(o=(f=c.next()).done);o=!0)l=(0,w["default"])(f.value,2),p=l[0],y=l[1],y&&this.__injectMetadata(p,n,y);t.next=28;break;case 24:t.prev=24,t.t0=t["catch"](20),s=!0,u=t.t0;case 28:t.prev=28,t.prev=29,!o&&c["return"]&&c["return"]();case 31:if(t.prev=31,!s){t.next=34;break}throw u;case 34:return t.finish(31);case 35:return t.finish(28);case 36:return t.abrupt("return",r);case 39:if(t.prev=39,t.t1=t["catch"](8),!t.t1.response||404!=t.t1.response.status){t.next=84;break}if(h={},e&&("function"==typeof e[k["default"]]||Array.isArray(e))){t.next=45;break}throw new TypeError("Expected ids to be iterable, got "+a(e));case 45:if(e&&("function"==typeof e[k["default"]]||Array.isArray(e))){t.next=47;break}throw new TypeError("Expected ids to be iterable, got "+i(e));case 47:g=!0,v=!1,m=void 0,t.prev=50,b=(0,_["default"])(e);case 52:if(g=(E=b.next()).done){t.next=67;break}return p=E.value,t.prev=54,t.next=57,this.find(p,n);case 57:h[p]=t.sent,t.next=64;break;case 60:if(t.prev=60,t.t2=t["catch"](54),t.t2.code==ee["default"].NotFoundError.CODE){t.next=64;break}throw t.t2;case 64:g=!0,t.next=52;break;case 67:t.next=73;break;case 69:t.prev=69,t.t3=t["catch"](50),v=!0,m=t.t3;case 73:t.prev=73,t.prev=74,!g&&b["return"]&&b["return"]();case 76:if(t.prev=76,!v){t.next=79;break}throw m;case 79:return t.finish(76);case 80:return t.finish(73);case 81:return t.abrupt("return",h);case 84:throw t.t1;case 85:case"end":return t.stop()}},t,this,[[8,39],[20,24,28,36],[29,,31,35],[50,69,73,81],[54,60],[74,,76,80]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"__injectMetadata",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));var r=e+":"+t;this.host.models.Metadata.inject({id:r,data:n,entityId:e,organizationId:t})}}]),t}(Y["default"]),d.METADTA_TYPES=["user","group"],f=l,o(f.prototype,"find",[s],(0,m["default"])(f.prototype,"find"),f.prototype),o(f.prototype,"findMulti",[u],(0,m["default"])(f.prototype,"findMulti"),f.prototype),o(f.prototype,"__findMultiPaged",[ne.privateMethod],(0,m["default"])(f.prototype,"__findMultiPaged"),f.prototype),o(f.prototype,"__injectMetadata",[ne.privateMethod],(0,m["default"])(f.prototype,"__injectMetadata"),f.prototype),c=f))||c);t["default"]=re,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/helpers/slicedToArray")},function(e,t){e.exports=require("babel-runtime/core-js/object/entries")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a,i,s=n(49),u=r(s),c=n(12),f=r(c),d=n(11),l=r(d),p=n(8),y=r(p),h=n(13),g=r(h),v=n(23),m=r(v),b=n(14),w=r(b),E=n(15),_=r(E),x=n(24),k=r(x),j=n(25),I=r(j),O=n(51),T=r(O),A=n(32),M=n(21),G=r(M),V=n(31),C=r(V),z=n(78),S=r(z),P={user:"account",distributionList:"distribution_list",group:"group",organization:"organization"},N=C["default"].values(P),R=(a=(0,A.decorator)(),i=function(e){function t(){return(0,w["default"])(this,t),(0,k["default"])(this,(0,m["default"])(t).apply(this,arguments))}return(0,I["default"])(t,e),(0,_["default"])(t,[{key:"query",value:function(){var e=(0,g["default"])(f["default"].mark(function t(e){var n,r,o,a,i,s=this,u=e.types,c=void 0===u?[]:u,d=e.query,p=void 0===d?{}:d,h=e.continuation,g=void 0===h?null:h,v=e.includeDisabled,m=void 0===v?!1:v,b=e.excludeTokens,w=void 0===b?[]:b,E=e.resultsFormat,_=void 0===E?"entities":E,x=e.organizationId,k=void 0===x?null:x,j=e.organizationIds,I=void 0===j?[]:j,O=e.sort,T=void 0===O?[]:O,A=e.includeMetadata,M=void 0===A?!1:A;return f["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=c.length){e.next=2;break}throw new G["default"].ValidationError("types","required","no types specified");case 2:if(c=c.map(function(e){return P[e]}),n=C["default"].difference(c,N),!(n.length>0)){e.next=6;break}throw new G["default"].ValidationError("types","invalid","invalid types: "+n.join(", "));case 6:if(k&&(I=[k]),0!=I.length){e.next=9;break}throw new G["default"].ValidationError("organizationIds","invalid","search must be done in a context of an organization");case 9:return"ids"===_&&(_="tokens"),r={type:c,include_disabled:m,directory:I,results_format:_},g&&(r.continuation=g),T&&T.length&&(r.sort=T),w=C["default"].arrayWrap(w),p&&(0,y["default"])(p).length>0&&(r.bool={must:S["default"].underscoreObject(p)}),e.next=17,this.httpClient.post("/search",{data:r});case 17:if(o=e.sent,a=o.data.results,i=C["default"].eachWithObject(a,function(e,t){var n=e.type,r=e.entity,o=e.organization_id;if(0!=(0,y["default"])(r).length){"tigertext:entity:account"===n&&C["default"].replaceKey(r,"status","account_status");var a=s.host.injectModel(r,n);if(!w.length||!w.includes(a.id)){if(!a)return void s.logger.warn("no entity for ",e);var i=new s.host.models.SearchResult(a,o);t.push(i)}}},[]),!M){e.next=22;break}return e.delegateYield(f["default"].mark(function t(){var e,n,r;return f["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=C["default"].groupBy(i,"organizationId"),n=C["default"].keyBy(i,"entityId"),r=C["default"].transform(e,function(e,t,r){e.push(s.host.metadata.findMulti(C["default"].map(t,"entityId"),r).then(function(e){C["default"].each(e,function(e,t){return n[t].metadata=e})}))},[]),!(r.length>0)){t.next=6;break}return t.next=6,l["default"].all(r);case 6:case"end":return t.stop()}},t,s)})(),"t0",22);case 22:return e.abrupt("return",i);case 23:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(T["default"]),o(i.prototype,"query",[a],(0,u["default"])(i.prototype,"query"),i.prototype),i);t["default"]=R,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var o=(0,l["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,y["default"])(u))?u.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var o=(0,l["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(s+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+s+"\n"+a+"}":"{\n  "+a+s+"\n"+a+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,y["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var s,u,c=n(7),f=r(c),d=n(8),l=r(d),p=n(9),y=r(p),h=n(49),g=r(h),v=n(88),m=r(v),b=n(12),w=r(b),E=n(13),_=r(E),x=n(89),k=r(x),j=n(23),I=r(j),O=n(14),T=r(O),A=n(15),M=r(A),G=n(24),V=r(G),C=n(25),z=r(C),S=n(51),P=r(S),N=n(31),R=r(N),U=n(58),q="global",$=(0,U.classWithPrivateMethods)((u=function(e){function t(){return(0,T["default"])(this,t),(0,V["default"])(this,(0,I["default"])(t).apply(this,arguments))}return(0,z["default"])(t,e),(0,M["default"])(t,[{key:"mounted",value:function(){this._typersByContext=new k["default"],this._timers={}}},{key:"dispose",value:function(){(0,R["default"])(this._timers).values().each(function(e){return clearTimeout(e)}),this._timers={}}},{key:"reactToIsTypingEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));this.host.requireUser();var t=e.data.sender_token;if(t!==this.host.getCurrentUser().id){var n=e.data.group_token||q,r="typing"===e.data.status;this._setUser(n,t,r)}}},{key:"startTyping",value:function(){var e=(0,_["default"])(w["default"].mark(function t(e){return w["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return e=this._resolveModelId(e),this.host.requireUser(),t.next=8,this.host.api.messages.startTyping(e);case 8:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"stopTyping",value:function(){var e=(0,_["default"])(w["default"].mark(function t(e){return w["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:return e=this._resolveModelId(e),this.host.requireUser(),t.next=8,this.host.api.messages.stopTyping(e);case 8:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_setUser",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("boolean"!=typeof n)throw new TypeError('Value of argument "isTyping" violates contract.\n\nExpected:\nbool\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("boolean"!=typeof n)throw new TypeError('Value of argument "isTyping" violates contract.\n\nExpected:\nbool\n\nGot:\n'+a(n));var r=this._typersByContext.get(e),o=e!==q;if(n)r||(r=new m["default"],this._typersByContext.set(e,r)),r.add(t),this._addClearTimer(e,t);else{if(!r)return;this._typersByContext.get(e)["delete"](t),this._disposeTimer(e,t)}var s={userId:t,isTyping:n};o&&(s.groupId=e),this.emit("change",s)}},{key:"_addClearTimer",value:function(e,t){var n=this;if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));var r=this._getTimerKey(e,t);this._timers[r]&&this._disposeTimer(e,t),this._timers[r]=setTimeout(function(){return n._setUser(e,t,!1)},this.host.config.clearTypingStatusAfter)}},{key:"_disposeTimer",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));var n=this._getTimerKey(e,t);this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n])}},{key:"isUserTyping",value:function(e){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(e));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(e));
return e=this._resolveModelId(e),this._isUserTypingInContext(q,e)}},{key:"isUserTypingInGroup",value:function(e,t){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(e));if(!(t instanceof Object||"string"==typeof t))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(t));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(e));if(!(t instanceof Object||"string"==typeof t))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(t));return t=this._resolveModelId(t),e=this._resolveModelId(e),this._isUserTypingInContext(e,t)}},{key:"_isUserTypingInContext",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return this._typersByContext.has(e)?this._typersByContext.get(e).has(t):!1}},{key:"_getTimerKey",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return[t,e].filter(Boolean).join(":")}}]),t}(P["default"]),o(u.prototype,"_setUser",[U.privateMethod],(0,g["default"])(u.prototype,"_setUser"),u.prototype),o(u.prototype,"_addClearTimer",[U.privateMethod],(0,g["default"])(u.prototype,"_addClearTimer"),u.prototype),o(u.prototype,"_disposeTimer",[U.privateMethod],(0,g["default"])(u.prototype,"_disposeTimer"),u.prototype),o(u.prototype,"_isUserTypingInContext",[U.privateMethod],(0,g["default"])(u.prototype,"_isUserTypingInContext"),u.prototype),o(u.prototype,"_getTimerKey",[U.privateMethod],(0,g["default"])(u.prototype,"_getTimerKey"),u.prototype),s=u))||s;t["default"]=$,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/set")},function(e,t){e.exports=require("babel-runtime/core-js/map")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=n(45),a=r(o),i=n(54),s=r(i),u=n(14),c=r(u),f=n(15),d=r(f),l=n(31),p=r(l),y=n(91),h=r(y),g=n(94),v=r(g),m=n(78),b=r(m),w=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=n.logger,o=(0,s["default"])(n,["logger"]);(0,c["default"])(this,e),this.host=t,this.options=o,this.logger=r,this.store=new h["default"]((0,a["default"])({},o,{host:t,logger:r}))}return(0,d["default"])(e,[{key:"defineModels",value:function(){var e=this,t={},n=(0,a["default"])({},this.options,{host:this.host,logger:this.logger});p["default"].each(v["default"],function(r,o){t[o]=r(e,n)}),this.models=t}},{key:"defineModel",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t.replaceKeys=t.replaceKeys||{},p["default"].defaults(t.replaceKeys,{token:"id"});var n=(this.store,this.store.defineModel(e,(0,a["default"])({},t,{beforeCreateInstance:function(e){!e[n.idAttribute]||"serverId"in e||(e.serverId=e[n.idAttribute]),t.beforeCreateInstance&&t.beforeCreateInstance(e)},beforeInject:function(e){var r=n.get(e[n.idAttribute]);!r||"serverId"in e||(e.serverId=r.serverId),t.beforeInject&&t.beforeInject(e)},afterInject:function(e){var n=Date.now();e.$lastModified==n&&(n+=1e-5),e.$lastModified=n,t.afterInject&&t.afterInject(e)},parseAttrs:function(e){var n=b["default"].camelizeObject(e);return p["default"].each(t.replaceKeys,function(e,t){p["default"].replaceKey(n,t,e)}),t.parseAttrs&&(n=t.parseAttrs(n,e)),n}})));return n}},{key:"clear",value:function(){this.store.clear()}}]),e}();t["default"]=w,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),s=r(i),u=n(8),c=r(u),f=n(9),d=r(f),l=n(12),p=r(l),y=n(13),h=r(y),g=n(45),v=r(g),m=n(92),b=r(m),w=n(10),E=r(w),_=n(14),x=r(_),k=n(15),j=r(k),I=n(31),O=r(I),T=n(37),A=r(T),M=n(93),G=r(M);A["default"].prototype.off=A["default"].prototype.removeListener;var V={idAttribute:"id",parseAttrs:O["default"].identity,relations:{belongsTo:{},hasMany:{}},defaultValues:null,computed:{}},C=function(){function e(t,n){var r=this,o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];(0,x["default"])(this,e),this.options=O["default"].defaultsDeep({},o,V),this.idAttribute=this.options.idAttribute,this.name=n,this.store=t,this.entitiesById={},this.entitiesList=[],this.transientAttrsStore={},this.options.relations&&this.__initRelations(),this.__initTransientAttrs(),(0,E["default"])(this.options.computed,{$entityType:{enumerable:!0,get:function(){return n}},$entityClass:{enumerable:!1,get:function(){return r}}}),this.options.computed=O["default"].transform(this.options.computed,function(e,t,n){"function"==typeof t?e[n]={get:t,enumerable:!1}:e[n]=t},{}),this._computedKeys=(0,O["default"])(this.options.computed).keys().without("$entityType","$entityClass","$$transientAttrs").value(),this._writablePropertyKeys=(0,O["default"])(this.options.computed).toPairs().filter(function(e){return e[1].set}).map(O["default"].first).value(),this._relationKeys=(0,O["default"])(this.options.relations).values().map(O["default"].keys).flatten().value()}return(0,j["default"])(e,null,[{key:"create",value:function(e,t,n){return new this(e,t,n)}}]),(0,j["default"])(e,[{key:"__initRelations",value:function(){var e=this,t=O["default"].transform(this.options.relations.belongsTo,function(t,n,r){t[r]={get:function(){return e.store.get(n.type,this[n.foreignKey])},set:function(t){this[n.foreignKey]=e.store.resolveId(n.type,t)}}},{});(0,E["default"])(this.options.computed,t);var n=O["default"].transform(this.options.relations.hasMany,function(t,n,r){t[r]={get:function(){var t=this;if(this.$$transientAttrs.relations||(this.$$transientAttrs.relations={},this.$$transientAttrs.relationsCreated={}),this.$$transientAttrs.relations[r])return this.$$transientAttrs.relations[r];var o=e.store.getAll(n.type).filter(function(r){return r[n.foreignKey]==t[e.options.idAttribute]});return this.$$transientAttrs.relations[r]=o,this.$$transientAttrs.relationsCreated[r]=!0,o},set:function(e){}}},{});(0,E["default"])(this.options.computed,n)}},{key:"__initTransientAttrs",value:function(){var e=this,t=this,n={$$transientAttrs:{enumerable:!1,get:function(){var e=this[t.options.idAttribute];return t.transientAttrsStore[e]||(t.transientAttrsStore[e]={})}}},r={};this.options.transientAttrs&&this.options.transientAttrs.forEach(function(t){e.options.defaultValues&&t in e.options.defaultValues&&(r[t]=(0,G["default"])(e.options.defaultValues[t]),delete e.options.defaultValues[t]),n[t]={get:function(){return t in this.$$transientAttrs?this.$$transientAttrs[t]:t in r?this.$$transientAttrs[t]=r[t]:void 0},set:function(e){this.$$transientAttrs[t]=e}}}),(0,E["default"])(this.options.computed,n)}},{key:"createInstance",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=this;t&&(e=this.parseAttrs(e)),this.options.defaultValues&&O["default"].defaults(e,(0,G["default"])(this.options.defaultValues));var r={};return this._writablePropertyKeys.forEach(function(t){t in e&&(r[t]=e[t],delete e[t])}),(0,b["default"])(e,this.options.computed),(0,E["default"])(e,r),this.options.instanceEvents&&(0,E["default"])(e,A["default"].prototype),(0,E["default"])(e,{toPlainObject:function(e){var t=this,r={};n._computedKeys.forEach(function(e){return r[e]=t[e]});var o=(0,E["default"])({},this,r);return delete o.toPlainObject,delete o.setMaxListeners,delete o.emit,delete o.addListener,delete o.on,delete o.once,delete o.removeListener,delete o.removeAllListeners,delete o.listeners,delete o.listenerCount,delete o.off,delete o.toPlainObject,delete o._events,delete o._maxListeners,o}}),this.options.beforeCreateInstance&&this.options.beforeCreateInstance(e),e}},{key:"inject",value:function(e){var t=void 0,n=!0,r=this.is(e);if(r){if(t=e,this.entitiesById[this.resolveId(t)])return this.options.beforeInject&&this.options.beforeInject(t),this.emit("beforeInject",this,t),this.options.afterInject&&this.options.afterInject(t),this.emit("afterInject",this,t),t;n=!1}n&&(e=this.parseAttrs(e));var o=this.resolveId(e);if(!this.isValidId(o))throw new Error("'"+this.options.idAttribute+"' is required");return(t=this.entitiesById[o])?(this.options.beforeInject&&this.options.beforeInject(e),this.emit("beforeInject",this,e),(0,E["default"])(t,e)):(t=r?e:this.createInstance(e,!1),this.options.beforeInject&&this.options.beforeInject(e),this.emit("beforeInject",this,e),this.entitiesById[o]=t,this.entitiesList.push(t)),this.__addToHasManyRelationships(t),this.options.afterInject&&this.options.afterInject(t),this.emit("afterInject",this,t),t}},{key:"eject",value:function(e){e=this.resolveId(e);var t=this.entitiesById[e];t&&(this.__removeFromHasManyRelationships(t),delete this.entitiesById[e],O["default"].pull(this.entitiesList,t),e in this.transientAttrsStore&&delete this.transientAttrsStore[e],this.emit("afterEject",this,t))}},{key:"__addToHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"add")}},{key:"__removeFromHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"remove")}},{key:"__updateRelationsIfNeeded",value:function(e,t){var n=this,r=this.store.getParentRelationshipsOfModel(this.name);r&&r.forEach(function(r){var o=n.store.get(r.parent,e[r.foreignKey]);o&&o.$$transientAttrs.relationsCreated&&o.$$transientAttrs.relationsCreated[r.relationKey]&&("add"==t?o[r.relationKey].includes(e)||o[r.relationKey].push(e):"remove"==t&&O["default"].pull(o[r.relationKey],e))})}},{key:"ejectAll",value:function(){var e=this;O["default"].eachRight(this.entitiesList,function(t){return e.eject(t)})}},{key:"parseAttrs",value:function(e){var t=this,n=O["default"].pickBy(e,function(e){return t.store.isEntity(e)||t.store.isEntityArray(e)}),r=O["default"].omit(e,O["default"].keys(n)),o=this.options.parseAttrs((0,G["default"])(r)),a=(0,v["default"])({},o,n);return a}},{key:"get",value:function(e){return this.entitiesById[e]}},{key:"getAll",value:function(){return this.entitiesList}},{key:"getMulti",value:function(e){return e.map(this.get.bind(this))}},{key:"resolveId",value:function(e){return this.isValidId(e)?e:e[this.options.idAttribute]}},{key:"isValidId",value:function(e){return"string"==typeof e||"number"==typeof e}},{key:"is",value:function(e){return e&&e.$entityClass==this}},{key:"find",value:function(){var e=(0,h["default"])(p["default"].mark(function t(e){return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:throw new"not implemented find";case 5:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=(0,h["default"])(p["default"].mark(function t(e){return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 4:throw e=this.resolveId(e),new"not implemented refresh";case 6:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();(0,E["default"])(C.prototype,A["default"].prototype);var z=function(){function e(){var t=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];(0,x["default"])(this,e),this.options=n,this.models={},this.__relationsOfHasManyByContainedItem={},["inject","get","getAll","filter","resolveId","is","find","refresh"].forEach(function(e){t[e]=function(n){for(var r,o=arguments.length,a=Array(o>1?o-1:0),i=1;o>i;i++)a[i-1]=arguments[i];return(r=t.models[n])[e].apply(r,a)}})}return(0,j["default"])(e,[{key:"defineModel",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(this.models[e])throw new Error(e+" already defined");n=(0,v["default"])({},this.options,n),this.models[e]=C.create(this,e,n);var r=this.models[e].options.relations.hasMany;return O["default"].isEmpty(r)||O["default"].each(r,function(n,r){t.__relationsOfHasManyByContainedItem[n.type]||(t.__relationsOfHasManyByContainedItem[n.type]=[]),t.__relationsOfHasManyByContainedItem[n.type].push((0,v["default"])({},n,{relationKey:r,parent:e}))}),this.models[e]}},{key:"getParentRelationshipsOfModel",value:function(e){return this.__relationsOfHasManyByContainedItem[e]}},{key:"isEntity",value:function(e){return e&&e.$entityClass&&e.$entityClass.constructor===C}},{key:"isEntityArray",value:function(e){return e&&Array.isArray(e)&&e.some(this.isEntity)}},{key:"clear",value:function(){(0,O["default"])(this.models).values().forEach(function(e){return e.ejectAll()})}}]),e}();t["default"]=z,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/object/define-properties")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=r(o),i=function(e){return JSON.parse((0,a["default"])(e))};t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={User:n(95),Group:n(97),Organization:n(98),Message:n(99),MessageStatusPerRecipient:n(100),Event:n(101),Conversation:n(102),SearchResult:n(103),Metadata:n(104)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){var n=e.defineModel("user",{transientAttrs:["presence"],replaceKeys:{avatar:"avatarUrl"},defaultValues:{presence:c["default"].UNKNOWN},computed:{metadataByOrganizationId:{enumerable:!0,get:function(){return(0,a["default"])(e.store.getAll("metadata")).filter({entityId:this.id}).keyBy("organizationId").mapValues("data").value()}}},parseAttrs:function(e){return e.presence&&(e.presence=c["default"].resolve(e.presence)||c["default"].UNKNOWN),e}});return(0,s["default"])(e,n,{before:function(e,t,n){},after:function(e,t){}}),n};var o=n(31),a=r(o),i=n(96),s=r(i),u=n(69),c=r(u);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){var r=n.before,o=n.after;if(null==arguments[2]||null!=arguments[2].before&&"function"!=typeof arguments[2].before||null!=arguments[2].after&&"function"!=typeof arguments[2].after)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ before: ?Function;\n  after: ?Function;\n}\n\nGot:\n"+i(arguments[2]));if(null==arguments[2]||null!=arguments[2].before&&"function"!=typeof arguments[2].before||null!=arguments[2].after&&"function"!=typeof arguments[2].after)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ before: ?Function;\n  after: ?Function;\n}\n\nGot:\n"+a(arguments[2]));e.ensureEntityOrCreateTemporaryAndFind||(e.ensureEntityOrCreateTemporaryAndFind=function(t,n){function r(){var n=this;if(e.host.config.enableEnsureEntityFindMissing&&!w[E(u)]){var r=function(){var r=(0,g["default"])(y["default"].mark(function i(){return y["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(u.$temporary){n.next=3;break}return e.logger.info("entity "+t+":"+s+" was already updated elsewhere"),n.abrupt("return");case 3:return n.next=5,a();case 5:delete w[E(u)];case 6:case"end":return n.stop()}},i,n)})),o=n;return function(){return r.apply(o,arguments)}}(),a=function(){var e=(0,g["default"])(y["default"].mark(function r(){return y["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.finder(s,{bypassCache:!0});case 3:delete u.$temporary,i.after(u,o),o.onLoad(u),e.next=13;break;case 8:e.prev=8,e.t0=e["catch"](0),e.next=12;break;case 12:o.onLoad(null);case 13:case"end":return e.stop()}},r,n,[[0,8]])})),t=n;return function(){return e.apply(t,arguments)}}();e.host.config.temporaryEntityDelayBeforeRefreshing?w[E(u)]=setTimeout(r,e.host.config.temporaryEntityDelayBeforeRefreshing):a()}}var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(e.host.config.enableEnsureEntityWithTemp||e.host.config.enableEnsureEntityFindMissing){if(o=m["default"].defaults(o,{onLoad:b.noop,onExists:b.noop,onMissing:b.noop,onlyPlaceholder:!1}),!o.finder)throw new Error("finder is missing in ensureEntityOrCreateTemporaryAndFind call");var a=e.store.models[t],i=a.__addEnsureEntityOrCreateTemporaryAndFind__config,s=n[a.idAttribute],u=e.store.get(t,s);if(i.before(n,u,o),u)i.after(u,o),u.$temporary?o.onlyPlaceholder||r():o.onExists(u);else{if(o.onMissing(),u=e.store.inject(t,n),Object.defineProperty(u,"$temporary",{value:!0,configurable:!0}),o.onlyPlaceholder)return u;r()}return u}}),t.__addEnsureEntityOrCreateTemporaryAndFind__config={before:r||b.noop,after:o||b.noop},t.ensureEntityOrCreateTemporaryAndFind=function(n,r){return e.ensureEntityOrCreateTemporaryAndFind(t.name,n,r)}}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var o=(0,f["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var c=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof c?"undefined":(0,l["default"])(c))?c.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l["default"])(e);if(!Array.isArray(e)){var o=(0,f["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(s+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+s+"\n"+a+"}":"{\n  "+a+s+"\n"+a+"}"}if(!(e.length>0))return"Array";var c=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof c?"undefined":(0,l["default"])(c))?c.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var s=n(7),u=r(s),c=n(8),f=r(c),d=n(9),l=r(d),p=n(12),y=r(p),h=n(13),g=r(h);t["default"]=o;var v=n(31),m=r(v),b=n(55),w={},E=function(e){return e.$entityType+":"+e.id};e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){function n(n){var r;e.ensureEntityOrCreateTemporaryAndFind("user",{id:n,displayName:"Loading..."},{onlyPlaceholder:!0,finder:(r=t.host.users).find.bind(r)})}function r(e){e.memberIds&&e.memberIds.forEach(n)}function o(e){e&&e.forEach(n)}var s=e.defineModel("group",{replaceKeys:{organizationKey:"organizationId",members:"memberIds",avatar:"avatarUrl",displayName:"name",numMembers:"memberCount",createdTime:"createdAt"},defaultValues:{memberIds:[],memberCount:0,groupType:i.GroupType.GROUP},validate:function(){u["default"].notEmpty("groupType",this.groupType)},__extractGroupTypeFromAttrs:function(e){return"tigertext:entity:list"==(e.type||e.xmlns)?i.GroupType.DISTRIBUTION_LIST:e.isPublic?i.GroupType.ROOM:null},parseAttrs:function(e){var t=this.__extractGroupTypeFromAttrs(e);return t&&(e.groupType=t),e},beforeCreateInstance:function(e){o(e.memberIds)},afterInject:function(e){e.memberIds&&e.memberIds.length>0&&!e.memberCount&&(e.memberCount=e.memberIds.length)},computed:{metadata:{enumerable:!0,get:function(){var t=e.store.get("metadata",this.id+":"+this.organizationId);return t?t.data:null}},members:{enumerable:!0,get:function(){return this.memberIds.map(function(t){return e.store.get("user",t)})}},conversation:{enumerable:!0,get:function(){return t.host.conversations.get("group",this.id,this.organizationId)}},displayName:{configurable:!0,enumerable:!0,get:function(){return this.name}}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}});return(0,a["default"])(e,s,{before:function(e,t,n){t&&r(t)},after:function(e,t){r(e)}}),s};var o=n(96),a=r(o),i=n(63),s=n(72),u=r(s);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){var n=e.defineModel("organization",{instanceEvents:!0,replaceKeys:{members:"memberCount"},fields:{},transientAttrs:["conversations","unreadCount"],defaultValues:{conversations:[]}});return(0,i["default"])(e,n,{before:function(e,t,n){},after:function(e,t){}}),n};var o=n(31),a=(r(o),n(96)),i=r(a);e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){var t=e.defineModel("message",{replaceKeys:{messageId:"id",clientId:"id",senderToken:"senderId",sender:"senderId",recipientToken:"recipientId",recipient:"recipientId",senderOrganization:"senderOrganizationId",recipientOrganization:"recipientOrganizationId",groupToken:"groupId",status:"recipientStatus",data:"metadata",createdTime:"createdAt"},defaultValues:{recipientStatus:r.MessageRecipientStatus.NEW,senderStatus:r.MessageRecipientStatus.NEW,sortNumber:0,messageType:r.MessageType.USER_SENT},fields:{id:{type:"string"},senderStatus:{type:"enum","enum":r.MessageSenderStatus,require:!0},recipientStatus:{type:"enum","enum":r.MessageRecipientStatus,require:!0},direction:{type:"enum","enum":r.MessageDirection,require:!0},counterPartyId:{type:"string",require:!0},counterPartyType:{type:"enum",values:["user","group"],require:!0},createdAt:{type:Date,require:!0}},parseAttrs:function(e){if(e.recipientStatus&&(e.recipientStatus=r.MessageRecipientStatus.resolve(e.recipientStatus)),"attachmentName"in e){var t=e.attachmentName;delete e.attachmentName,Array.isArray(e.attachments)&&e.attachments.length>0&&t&&(e.attachments[0].name=t)}return Array.isArray(e.attachments)&&e.attachments.forEach(function(e,t){return e.id=""+(t+1)}),e},relations:{belongsTo:{sender:{type:"user",foreignKey:"senderId"},recipient:{type:"user",foreignKey:"recipientId"},senderOrganization:{type:"organization",foreignKey:"senderOrganizationId"},recipientOrganization:{type:"organization",foreignKey:"recipientOrganizationId"},group:{type:"group",foreignKey:"groupId"},conversation:{type:"conversation",foreignKey:"conversationId"}},hasMany:{statusesPerRecipient:{type:"messageStatusPerRecipient",foreignKey:"messageId"}}},computed:{counterParty:{enumerable:!0,get:function(){return this.counterPartyType&&this.counterPartyId?e.store.get(this.counterPartyType,this.counterPartyId):null},set:function(e){if(e){switch(e.$entityType){case"user":this.recipientId=e.id;break;case"group":this.groupId=e.id;break;default:throw new Error("unsupported counterPartyType '"+e.$entityType+"'")}this.counterPartyId=e.id,this.counterPartyType=e.$entityType}else this.counterPartyId=null,this.counterPartyType=null}}}});return t};var r=n(63);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){var t=e.defineModel("messageStatusPerRecipient",{replaceKeys:{accountId:"userId",timestamp:"createdAt"},defaultValues:{status:a["default"].NEW},fields:{userId:{type:String,require:!0},messageId:{type:String,require:!0},recipientStatus:{type:"enum","enum":a["default"],require:!0},createdAt:{type:Date,require:!0}},parseAttrs:function(e){return e.status&&(e.status=a["default"].resolve(e.status)),e},relations:{belongsTo:{message:{type:"message",foreignKey:"messageId"},user:{type:"user",foreignKey:"userId"}}}});return t};var o=n(64),a=r(o);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(10),a=r(o),i=n(54),s=r(i),u=n(14),c=r(u),f=n(15),d=r(f);t["default"]=function(){return function(){function e(t,n,r,o){var i=this;(0,c["default"])(this,e),this.id=t,this.type=n,this.data=r,o&&!function(){var e=o._origData,t=(0,s["default"])(o,["_origData"]);Object.defineProperty(i,"_origData",{get:function(){return e}}),(0,a["default"])(i,t)}()}return(0,d["default"])(e,null,[{key:"is",value:function(e){return e instanceof this}}]),e}()},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){var t=e.defineModel("conversation",{instanceEvents:!0,transientAttrs:["messages","timeline","lastMessage","unreadCount","unreadMessages","lastEventMessageSortNumber","_counterPartyAddedOnServer"],defaultValues:{lastEventMessageSortNumber:0,messages:[],timeline:[],unreadMessages:[],unreadCount:0},computed:{counterParty:{enumerable:!0,get:function(){return this.counterPartyType&&this.counterPartyId?e.store.get(this.counterPartyType,this.counterPartyId):null},set:function(e){if(e)switch(e.$entityType){case"user":case"group":this.counterPartyId=e.id,this.counterPartyType=e.$entityType;break;default:throw new Error("unsupported counterPartyType '"+e.$entityType+"'")}else this.counterPartyId=null,this.counterPartyType=null}}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}});return t};var o=n(31),a=(r(o),n(64));r(a),e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(14),a=r(o),i=n(15),s=r(i);t["default"]=function(){return function(){function e(t,n){(0,a["default"])(this,e),this.id="searchResult:"+n+":"+t.id,this.entityType=t.$entityType,this.entityId=t.id,this.entity=t,this.organizationId=n}return(0,s["default"])(e,null,[{key:"is",value:function(e){return e instanceof this}}]),e}()},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){var n=e.defineModel("metadata",{fields:{entityType:{type:"string",required:!0},entityId:{type:"string",required:!0},organizationId:{type:"string",required:!0}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}},parseAttrs:function(e,t){return e.data=t.data,e}});return n},e.exports=t["default"]},function(e,t){e.exports=require("invariant")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(10),a=r(o),i=n(8),s=r(i);t["default"]=function(e){function t(t,n){return e.includes(t,n)||t.push(n),t}e.__tigerconnectJsUtilsEnhanced||(e.__tigerconnectJsUtilsEnhanced=!0,e.mixin({arrayWrap:function(e){return Array.isArray(e)?e:void 0!=e&&null!=e?[e]:[]},eachWithObject:function(t,n,r){return Array.isArray(t)?t.forEach(function(e,o){return n(e,r,o,t)}):e.each(t,function(e,o,a){return n(e,o,r,a,t)}),r},contain:function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];return r.forEach(function(n){return t(e,n)}),e},count:function(t){var n=arguments.length<=1||void 0===arguments[1]?e.identity:arguments[1];return t.reduce(function(e,t){return e+(n(t)?1:0)},0)},replaceKey:function(e,t,n){!(n in e)&&t in e&&(e[n]=e[t],delete e[t])},replaceObject:function(t,n){var r=(0,s["default"])(t),o=(0,s["default"])(n),i=e.difference(r,o);(0,a["default"])(t,n),i.forEach(function(e){return delete t[e]})}}))},e.exports=t["default"]}]);