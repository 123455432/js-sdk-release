module.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),global._babelPolyfill||n(134);var r="node";n(133)("./"+r);var o=n(79),a=t.Client=o;a.Client=a,t.default=a,e.exports=a},function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t){e.exports=require("babel-runtime/helpers/createClass")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-prototype-of")},function(e,t){e.exports=require("babel-runtime/helpers/inherits")},function(e,t){e.exports=require("babel-runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("babel-runtime/core-js/object/keys")},function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("babel-runtime/helpers/typeof")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-own-property-descriptor")},function(e,t){e.exports=require("babel-runtime/helpers/extends")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(!Array.isArray(e)){var a=(0,c.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u.default)(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var l=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof l?"undefined":(0,h.default)(l))?l.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(!Array.isArray(e)){var o=(0,c.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var l=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof l?"undefined":(0,h.default)(l))?l.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(7),u=r(i),s=n(6),c=r(s),l=n(28),f=r(l),d=n(29),p=r(d),y=n(10),h=r(y),g=n(20),v=r(g),m=n(1),b=r(m),w=n(2),E=r(w),x=n(73),_=r(x),k=n(32),O=r(k),T=n(27),I=r(T),j=n(19),A=function(){function e(t,n){(0,b.default)(this,e),(0,v.default)(this,n),this.host=t,this.config=t.config,this.httpClient=t.httpClient}return(0,E.default)(e,[{key:"_resolveModelId",value:function(e){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(e));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+o(e));return"string"==typeof e?e:e?e.serverId||e.id||null:null}},{key:"_resolveModelIdWithTypes",value:function(e,t){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(e));if(!("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "allowedEntityTypes" violates contract.\n\nExpected:\nstring | string[]\n\nGot:\n'+a(t));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+o(e));if(!("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "allowedEntityTypes" violates contract.\n\nExpected:\nstring | string[]\n\nGot:\n'+o(t));if(!e)return null;if("string"==typeof e){var n=this._resolveEntity(e);if(!n)return e;e=n}return I.default.oneOf("thing",e.$entityType,(0,j.arrayWrap)(t)),e.serverId||e.id||null}},{key:"_resolveEntity",value:function(e,t){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(e));if(!(null==t||"string"==typeof t||null==t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "types" violates contract.\n\nExpected:\n?string | ?string[]\n\nGot:\n'+a(t));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+o(e));if(!(null==t||"string"==typeof t||null==t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "types" violates contract.\n\nExpected:\n?string | ?string[]\n\nGot:\n'+o(t));if(t||(t=this.host.allModelEntityTypes),t=(0,j.arrayWrap)(t),"object"===("undefined"==typeof e?"undefined":(0,h.default)(e)))return t.includes(e.$entityType)?e:null;if(!t||"function"!=typeof t[p.default]&&!Array.isArray(t))throw new TypeError("Expected types to be iterable, got "+o(t));if(!t||"function"!=typeof t[p.default]&&!Array.isArray(t))throw new TypeError("Expected types to be iterable, got "+a(t));var n=!0,r=!1,i=void 0;try{for(var u,s=(0,f.default)(t);!(n=(u=s.next()).done);n=!0){var c=u.value,l=this.host.modelsByEntityType[c].get(e);if(l)return l;if(l=(0,_.default)(this.host.modelsByEntityType[c].getAll(),{serverId:e}))return l}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}return null}},{key:"mounted",value:function(){}},{key:"dispose",value:function(){}}]),e}();t.default=A,(0,v.default)(A.prototype,O.default.prototype),e.exports=t.default},function(e,t){e.exports=require("class-private-method-decorator")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={NotSignedInError:n(93),WrongCredentialsError:n(96),NotFoundError:n(92),PermissionDeniedError:n(94),ValidationError:n(54),TargetNotSupportedError:n(95),ConnectionUnavailableError:n(91)},e.exports=t.default},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("lodash/defaults")},function(e,t){e.exports=require("reuse-promise")},function(e,t){"use strict";function n(){return r(this)}function r(e){return Array.isArray(e)?e:void 0!=e&&null!=e?[e]:[]}function o(e,t,n){!(n in e)&&t in e&&(e[n]=e[t],delete e[t])}Object.defineProperty(t,"__esModule",{value:!0}),t.arrayWrapBound=n,t.arrayWrap=r,t.replaceKey=o},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{fallbackValue:null,httpStatusCodes:[404]};return function(t,n,r){var o=r.value;return r.value=function(){var t=(0,s.default)(i.default.mark(function t(){var n,r,a,u=arguments;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(t.prev=0,n=u.length,r=Array(n),a=0;a<n;a++)r[a]=u[a];return t.next=4,o.call.apply(o,[this].concat(r));case 4:return t.abrupt("return",t.sent);case 7:if(t.prev=7,t.t0=t.catch(0),!t.t0.response||!e.httpStatusCodes.includes(t.t0.response.status)){t.next=13;break}return t.abrupt("return",e.fallbackValue);case 13:throw t.t0;case 14:case"end":return t.stop()}},t,this,[[0,7]])}));return function(){return t.apply(this,arguments)}}(),r}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(9),i=r(a),u=n(8),s=r(u),c=n(20),l=r(c),f=n(1),d=r(f);t.recoverFromNotFound=o;var p=n(32),y=r(p),h=function e(t,n){(0,d.default)(this,e),(0,l.default)(this,n),this.config=t.config,this.host=t,this.httpClient=t.httpClient};t.default=h,(0,l.default)(h.prototype,y.default.prototype)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ServerValueEnum=t.default=void 0;var o=n(3),a=r(o),i=n(5),u=r(i),s=n(4),c=r(s),l=n(137),f=r(l),d=n(12),p=r(d),y=n(1),h=r(y),g=n(2),v=r(g),m=n(159),b=r(m),w=n(42),E=r(w),x=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,h.default)(this,e),Array.isArray(t)&&(t=t.reduce(function(e,t){return e[t]={},e},{})),this.keys=[],this.entries=[],this.entriesByKey={},this.defaultValue=n.defaultValue||null;for(var r in t){this[r]=r;var o=(0,p.default)({key:r},t[r]);this.entriesByKey[r]=o,this.entries.push(o),this.keys.push(r)}(0,f.default)(this.keys),(0,f.default)(this.entries),(0,f.default)(this.entriesByKey)}return(0,v.default)(e,[{key:"resolve",value:function(e){return e||this.defaultValue}},{key:"isValid",value:function(e){return!!this.entriesByKey[e]}}]),e}();t.default=x,t.ServerValueEnum=function(e){function t(){return(0,h.default)(this,t),(0,u.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,v.default)(t,[{key:"mapEnumKeyToServerValue",value:function(){return this._mapEnumKeyToServerValue||(this._mapEnumKeyToServerValue=(0,E.default)(this.entries,function(e,t){return e[t.key]=t.serverValue},{}))}},{key:"mapServerValueToEnumKey",value:function(){return this._mapServerValueToEnumKey||(this._mapServerValueToEnumKey=(0,b.default)(this.mapEnumKeyToServerValue()))}},{key:"fromServer",value:function(e){return this.mapServerValueToEnumKey()[e]}},{key:"toServer",value:function(e){return this.mapEnumKeyToServerValue()[e]||this.mapServerValueToEnumKey()[e]}},{key:"resolve",value:function(e){return(this.isValid(e)?e:this.fromServer(e))||this.defaultValue}}]),t}(x)},function(e,t){e.exports=require("autobind-decorator")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={MessageRecipientStatus:n(36),MessageSenderStatus:n(111),MessageDirection:n(109),PresenceStatus:n(55),GroupType:n(108),MessageType:n(112),MessagePriority:n(110)},e.exports=t.default},function(e,t){e.exports=require("lodash-bound/map")},function(e,t){e.exports=require("lodash/each")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=r(o),i=n(54),u=r(i),s={isOneOf:function(e,t,n){return n.includes(t)},isNotEmpty:function(e,t){return!!t},raise:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"invalid",n=arguments[2];throw new u.default(e,t,n)}};(0,a.default)(s).forEach(function(e){var t=e.replace(/^is([A-Z])/,function(e,t){return t.toLowerCase()}),n=s[e];s[t]=function(e,t,r){for(var o=arguments.length,a=Array(o>3?o-3:0),i=3;i<o;i++)a[i-3]=arguments[i];n.apply(void 0,[e,t,r].concat(a))||s.raise(e,void 0,r)}}),t.default=s,e.exports=t.default},function(e,t){e.exports=require("babel-runtime/core-js/get-iterator")},function(e,t){e.exports=require("babel-runtime/core-js/symbol/iterator")},function(e,t){e.exports=require("babel-runtime/helpers/defineProperty")},function(e,t){e.exports=require("babel-runtime/helpers/objectWithoutProperties")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("lodash-bound/filter")},function(e,t){e.exports=require("lodash/pick")},function(e,t){e.exports=require("lodash/values")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),o=new r.ServerValueEnum({READ:{serverValue:"Read"},DELIVERED:{serverValue:"Delivered"},RECEIVED_ON_CLIENT:{serverValue:"ReceivedOnClient"},NEW:{serverValue:"New"},NA:{key:"NA"}});t.default=o,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e.get(t);if(o)o.$placeholder?o.$$loading||o.$notFound||r.onlyPlaceholder||a(e,o,r):(r.onExists&&r.onExists(o),r.onFinish&&r.onFinish(o));else{if(n=(0,I.default)((0,O.default)({},e.idAttribute,t),n),r.onMissing&&r.onMissing(),o=e.createInstance(n),Object.defineProperty(o,"$placeholder",{value:!0,configurable:!0}),e.inject(o),r.onlyPlaceholder)return o;a(e,o,r)}}function a(e,t,n){var r=C(t);if(!S[r]){if(!n.placeholderEntityDelayBeforeRefreshing){var o;return M(e,t,n).catch((o=console).error.bind(o))}Object.defineProperty(t,"$$loadingScheduled",{value:!0,configurable:!0}),S[r]=setTimeout(function(){return G(e,t,n)},n.placeholderEntityDelayBeforeRefreshing)}}function i(e,t){var n=t.finder,r=t.defaultPlaceholderAttrs,a=t.defaultNotFoundAttrs,i=t.placeholderEntityDelayBeforeRefreshing,u=t.placeholderEntityAllowLoading,l=t.shouldEnsure;if(null==arguments[1]||null!=arguments[1].finder&&"function"!=typeof arguments[1].finder||!(null==arguments[1].defaultPlaceholderAttrs||arguments[1].defaultPlaceholderAttrs instanceof Object)||!(null==arguments[1].defaultNotFoundAttrs||arguments[1].defaultNotFoundAttrs instanceof Object)||null!=arguments[1].placeholderEntityDelayBeforeRefreshing&&"function"!=typeof arguments[1].placeholderEntityDelayBeforeRefreshing&&null!=arguments[1].placeholderEntityDelayBeforeRefreshing&&"number"!=typeof arguments[1].placeholderEntityDelayBeforeRefreshing||null!=arguments[1].placeholderEntityAllowLoading&&"function"!=typeof arguments[1].placeholderEntityAllowLoading&&null!=arguments[1].placeholderEntityAllowLoading&&"boolean"!=typeof arguments[1].placeholderEntityAllowLoading||null!=arguments[1].shouldEnsure&&"function"!=typeof arguments[1].shouldEnsure)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  finder: ?Function;\n  defaultPlaceholderAttrs: ?Object;\n  defaultNotFoundAttrs: ?Object;\n  placeholderEntityDelayBeforeRefreshing: ?Function | ?number;\n  placeholderEntityAllowLoading: ?Function | ?boolean;\n  shouldEnsure: ?Function;\n}\n\nGot:\n"+c(arguments[1]));if(null==arguments[1]||null!=arguments[1].finder&&"function"!=typeof arguments[1].finder||!(null==arguments[1].defaultPlaceholderAttrs||arguments[1].defaultPlaceholderAttrs instanceof Object)||!(null==arguments[1].defaultNotFoundAttrs||arguments[1].defaultNotFoundAttrs instanceof Object)||null!=arguments[1].placeholderEntityDelayBeforeRefreshing&&"function"!=typeof arguments[1].placeholderEntityDelayBeforeRefreshing&&null!=arguments[1].placeholderEntityDelayBeforeRefreshing&&"number"!=typeof arguments[1].placeholderEntityDelayBeforeRefreshing||null!=arguments[1].placeholderEntityAllowLoading&&"function"!=typeof arguments[1].placeholderEntityAllowLoading&&null!=arguments[1].placeholderEntityAllowLoading&&"boolean"!=typeof arguments[1].placeholderEntityAllowLoading||null!=arguments[1].shouldEnsure&&"function"!=typeof arguments[1].shouldEnsure)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  finder: ?Function;\n  defaultPlaceholderAttrs: ?Object;\n  defaultNotFoundAttrs: ?Object;\n  placeholderEntityDelayBeforeRefreshing: ?Function | ?number;\n  placeholderEntityAllowLoading: ?Function | ?boolean;\n  shouldEnsure: ?Function;\n}\n\nGot:\n"+s(arguments[1]));e.ensureEntity=function(t){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"function"==typeof i&&(i=i()),"function"==typeof u&&(u=u()),o(e,t,(0,I.default)({},r,s.attrs),(0,I.default)({finder:n,notFoundAttributes:a,placeholderEntityDelayBeforeRefreshing:i,placeholderEntityAllowLoading:u},s))},e.waitForEnsuredEntity=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new v.default(function(r,o){e.ensureEntity(t,(0,I.default)({},n,{onFinish:r}))})},e.shouldEnsure=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return"string"==typeof t&&(t=e.get(t)),!t||!(!l||!l(t,n,r))||!(!t.$placeholder||t.$$loading||n)}}function u(){(0,A.default)(S).map(function(e){return clearTimeout(e)}),S={}}function s(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(!Array.isArray(e)){var o=(0,p.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),i=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+s(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(i+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+i+"\n"+a+"}":"{\n  "+a+i+"\n"+a+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=s(e[0],t);return e.every(function(e){return s(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return s(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,h.default)(u))?u.v:void 0}function c(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(!Array.isArray(e)){var o=(0,p.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),i=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+c(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(i+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+i+"\n"+a+"}":"{\n  "+a+i+"\n"+a+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=c(e[0],t);return e.every(function(e){return c(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return c(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,h.default)(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var l=n(7),f=r(l),d=n(6),p=r(d),y=n(10),h=r(y),g=n(16),v=r(g),m=n(9),b=r(m),w=n(20),E=r(w),x=n(8),_=r(x),k=n(30),O=r(k),T=n(12),I=r(T),j=n(35),A=r(j),M=function(){var e=(0,_.default)(b.default.mark(function e(t,n,r){var o;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.placeholderEntityAllowLoading){e.next=2;break}return e.abrupt("return");case 2:return Object.defineProperty(n,"$$loading",{value:!0,configurable:!0}),o=void 0,e.prev=4,e.next=7,r.finder(n.id);case 7:e.next=18;break;case 9:if(e.prev=9,e.t0=e.catch(4),e.t0.code!==z.default.NotFoundError.CODE){e.next=15;break}o=!0,e.next=18;break;case 15:e.next=18;break;case 18:delete n.$$loading,o?((0,E.default)(n,r.notFoundAttributes),Object.defineProperty(n,"$notFound",{value:!0,configurable:!0}),t.touch(n),r.onNotFound&&r.onNotFound(),r.onLoad&&r.onLoad(null),r.onFinish&&r.onFinish(null)):(delete n.$placeholder,delete n.$notFound,t.touch(n),r.onSuccess&&r.onSuccess(n),r.onLoad&&r.onLoad(n),r.onFinish&&r.onFinish(n));case 20:case"end":return e.stop()}},e,this,[[4,9]])}));return function(t,n,r){return e.apply(this,arguments)}}(),G=function(){var e=(0,_.default)(b.default.mark(function e(t,n,r){return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,delete n.$$loadingScheduled,delete S[C(n)],n.$placeholder){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",M(t,n,r));case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(t,n,r){return e.apply(this,arguments)}}();t.default=i,t.dispose=u;var V=n(15),z=r(V),S={},C=function(e){return e.$entityType+":"+e.id}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return(0,f.default)(e)?e.map(function(e){return o(e,t)}):(0,c.default)(e)?(0,u.default)(e,function(e,n,r){e[t(r)]=o(n,t)},{}):e}Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),i=(r(a),n(42)),u=r(i),s=n(161),c=r(s),l=n(160),f=r(l),d=n(173),p=r(d),y=n(70),h=r(y),g=n(167),v=r(g),m={camelizeKey:(0,v.default)(h.default),underscoreKey:(0,v.default)(p.default),camelizeObject:function(e){return o(e,m.camelizeKey)},underscoreObject:function(e){return o(e,m.underscoreKey)}};t.default=m,e.exports=t.default},function(e,t){e.exports=require("babel-runtime/helpers/toConsumableArray")},function(e,t){e.exports=require("lodash/get")},function(e,t){e.exports=require("lodash/isEmpty")},function(e,t){e.exports=require("lodash/transform")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),a=r(o),i=new a.default(["ONLINE","OFFLINE","CONNECTING","UNREACHABLE"]);t.default=i,e.exports=t.default},function(e,t){e.exports=require("babel-runtime/core-js/object/entries")},function(e,t){e.exports=require("babel-runtime/helpers/slicedToArray")},function(e,t){e.exports=require("btoa")},function(e,t){e.exports=require("lodash-bound/flatten")},function(e,t){e.exports=require("lodash-bound/orderBy")},function(e,t){e.exports=require("lodash-bound/uniq")},function(e,t){e.exports=require("lodash/filter")},function(e,t){e.exports=require("lodash/omit")},function(e,t){e.exports=require("lodash/throttle")},function(e,t){e.exports=require("moment")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(3),u=r(i),s=n(1),c=r(s),l=n(5),f=r(l),d=n(4),p=r(d),y=(a=o=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"invalid",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e+" is "+n;(0,c.default)(this,t);var o=(0,f.default)(this,(t.__proto__||(0,u.default)(t)).call(this,r));return o.code=t.CODE,o.name=e,o.reason=n,o}return(0,p.default)(t,e),t}(Error),o.CODE="validation",a);t.default=y,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),o=new r.ServerValueEnum({UNKNOWN:{serverValue:"unknown"},AVAILABLE:{serverValue:"available"},UNAVAILABLE:{serverValue:"unavailable"}});t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Event:n(99),SearchResult:n(106)};t.default=r,e.exports=t.default},function(e,t,n){},function(e,t,n){"use strict";!function(){try{var e=n(141).request().constructor.prototype;e.setNoDelay||(e.setNoDelay=function(){}),e.abort||(e.abort=function(){this.xhr&&this.xhr.abort()})}catch(e){}}()},function(e,t){e.exports=require("file-type")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("is-email")},function(e,t){e.exports=require("jshashes")},function(e,t){e.exports=require("lodash-bound/keyBy")},function(e,t){e.exports=require("lodash-bound/keys")},function(e,t){e.exports=require("lodash-bound/mapValues")},function(e,t){e.exports=require("lodash-bound/omitBy")},function(e,t){e.exports=require("lodash-bound/values")},function(e,t){e.exports=require("lodash-bound/without")},function(e,t){e.exports=require("lodash/assign")},function(e,t){e.exports=require("lodash/camelCase")},function(e,t){e.exports=require("lodash/defaultsDeep")},function(e,t){e.exports=require("lodash/difference")},function(e,t){e.exports=require("lodash/find")},function(e,t){e.exports=require("lodash/identity")},function(e,t){e.exports=require("lodash/sumBy")},function(e,t){e.exports=require("node-uuid")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("shallowequal")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p.default)(e);if(!Array.isArray(e)){var o=(0,z.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,p.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p.default)(e);if(!Array.isArray(e)){var o=(0,z.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,p.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var u,s,c,l=n(7),f=r(l),d=n(10),p=r(d),y=n(11),h=r(y),g=n(20),v=r(g),m=n(45),b=r(m),w=n(28),E=r(w),x=n(29),_=r(x),k=n(44),O=r(k),T=n(16),I=r(T),j=n(9),A=r(j),M=n(8),G=r(M),V=n(6),z=r(V),S=n(12),C=r(S),P=n(1),N=r(P),R=n(2),U=r(R),q=n(169),F=r(q),$=n(26),L=r($),B=n(70),D=r(B),K=n(166),Z=r(K),W=n(17),H=r(W),X=n(81),Q=r(X),Y=n(80),J=r(Y),ee=n(32),te=r(ee),ne=n(76),re=r(ne),oe=n(15),ae=r(oe),ie=n(90),ue=r(ie),se=n(127),ce=r(se),le=n(129),fe=r(le),de=n(24),pe=r(de),ye=n(143),he=r(ye),ge=(n(14),n(23)),ve=r(ge),me=n(131),be=r(me),we=n(43),Ee=r(we),xe="UpM28mnfW65vJkbqEATtKvxm",_e={tt:"https://api.tigertext.me/v2",production:"https://developer.tigertext.me/v2",uat:"https://uat-devapi.tigertext.me/v2",qa:"https://qa-devapi.tigertext.me/v2",productionOauth:"http://52.41.133.15:8000/tigertextapi/v2"},ke={events:{autoAck:!1,isTyping:!0,multiOrg:!0,noOfflineMessages:!1,autoDeliver:!1,hidden:!1,closeAfterMessages:!1},autoAckSuccessfullyHandledEvents:!0,logLevel:"error",serviceLogLevels:{},eventsAutoReconnect:!0,flushAckInterval:2e3,flushAckMaxEvents:500,flushSetMessageStatusInterval:1e3,flushMessageMaxCount:500,conversationReloadDelay:200,eventsAutoReconnectDelay:2e3,clearTypingStatusTimeout:15e3,organizationRostersChangeThrottleDelay:500,placeholderEntityAllowLoading:!0,placeholderEntityDelayBeforeRefreshing:100,consumerOrganizationId:xe,maxMetadataKeyCount:8,pushAgent:"consumer",baseUrl:null,apiEnv:"production",productKey:"bc1oOf3DZXbnaNZ2LCWZGvSg",version:"1.0",autoSignOutOnBrowserUnload:!1},Oe=(c=s=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,N.default)(this,e),this.VERSION=be.default,this.version=be.default,!(null==n||n instanceof Object))throw new TypeError('Value of argument "config" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+i(n));if(!(null==n||n instanceof Object))throw new TypeError('Value of argument "config" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+a(n));this.config=(0,H.default)(n,ke),this.config.baseUrl||(this.config.baseUrl=_e[this.config.apiEnv]),this.config.autoSignOutOnBrowserUnload=!1,this.httpClient=new J.default({baseUrl:this.config.baseUrl,logger:new Q.default({name:"HttpClient",level:this.config.logLevel})}),this.enums=(0,C.default)({},pe.default,{NetworkStatus:Ee.default}),this.store=new fe.default(this,{logger:new Q.default({name:"Store",level:this.config.logLevel})}),this.store.defineModels(),this.models=this.store.models,this.modelsByEntityType=(0,Z.default)(this.store.models,function(e,t){return(0,D.default)(t)}),this.allModelEntityTypes=(0,z.default)(this.modelsByEntityType),this.logger=new Q.default({name:"TigerConnectClient",level:this.config.logLevel}),this.api={},(0,L.default)(ue.default,function(e,n){t.api[(0,D.default)(n)]=new e(t,{logger:new Q.default({name:e.name,level:t.config.logLevel})})}),this._services={},(0,L.default)(ce.default,function(e,n){n=(0,D.default)(n),t._services[n]=t[n]=new e(t,{logger:new Q.default({name:e.name,level:t.config.serviceLogLevels[n]||t.config.logLevel})})}),(0,L.default)(this._services,function(e){return e.mounted&&e.mounted()}),this._listenToEvents(),this._startTicker(),this.config.autoSignOutOnBrowserUnload&&this.on("browserUnload",function(e){return e(function(){t.config.autoSignOutOnBrowserUnload&&t.signOut({async:!1,resetClient:!1})},100,"signOut")}),this.currentlyServingOfflineMessages=!1}return(0,U.default)(e,[{key:"_listenToEvents",value:function(){var e=this;this.httpClient.on("networkStatus:change",function(t){var n=t.networkStatus;e.emit("networkStatus:change",{networkStatus:n})}).on("auth:invalid",function(){e.emit("auth:invalid")}),this.on("signedIn",function(t,n){e.logger.info("signedIn",t.id)}).on("signedOut",function(t){var n=t.resetClient;n&&e.reset()}).on("signUp",function(t){var n=t.user,r=t.auth;e.logger.info("signUp",n.id),e._setCurrentUser(n),e._setAuth(r)}),this.events.on("event",function(t){return e.emit("event",t)}),this.conversations.on("message",function(t){return e.emit("message",t)}),this.conversations.on("change",function(t){return e.emit("conversation:change",t)}),this.groups.on("membership:change",function(t){return e.emit("group:membership:change",t)}),this.presence.on("change",function(t){return e.emit("presence:change",t)}),this.typingStatus.on("change",function(t){return e.emit("typing:change",t)}),"undefined"!=typeof window&&window.addEventListener("beforeunload",this._onBrowserUnload)}},{key:"_onBrowserUnload",value:function(){var e=[],t=function(t,n,r){return e.push({fn:t,priority:n,name:r})};this.emit("browserUnload",t),
(0,F.default)(e,["priority"],["desc"]).forEach(function(e){var t=e.fn,n=e.priority,r=e.name;console.log("[unload]",n,r),t()})}},{key:"_startTicker",value:function(){this.__ticker=setInterval(this._onTick,1e3)}},{key:"_stopTicker",value:function(){clearInterval(this.__ticker)}},{key:"_onTick",value:function(){this.emit("tick")}},{key:"signIn",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(t,n){var r,o,a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{udid:void 0};return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.udid=i.udid||(0,re.default)(),this.emit("signingIn"),e.prev=2,e.next=5,this.users.signIn(t,n,i);case 5:return r=e.sent,o=r.user,a=r.auth,this._setCurrentUser(o),this._setAuth(a),e.next=12,this.users.findMe({bypassCache:!0});case 12:return this.emit("signedIn",o,a),e.abrupt("return",{user:o,auth:a});case 16:throw e.prev=16,e.t0=e.catch(2),e.t0;case 20:case"end":return e.stop()}},e,this,[[2,16]])}));return e}()},{key:"signOut",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{async:!0,resetClient:!0},n=t.async,r=void 0===n||n,o=t.resetClient,u=void 0===o||o;if(!this.isSignedIn)return I.default.resolve();if(this.emit("signingOut"),!r&&"undefined"==typeof XMLHttpRequest)throw new Error("async: false option has to be on the browser.");if(r)return this.users.signOut({async:r}).then(function(){e._currentUser=null,e._auth=null,e.httpClient.removeAuth(),e.events.disconnect(),e.emit("signedOut",{resetClient:u})});var s=new XMLHttpRequest;if(s.open("POST",this.config.baseUrl+"/logout",!1),y=(0,O.default)(this.httpClient.getAuthHeaders()),!y||"function"!=typeof y[_.default]&&!Array.isArray(y))throw new TypeError("Expected _Object$entries to be iterable, got "+a(y));if(!y||"function"!=typeof y[_.default]&&!Array.isArray(y))throw new TypeError("Expected _Object$entries to be iterable, got "+i(y));var c=!0,l=!1,f=void 0;try{for(var d,p=(0,E.default)(y);!(c=(d=p.next()).done);c=!0){var y,h=(0,b.default)(d.value,2),g=h[0],v=h[1];s.setRequestHeader(g,v)}}catch(e){l=!0,f=e}finally{try{!c&&p.return&&p.return()}finally{if(l)throw f}}return s.send(null),this.emit("signedOut",{resetClient:u}),I.default.resolve()}},{key:"wipe",value:function(){function e(){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signOut();case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"authenticate",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return this._authenticateWithParams({key:e,secret:t})}},{key:"authenticateUsingOauth",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{udid:void 0};if("string"!=typeof e)throw new TypeError('Value of argument "bearerToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "bearerToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return t.udid=t.udid||(0,re.default)(),this._authenticateWithParams({bearerToken:e,udid:t.udid})}},{key:"_authenticateWithParams",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(t){var n;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._setAuth(t),e.prev=1,e.next=4,this.users.findMe();case 4:return n=e.sent,this._setCurrentUser(n),this.emit("signedIn",n,t),e.abrupt("return",n);case 10:throw e.prev=10,e.t0=e.catch(1),this._removeAuth(),this._currentUser=null,e.t0;case 15:case"end":return e.stop()}},e,this,[[1,10]])}));return e}()},{key:"_setCurrentUser",value:function(e){this._currentUser=e}},{key:"_setAuth",value:function(e){this._auth=e,this.httpClient.setAuth(e)}},{key:"_removeAuth",value:function(){this._auth=null,this.httpClient.removeAuth()}},{key:"getCurrentUser",value:function(){return this._currentUser||null}},{key:"getAuth",value:function(){return this._auth}},{key:"requireUser",value:function(){if(!this.isSignedIn)throw new ae.default.NotSignedInError}},{key:"reactToAdvisoryEvent",value:function(e,t){var n=this;switch(this.emit("advisory",{type:e,data:t}),e){case"replayStart":this.currentlyServingOfflineMessages=!0,this.emit("messages:offline:start",t);break;case"replayStop":var r=function(){n.currentlyServingOfflineMessages=!1,n.emit("messages:offline:stop"),n.emit("messages:new:start")};this.conversations.hasPendingReloads()?this.conversations.once("_reloadQueueFinished",r):r()}}},{key:"modelByTypeNS",value:function(e){return this.MODEL_BY_TYPE_NS[e]}},{key:"injectModel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.xmlns||e.type,n=this.modelByTypeNS(t);return n?n.inject(e):((0,he.default)(n,"injectModel: Missing class for "+t),null)}},{key:"getEntity",value:function(e,t){return this.modelsByEntityType[e].get(t)}},{key:"getEntities",value:function(e){var t=this;return e.map(function(e){return t.getEntity(e.type,e.id)})}},{key:"dispose",value:function(){this._stopTicker(),(0,L.default)(this._services,function(e){return e.dispose&&e.dispose()}),this.store&&this.store.clear()}},{key:"reset",value:function(){this.dispose(),(0,L.default)(this._services,function(e){return e.mounted&&e.mounted()}),this._startTicker()}},{key:"configure",value:function(e){return(0,v.default)(this.config,e),this}},{key:"setDefaultOrganization",value:function(e){return this.configure({defaultOrganizationId:e})}},{key:"currentUser",get:function(){return this.getCurrentUser()}},{key:"currentUserId",get:function(){return this.getCurrentUser()&&this.getCurrentUser().id}},{key:"isSignedIn",get:function(){return null!=this.getAuth()}},{key:"MODEL_BY_TYPE_NS",get:function(){return this._MODEL_BY_TYPE_NS||(this._MODEL_BY_TYPE_NS={"tigertext:entity:account":this.models.User,"tigertext:entity:group":this.models.Group,"tigertext:entity:distribution_list":this.models.DistributionList,"tigertext:entity:list":this.models.DistributionList,"tigertext:iq:message":this.models.Message,"tigertext:iq:group_message":this.models.Message,"tigertext:iq:group:message":this.models.Message}),this._MODEL_BY_TYPE_NS}},{key:"networkStatus",get:function(){return this.httpClient.networkStatus}}]),e}(),s.errors=ae.default,s.VERSION=be.default,s.version=be.default,s.CONSUMER_ORGANIZATION_ID=xe,u=c,o(u.prototype,"_onBrowserUnload",[ve.default],(0,h.default)(u.prototype,"_onBrowserUnload"),u.prototype),o(u.prototype,"_onTick",[ve.default],(0,h.default)(u.prototype,"_onTick"),u.prototype),u);(0,v.default)(Oe.prototype,te.default.prototype),t.default=Oe,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"attachment",r=e.name;if(!r)if("string"==typeof e)r=n(77).basename(e);else if(e instanceof Buffer){var o=(0,$.default)(n(59)(e),"ext");r=t+"."+o}return r}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g.default)(e);if(!Array.isArray(e)){var o=(0,l.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var c=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof c?"undefined":(0,g.default)(c))?c.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g.default)(e);if(!Array.isArray(e)){var o=(0,l.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var c=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof c?"undefined":(0,g.default)(c))?c.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var u=n(7),s=r(u),c=n(6),l=r(c),f=n(20),d=r(f),p=n(12),y=r(p),h=n(10),g=r(h),v=n(45),m=r(v),b=n(28),w=r(b),E=n(29),x=r(E),_=n(44),k=r(_),O=n(16),T=r(O),I=n(9),j=r(I),A=n(8),M=r(A),G=n(1),V=r(G),z=n(2),S=r(z),C=n(172),P=r(C),N=n(41),R=r(N),U=n(17),q=r(U),F=n(40),$=r(F),L=n(168),B=r(L),D=n(184),K=r(D),Z=n(46),W=r(Z),H=n(15),X=r(H),Q=n(185),Y=r(Q),J=n(18),ee=n(32),te=r(ee),ne=n(139),re=r(ne),oe=n(43),ae=r(oe);n(186)(K.default);var ie=["get","post","put","patch","del"],ue=function(){function e(t){(0,V.default)(this,e),this.downloadFileBlobAndUrl=function(){return X.default.TargetNotSupportedError.raise()},this.config=t,this.logger=t.logger,this._prefixBaseUrl=(0,Y.default)(this.config.baseUrl),this._watchNetworkConnection()}return(0,S.default)(e,[{key:"setAuth",value:function(e){e.key&&e.secret?(this._key=e.key,this._secret=e.secret):e.bearerToken&&(this._bearerToken=e.bearerToken,this._udid=e.udid)}},{key:"removeAuth",value:function(){this._key=null,this._secret=null,this._bearerToken=null,this._udid=null}},{key:"getAuthHeaderForKeyAndSecret",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._key,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._secret;if("string"!=typeof e)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(null!=t&&"string"!=typeof t)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(null!=t&&"string"!=typeof t)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(t));return e&&t?"Basic "+(0,W.default)(e+":"+t):null}},{key:"getAuthHeaderForBererToken",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._bearerToken;if("string"!=typeof e)throw new TypeError('Value of argument "bearerToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "bearerToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return"Bearer "+e}},{key:"getAuthHeaders",value:function(){return this._key&&this._secret?{Authorization:this.getAuthHeaderForKeyAndSecret()}:this._bearerToken&&this._udid?{Authorization:this.getAuthHeaderForBererToken(),"X-Device-ID":this._udid}:{}}},{key:"_contentType",value:function(e){switch(e){case"json":return"application/json";case"event-stream":return"text/event-stream";case"text":default:return"plain/text"}}},{key:"downloadFileBlob",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));X.default.TargetNotSupportedError.raise()}},{key:"downloadToFile",value:function(e,t){var r=this,o=function(){var o=n(60);return{v:new T.default(function(a,i){var u=r.config.baseUrl+e;n(183)({url:u,headers:r.getAuthHeaders()},function(e,t){e||t&&t.statusCode<200||t.statusCode>299?i(new Error("Failed downloading "+u+". Error: "+e.message+" | Status: "+(t?t.statusCode:null))):a()}).pipe(o.createWriteStream(t))})}}();if("object"===("undefined"==typeof o?"undefined":(0,g.default)(o)))return o.v}},{key:"_watchNetworkConnection",value:function(){this.networkStatus=ae.default.ONLINE}},{key:"_setNetworkStatus",value:function(e){e!==this.networkStatus&&(e===ae.default.UNREACHABLE&&this.networkStatus===ae.default.OFFLINE||(this.networkStatus=e,this.emit("networkStatus:change",{networkStatus:this.networkStatus})))}},{key:"createEventSource",value:function(e,t){var n=this,r=t.headers,o=t.onOpen,u=t.onMessage,s=t.onError,c=t.onClose;if("string"!=typeof e)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(null==arguments[1]||!(null==arguments[1].headers||arguments[1].headers instanceof Object)||null!=arguments[1].onOpen&&"function"!=typeof arguments[1].onOpen||null!=arguments[1].onMessage&&"function"!=typeof arguments[1].onMessage||null!=arguments[1].onError&&"function"!=typeof arguments[1].onError||null!=arguments[1].onClose&&"function"!=typeof arguments[1].onClose)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  headers: ?Object;\n  onOpen: ?Function;\n  onMessage: ?Function;\n  onError: ?Function;\n  onClose: ?Function;\n}\n\nGot:\n"+i(arguments[1]));if("string"!=typeof e)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(null==arguments[1]||!(null==arguments[1].headers||arguments[1].headers instanceof Object)||null!=arguments[1].onOpen&&"function"!=typeof arguments[1].onOpen||null!=arguments[1].onMessage&&"function"!=typeof arguments[1].onMessage||null!=arguments[1].onError&&"function"!=typeof arguments[1].onError||null!=arguments[1].onClose&&"function"!=typeof arguments[1].onClose)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  headers: ?Object;\n  onOpen: ?Function;\n  onMessage: ?Function;\n  onError: ?Function;\n  onClose: ?Function;\n}\n\nGot:\n"+a(arguments[1]));r=r||{},r=(0,y.default)({},this.getAuthHeaders(),r),o=o||B.default,u=u||B.default,s=s||B.default,c=c||B.default;var l=/https?:/.test(e)?e:this.config.baseUrl+e,f=new re.default(l,{headers:r});return f.once("open",function(){n._setNetworkStatus(ae.default.ONLINE),o()}),f.on("message",u),f.once("error",function(e){e&&(0===e.status?n._setNetworkStatus(ae.default.UNREACHABLE):401===e.status&&n.emit("auth:invalid")),s(e)}),f.once("close",c),f}}]),e}();ie.forEach(function(e){ue.prototype[e]=function(){var t=(0,M.default)(j.default.mark(function t(n){var r,u,s=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return j.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return c=(0,q.default)(c||{},{reqFormat:"json",resFormat:"json"}),c.urlParams&&(n=n.replace(/:([\w\-]+)/g,function(e,t){return encodeURIComponent(c.urlParams[t])})),this.logger&&this.logger.info("start",e.toUpperCase(),n,c),r=(0,d.default)({},c.headers),(0,R.default)(c.files)&&(r["Content-Type"]=r["Content-Type"]||this._contentType(c.reqFormat)),r.Accept=r.Accept||this._contentType(c.resFormat),c.requestId&&(r["Request-ID"]=c.requestId),u=new T.default(function(t,u){var l=K.default[e](n).use(s._prefixBaseUrl).set(r).query(c.query||{});c.retry!==!1&&(l=l.retry(c.retryCount||3)),c.timeout!==!1&&(l=l.timeout(c.timeout===!0?5e3:c.timeout));var f=!(0,R.default)(c.files);if(f?(l=(0,P.default)(c.data,function(e,t,n){return e.field(n,String(t))},l),l=(0,P.default)(c.files,function(e,t,n,r){return t?e.attach(n,t,o(t,"attachment-"+r)):e.field(n,"")},l),l=l.send()):l=l.send(c.data||{}),!("Authorization"in r)){if(v=(0,k.default)(s.getAuthHeaders()),!v||"function"!=typeof v[x.default]&&!Array.isArray(v))throw new TypeError("Expected _Object$entries2 to be iterable, got "+a(v));if(!v||"function"!=typeof v[x.default]&&!Array.isArray(v))throw new TypeError("Expected _Object$entries2 to be iterable, got "+i(v));var d=!0,p=!1,y=void 0;try{for(var h,g=(0,w.default)(v);!(d=(h=g.next()).done);d=!0){var v,b=(0,m.default)(h.value,2),E=b[0],_=b[1];l=l.set(E,_)}}catch(e){p=!0,y=e}finally{try{!d&&g.return&&g.return()}finally{if(p)throw y}}}l.end(function(r,o){if(r)return s.logger&&s.logger.info("error",e.toUpperCase(),n,r),void(r.status?401==r.status?(s.emit("auth:invalid"),u(new X.default.WrongCredentialsError)):u(r):(s._setNetworkStatus(ae.default.UNREACHABLE),u(new X.default.ConnectionUnavailableError)));switch(s._setNetworkStatus(ae.default.ONLINE),c.resFormat){case"json":var a=o.body||{};"reply"in a&&(a=a.reply);var i={data:a,headers:o.headers,getHeader:function(e){return o.headers[e.toLowerCase()]},status:o.status};Object.defineProperty(i,"_origData",{get:function(){return o.body}}),s.logger&&s.logger.info("success",e.toUpperCase(),n,i),t(i);break;default:s.logger&&s.logger.info("success",e.toUpperCase(),n,o.text?o.text.substr(0,80)+"...":"[null]"),t(o.text)}})}),t.abrupt("return",u);case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}),!function(){var e=ue.prototype.get,t=(0,J.decorator)(e);ue.prototype.get=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.reusePromise?t.call(this,n,r):e.call(this,n,r)}}(),(0,d.default)(ue.prototype,te.default.prototype),t.default=ue,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,f.default)(e);if(!Array.isArray(e)){var a=(0,c.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u.default)(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var l=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof l?"undefined":(0,f.default)(l))?l.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,f.default)(e);if(!Array.isArray(e)){var o=(0,c.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var l=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof l?"undefined":(0,f.default)(l))?l.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(7),u=r(i),s=n(6),c=r(s),l=n(10),f=r(l),d=n(39),p=r(d),y=n(1),h=r(y),g=n(2),v=r(g),m=function(){function e(t){var n=t.name,r=t.level;if((0,h.default)(this,e),null==arguments[0]||"string"!=typeof arguments[0].name||"string"!=typeof arguments[0].level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  name: string;\n  level: string;\n}\n\nGot:\n"+a(arguments[0]));if(null==arguments[0]||"string"!=typeof arguments[0].name||"string"!=typeof arguments[0].level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  name: string;\n  level: string;\n}\n\nGot:\n"+o(arguments[0]));this.name=n,this.level=r}return(0,v.default)(e,[{key:"setLevel",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));if(this.level=e.toLowerCase(),"string"!=typeof this.level)throw new TypeError('Value of "this.level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(this.level))}}]),e}();t.default=m;var b=["debug","log","info","warn","error"],w=b.reduce(function(e,t,n){return e[t]=n,e},{});b.forEach(function(e){var t=w[e];m.prototype[e]=function(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];t>=w[this.level]&&(r=["["+this.name+"]"].concat((0,p.default)(r)),Function.prototype.apply.call(console[e],console,r))}}),e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y.default)(e);if(!Array.isArray(e)){var o=(0,d.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,y.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y.default)(e);if(!Array.isArray(e)){var o=(0,d.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,y.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c=n(7),l=r(c),f=n(6),d=r(f),p=n(10),y=r(p),h=n(11),g=r(h),v=n(9),m=r(v),b=n(8),w=r(b),E=n(3),x=r(E),_=n(1),k=r(_),O=n(2),T=r(O),I=n(5),j=r(I),A=n(4),M=r(A),G=n(21),V=r(G),z=(u=(0,G.recoverFromNotFound)(),s=function(e){function t(){return(0,k.default)(this,t),(0,j.default)(this,(t.__proto__||(0,x.default)(t)).apply(this,arguments))}return(0,M.default)(t,e),(0,T.default)(t,[{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,w.default)(m.default.mark(function e(t){var n;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.get("/dist_list/:id",{urlParams:{id:t}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)}));return e}()}]),t}(V.default),o(s.prototype,"find",[u],(0,g.default)(s.prototype,"find"),s.prototype),s);t.default=z,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(!Array.isArray(e)){var o=(0,p.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(!Array.isArray(e)){var o=(0,p.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c,l=n(7),f=r(l),d=n(6),p=r(d),y=n(10),h=r(y),g=n(11),v=r(g),m=n(9),b=r(m),w=n(8),E=r(w),x=n(3),_=r(x),k=n(1),O=r(k),T=n(2),I=r(T),j=n(5),A=r(j),M=n(4),G=r(M),V=n(21),z=r(V),S=(u=(0,V.recoverFromNotFound)(),s=(0,V.recoverFromNotFound)({httpStatusCodes:[404,403]}),c=function(e){function t(){return(0,O.default)(this,t),(0,A.default)(this,(t.__proto__||(0,_.default)(t)).apply(this,arguments))}return(0,G.default)(t,e),(0,I.default)(t,[{key:"create",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t){var n,r,o,a,i,u,s,c=t.name,l=t.avatarFile,f=t.replayHistory,d=void 0===f||f,p=t.memberIds,y=void 0===p?[]:p,h=t.organizationId;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},r={name:c,replay_history:d,members:y.join(",")},o={},l&&(o.avatar=l),h&&(n["TT-X-Organization-Key"]=h),e.next=7,this.httpClient.post("/group",{headers:n,data:r,files:o});case 7:return a=e.sent,i=a.getHeader("TT-X-Group-Token"),u=a.getHeader("TT-X-Group-Avatar"),s={id:i,avatarUrl:u,name:c,memberIds:y,organizationId:h},e.abrupt("return",s);case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"update",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t,n){var r,o,a,i,u=n.name,s=void 0===u?void 0:u,c=n.avatarFile,l=void 0===c?void 0:c,f=n.replayHistory,d=void 0===f?void 0:f,p=n.memberIds;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={},o={},"undefined"!=typeof s&&(r.name=s),"undefined"!=typeof p&&(r.members=p.join(",")),"undefined"!=typeof d&&(r.replay_history=d),l&&(o.avatar=l),e.next=8,this.httpClient.post("/group/:id",{urlParams:{id:t},data:r,files:o});case 8:return a=e.sent,i=a.getHeader("TT-X-Group-Avatar"),e.abrupt("return",{id:t,avatarUrl:i});case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t){var n;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.get("/group/:id",{urlParams:{id:t}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"destroy",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t){return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.del("/group/:id",{urlParams:{id:t}});case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"addMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t,n){return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));
case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(n));case 8:return e.next=10,this.httpClient.post("/group/:id/members",{urlParams:{id:t},data:{members:n}});case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t,n){return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(n));case 8:return e.next=10,this.httpClient.post("/group/:id/members/remove",{urlParams:{id:t},data:{members:n}});case 10:case"end":return e.stop()}},e,this)}));return e}()}]),t}(z.default),o(c.prototype,"find",[u],(0,v.default)(c.prototype,"find"),c.prototype),o(c.prototype,"destroy",[s],(0,v.default)(c.prototype,"destroy"),c.prototype),c);t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p.default)(e);if(!Array.isArray(e)){var o=(0,f.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,b.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,p.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p.default)(e);if(!Array.isArray(e)){var o=(0,f.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,b.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,p.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c,l=n(6),f=r(l),d=n(10),p=r(d),y=n(11),h=r(y),g=n(9),v=r(g),m=n(7),b=r(m),w=n(12),E=r(w),x=n(8),_=r(x),k=n(3),O=r(k),T=n(1),I=r(T),j=n(2),A=r(j),M=n(5),G=r(M),V=n(4),z=r(V),S=n(21),C=r(S),P=n(61),N=r(P),R=(u=(0,S.recoverFromNotFound)(),s=(0,S.recoverFromNotFound)(),c=function(e){function t(){return(0,I.default)(this,t),(0,G.default)(this,(t.__proto__||(0,O.default)(t)).apply(this,arguments))}return(0,z.default)(t,e),(0,A.default)(t,[{key:"send",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,_.default)(v.default.mark(function e(t){var n,r,o,u,s=t.counterPartyId,c=t.body,l=t.senderOrganizationId,f=t.recipientOrganizationId,d=t.attachment,p=t.metadata,y=t.priority,h=t.ttl,g=t.deleteOnRead,m=t.localId,w=arguments;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==w[0]||"string"!=typeof w[0].counterPartyId||"string"!=typeof w[0].body||"string"!=typeof w[0].senderOrganizationId||"string"!=typeof w[0].recipientOrganizationId||!(null==w[0].attachment||w[0].attachment instanceof Object||null==w[0].attachment||"string"==typeof w[0].attachment)||!(null==w[0].metadata||w[0].metadata instanceof Object)||null!=w[0].priority&&"number"!=typeof w[0].priority||null!=w[0].ttl&&"number"!=typeof w[0].ttl||null!=w[0].deleteOnRead&&"boolean"!=typeof w[0].deleteOnRead||"string"!=typeof w[0].localId)){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  counterPartyId: string;\n  body: string;\n  senderOrganizationId: string;\n  recipientOrganizationId: string;\n  attachment: ?Object | ?string;\n  metadata: ?Object;\n  priority: ?number;\n  ttl: ?number;\n  deleteOnRead: ?boolean;\n  localId: string;\n}\n\nGot:\n"+i(w[0]));case 2:if(!(null==w[0]||"string"!=typeof w[0].counterPartyId||"string"!=typeof w[0].body||"string"!=typeof w[0].senderOrganizationId||"string"!=typeof w[0].recipientOrganizationId||!(null==w[0].attachment||w[0].attachment instanceof Object||null==w[0].attachment||"string"==typeof w[0].attachment)||!(null==w[0].metadata||w[0].metadata instanceof Object)||null!=w[0].priority&&"number"!=typeof w[0].priority||null!=w[0].ttl&&"number"!=typeof w[0].ttl||null!=w[0].deleteOnRead&&"boolean"!=typeof w[0].deleteOnRead||"string"!=typeof w[0].localId)){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  counterPartyId: string;\n  body: string;\n  senderOrganizationId: string;\n  recipientOrganizationId: string;\n  attachment: ?Object | ?string;\n  metadata: ?Object;\n  priority: ?number;\n  ttl: ?number;\n  deleteOnRead: ?boolean;\n  localId: string;\n}\n\nGot:\n"+a(w[0]));case 4:return(0,N.default)(s)&&(s=s.toLowerCase()),f||(f=l),n={recipient:s,body:c},r={},p&&(n.data=p.map(function(e){return(0,E.default)({},e,{payload:(0,b.default)(e.payload)})})),l&&(n.sender_organization=l),f&&(n.recipient_organization=f),"undefined"!=typeof y&&(n.priority=y),d&&(r.attachment=d),h&&(n.ttl=h),g&&(n.dor=g),e.next=17,this.httpClient.post("/message",{data:n,files:r,requestId:m,timeout:!d||6e4});case 17:return o=e.sent,u={serverId:o.getHeader("TT-X-Message-Id"),ttl:+o.getHeader("TT-X-Msg-Ttl")},e.abrupt("return",u);case 20:case"end":return e.stop()}},e,this)}));return e}()},{key:"destroy",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,_.default)(v.default.mark(function e(t){return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.prev=4,e.next=7,this.httpClient.del("/message/:id",{urlParams:{id:t}});case 7:return e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",!1);case 13:case"end":return e.stop()}},e,this,[[4,10]])}));return e}()},{key:"startTyping",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,_.default)(v.default.mark(function e(t){return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.post("/message/typing",{data:{recipient:t}});case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"stopTyping",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,_.default)(v.default.mark(function e(t){return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.del("/message/typing/:recipientId",{urlParams:{recipientId:t}});case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"forward",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,_.default)(v.default.mark(function e(t,n,r){var o,u,s,c=r.senderOrganizationId,l=r.recipientOrganizationId,f=r.priority,d=r.localId,p=arguments;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(!(null==p[2]||null!=p[2].senderOrganizationId&&"string"!=typeof p[2].senderOrganizationId||null!=p[2].recipientOrganizationId&&"string"!=typeof p[2].recipientOrganizationId||null!=p[2].priority&&"number"!=typeof p[2].priority||"string"!=typeof p[2].localId)){e.next=6;break}throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{\n  senderOrganizationId: ?string;\n  recipientOrganizationId: ?string;\n  priority: ?number;\n  localId: string;\n}\n\nGot:\n"+i(p[2]));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if("string"==typeof n){e.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if(!(null==p[2]||null!=p[2].senderOrganizationId&&"string"!=typeof p[2].senderOrganizationId||null!=p[2].recipientOrganizationId&&"string"!=typeof p[2].recipientOrganizationId||null!=p[2].priority&&"number"!=typeof p[2].priority||"string"!=typeof p[2].localId)){e.next=12;break}throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{\n  senderOrganizationId: ?string;\n  recipientOrganizationId: ?string;\n  priority: ?number;\n  localId: string;\n}\n\nGot:\n"+a(p[2]));case 12:return l||(l=c),o={recipient:n},c&&(o.sender_organization=c),l&&(o.recipient_organization=l),"undefined"!=typeof f&&(o.priority=f),e.next=19,this.httpClient.post("/message/:id/forward",{urlParams:{id:t},data:o,requestId:d});case 19:return u=e.sent,s={serverId:u.getHeader("TT-X-Message-Id")},e.abrupt("return",s);case 22:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,_.default)(v.default.mark(function e(t){var n;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.get("/message/:id",{urlParams:{id:t}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"findStatusesPerRecipient",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,_.default)(v.default.mark(function e(t){var n;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.get("/message/:id/status",{urlParams:{id:t}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)}));return e}()}]),t}(C.default),o(c.prototype,"find",[u],(0,h.default)(c.prototype,"find"),c.prototype),o(c.prototype,"findStatusesPerRecipient",[s],(0,h.default)(c.prototype,"findStatusesPerRecipient"),c.prototype),c);t.default=R,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,f.default)(e);if(!Array.isArray(e)){var a=(0,c.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u.default)(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var l=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof l?"undefined":(0,f.default)(l))?l.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,f.default)(e);if(!Array.isArray(e)){var o=(0,c.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var l=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof l?"undefined":(0,f.default)(l))?l.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(7),u=r(i),s=n(6),c=r(s),l=n(10),f=r(l),d=n(9),p=r(d),y=n(8),h=r(y),g=n(3),v=r(g),m=n(1),b=r(m),w=n(2),E=r(w),x=n(5),_=r(x),k=n(4),O=r(k),T=n(179),I=r(T),j=n(21),A=r(j),M=function(e){function t(){return(0,b.default)(this,t),(0,_.default)(this,(t.__proto__||(0,v.default)(t)).apply(this,arguments))}return(0,O.default)(t,e),(0,E.default)(t,[{key:"update",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,h.default)(p.default.mark(function e(t,n,r){return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 2:if(n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 8:if(n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:return e.next=14,this.httpClient.post("/metadata/:id",{urlParams:{id:t},data:n,headers:{"TT-X-Organization-Key":r}});case 14:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,h.default)(p.default.mark(function e(t,n){var r;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return e.next=10,this.httpClient.get("/metadata/:id",{urlParams:{id:t},headers:{"TT-X-Organization-Key":n}});case 10:return r=e.sent,e.abrupt("return",r.data);case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"findMulti",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,h.default)(p.default.mark(function e(t,n){var r,i;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+o(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return e.next=10,this.httpClient.post("/metadata_bulk",{data:{entities:t},headers:{"TT-X-Organization-Key":n}});case 10:return r=e.sent,i=(0,I.default)(t,r.data),e.abrupt("return",i);case 13:case"end":return e.stop()}},e,this)}));return e}()}]),t}(A.default);t.default=M,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,b.default)(e);if(!Array.isArray(e)){var o=(0,v.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,h.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,b.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,b.default)(e);if(!Array.isArray(e)){var o=(0,v.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,h.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,b.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c,l,f,d,p,y=n(7),h=r(y),g=n(6),v=r(g),m=n(10),b=r(m),w=n(11),E=r(w),x=n(9),_=r(x),k=n(8),O=r(k),T=n(3),I=r(T),j=n(1),A=r(j),M=n(2),G=r(M),V=n(5),z=r(V),S=n(4),C=r(S),P=n(21),N=r(P),R=(u=(0,P.recoverFromNotFound)(),s=(0,P.recoverFromNotFound)(),c=(0,P.recoverFromNotFound)(),l=(0,P.recoverFromNotFound)(),f=(0,P.recoverFromNotFound)(),d=(0,P.recoverFromNotFound)(),p=function(e){function t(){return(0,A.default)(this,t),(0,z.default)(this,(t.__proto__||(0,I.default)(t)).apply(this,arguments))}return(0,C.default)(t,e),(0,G.default)(t,[{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(){var t;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.get("/mute");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"unmuteAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.del("/mute");case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"muteUser",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=o.recipientOrganizationId,s=void 0===u?r:u;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if("number"==typeof n){e.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return e.next=14,this.httpClient.post("/mute/p2p",{data:{sender_token:t,sender_organization:r,receiver_organization:s,duration:n.toString()}});case 14:case"end":return e.stop()}},e,this)}));return e}()},{key:"unmuteUser",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.recipientOrganizationId,u=void 0===o?n:o;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e.next=10,this.httpClient.del("/mute/p2p",{headers:{"TT-X-Sender-Token":t,"TT-X-Sender-Organization":n,"TT-X-Receiver-Organization":u}});case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"muteGroup",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(t,n,r){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if("number"==typeof n){e.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return e.next=14,this.httpClient.post("/mute/group/:groupId",{urlParams:{groupId:t},data:{duration:n.toString(),receiver_organization:r}});case 14:case"end":return e.stop()}},e,this)}));return e}()},{key:"unmuteGroup",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(t,n){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e.next=10,this.httpClient.del("/mute/group/:groupId",{urlParams:{groupId:t},headers:{"TT-X-Receiver-Organization":n}});case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"muteOrganization",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(t,n){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("number"==typeof n){e.next=8;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 8:return e.next=10,this.httpClient.post("/mute/organization/:organizationId",{urlParams:{organizationId:t},data:{duration:n.toString(),receiver_organization:t}});case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"unmuteOrganization",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(t){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.del("/mute/organization/:organizationId",{urlParams:{organizationId:t},headers:{"TT-X-Receiver-Organization":t}});case 6:case"end":return e.stop()}},e,this)}));return e}()}]),t}(N.default),o(p.prototype,"muteUser",[u],(0,E.default)(p.prototype,"muteUser"),p.prototype),o(p.prototype,"unmuteUser",[s],(0,E.default)(p.prototype,"unmuteUser"),p.prototype),o(p.prototype,"muteGroup",[c],(0,E.default)(p.prototype,"muteGroup"),p.prototype),o(p.prototype,"unmuteGroup",[l],(0,E.default)(p.prototype,"unmuteGroup"),p.prototype),o(p.prototype,"muteOrganization",[f],(0,E.default)(p.prototype,"muteOrganization"),p.prototype),o(p.prototype,"unmuteOrganization",[d],(0,E.default)(p.prototype,"unmuteOrganization"),p.prototype),p);t.default=R,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(!Array.isArray(e)){var o=(0,p.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";
if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(!Array.isArray(e)){var o=(0,p.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,h.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c,l=n(7),f=r(l),d=n(6),p=r(d),y=n(10),h=r(y),g=n(11),v=r(g),m=n(9),b=r(m),w=n(8),E=r(w),x=n(3),_=r(x),k=n(1),O=r(k),T=n(2),I=r(T),j=n(5),A=r(j),M=n(4),G=r(M),V=n(21),z=r(V),S=(u=(0,V.recoverFromNotFound)(),s=(0,V.recoverFromNotFound)(),c=function(e){function t(){return(0,O.default)(this,t),(0,A.default)(this,(t.__proto__||(0,_.default)(t)).apply(this,arguments))}return(0,G.default)(t,e),(0,I.default)(t,[{key:"find",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t,n){var r;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e.next=10,this.httpClient.get("/user/:userId/organization/:id",{urlParams:{userId:t,id:n}});case 10:return r=e.sent,e.abrupt("return",r.data);case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAllOfUser",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t){var n;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.get("/user/:userId/organization",{urlParams:{userId:t}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)}));return e}()}]),t}(z.default),o(c.prototype,"find",[u],(0,v.default)(c.prototype,"find"),c.prototype),o(c.prototype,"findAllOfUser",[s],(0,v.default)(c.prototype,"findAllOfUser"),c.prototype),c);t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,f.default)(e);if(!Array.isArray(e)){var a=(0,c.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u.default)(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var l=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof l?"undefined":(0,f.default)(l))?l.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,f.default)(e);if(!Array.isArray(e)){var o=(0,c.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var l=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof l?"undefined":(0,f.default)(l))?l.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(7),u=r(i),s=n(6),c=r(s),l=n(10),f=r(l),d=n(9),p=r(d),y=n(8),h=r(y),g=n(3),v=r(g),m=n(1),b=r(m),w=n(2),E=r(w),x=n(5),_=r(x),k=n(4),O=r(k),T=n(158),I=r(T),j=n(21),A=r(j),M=["user","distributionList"],G=function(e){function t(){return(0,b.default)(this,t),(0,_.default)(this,(t.__proto__||(0,v.default)(t)).apply(this,arguments))}return(0,O.default)(t,e),(0,E.default)(t,[{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,h.default)(p.default.mark(function e(){var t;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.get("/roster");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"add",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,h.default)(p.default.mark(function e(t,n,r){var i,u;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 8:if("string"==typeof n){e.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:if((0,I.default)(M,t)){e.next=14;break}return e.abrupt("return");case 14:return i={},r&&(i["TT-X-Organization-Key"]=r),u=this.__typeToNS(t),e.next=19,this.httpClient.post("/roster",{headers:i,data:{entity:n,type:u}});case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"remove",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,h.default)(p.default.mark(function e(t,n,r){var i,u;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 8:if("string"==typeof n){e.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:if((0,I.default)(M,t)){e.next=14;break}return e.abrupt("return");case 14:return i={},r&&(i["TT-X-Organization-Key"]=r),u=this.__typeToNS(t),e.next=19,this.httpClient.del("/roster/:counterPartyId",{headers:i,urlParams:{counterPartyId:n},data:{type:u}});case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"__typeToNS",value:function(e){return V[e]}}]),t}(A.default);t.default=G;var V={user:"tigertext:entity:account",distributionList:"tigertext:entity:list"};e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y.default)(e);if(!Array.isArray(e)){var o=(0,d.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,y.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y.default)(e);if(!Array.isArray(e)){var o=(0,d.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,y.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c=n(7),l=r(c),f=n(6),d=r(f),p=n(10),y=r(p),h=n(11),g=r(h),v=n(12),m=r(v),b=n(9),w=r(b),E=n(8),x=r(E),_=n(3),k=r(_),O=n(1),T=r(O),I=n(2),j=r(I),A=n(5),M=r(A),G=n(4),V=r(G),z=n(21),S=r(z),C=n(66),P=r(C),N=n(46),R=r(N),U=n(61),q=r(U),F=(u=(0,z.recoverFromNotFound)(),s=function(e){function t(){return(0,T.default)(this,t),(0,M.default)(this,(t.__proto__||(0,k.default)(t)).apply(this,arguments))}return(0,V.default)(t,e),(0,j.default)(t,[{key:"getSignInAuthHeader",value:function(){var e;return(e=this.constructor).getSignInAuthHeader.apply(e,arguments)}},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(t){var n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=o.organizationId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return(0,q.default)(t)&&(t=t.toLowerCase()),n=u?{"TT-X-Organization-Key":u}:null,e.next=8,this.httpClient.get("/user/:id",{urlParams:{id:t},headers:n});case 8:return r=e.sent,e.abrupt("return",r.data);case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"findMe",value:function(){function e(){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(){var t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=r.organizationId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=o?{"TT-X-Organization-Key":o}:null,e.next=3,this.httpClient.get("/user",{headers:t});case 3:return n=e.sent,e.abrupt("return",n.data);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"update",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(t,n){var r,o,u,s,c=n.firstName,l=void 0===c?void 0:c,f=n.lastName,d=void 0===f?void 0:f,p=n.displayName,y=void 0===p?void 0:p,h=n.status,g=void 0===h?void 0:h,v=n.dnd,b=void 0===v?void 0:v,E=n.dndText,x=void 0===E?void 0:E,_=n.avatarFile,k=void 0===_?void 0:_,O=n.removeAvatar,T=void 0===O?void 0:O;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return o={},T?o.avatar=null:k&&(o.avatar=k),u=(r={first_name:l,last_name:d,display_name:y,status:g,dnd:b,dnd_text:x},P.default).call(r,function(e,t){return"undefined"==typeof e}),e.next=9,this.httpClient.post("/user/:id/settings",{urlParams:{id:t},data:u,files:o});case 9:return s=e.sent,e.abrupt("return",(0,m.default)({id:t},k&&k.preview?{avatarUrl:k.preview}:null));case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"updatePassword",value:function(){function e(e,n,r,o){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(t,n,r,o){var u,s;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof o){e.next=8;break}throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(o));case 8:if("string"==typeof t){e.next=10;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 10:if("string"==typeof n){e.next=12;break}throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 12:if("string"==typeof r){e.next=14;break}throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 14:if("string"==typeof o){e.next=16;break}throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(o));case 16:return u={Authorization:this.getSignInAuthHeader(o,t,n)},e.next=19,this.httpClient.post("/user/:id/password",{urlParams:{id:t},headers:u,data:{password:r}});case 19:return s=e.sent,e.abrupt("return",s);case 21:case"end":return e.stop()}},e,this)}));return e}()}],[{key:"getSignInAuthHeader",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=[e,t,n].join(":"),o=(0,R.default)(r),u="XMPP-Simple "+o;return u}}]),t}(S.default),o(s.prototype,"find",[u],(0,g.default)(s.prototype,"find"),s.prototype),s);t.default=F,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Roster:n(88),Users:n(89),Groups:n(83),DistributionLists:n(82),Organizations:n(87),Messages:n(84),Metadata:n(85),Mute:n(86)};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(3),u=r(i),s=n(1),c=r(s),l=n(5),f=r(l),d=n(4),p=r(d),y=(a=o=function(e){function t(){(0,c.default)(this,t);var e=(0,f.default)(this,(t.__proto__||(0,u.default)(t)).call(this,"No internet connection"));return e.code=t.CODE,e}return(0,p.default)(t,e),t}(Error),o.CODE="connection-unavailable",a);t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(3),u=r(i),s=n(1),c=r(s),l=n(5),f=r(l),d=n(4),p=r(d),y=(a=o=function(e){function t(e,n,r){(0,c.default)(this,t);var o=(0,f.default)(this,(t.__proto__||(0,u.default)(t)).call(this,r));return o.code=t.CODE,o.resource=e,o.id=n,o}return(0,p.default)(t,e),t}(Error),o.CODE="not-found",a);t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(3),u=r(i),s=n(1),c=r(s),l=n(5),f=r(l),d=n(4),p=r(d),y=(a=o=function(e){function t(){var e;(0,c.default)(this,t);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];var a=(0,f.default)(this,(e=t.__proto__||(0,u.default)(t)).call.apply(e,[this].concat(r)));return a.code=t.CODE,a}return(0,p.default)(t,e),t}(Error),o.CODE="not-signed-in",a);t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(3),u=r(i),s=n(1),c=r(s),l=n(5),f=r(l),d=n(4),p=r(d),y=(a=o=function(e){function t(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"can't perform action "+r+" on "+(e.name||e)+" #"+n;(0,c.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,u.default)(t)).call(this,o));return a.code=t.CODE,a.resource=e,a.action=r,a.id=n,a}return(0,p.default)(t,e),t}(Error),o.CODE="permission-denied",a);t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(3),u=r(i),s=n(1),c=r(s),l=n(2),f=r(l),d=n(5),p=r(d),y=n(4),h=r(y),g=(a=o=function(e){function t(e){return(0,c.default)(this,t),(0,p.default)(this,(t.__proto__||(0,u.default)(t)).call(this,"method"+(e?" "+e:"")+" not supported in target node"))}return(0,h.default)(t,e),(0,f.default)(t,null,[{key:"raise",value:function(e){throw new this(e)}}]),t}(Error),o.CODE="target-not-supported",a);t.default=g,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(3),u=r(i),s=n(1),c=r(s),l=n(5),f=r(l),d=n(4),p=r(d),y=(a=o=function(e){function t(){var e;(0,c.default)(this,t);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];var a=(0,f.default)(this,(e=t.__proto__||(0,u.default)(t)).call.apply(e,[this].concat(r)));return a.code=t.CODE,a}return(0,p.default)(t,e),t}(Error),o.CODE="wrong-credentials",a);t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(40),a=r(o);t.default=function(e){var t=e.defineModel("conversation",{instanceEvents:!0,fields:{counterPartyType:{type:String,required:!0},counterPartyId:{type:String,required:!0},organizationId:{type:String,required:!0}},transientAttrs:["messages","timeline","lastMessage","unreadCount","unreadMessages","lastEventMessageSortNumber","_counterPartyAddedOnServer"],defaultValues:{lastEventMessageSortNumber:0,messages:[],timeline:[],unreadMessages:[],unreadCount:0},computed:{counterParty:{enumerable:!0,get:function(){return this.counterPartyType&&this.counterPartyId?e.store.get(this.counterPartyType,this.counterPartyId):null},set:function(e){if(e)switch(e.$entityType){case"user":case"group":case"distributionList":this.counterPartyId=e.id,this.counterPartyType=e.$entityType;break;default:throw new Error("unsupported counterPartyType '"+e.$entityType+"'")}else this.counterPartyId=null,this.counterPartyType=null}},lastMessageId:{enumerable:!0,get:function(){return(0,a.default)(this.lastMessage,"id")}},muteSettings:{enumerable:!0,get:function(){return e.host.mute.getByConversationId(this.id)}},isMuted:{enumerable:!0,get:function(){return!!this.muteSettings}}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}});return t};var i=n(36);r(i),e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.defineModel("distributionList",{replaceKeys:{organizationKey:"organizationId",totalMembers:"memberCount",avatar:"avatarUrl",displayName:"name"},fields:{name:{type:String,required:!0},organizationId:{type:String,required:!0}},defaultValues:{memberCount:0},computed:{displayName:{configurable:!0,enumerable:!0,get:function(){return this.name},set:function(e){return this.name=e}}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}});return(0,a.default)(n,{finder:function(){var e;return(e=t.host.distributionLists).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return e.host.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return e.host.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{name:"Loading Distribution List..."},defaultNotFoundAttrs:{name:"<Distribution List Not Found>"}}),n};var o=n(37),a=r(o);e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(20),a=r(o),i=n(31),u=r(i),s=n(1),c=r(s),l=n(2),f=r(l),d=function(){function e(t,n,r,o){var i=this;(0,c.default)(this,e),this.id=t,this.type=n,this.data=r,o&&!function(){var e=o._origData,t=(0,u.default)(o,["_origData"]);Object.defineProperty(i,"_origData",{get:function(){return e}}),(0,a.default)(i,t)}()}return(0,f.default)(e,null,[{key:"is",value:function(e){return e instanceof this}}]),e}();t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(40),a=r(o);t.default=function(e,t){function n(e,n){n&&t.host.groups.ensureMembersWithIds(e,n,{onlyPlaceholder:!0})}var r=e.defineModel("group",{replaceKeys:{organizationKey:"organizationId",createdBy:"createdByUserId",members:"memberIds",avatar:"avatarUrl",displayName:"name",numMembers:"__memberCount",createdTime:"createdAt"},fields:{name:{type:String,required:!0},description:{type:String,required:!0},organizationId:{type:String,required:!0},createdByUserId:{type:String},avatarUrl:{type:String},createdAt:{type:Date},replayHistory:{type:Boolean},isPublic:{type:Boolean},memberIds:{type:[Number]},memberCount:{type:Number},groupType:{type:"enum",enum:s.GroupType}},transientAttrs:["__memberCount"],defaultValues:{memberIds:[],memberCount:0,groupType:s.GroupType.GROUP},validate:function(){l.default.notEmpty("groupType",this.groupType)},__extractGroupTypeFromAttrs:function(e){return e.type||e.xmlns,e.isPublic?s.GroupType.ROOM:null},parseAttrs:function(e){var t=this.__extractGroupTypeFromAttrs(e);return t&&(e.groupType=t),"createdAt"in e&&(e.createdAt=new Date(e.createdAt)),e},beforeCreateInstance:function(e){n(e.id,e.memberIds)},computed:{memberCount:{enumerable:!0,get:function(){return this.memberIds&&this.memberIds.length||this.__memberCount||0}},metadata:{enumerable:!0,get:function(){var t=e.store.get("metadata",this.id+":"+this.organizationId);return t?t.data:null}},members:{enumerable:!0,get:function(){return this.memberIds?this.memberIds.map(function(t){return e.store.get("user",t)}):[]}},conversation:{enumerable:!0,get:function(){return t.host.conversations.get("group",this.id,this.organizationId)}},conversationId:{enumerable:!0,get:function(){return(0,a.default)(t.host.conversations.get("group",this.id,this.organizationId),"id")}},displayName:{configurable:!0,enumerable:!0,get:function(){return this.name},set:function(e){return this.name=e}}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"},createdByUser:{type:"user",foreignKey:"createdByUserId"}}}});return(0,u.default)(r,{finder:function(){var e;return(e=t.host.groups).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return e.host.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return e.host.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{displayName:"Loading group..."},defaultNotFoundAttrs:{displayName:"<Group Not Found>"},shouldEnsure:function(e,n,r){var o=r.groupMembersOnlyPlaceholder;return e.members.some(function(e){return t.host.models.User.shouldEnsure(e,o)})}}),r};var i=n(37),u=r(i),s=n(24),c=n(27),l=r(c);e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.defineModel("groupMembersChange",{fields:{action:{type:String,required:!0}},computed:{members:{enumerable:!0,get:function(){return this.memberIds?this.memberIds.map(function(t){return e.store.get("user",t)}):[]}}}});return t};var o=n(36);r(o),e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=r(o),i=n(151),u=r(i);t.default=function(e){var t=e.defineModel("message",{replaceKeys:{messageId:"id",clientId:"id",senderToken:"senderId",sender:"senderId",recipientToken:"recipientId",recipient:"recipientId",senderOrganization:"senderOrganizationId",recipientOrganization:"recipientOrganizationId",groupToken:"groupId",originalSender:"originalSenderId",originalTimestamp:"originalForwardedMessageCreatedAt",status:"recipientStatus",data:"metadata",dor:"deleteOnRead",createdTime:"createdAt"},fields:{conversationId:{type:String,required:!0},messageType:{type:"enum",enum:s.MessageType,required:!0},counterPartyId:{type:String,required:!0},counterPartyType:{type:"enum",enum:["user","group","distributionList"],required:!0},body:{type:String},senderOrganizationId:{type:String,required:!0},recipientOrganizationId:{type:String,required:!0},sortNumber:{type:Number,required:!0},createdAt:{type:Date,required:!0},senderId:{type:String,required:!0},direction:{type:"enum",enum:s.MessageDirection,required:!0},senderStatus:{type:"enum",enum:s.MessageSenderStatus,required:!0},recipientStatus:{type:"enum",enum:s.MessageRecipientStatus},$synced:{type:Boolean,required:!0},serverId:{type:String},metadata:{type:Array},priority:{type:"enum",enum:s.MessagePriority},deleteOnRead:{type:Boolean},ttl:{type:Number},groupId:{type:String},recipientId:{type:String},distributionListId:{type:String}},transientAttrs:["groupMembersChange"],defaultValues:{recipientStatus:s.MessageRecipientStatus.NEW,senderStatus:s.MessageRecipientStatus.NEW,sortNumber:0,messageType:s.MessageType.USER_SENT},parseAttrs:function(e){if(e.recipientStatus&&(e.recipientStatus=s.MessageRecipientStatus.resolve(e.recipientStatus)),"attachmentName"in e){var t=e.attachmentName;delete e.attachmentName,"undefined"!==t&&Array.isArray(e.attachments)&&e.attachments.length>0&&t&&(e.attachments[0].name=t)}if(Array.isArray(e.attachments)&&e.attachments.forEach(function(e,t){return e.id=""+(t+1)}),"priority"in e&&(e.priority=s.MessagePriority.resolve(e.priority)),"createdAt"in e&&"string"==typeof e.createdAt&&(e.createdAt=new Date(e.createdAt)),"ttl"in e&&e.createdAt){var n=(0,l.default)(e.createdAt).add(e.ttl,"minute").toDate().getTime();e.expiresAt=n}return"metadata"in e&&(e.metadata=(0,u.default)(e.metadata).map(function(e){return"application/json"===e.mimetype&&"string"==typeof e.payload?(0,a.default)({},e,{payload:JSON.parse(e.payload)}):e})),e},relations:{belongsTo:{sender:{type:"user",foreignKey:"senderId"},recipient:{type:"user",foreignKey:"recipientId"},originalSender:{type:"user",foreignKey:"originalSenderId"},senderOrganization:{type:"organization",foreignKey:"senderOrganizationId"},recipientOrganization:{type:"organization",foreignKey:"recipientOrganizationId"},group:{type:"group",foreignKey:"groupId"},distributionList:{type:"distributionList",foreignKey:"distributionListId"},conversation:{type:"conversation",foreignKey:"conversationId"}},hasMany:{statusesPerRecipient:{type:"messageStatusPerRecipient",foreignKey:"messageId"}}},computed:{counterParty:{enumerable:!0,get:function(){return this.counterPartyType&&this.counterPartyId?e.store.get(this.counterPartyType,this.counterPartyId):null},set:function(e){if(e){switch(e.$entityType){case"user":this.recipientId=e.id;break;case"group":this.groupId=e.id;break;case"distributionList":
this.distributionListId=e.id;break;default:throw new Error("unsupported counterPartyType '"+e.$entityType+"'")}this.counterPartyId=e.id,this.counterPartyType=e.$entityType}else this.counterPartyId=null,this.counterPartyType=null}}}});return t};var s=n(24),c=n(53),l=r(c);e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.defineModel("messageStatusPerRecipient",{replaceKeys:{accountId:"userId",timestamp:"createdAt"},defaultValues:{status:a.default.NEW},fields:{userId:{type:String,required:!0},messageId:{type:String,required:!0},status:{type:"enum",enum:a.default,required:!0},createdAt:{type:Date,required:!0}},parseAttrs:function(e){return e.status&&(e.status=a.default.resolve(e.status)),e},relations:{belongsTo:{message:{type:"message",foreignKey:"messageId"},user:{type:"user",foreignKey:"userId"}}}});return t};var o=n(36),a=r(o);e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.defineModel("metadata",{fields:{entityId:{type:String,required:!0},organizationId:{type:String,required:!0},data:{type:Object,required:!0}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}},parseAttrs:function(e,t){return e.data=t.data,e}});return n},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(30),a=r(o);t.default=function(e,t){var n,r=e.defineModel("organization",(n={instanceEvents:!0,replaceKeys:{members:"memberCount",dor:"deleteOnRead"},fields:{name:{type:String,required:!0}},defaultValues:{settings:{}},transientAttrs:["conversations","unreadCount"]},(0,a.default)(n,"defaultValues",{conversations:[]}),(0,a.default)(n,"parseAttrs",function(e){if(e.settings){var t;e.settings=(t=(t=e.settings,f.default).call(t,function(e){return c.default.camelizeKey(e.name)}),y.default).call(t,function(e){isFinite(e.value)&&(e.value=+e.value),"true"===e.value&&(e.value=!0),"false"===e.value&&(e.value=!1)})}return e}),(0,a.default)(n,"methods",{getSettingValue:function(e){return this.settings&&e in this.settings?this.settings[e].value:null},getSettingEntry:function(e){return this.settings&&e in this.settings?this.settings[e]:null}}),n));return(0,u.default)(r,{finder:function(){var e;return(e=t.host.organizations).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return e.host.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return e.host.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{name:"Loading Organization..."},defaultNotFoundAttrs:{displayName:"<Organization Not Found>"}}),r};var i=n(37),u=r(i),s=n(38),c=r(s),l=n(63),f=r(l),d=n(65),p=(r(d),n(145)),y=r(p);e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(1),a=r(o),i=n(2),u=r(i),s=function(){function e(t,n){(0,a.default)(this,e),this.id="searchResult:"+n+":"+t.id,this.entityType=t.$entityType,this.entityId=t.id,this.entity=t,this.organizationId=n}return(0,u.default)(e,null,[{key:"is",value:function(e){return e instanceof this}}]),e}();t.default=s,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=r(o),i=n(41),u=r(i),s=n(34),c=r(s);t.default=function(e,t){var n=e.defineModel("user",{transientAttrs:[],replaceKeys:{avatar:"avatarUrl",organizationToken:"organizationId",organizationKey:"organizationId",timeToLive:"messagesTTL"},fields:{displayName:{type:String,required:!0},status:{type:String},timeToLive:{type:String},deleteOnRead:{type:Boolean},firstName:{type:String},lastName:{type:String},username:{type:String},avatarUrl:{type:String},dnd:{type:Boolean},dndText:{type:String},distinguishedName:{type:String},title:{type:String},department:{type:String}},defaultValues:{profileByOrganizationId:{}},parseAttrs:function(e){var t=e.organizationId;if(t){delete e.organizationId;var n=(0,a.default)({},(0,c.default)(e,w),{organizationId:t});(0,u.default)(n)||(e.profileByOrganizationId||(e.profileByOrganizationId={}),e.profileByOrganizationId[t]=n)}return e},beforeInject:function(e,t){t&&e.profileByOrganizationId&&(e.profileByOrganizationId=(0,a.default)({},t.profileByOrganizationId,e.profileByOrganizationId))},computed:{metadataByOrganizationId:{enumerable:!0,get:function(){var t;return(t=(t=(t=e.store.getAll("metadata"),h.default).call(t,{entityId:this.id}),v.default).call(t,"organizationId"),b.default).call(t,"data")}},presence:{enumerable:!0,get:function(){return e.host.presence.get(this.id)||p.default.UNKNOWN}}}});return(0,f.default)(n,{finder:function(){var e;return(e=t.host.users).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return e.host.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return e.host.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{displayName:"Loading..."},defaultNotFoundAttrs:{displayName:"<User Not Found>"}}),n};var l=n(37),f=r(l),d=n(55),p=r(d),y=n(33),h=r(y),g=n(63),v=r(g),m=n(65),b=r(m),w=["title","department"];e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),a=r(o),i=new a.default(["GROUP","ROOM"]);t.default=i,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),a=r(o),i=new a.default(["INCOMING","OUTGOING"]);t.default=i,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),o=new r.ServerValueEnum({LOW:{serverValue:-1},NORMAL:{serverValue:0},HIGH:{serverValue:1}},{defaultValue:"NORMAL"});t.default=o,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),a=r(o),i=new a.default(["SENDING","SENT","FAILED","RETRYING","NEW","NA"]);t.default=i,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),a=r(o),i=new a.default(["USER_SENT","GROUP_MEMBERSHIP_CHANGE"]);t.default=i,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={User:n(107),Group:n(100),DistributionList:n(98),Organization:n(105),Message:n(102),MessageStatusPerRecipient:n(103),GroupMembersChange:n(101),Conversation:n(97),Metadata:n(104)};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,E.default)(e);if(!Array.isArray(e)){var o=(0,b.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,v.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,E.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,E.default)(e);if(!Array.isArray(e)){var o=(0,b.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,v.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,E.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c,l,f,d,p,y,h,g=n(7),v=r(g),m=n(6),b=r(m),w=n(10),E=r(w),x=n(11),_=r(x),k=n(16),O=r(k),T=n(31),I=r(T),j=n(9),A=r(j),M=n(8),G=r(M),V=n(3),z=r(V),S=n(1),C=r(S),P=n(2),N=r(P),R=n(5),U=r(R),q=n(4),F=r(q),$=n(30),L=r($),B=n(69),D=r(B),K=n(164),Z=r(K),W=n(50),H=r(W),X=n(34),Q=r(X),Y=n(71),J=r(Y),ee=n(17),te=r(ee),ne=n(52),re=r(ne),oe=n(13),ae=r(oe),ie=n(18),ue=n(62),se=r(ue),ce=n(78),le=(r(ce),n(23)),fe=r(le),de=n(14),pe=n(24),ye=n(142),he=r(ye),ge=n(27),ve=r(ge),me=n(25),be=r(me),we=n(49),Ee=r(we),xe=n(33),_e=r(xe),ke=n(48),Oe=r(ke),Te=n(68),Ie=r(Te),je=n(19),Ae="tigertext:entity:account",Me=new se.default.MD5,Ge=(u={},(0,L.default)(u,"ADD","added"),(0,L.default)(u,"REMOVE","removed"),(0,L.default)(u,"LEAVE","left"),(0,L.default)(u,"JOIN","joined"),u),Ve=(s={},(0,L.default)(s,"ADD","to"),(0,L.default)(s,"REMOVE","from"),s),ze=(c={},(0,L.default)(c,"GROUP","group"),(0,L.default)(c,"ROOM","room"),c),Se=(l=(0,ie.decorator)(),f=(0,ie.decorator)(),d=(0,ie.decorator)(),p=(0,ie.decorator)(),(0,de.classWithPrivateMethods)((h=function(e){function t(){var e;(0,C.default)(this,t);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];var a=(0,U.default)(this,(e=t.__proto__||(0,z.default)(t)).call.apply(e,[this].concat(r)));return a._throtelled__flushConversationsToReload=a.config.conversationReloadDelay?a._throtelled__flushConversationsToReload=(0,re.default)(a.__flushConversationsToReload,a.config.conversationReloadDelay,{leading:!1}):a.__flushConversationsToReload,a}return(0,F.default)(t,e),(0,N.default)(t,[{key:"mounted",value:function(){this._fetched=!1,this.host.on("message:sending",this._onMessageSending),this.host.on("message:sent",this._onMessageSent),this.host.models.Message.on("afterInject",this._onMessageChange),this.host.models.Message.on("afterEject",this._onMessageChange),this.host.models.Group.on("afterEject",this._onGroupDelete),this.__queuedConversationsToReload=[]}},{key:"dispose",value:function(){this._fetched=!1,this.host.removeListener("message:sending",this._onMessageSending),this.host.removeListener("message:sent",this._onMessageSent),this.host.models.Message.off("afterInject",this._onMessageChange),this.host.models.Message.off("afterEject",this._onMessageChange),this.host.models.Group.off("afterEject",this._onGroupDelete),this.__queuedConversationsToReload=null,this._throtelled__flushConversationsToReload.cancel&&this._throtelled__flushConversationsToReload.cancel()}},{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(){var t,n,r,o=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(0,te.default)(a,{includeMutes:!0}),!this._fetched){e.next=3;break}return e.abrupt("return",this.getAll());case 3:return e.next=5,this.host.api.roster.findAll();case 5:if(t=e.sent,n=t.slice(),t.forEach(function(e,t){e.type===Ae&&(n[t]={counterParty:o.host.injectModel(e),organizationId:e.organization_key})}),t.forEach(function(e,t){e.type!==Ae&&(n[t]={counterParty:o.host.injectModel(e),organizationId:e.organization_key})}),r=n.filter(Boolean).map(function(e){var t=e.counterParty,n=e.organizationId;delete t.$placeholder;var r=o.ensureConversation(t.$entityType,t.id,n,{ensureEntities:{organization:"full"}});return r._counterPartyAddedOnServer=!0,r}),!a.includeMutes){e.next=13;break}return e.next=13,this.host.mute.findAll();case 13:return this._fetched=!0,e.abrupt("return",r);case 15:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(r=(0,J.default)(r,{ensureEntities:{counterParty:"full",organization:"full",messageCounterParties:"full",groupMembers:"full",touchOnRelatedEntityLoad:!1}}),n=this.getById(t),!n){e.next=10;break}return e.next=9,this.__ensureEntities(n,r.ensureEntities);case 9:return e.abrupt("return",n);case 10:return e.next=12,this.findAll();case 12:if(n=this.getById(t)){e.next=15;break}throw new errors.NotFoundError(this.host.models.Conversation.name,t);case 15:return e.next=17,this.__ensureEntities(n,r.ensureEntities);case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}},e,this)}));return e}()},{key:"refetch",value:function(){function e(){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._fetched=!1,e.abrupt("return",this.findAll());case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"markAllMessagesAsRead",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(t){var n;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:if(t=this._resolveModelId(t),n=this.getById(t)){e.next=8;break}return e.abrupt("return");case 8:return e.abrupt("return",this.host.messages.markAsRead(n.unreadMessages));case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"add",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(t,n,r){var o;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if("string"==typeof n){e.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return o=this.ensureConversation(t,n,r),e.prev=13,e.next=16,this.host.api.roster.add(t,n,r);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(13),this.logger.warn("can't add "+n+" "+t,e.t0);case 21:o._counterPartyAddedOnServer=!0;case 22:case"end":return e.stop()}},e,this,[[13,18]])}));return e}()},{key:"remove",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(t,n,r){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if("string"==typeof n){e.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return this.ejectConversation(t,n,r),e.prev=13,e.next=16,this.host.api.roster.remove(t,n,r);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(13),this.logger.warn("can't remove "+n+" "+t);case 21:case"end":return e.stop()}},e,this,[[13,18]])}));return e}()},{key:"ensureConversation",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));r=(0,J.default)(r,{ensureEntities:{counterParty:!1,organization:!1,messageCounterParties:!1,groupMembers:!1,touchOnRelatedEntityLoad:!0}});var o=this.getConversationKey(e,t,n),u=this.get(e,t,n);return u?(this.__ensureEntities(u,r.ensureEntities),u):(u=this.host.models.Conversation.createInstance({id:o,counterPartyType:e,counterPartyId:t,organizationId:n,_origIndex:this.host.models.Conversation.getAll().length}),this.__ensureEntities(u,r.ensureEntities),this.host.models.Conversation.inject(u),this.__notifyOrganizationChange(u.organizationId),u)}},{key:"ejectConversation",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=this.get(e,t,n);return r&&(this.host.models.Conversation.eject(r),this.__notifyOrganizationChange(r.organizationId)),r}},{key:"reactToMessageEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.host.currentUserId,n=this.host.models.Message.parseAttrs(e.data);n.messageType=pe.MessageType.USER_SENT,n.direction=n.senderId==t?pe.MessageDirection.OUTGOING:pe.MessageDirection.INCOMING,n.groupId?(n.counterPartyType="group",n.counterPartyId=n.groupId):n.recipientId&&(n.counterPartyType="user",n.counterPartyId=n.senderId==t?n.recipientId:n.senderId),n.direction==pe.MessageDirection.OUTGOING?n.senderStatus=pe.MessageSenderStatus.SENT:n.senderStatus=pe.MessageSenderStatus.NA;var r=this.host.conversations.ensureConversation(n.counterPartyType,n.counterPartyId,n.recipientOrganizationId,{ensureEntities:{counterParty:"placeholder",groupMembers:"placeholder",organization:"full"}});n.conversationId=r.id;var o=this.host.models.Message.createInstance(n),u=o.senderId==t?o.recipientId:o.senderId;u&&this.__ensureMessageCounterParty(r,u,{messageCounterParties:this.host.currentlyServingOfflineMessages?"placeholder":"full",touchOnRelatedEntityLoad:!0}),this.host.models.Message.inject(o),this.emit("message",o),this.__addConversationCounterPartyToServerRosterIfShould(r),this.__queueReload(r),r.emit("message",o),this.__notifyOrganizationChange(r.organizationId),o.senderId!=t&&o.recipientStatus!=pe.MessageRecipientStatus.READ&&o.recipientStatus!=pe.MessageRecipientStatus.DELIVERED&&this.host.messages.markAsReceived(o)}},{key:"reactToFriendsEvent",value:function(e){var t=e.data.friend,n=t.action,r=t.organization_id,o=(0,I.default)(t,["action","organization_id"]),a=r,i=this.host.modelByTypeNS(o.xmlns);if(!i)return void this.logger.error("Class "+o.xmlns+" not found");switch(n){case"add":"group"==i.name&&(o.organizationId=a);var u=this.host.injectModel(o);this.__addedByCounterParty(u,a);break;case"del":this.__removedByCounterParty(i.name,o.token,a);break;default:this.logger.error("friends action not implemented",n,e.data)}}},{key:"_onMessageSending",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId,{ensureEntities:{counterParty:"full",organization:"full",messageCounterParties:"full",groupMembers:"full",touchOnRelatedEntityLoad:!0}});this.__addConversationCounterPartyToServerRosterIfShould(t),this.__reloadConversation(t),this.__notifyOrganizationChange(t.organizationId)}},{key:"_onMessageSent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId);this.__reloadConversation(t),t.emit("message",e)}},{key:"_onMessageChange",value:function(e,t){t.conversation&&this.__queueReload(t.conversation)}},{key:"_onGroupDelete",value:function(e,t){this.ejectConversation("group",t.id,t.organizationId)}},{key:"__queueReload",value:function(e){!this.__queuedConversationsToReload.includes(e)&&this.__queuedConversationsToReload.push(e),this._throtelled__flushConversationsToReload()}},{key:"__flushConversationsToReload",value:function(){var e=this;this.__queuedConversationsToReload.forEach(function(t){return e.__reloadConversation(t)}),this.__queuedConversationsToReload.length=0,this.emit("_reloadQueueFinished")}},{key:"hasPendingReloads",value:function(){return this.__queuedConversationsToReload&&this.__queuedConversationsToReload.length>0}},{key:"__reloadConversation",value:function(e){var t,n=((0,Q.default)(e,["messages","timeline","lastMessage","unreadMessages","unreadCount","lastEventMessageSortNumber"]),{}),r=(t=(t=this.host.models.Message.getAll(),_e.default).call(t,{conversationId:e.id}),Oe.default).call(t,["sortNumber"],["asc"]),o=(0,H.default)(r,{messageType:pe.MessageType.USER_SENT});n.timeline=r,n.messages=o,n.lastMessage=(0,Z.default)(o),n.unreadMessages=o.filter(function(e){return e.direction===pe.MessageDirection.INCOMING&&(e.recipientStatus===pe.MessageRecipientStatus.NEW||e.recipientStatus===pe.MessageRecipientStatus.DELIVERED)}),n.unreadCount=n.unreadMessages.length,n.lastEventMessageSortNumber=n.lastMessage&&n.lastMessage.sortNumber||0,(0,D.default)(e,n),this.__touch(e.id),e.emit("change"),this.emit("change",e)}},{key:"__notifyOrganizationChange",value:function(e){var t=this.host.models.Organization.get(e);t&&t.emit("change")}},{key:"__addConversationCounterPartyToServerRosterIfShould",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));e&&(e._counterPartyAddedOnServer||this.add(e.counterPartyType,e.counterPartyId,e.organizationId))}},{key:"addMembershipChangeLog",value:function(e){var t=void 0;if(e.actorId===this.host.currentUserId&&"LEAVE"===e.action){if(t=this.get("group",e.group.id,e.group.organizationId),!t)return}else t=this.ensureConversation("group",e.group.id,e.group.organizationId);var n=this.host.models.GroupMembersChange.inject({id:e.id+":groupMembersChange",action:e.action,memberIds:e.memberIds});this.host.models.Message.inject({id:e.id,conversationId:t.id,groupId:e.groupId,sortNumber:e.sortNumber,messageType:pe.MessageType.GROUP_MEMBERSHIP_CHANGE,senderId:e.actorId,recipient:this.host.currentUser,direction:pe.MessageDirection.INCOMING,groupMembersChange:n,body:this.__generateGroupMembershipChangeBody(e),createdAt:e.createdAt}),this.__reloadConversation(t)}},{key:"__generateGroupMembershipChangeBody",value:function(e){var t=Ge[e.action],n=Ve[e.action]||"",r=null;return"ADD"!==e.action&&"REMOVE"!==e.action||(r=(0,he.default)(e.members.filter(Boolean).map(function(e){return e.displayName}))),[e.actor.displayName,t,r,n,"this",ze[e.group.groupType]].filter(Boolean).join(" ")}},{key:"getMessageConversationKey",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if(e.groupId)return this.conversationHashForListEnityId(e.groupId);if(e.distributionListId)return this.conversationHashForListEnityId(e.distributionListId);var t=e.senderId==this.host.currentUserId?e.recipientId:e.senderId;return this.conversationHashForUserMessage(t,e.senderOrganizationId,e.recipientOrganizationId)}},{key:"getConversationKey",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(n));if(null!=r&&"string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(r));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(n));if(null!=r&&"string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(r));switch(e){case"user":return this.conversationHashForUserMessage(t,n,r);case"group":case"distributionList":return this.conversationHashForListEnityId(t);default:throw new Error("type "+e+" not supported in conversation")}}},{key:"conversationHashForUserMessage",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(n));var r=[e,t,n].join(":");return Me.b64(r)}},{key:"conversationHashForListEnityId",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return Me.b64(e)}},{key:"conversationHashForGroupId",value:function(){return this.conversationHashForListEnityId.apply(this,arguments)}},{key:"conversationHashForDistributionListId",value:function(){return this.conversationHashForListEnityId.apply(this,arguments)}},{key:"looksLikeConversationId",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return/^[a-zA-Z0-9\/+=]{24}$/.test(e)}},{key:"findConversationWithUser",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(t,n){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));
case 8:return e.abrupt("return",this.get(this.host.models.User.name,t,n));case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"findConversationWithGroup",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(t,n){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e.abrupt("return",this.get(this.host.models.Group.name,t,n));case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAllGroupConversationsWithMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(t,n){var r,o=this;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return t=(0,je.arrayWrap)(t).map(this._resolveModelId.bind(this)),e.next=11,this.host.groups.findAllWithSpecificMembers(t,n);case 11:return r=e.sent,e.abrupt("return",r.map(function(e){return o.get(o.host.models.Group.name,e.id,n)}));case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"getWithUser",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{createIfNotFound:!1},r=n.createIfNotFound,o=void 0!==r&&r;if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));e=this._resolveModelId(e),t=this._resolveModelId(t);var u=this.conversationHashForUserMessage(e,t),s=this.getById(u);return!s&&o&&(s=this.ensureConversation("user",e,t)),s||null}},{key:"getWithListEntity",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{createIfNotFound:!1},r=n.createIfNotFound,o=void 0!==r&&r,u=n.organizationId;if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));t=this._resolveModelId(t);var s=this.conversationHashForListEnityId(t),c=this.getById(s);if(!c&&o){var l=this._resolveEntity(t,e);l?u=l.organizationId:ve.default.notEmpty("organizationId",u,"required when using createIfNotFound"),c=this.ensureConversation(e,t,u)}return c||null}},{key:"getWithGroup",value:function(e){return this.getWithListEntity("group",e)}},{key:"getWithDistributionList",value:function(e){return this.getWithListEntity("distributionList",e)}},{key:"get",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=this.getConversationKey(e,t,n),o=this.host.models.Conversation.get(r);return o||null}},{key:"getAll",value:function(){return this.host.models.Conversation.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Conversation.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Conversation.getMulti(e)}},{key:"__addedByCounterParty",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));this.ensureConversation(e.$entityType,e.id,t)}},{key:"__removedByCounterParty",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));this.ejectConversation(e,t,n)}},{key:"__ensureEntities",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var r=[];return n.organization&&r.push(this.__ensureOrganization(e,n)),n.counterParty&&r.push(this.__ensureCounterParty(e,n)),n.messageCounterParties&&r.push(this.__ensureAllMessagesCounterParties(e,n)),r=r.filter(Boolean),r.length>0?O.default.all(r).then(function(){n.onLoad&&n.onLoad(),t.__touch(e)}).catch(function(e){return console.error(e)}):O.default.resolve()}},{key:"__ensureOrganization",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));return this.host.models.Organization.shouldEnsure(e.organization,"full"!==n.organization)?new O.default(function(r,o){t.host.models.Organization.ensureEntity(e.organizationId,{onlyPlaceholder:"placeholder"===n.organization,onMissing:function(){t.logger.info("org "+e.organizationId+" not found, created placeholder org"),e.$loadingOrganization=!0},onLoad:function(){t.logger.info("org "+e.organizationId+" loaded"),e.$loadingOrganization=!1,n.touchOnRelatedEntityLoad&&t.__touch(e)},onFinish:r})}):null}},{key:"__ensureCounterParty",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var r=this.host.modelsByEntityType[e.counterPartyType];return r.shouldEnsure(e.counterParty,"full"!==n.counterParty,{groupMembersOnlyPlaceholder:"full"!==n.groupMembers})?new O.default(function(o,a){var i={};switch(e.counterPartyType){case"user":break;case"group":case"distributionList":i.organizationId=e.organizationId;break;default:throw new Error("unsupported counterPartyType",e.counterPartyType)}var u=function(e){if("placeholder"!==n.counterParty&&"group"===r.name&&n.groupMembers)return t.host.groups.ensureMembers(e,{onlyPlaceholder:"placeholder"===n.groupMembers})};r.ensureEntity(e.counterPartyId,{attrs:i,onlyPlaceholder:"placeholder"===n.counterParty,onMissing:function(){t.logger.info("entry "+e.counterPartyId+" not found, created placeholder on org "+e.organizationId),e.$loadingCounterParty=!0},onLoad:function(){e.$loadingCounterParty=!1,n.touchOnRelatedEntityLoad&&t.__touch(e)},onFinish:function(){var e=(0,G.default)(A.default.mark(function e(n){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n,!e.t0){e.next=4;break}return e.next=4,u(n);case 4:o();case 5:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}()})}):null}},{key:"__ensureAllMessagesCounterParties",value:function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var o=(t=(t=(t=e.messages,be.default).call(t,"senderId"),Ee.default).call(t),Ie.default).call(t,this.host.currentUserId,e.counterPartyId);return O.default.all(o.map(function(t){return n.__ensureMessageCounterParty(e,t,r)}))}},{key:"__ensureMessageCounterParty",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "messageOtherUserId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "messageOtherUserId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));var o=this.host.models.User.get(t);return this.host.models.User.shouldEnsure(o,"full"!==r.messageCounterParties)?new O.default(function(o,a){n.host.models.User.ensureEntity(t,{onlyPlaceholder:"placeholder"===r.messageCounterParties,onMissing:function(){n.logger.info("entry "+e.counterPartyId+" not found, created placeholder on org "+e.organizationId)},onLoad:function(){r.touchOnRelatedEntityLoad&&n.__touch(e)},onFinish:o})}):null}},{key:"__touch",value:function(e){this.host.models.Conversation.touch(e)}}]),t}(ae.default),o(h.prototype,"findAll",[l],(0,_.default)(h.prototype,"findAll"),h.prototype),o(h.prototype,"find",[f],(0,_.default)(h.prototype,"find"),h.prototype),o(h.prototype,"add",[d],(0,_.default)(h.prototype,"add"),h.prototype),o(h.prototype,"remove",[p],(0,_.default)(h.prototype,"remove"),h.prototype),o(h.prototype,"_onMessageSending",[de.privateMethod,fe.default],(0,_.default)(h.prototype,"_onMessageSending"),h.prototype),o(h.prototype,"_onMessageSent",[de.privateMethod,fe.default],(0,_.default)(h.prototype,"_onMessageSent"),h.prototype),o(h.prototype,"_onMessageChange",[de.privateMethod,fe.default],(0,_.default)(h.prototype,"_onMessageChange"),h.prototype),o(h.prototype,"_onGroupDelete",[de.privateMethod,fe.default],(0,_.default)(h.prototype,"_onGroupDelete"),h.prototype),o(h.prototype,"__queueReload",[de.privateMethod],(0,_.default)(h.prototype,"__queueReload"),h.prototype),o(h.prototype,"__flushConversationsToReload",[de.privateMethod,fe.default],(0,_.default)(h.prototype,"__flushConversationsToReload"),h.prototype),o(h.prototype,"__reloadConversation",[de.privateMethod],(0,_.default)(h.prototype,"__reloadConversation"),h.prototype),o(h.prototype,"__notifyOrganizationChange",[de.privateMethod],(0,_.default)(h.prototype,"__notifyOrganizationChange"),h.prototype),o(h.prototype,"__addConversationCounterPartyToServerRosterIfShould",[de.privateMethod],(0,_.default)(h.prototype,"__addConversationCounterPartyToServerRosterIfShould"),h.prototype),o(h.prototype,"__generateGroupMembershipChangeBody",[de.privateMethod],(0,_.default)(h.prototype,"__generateGroupMembershipChangeBody"),h.prototype),o(h.prototype,"__addedByCounterParty",[de.privateMethod],(0,_.default)(h.prototype,"__addedByCounterParty"),h.prototype),o(h.prototype,"__removedByCounterParty",[de.privateMethod],(0,_.default)(h.prototype,"__removedByCounterParty"),h.prototype),o(h.prototype,"__ensureEntities",[de.privateMethod],(0,_.default)(h.prototype,"__ensureEntities"),h.prototype),o(h.prototype,"__ensureOrganization",[de.privateMethod],(0,_.default)(h.prototype,"__ensureOrganization"),h.prototype),o(h.prototype,"__ensureCounterParty",[de.privateMethod],(0,_.default)(h.prototype,"__ensureCounterParty"),h.prototype),o(h.prototype,"__ensureAllMessagesCounterParties",[de.privateMethod],(0,_.default)(h.prototype,"__ensureAllMessagesCounterParties"),h.prototype),o(h.prototype,"__ensureMessageCounterParty",[de.privateMethod],(0,_.default)(h.prototype,"__ensureMessageCounterParty"),h.prototype),o(h.prototype,"__touch",[de.privateMethod],(0,_.default)(h.prototype,"__touch"),h.prototype),y=h))||y);t.default=Se,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g.default)(e);if(!Array.isArray(e)){var o=(0,y.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g.default)(e);if(!Array.isArray(e)){var o=(0,y.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c,l,f=n(7),d=r(f),p=n(6),y=r(p),h=n(10),g=r(h),v=n(11),m=r(v),b=n(9),w=r(b),E=n(8),x=r(E),_=n(3),k=r(_),O=n(1),T=r(O),I=n(2),j=r(I),A=n(5),M=r(A),G=n(4),V=r(G),z=n(17),S=r(z),C=n(13),P=r(C),N=n(15),R=r(N),U=n(18),q=n(14),F=(u=(0,U.decorator)(),s=(0,U.decorator)(),(0,q.classWithPrivateMethods)((l=function(e){function t(){return(0,T.default)(this,t),(0,M.default)(this,(t.__proto__||(0,k.default)(t)).apply(this,arguments))}return(0,V.default)(t,e),(0,j.default)(t,[{key:"mounted",value:function(){this._fetched=!1}},{key:"dispose",value:function(){this._fetched=!1}},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(t){var n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(o=(0,S.default)(o,{ignoreNotFound:!1,bypassCache:!1,includeMembers:!1,includeMetadata:!1}),this.host.requireUser(),n=null,o.bypassCache){e.next=11;break}if(n=this.host.models.DistributionList.get(t),!n){e.next=11;break}return e.abrupt("return",n);case 11:return e.next=13,this.host.api.distributionLists.find(t);case 13:if(r=e.sent,!r){e.next=19;break}n=this.host.models.DistributionList.inject(r),delete n.$placeholder,e.next=21;break;case 19:if(o.ignoreNotFound){e.next=21;break}throw new R.default.NotFoundError(this.host.models.DistributionList.name,t);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(){var t,n,r;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._fetched){e.next=2;break}return e.abrupt("return",this.getAll());case 2:if(t=this.host.models.Organization.getAll(),0!=t.length){e.next=7;break}return e.next=6,this.host.organizations.findAll();case 6:t=e.sent;case 7:return e.next=9,this.host.search.query({types:["distributionList"],organizationIds:t.map(function(e){return e.id}),query:{displayName:""}});case 9:return n=e.sent,r=n.map(function(e){return e.entity}),this._fetched=!0,e.abrupt("return",r);case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"getAll",value:function(){return this.host.models.DistributionList.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.DistributionList.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.DistributionList.getMulti(e)}}]),t}(P.default),o(l.prototype,"find",[u],(0,m.default)(l.prototype,"find"),l.prototype),o(l.prototype,"findAll",[s],(0,m.default)(l.prototype,"findAll"),l.prototype),c=l))||c);t.default=F,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(30),a=r(o),i=n(31),u=r(i),s=n(3),c=r(s),l=n(1),f=r(l),d=n(2),p=r(d),y=n(5),h=r(y),g=n(4),v=r(g),m=n(26),b=r(m),w=n(13),E=r(w),x=n(182),_=function(e){function t(e,n){var r;(0,f.default)(this,t);var o=(0,h.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e,n));o.EVENTS=(r={},(0,a.default)(r,"client_advisory",function(e){switch(e.data.advisory.name){case"replay_start":this.host.reactToAdvisoryEvent("replayStart",{replayMessageCount:e.data.advisory.replay_message_count});break;case"replay_stop":this.host.reactToAdvisoryEvent("replayStop")}}),(0,a.default)(r,"message|group_message",function(e){this.host.conversations.reactToMessageEvent(e)}),(0,a.default)(r,"message:status|group:message:status",function(e){this.host.messages.reactToMessageStatusEvent(e)}),(0,a.default)(r,"friends",function(e){this.host.conversations.reactToFriendsEvent(e)}),(0,a.default)(r,"presence",function(e){this.host.presence.reactToPresenceEvent(e)}),(0,a.default)(r,"bang",function(e){this.host.groups.reactToBangEvent(e)}),(0,a.default)(r,"update",function(e){var t=e.data,n=t.type,r=(0,u.default)(t,["type"]);this.host.injectModel(r,n)}),(0,a.default)(r,"account:settings",function(e){var t=this;e.data.services.forEach(function(n){switch(n.xmlns){case"tigertext:iq:update:account":var r=n.account||e.data.token;t.host.users.refresh(r);break;case"tigertext:iq:update:org_settings":t.host.organizations.refreshAll();break;default:t.logger.warn("unhandled account:settings service type "+n.xmlns)}})}),(0,a.default)(r,"message:is_typing",function(e){this.host.typingStatus.reactToIsTypingEvent(e)}),(0,a.default)(r,"push:credentials",function(e){}),(0,a.default)(r,"remote_wipe",function(e){this.host.wipe()}),(0,a.default)(r,"validated",function(e){this.logger.warn("validated not implemented")}),(0,a.default)(r,"msg:metadata_update",function(e){this.logger.warn("msg:metadata_update not implemented")}),(0,a.default)(r,"conversation_mute",function(e){this.host.mute.reactToMuteEvent(e)}),(0,a.default)(r,"reconnect",function(e){this.host.events.reconnect()}),(0,a.default)(r,"push:credentials",x.noop),(0,a.default)(r,"sse:heartbeat",x.noop),r);var i=[];return(0,b.default)(o.EVENTS,function(e,t){t.includes("|")&&(i.push(t),t.split("|").forEach(function(t){return o.EVENTS[t]=e}))}),i.forEach(function(e){return delete o.EVENTS[e]}),o}return(0,v.default)(t,e),(0,p.default)(t,[{key:"emit",value:function(e){this.EVENTS[e.type]?this.EVENTS[e.type].call(this,e):this.logger.error("unhandled event: "+e.type,e.data)}}]),t}(E.default);t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r){n&&(0,l.default)(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function a(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,u,s,c=n(136),l=r(c),f=n(11),d=r(f),p=n(9),y=r(p),h=n(8),g=r(h),v=n(39),m=r(v),b=n(6),w=r(b),E=n(16),x=r(E),_=n(3),k=r(_),O=n(1),T=r(O),I=n(2),j=r(I),A=n(5),M=r(A),G=n(4),V=r(G),z=n(74),S=r(z),C=n(52),P=r(C),N=n(13),R=r(N),U=n(14),q=n(56),F=n(148),$=r(F),L=n(64),B=r(L),D=n(25),K=r(D),Z=n(144),W=r(Z),H=n(19),X=n(43),Q=r(X),Y=["00000000-0000-0000-0000-000000000001"],J={isTyping:"is-typing",multiOrg:"multi-org",noOfflineMessages:"no-offline-messages",autoDeliver:"auto-deliver",hidden:"hidden",closeAfterMessages:"close-after-messages"},ee=(0,U.classWithPrivateMethods)((u=function(e){function t(e,n){(0,T.default)(this,t);var r=(0,M.default)(this,(t.__proto__||(0,k.default)(t)).call(this,e,n));return o(r,"onNetworkStatusChanged",s,r),r._throtelled_flushQueuedAcks=(0,P.default)(r._flushQueuedAcks.bind(r),r.config.flushAckInterval,{leading:!1}),r._connectionRetryCount=0,r}return(0,V.default)(t,e),(0,j.default)(t,[{key:"mounted",value:function(){this._queuedAcks=[],this.config.autoAckSuccessfullyHandledEvents||(this._processedEventIds=[])}},{key:"dispose",value:function(){this._queuedAcks=null,this._processedEventIds=null,this._throtelled_flushQueuedAcks.cancel&&this._throtelled_flushQueuedAcks.cancel(),this._cancelScheduledConnectionRetry()}},{key:"connect",value:function(){var e,t=this;if(this.host.requireUser(),this.eventSource)return this.logger.warn("already connected"),x.default.resolve();if(this.logger.info("connecting events. networkStatus=",this.host.httpClient.networkStatus),this.host.httpClient.networkStatus===Q.default.OFFLINE)return this._scheduleConnectRetry(),x.default.resolve();var n=(e=(e=(e=(e=this.config.events,$.default).call(e,S.default),B.default).call(e),K.default).call(e,function(e){return J[e]}),W.default).call(e).join(",");return this._watchNetworkConnection(),new x.default(function(e,r){var o=void 0;t.eventSource=t.httpClient.createEventSource("/events",{headers:{"TT-X-Features":n},onOpen:function(){t.logger.info("open"),t._connectionRetryCount=0,t._cancelScheduledConnectionRetry(),o=!0,e()},onMessage:t._onEvent.bind(t),onError:function(e){o||r(e),t._onError(e)},onClose:function(){t.logger.info("close",err)}})})}},{key:"disconnect",value:function(){this._cancelScheduledConnectionRetry(),this._unwatchNetworkConnection(),this.eventSource&&this.eventSource.close(),this.eventSource=null}},{key:"reconnect",value:function(){this.eventSource&&this.disconnect(),this.connect()}},{key:"_onEvent",value:function(e){var t=this,n=e.data;if(n.includes("\n"))return void n.split("\n").forEach(function(e){return t._onEvent({data:e})});var r=n;try{n=JSON.parse(r)}catch(e){throw this.logger.error("error parsing ",r),e}var o=n.event_id;if(this.config.autoAckSuccessfullyHandledEvents||!this._processedEventIds.includes(o)||Y.includes(o)){var a=(0,w.default)(n.event)[0],i=a.replace("tigertext:iq:",""),u=n.event[a];this.logger.debug("incoming",i,u);var s=new q.Event(o,i,u,{_origData:r});try{this.host.eventRouter.emit(s),this.emit("event",s),this.config.autoAckSuccessfullyHandledEvents?this.__queueAck(o):this._processedEventIds.push(o)}catch(e){throw this.logger.error("error in event "+i,e,e.stack,{data:u}),e}}}},{key:"_onError",value:function(e){this.logger.info("error",e,e.message||"",e.status||""),this.disconnect(),this.config.eventsAutoReconnect&&this._scheduleConnectRetry()}},{key:"__queueAck",value:function(e){var t;e=(0,H.arrayWrap)(e),(t=this._queuedAcks).push.apply(t,(0,m.default)(e)),e.length>=this.config.flushAckMaxEvents?(this.logger.log("reached "+this.config.flushAckMaxEvents+" -- flushing"),this._flushQueuedAcks()):this._throtelled_flushQueuedAcks()}},{key:"_flushQueuedAcks",value:function(){this._queuedAcks.length>0&&(this.ack(this._queuedAcks),this._queuedAcks.length=0)}},{key:"_scheduleConnectRetry",value:function(){var e=this;this._connectionRetryCount++,this._cancelScheduledConnectionRetry(),this.logger.info("scheduleConnectRetry",this._connectionRetryCount),this._scheduleConnectRetryTimeout=setTimeout(function(){e.connect().catch(function(){})},this.config.eventsAutoReconnectDelay*this._connectionRetryCount)}},{key:"_cancelScheduledConnectionRetry",value:function(){this._scheduleConnectRetryTimeout&&clearTimeout(this._scheduleConnectRetryTimeout)}},{key:"_watchNetworkConnection",value:function(){this._watchingNetworkConnection||(this._watchingNetworkConnection=!0,this.host.on("networkStatus:change",this.onNetworkStatusChanged))}},{key:"_unwatchNetworkConnection",value:function(){this._watchingNetworkConnection&&(this.host.off("networkStatus:change",this.onNetworkStatusChanged),this._watchingNetworkConnection=!1)}},{key:"ack",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,g.default)(y.default.mark(function e(t){return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),t=(0,H.arrayWrap)(t),this.logger.log("ack",t),e.prev=3,e.next=6,this.httpClient.post("/events/ack",{data:{events:t}});case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),this.logger.warn("some events not acked",t);case 11:case"end":return e.stop()}},e,this,[[3,8]])}));return e}()},{key:"isConnected",get:function(){return!!this.eventSource}}]),t}(R.default),a(u.prototype,"_onEvent",[U.privateMethod],(0,d.default)(u.prototype,"_onEvent"),u.prototype),a(u.prototype,"_onError",[U.privateMethod],(0,d.default)(u.prototype,"_onError"),u.prototype),a(u.prototype,"__queueAck",[U.privateMethod],(0,d.default)(u.prototype,"__queueAck"),u.prototype),a(u.prototype,"_flushQueuedAcks",[U.privateMethod],(0,d.default)(u.prototype,"_flushQueuedAcks"),u.prototype),a(u.prototype,"_scheduleConnectRetry",[U.privateMethod],(0,d.default)(u.prototype,"_scheduleConnectRetry"),u.prototype),a(u.prototype,"_cancelScheduledConnectionRetry",[U.privateMethod],(0,d.default)(u.prototype,"_cancelScheduledConnectionRetry"),u.prototype),a(u.prototype,"_watchNetworkConnection",[U.privateMethod],(0,d.default)(u.prototype,"_watchNetworkConnection"),u.prototype),a(u.prototype,"_unwatchNetworkConnection",[U.privateMethod],(0,d.default)(u.prototype,"_unwatchNetworkConnection"),u.prototype),s=a(u.prototype,"onNetworkStatusChanged",[U.privateMethod],{enumerable:!0,initializer:function(){var e=this;return function(t){var n=t.networkStatus;n!==Q.default.OFFLINE&&n!==Q.default.UNREACHABLE||(e.disconnect(),e._scheduleConnectRetry())}}}),i=u))||i;t.default=ee,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){
var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,m.default)(e);if(!Array.isArray(e)){var o=(0,g.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,m.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,m.default)(e);if(!Array.isArray(e)){var o=(0,g.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,m.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c,l,f,d,p=n(7),y=r(p),h=n(6),g=r(h),v=n(10),m=r(v),b=n(11),w=r(b),E=n(39),x=r(E),_=n(16),k=r(_),O=n(12),T=r(O),I=n(9),j=r(I),A=n(8),M=r(A),G=n(3),V=r(G),z=n(1),S=r(z),C=n(2),P=r(C),N=n(5),R=r(N),U=n(4),q=r(U),F=n(178),$=r(F),L=n(50),B=r(L),D=n(177),K=r(D),Z=n(17),W=r(Z),H=n(13),X=r(H),Q=n(15),Y=r(Q),J=n(18),ee=n(14),te=n(25),ne=r(te),re=n(47),oe=r(re),ae=n(49),ie=r(ae),ue=n(19),se=(u=(0,J.decorator)(),s=(0,J.decorator)(),c=(0,J.decorator)(),l=(0,J.decorator)(),(0,ee.classWithPrivateMethods)((d=function(e){function t(){return(0,S.default)(this,t),(0,R.default)(this,(t.__proto__||(0,V.default)(t)).apply(this,arguments))}return(0,q.default)(t,e),(0,P.default)(t,[{key:"mounted",value:function(){this._fetched=!1}},{key:"dispose",value:function(){this._fetched=!1}},{key:"create",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t){var n,r,o=t.organizationId,a=t.name,i=t.avatarFile,u=t.replayHistory,s=void 0===u||u,c=t.memberIds,l=void 0===c?[]:c,f=t.metadata;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),o){e.next=3;break}throw new Y.default.ValidationError("organizationId","required");case 3:return l=l.map(this._resolveModelId.bind(this)),l.includes(this.host.currentUserId)||l.unshift(this.host.currentUserId),e.next=7,this.host.api.groups.create({name:a,avatarFile:i,replayHistory:s,memberIds:l,organizationId:o});case 7:if(n=e.sent,r=this.host.models.Group.inject(n),!f){e.next=12;break}return e.next=12,this.host.metadata.update(r.id,f,o);case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"update",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){var r,o,u,s=n.name,c=n.avatarFile,l=n.replayHistory,f=n.memberIds,d=n.metadata;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:return this.host.requireUser(),t=this._resolveModelId(t),r={},"undefined"!=typeof s&&(r.name=s),"undefined"!=typeof l&&(r.replayHistory=l),"undefined"!=typeof f&&(r.memberIds=f),e.next=12,this.host.api.groups.update(t,{name:s,avatarFile:c,replayHistory:l,memberIds:f});case 12:if(o=e.sent,"undefined"!=typeof o.avatarUrl&&(r.avatarUrl=o.avatarUrl),u=this.host.models.Group.inject((0,T.default)({id:t},r)),!d){e.next=18;break}return e.next=18,this.host.metadata.update(t,d,u.organizationId);case 18:return e.abrupt("return",u);case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t){var n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(o=(0,W.default)(o,{ignoreNotFound:!1,bypassCache:!1,includeMembers:!1,includeMetadata:!1}),this.host.requireUser(),n=null,o.bypassCache){e.next=13;break}if(n=this.host.models.Group.get(t),!n||n.$placeholder){e.next=13;break}return e.next=12,this.__ensureEntitiesLoaded(n.id,o);case 12:return e.abrupt("return",n);case 13:return e.next=15,this.host.api.groups.find(t);case 15:if(r=e.sent,!r){e.next=21;break}n=this.host.models.Group.inject(r),delete n.$placeholder,e.next=23;break;case 21:if(o.ignoreNotFound){e.next=23;break}throw new Y.default.NotFoundError(this.host.models.Group.name,t);case 23:if(!n){e.next=26;break}return e.next=26,this.__ensureEntitiesLoaded(n.id,o);case 26:return e.abrupt("return",n);case 27:case"end":return e.stop()}},e,this)}));return e}()},{key:"__ensureEntitiesLoaded",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){var r,o;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return r=this.host.models.Group.get(t),o=[],n.includeMetadata&&o.push(this.host.metadata.find(t,r.organizationId)),n.includeMembers&&o.push(this.ensureMembers(r)),e.next=10,k.default.all(o);case 10:this.host.models.Group.touch(t);case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(){var t,n,r,o,a,i,u,s=this,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=c.includeMembers,f=void 0!==l&&l,d=c.includeMetadata,p=void 0!==d&&d;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._fetched){e.next=2;break}return e.abrupt("return",this.getAll());case 2:if(t=this.host.models.Organization.getAll(),0!=t.length){e.next=7;break}return e.next=6,this.host.organizations.findAll();case 6:t=e.sent;case 7:return e.next=9,this.host.search.query({types:["group"],organizationIds:t.map(function(e){return e.id}),query:{displayName:""},includeMetadata:p});case 9:if(n=e.sent,r=n.map(function(e){return e.entity}),!f){e.next=19;break}if(i=[],u=(o=(o=ne.default.call(r,"memberIds"),oe.default).call(o),ie.default).call(o),(a=i).push.apply(a,(0,x.default)(u.map(function(e){return s.host.users.find(e,{ignoreNotFound:!0})}))),i=i.filter(Boolean),!(i.length>0)){e.next=19;break}return e.next=19,k.default.all(i);case 19:return this._fetched=!0,e.abrupt("return",r);case 21:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAllWithSpecificMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){var r;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:if(n=this._resolveModelId(n),t=(0,ue.arrayWrap)(t).map(this._resolveModelId.bind(this)),!t.includes(this.host.currentUserId)&&t.push(this.host.currentUserId),r=this.__findAllLocalWithSpecificMembers(t,n),0!==r.length){e.next=16;break}return e.next=15,this.findAll();case 15:r=this.__findAllLocalWithSpecificMembers(t,n);case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}},e,this)}));return e}()},{key:"ensureMembers",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(t));case 2:if(t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(t));case 4:return e.abrupt("return",this.ensureMembersWithIds(t.id,t.memberIds,n));case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"ensureMembersWithIds",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){var r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(n));case 8:if(this.host.requireUser(),n=(0,K.default)(n,this.host.currentUserId),0!==n.length){e.next=12;break}return e.abrupt("return");case 12:return o=(0,W.default)(o,{onlyPlaceholder:!1}),e.next=15,k.default.all(n.map(function(e){return r.__ensureMember(e,o)}).filter(Boolean));case 15:this.host.models.Group.touch(t);case 16:case"end":return e.stop()}},e,this)}));return e}()},{key:"__ensureMember",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.User.shouldEnsure(e,t.onlyPlaceholder)?this.host.models.User.waitForEnsuredEntity(e,t):null}},{key:"getAll",value:function(){return this.host.models.Group.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Group.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Group.getMulti(e)}},{key:"__findAllLocalWithSpecificMembers",value:function(e,t){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));var n=this.host.models.Group.getAll(),r=(0,B.default)(n,function(n){return n.organizationId==t&&0==(0,$.default)(n.memberIds,e).length});return r}},{key:"destroy",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t){var n;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:return this.host.requireUser(),t=this._resolveModelId(t),e.next=8,this.host.api.groups.destroy(t);case 8:if(n=e.sent){e.next=11;break}throw new Y.default.NotFoundError(this.host.models.Group.name,t);case 11:return this.host.models.Group.eject(t),e.abrupt("return",null);case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAllMemberIds",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t){var n;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:return this.host.requireUser(),t=this._resolveModelId(t),e.next=8,this.httpClient.get("/group/:id/members",{urlParams:{id:t}});case 8:return n=e.sent,e.abrupt("return",n.data);case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"addMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(n));case 8:return this.host.requireUser(),t=this._resolveModelId(t),n=(0,ue.arrayWrap)(n).map(this._resolveModelId.bind(this)),e.next=13,this.host.api.groups.addMembers(t,n);case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(n));case 8:return this.host.requireUser(),t=this._resolveModelId(t),n=(0,ue.arrayWrap)(n).map(this._resolveModelId.bind(this)),e.next=13,this.host.api.groups.removeMembers(t,n);case 13:n.includes(this.host.currentUserId)&&this.host.models.Group.eject(t);case 14:case"end":return e.stop()}},e,this)}));return e}()},{key:"addMember",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:return e.abrupt("return",this.addMembers(t,[n]));case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeMember",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:return e.abrupt("return",this.removeMembers(t,[n]));case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"join",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t){return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:return e.abrupt("return",this.addMembers(t,[this.host.currentUserId]));case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"leave",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t){var n;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:if(t=this._resolveModelId(t),n=this.getById(t)){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,this.host.conversations.remove("group",t,n.organizationId);case 10:return e.next=12,this.removeMember(t,this.host.currentUserId);case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"reactToBangEvent",value:function(e){switch(e.data.event){case"added":this.__addedToGroup(e);break;case"removed":this.__removedFromGroup(e)}}},{key:"__addedToGroup",value:function(e){var t=e.data.caller_entity,n=e.data.subject_entity,r=e.data.target_entity;if(t&&t.token&&r&&r.token&&n&&n.token){var o=this.host.injectModel(t),a=this.host.injectModel(n),i=this.host.models.Group.get(r.token);if(i){var u=a.id===o.id?"JOIN":"ADD",s={id:e.id,sortNumber:+e.data.sort_number,createdAt:new Date(e.data.created_on),action:u,actor:o,actorId:o.id,group:i,groupId:i.id,members:[a],memberIds:[a.id]};this.host.conversations.addMembershipChangeLog(s),i.memberIds.includes(a.id)||(this.host.models.Group.touch(i),this.emit("membership:change",s))}}}},{key:"__removedFromGroup",value:function(e){var t=e.data.caller_entity,n=e.data.subject_entity,r=e.data.target_entity;if(t&&t.token&&r&&r.token&&n&&n.token){var o=this.host.injectModel(t),a=this.host.models.Group.get(r.token);if(a&&a.memberIds){var i=this.host.injectModel(n),u=i.id===o.id?"LEAVE":"REMOVE",s={id:e.id,sortNumber:+e.data.sort_number,createdAt:new Date(e.data.created_on),action:u,actor:o,actorId:o.id,group:a,groupId:a.id,members:[i],memberIds:[i.id]};this.host.conversations.addMembershipChangeLog(s),a.memberIds.includes(i.id)&&this.emit("membership:change",s)}}}}]),t}(X.default),o(d.prototype,"find",[u],(0,w.default)(d.prototype,"find"),d.prototype),o(d.prototype,"__ensureEntitiesLoaded",[s],(0,w.default)(d.prototype,"__ensureEntitiesLoaded"),d.prototype),o(d.prototype,"findAll",[c],(0,w.default)(d.prototype,"findAll"),d.prototype),o(d.prototype,"findAllWithSpecificMembers",[l],(0,w.default)(d.prototype,"findAllWithSpecificMembers"),d.prototype),o(d.prototype,"__findAllLocalWithSpecificMembers",[ee.privateMethod],(0,w.default)(d.prototype,"__findAllLocalWithSpecificMembers"),d.prototype),o(d.prototype,"__addedToGroup",[ee.privateMethod],(0,w.default)(d.prototype,"__addedToGroup"),d.prototype),o(d.prototype,"__removedFromGroup",[ee.privateMethod],(0,w.default)(d.prototype,"__removedFromGroup"),d.prototype),f=d))||f);t.default=se,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,H.default)(e);if(!Array.isArray(e)){var o=(0,b.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,v.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,H.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,H.default)(e);if(!Array.isArray(e)){var o=(0,b.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,v.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,H.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c,l,f,d,p,y,h,g=n(7),v=r(g),m=n(6),b=r(m),w=n(11),E=r(w),x=n(16),_=r(x),k=n(20),O=r(k),T=n(31),I=r(T),j=n(28),A=r(j),M=n(29),G=r(M),V=n(9),z=r(V),S=n(12),C=r(S),P=n(8),N=r(P),R=n(3),U=r(R),q=n(1),F=r(q),$=n(2),L=r($),B=n(5),D=r(B),K=n(4),Z=r(K),W=n(10),H=r(W),X=n(72),Q=r(X),Y=n(175),J=r(Y),ee=n(75),te=r(ee),ne=n(17),re=r(ne),oe=n(73),ae=r(oe),ie=n(34),ue=r(ie),se=n(40),ce=r(se),le=n(41),fe=r(le),de=n(157),pe=r(de),ye=n(153),he=r(ye),ge=n(51),ve=r(ge),me=n(52),be=r(me),we=n(13),Ee=r(we),xe=n(53),_e=r(xe),ke=n(18),Oe=n(14),Te=n(76),Ie=r(Te),je=n(24),Ae=n(27),Me=r(Ae),Ge=n(15),Ve=r(Ge),ze=n(23),Se=r(ze),Ce=n(48),Pe=r(Ce),Ne=n(147),Re=r(Ne),Ue=n(146),qe=r(Ue),Fe=n(25),$e=r(Fe),Le=n(49),Be=r(Le),De=n(33),Ke=r(De),Ze=n(19),We=["user","group","distributionList"],He=(u=(0,ke.decorator)(),s=(0,ke.decorator)(),c=(0,ke.decorator)({memoize:!0}),l=(0,ke.decorator)({memoize:!0}),f=(0,ke.decorator)({memoize:!0}),d=(0,ke.decorator)(),p=(0,ke.decorator)({serializeArguments:function(e){return"object"===(0,H.default)(e[0])?e[0].id:e[0]}}),(0,Oe.classWithPrivateMethods)((h=function(e){function t(){var e;(0,F.default)(this,t);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];var a=(0,D.default)(this,(e=t.__proto__||(0,U.default)(t)).call.apply(e,[this].concat(r)));return a._throtelled_flushQueueMessageStatuses=a.config.flushSetMessageStatusInterval?(0,be.default)(a.__flushQueueMessageStatuses,a.config.flushSetMessageStatusInterval,{leading:!1}):a.__flushQueueMessageStatuses,a}return(0,Z.default)(t,e),(0,L.default)(t,[{key:"mounted",value:function(){this._queuedMessageStatuses={deliveredIds:[],readIds:[]},this.host.on("tick",this.deleteExpiredMessages)}},{key:"dispose",value:function(){this._queuedMessageStatuses=null,this._downloadAttachmentBlobAndUrl&&ke.decorator.clear(this._downloadAttachmentBlobAndUrl),this.downloadAttachmentUrl&&ke.decorator.clear(this.downloadAttachmentUrl),this.downloadAttachment&&ke.decorator.clear(this.downloadAttachment),this._throtelled_flushQueueMessageStatuses.cancel&&this._throtelled_flushQueueMessageStatuses.cancel(),this.host.off("tick",this.deleteExpiredMessages)}},{key:"send",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t,n){var r,o,u,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||t instanceof Object||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | string[] | Object | Object[]\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(null==s||s instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+i(s));case 6:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||t instanceof Object||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | string[] | Object | Object[]\n\nGot:\n'+a(t));case 8:if("string"==typeof n){e.next=10;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if(null==s||s instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+a(s));case 12:if(!Array.isArray(t)){e.next=14;break}return e.abrupt("return",this.__sendToGroupOfUsers(t,n,s));case 14:return e.next=16,this.__resolveCounterPartyEntityAndOrganizationId(t,!1);case 16:if(r=e.sent,o=r.counterParty,u=r.organizationId,u&&(s=(0,C.default)({},(0,ve.default)(s,"organizationId","senderOrganizationId","recipientOrganizationId"),{organizationId:u})),!o){e.next=24;break}return e.abrupt("return",this.__sendToKnownCounterParty(o.$entityType,o.serverId,n,s));case 24:return e.abrupt("return",this.__sendToUnknownCounterParty(t,n,s));case 25:case"end":return e.stop()}},e,this)}));return e}()},{key:"__resolveCounterPartyEntityAndOrganizationId",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t){var n,r,o,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];
return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("boolean"==typeof u){e.next=4;break}throw new TypeError('Value of argument "fallbackRemote" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+i(u));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("boolean"==typeof u){e.next=8;break}throw new TypeError('Value of argument "fallbackRemote" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+a(u));case 8:if(n=this._resolveEntity(t,[].concat(We,["conversation"])),r=null,n){e.next=16;break}if(!this.host.conversations.looksLikeConversationId(t)){e.next=16;break}return e.next=14,this.host.conversations.find(t);case 14:o=e.sent,o&&(n=o.counterParty,r=o.organizationId);case 16:if(n||!u){e.next=20;break}return e.next=19,this.__resolveRemoteCounterPartyEntity(t);case 19:n=e.sent;case 20:return n&&(n.organizationId&&(r=n.organizationId),"conversation"===n.$entityType&&(n=n.counterParty)),e.abrupt("return",{counterParty:n,organizationId:r});case 22:case"end":return e.stop()}},e,this)}));return e}()},{key:"__resolveRemoteCounterPartyEntity",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t){var n,r,o,u,s,c,l,f,d=this;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(n=null,r=(0,he.default)([(0,N.default)(z.default.mark(function e(){return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.host.users.find(t));case 1:case"end":return e.stop()}},e,d)})),(0,N.default)(z.default.mark(function e(){return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.host.groups.find(t));case 1:case"end":return e.stop()}},e,d)})),(0,N.default)(z.default.mark(function e(){return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.host.distributionLists.find(t));case 1:case"end":return e.stop()}},e,d)}))]),r&&("function"==typeof r[G.default]||Array.isArray(r))){e.next=8;break}throw new TypeError("Expected resolvers to be iterable, got "+a(r));case 8:if(r&&("function"==typeof r[G.default]||Array.isArray(r))){e.next=10;break}throw new TypeError("Expected resolvers to be iterable, got "+i(r));case 10:o=!0,u=!1,s=void 0,e.prev=13,c=(0,A.default)(r);case 15:if(o=(l=c.next()).done){e.next=32;break}return f=l.value,e.prev=17,e.next=20,f();case 20:if(n=e.sent,!n){e.next=23;break}return e.abrupt("break",32);case 23:e.next=29;break;case 25:if(e.prev=25,e.t0=e.catch(17),e.t0.code===Ve.default.NotFoundError.CODE){e.next=29;break}throw e.t0;case 29:o=!0,e.next=15;break;case 32:e.next=38;break;case 34:e.prev=34,e.t1=e.catch(13),u=!0,s=e.t1;case 38:e.prev=38,e.prev=39,!o&&c.return&&c.return();case 41:if(e.prev=41,!u){e.next=44;break}throw s;case 44:return e.finish(41);case 45:return e.finish(38);case 46:return e.abrupt("return",n);case 47:case"end":return e.stop()}},e,this,[[13,34,38,46],[17,25],[39,,41,45]])}));return e}()},{key:"__sendToKnownCounterParty",value:function(){function e(e,n,r,o){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t,n,r,o){var u,s,c,l,f=o.organizationId,d=o.senderOrganizationId,p=void 0===d?f:d,y=o.recipientOrganizationId,h=void 0===y?p:y,g=(0,I.default)(o,["organizationId","senderOrganizationId","recipientOrganizationId"]);return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if("string"==typeof n){e.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:this.host.requireUser(),Me.default.oneOf("counterPartyType",t,["user","group","distributionList"]),Me.default.notEmpty("counterPartyId",n),u=this.__getNextSortNumber(),p=this.__ensureOrganization(p),h=h||p,g=this.__normalizeSendOptions(g,p),s=this.host.conversations.ensureConversation(t,n,p),c=this.host.models.Message.createInstance({id:Ie.default.v4(),conversationId:s.id,messageType:je.MessageType.USER_SENT,counterPartyId:n,counterPartyType:t,body:r,senderOrganizationId:p,recipientOrganizationId:h,sortNumber:u,createdAt:new Date,senderId:this.host.currentUserId,direction:je.MessageDirection.OUTGOING,senderStatus:je.MessageSenderStatus.SENDING,$synced:!1,serverId:null,metadata:g.metadata,priority:g.priority,deleteOnRead:g.deleteOnRead,ttl:g.ttl}),g.attachmentFiles&&this.__setLocalMessageAttachments(c,g.attachmentFiles),e.t0=t,e.next="group"===e.t0?25:"user"===e.t0?28:"distributionList"===e.t0?31:34;break;case 25:return c.groupId=n,c.recipientStatus=je.MessageRecipientStatus.NA,e.abrupt("break",34);case 28:return c.recipientId=n,c.recipientStatus=je.MessageRecipientStatus.NEW,e.abrupt("break",34);case 31:return c.distributionListId=n,c.recipientStatus=je.MessageRecipientStatus.NA,e.abrupt("break",34);case 34:return this.host.models.Message.inject(c),this.host.emit("message:sending",c),e.prev=36,e.next=39,this.host.api.messages.send({localId:c.id,counterPartyId:n,body:r,senderOrganizationId:p,recipientOrganizationId:h,attachment:(0,pe.default)(g.attachmentFiles),priority:"undefined"!=typeof g.priority?je.MessagePriority.toServer(g.priority):void 0,metadata:g.metadata,ttl:g.ttl,deleteOnRead:g.deleteOnRead});case 39:l=e.sent,(0,O.default)(c,{serverId:l.serverId,ttl:l.ttl,senderStatus:je.MessageSenderStatus.SENT,$synced:!0}),e.next=46;break;case 43:e.prev=43,e.t1=e.catch(36),c.senderStatus=je.MessageSenderStatus.FAILED;case 46:return this.host.models.Message.inject(c),this.host.emit("message:sent",c),e.abrupt("return",c);case 49:case"end":return e.stop()}},e,this,[[36,43]])}));return e}()},{key:"__sendToUnknownCounterParty",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t,n){var r,o,u,s,c,l,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=f.organizationId,p=f.senderOrganizationId,y=void 0===p?d:p,h=f.recipientOrganizationId,g=void 0===h?y:h,v=(0,I.default)(f,["organizationId","senderOrganizationId","recipientOrganizationId"]);return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return r=Ie.default.v4(),o=this.__getNextSortNumber(),y=this.__ensureOrganization(y),g=g||y,v=this.__normalizeSendOptions(v,y),e.next=15,this.host.api.messages.send({localId:r,counterPartyId:t,body:n,senderOrganizationId:y,recipientOrganizationId:g,attachment:(0,pe.default)(v.attachmentFiles),priority:"undefined"!=typeof v.priority?je.MessagePriority.toServer(v.priority):void 0,metadata:v.metadata,ttl:v.ttl,deleteOnRead:v.deleteOnRead});case 15:return u=e.sent,e.next=18,this.__resolveRemoteCounterPartyEntity(t);case 18:return s=e.sent,c=this.host.conversations.ensureConversation(s.$entityType,s.serverId,y,{ensureEntities:{counterParty:"full",groupMembers:"full"}}),l=this.host.models.Message.inject({id:u.serverId,serverId:u.serverId,$synced:!0,conversationId:c.id,counterParty:s,messageType:je.MessageType.USER_SENT,body:n,senderOrganizationId:y,recipientOrganizationId:g,sortNumber:o,createdAt:new Date,senderId:this.host.currentUserId,direction:je.MessageDirection.OUTGOING,senderStatus:je.MessageSenderStatus.SENT,recipientStatus:je.MessageRecipientStatus.NEW,metadata:v.metadata,priority:v.priority,ttl:u.ttl,deleteOnRead:v.deleteOnRead}),v.attachmentFiles&&this.__setLocalMessageAttachments(l,v.attachmentFiles),this.host.emit("message:sending",l),this.host.emit("message:sent",l),e.abrupt("return",l);case 25:case"end":return e.stop()}},e,this)}));return e}()},{key:"__normalizeSendOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.metadata,n=e.attachmentFiles,r=e.attachmentFile,o=e.priority,u=e.ttl,s=e.deleteOnRead,c=arguments[1];if("string"!=typeof c)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(c));if("string"!=typeof c)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(c));return t&&(t=this.__normalizeMetadata(t)),n=this.__validateAttachments(n||r),"undefined"==typeof u&&(u=this.host.organizations.getSettingValue(c,"ttl")||-1),{metadata:t,attachmentFiles:n,priority:o,ttl:u,deleteOnRead:s}}},{key:"__ensureOrganization",value:function(e){if(null!=e&&"string"!=typeof e)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(e));if(null!=e&&"string"!=typeof e)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(e));return e?e:this.host.config.defaultOrganizationId?this.host.config.defaultOrganizationId:void Me.default.raise("organizationId","required","Message is sent in the context of an organization. Provide `organizationId` or set a default one with client.setDefaultOrganization(...)")}},{key:"__validateAttachments",value:function(e){return e=(0,Ze.arrayWrap)(e),!(0,fe.default)(e)&&e.length>1&&Me.default.raise("attachmentFiles","invalid","currently only a single attachment is supported"),e}},{key:"__normalizeMetadata",value:function(e){return e?(0,Ze.arrayWrap)(e).map(function(e){return(0,C.default)({mimetype:"application/json"},e)}):null}},{key:"__getNextSortNumber",value:function(){var e,t=(e=(e=this.host.models.Message.getAll(),Pe.default).call(e,["sortNumber"],["desc"]),Re.default).call(e),n=t?t.sortNumber:0,r=n+1e-6;return r}},{key:"__setLocalMessageAttachments",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!Array.isArray(t)||!t.every(function(e){return"string"==typeof e||e instanceof Object}))throw new TypeError('Value of argument "attachmentFiles" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if(!Array.isArray(t)||!t.every(function(e){return"string"==typeof e||e instanceof Object}))throw new TypeError('Value of argument "attachmentFiles" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+a(t));e.attachments=t.map(this.__generateAttachmentDescriptor.bind(this))}},{key:"__generateAttachmentDescriptor",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "attachment" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "attachment" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));var t="local:"+Ie.default.v4();"string"==typeof e||e instanceof Buffer||Me.default.raise("attachment","invalid","attachment (string or Buffer) is invalid");var r=void 0,o=void 0,u=void 0,s=n(60),c=n(77),l=n(180),f=n(59);if("string"==typeof e)r=s.statSync(e).size,o=l.lookup(e),u=c.basename(e);else{var d=f(e);if(d){var p=d.ext,y=d.mime;u="attachment."+p,o=y}r=e.byteLength}var h={id:t,localPath:"string"==typeof e?e:null,localFile:e instanceof Buffer?e:null,name:u,size:r,contentType:o,isLocal:!0};return h}},{key:"__loadLocalFilePathWithFileReader",value:function(e){return new _.default(function(t,n){var r=new FileReader;r.addEventListener("load",function(){t(r.result)},!1),r.addEventListener("error",function(e){n(e)},!1),r.readAsDataURL(e)})}},{key:"sendToUser",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.send.apply(this,[e].concat(n))}},{key:"sendToGroup",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.send.apply(this,[e].concat(n))}},{key:"sendToConversation",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.send.apply(this,[e].concat(n))}},{key:"sendToDistributionList",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "distributionListId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "distributionListId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.send.apply(this,[e].concat(n))}},{key:"sendToNewGroup",value:function(e){if(!(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})))throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+i(e));if(!(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})))throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+a(e));for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.send.apply(this,[e].concat(n))}},{key:"__sendToGroupOfUsers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t,n){var r,o=this,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=u.organizationId,c=u.preferExistingGroup,l=void 0!==c&&c,f=u.groupName,d=u.groupMetadata,p=(0,I.default)(u,["organizationId","preferExistingGroup","groupName","groupMetadata"]);return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(t=t.map(function(e){return o._resolveModelIdWithTypes(e,"user")}),0==t.length&&Me.default.raise("userIds","required"),r=void 0,!l){e.next=15;break}throw new Error("not implemented");case 15:return e.next=17,this.__prepareGroupForUsers(s,t,f,{groupMetadata:d});case 17:r=e.sent;case 18:return e.abrupt("return",this.sendToGroup(r,n,(0,C.default)({organizationId:s},p)));case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"__prepareGroupForUsers",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t,n,r){var o,a,i=this,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=u.groupMetadata;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=[this.host.currentUser].concat(n.map(function(e){return i.host.models.User.get(e)}).filter(Boolean)),r||(r=o.map(function(e){return e.displayName}).filter(Boolean).join(", ")||"Group"),e.next=4,this.host.groups.create({organizationId:t,name:r,replayHistory:!0,memberIds:n,metadata:s});case 4:return a=e.sent,e.abrupt("return",a);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"onMessageRecalled",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));this.host.requireUser();var t=this._getMessageByServerId(e);t&&this._deleteLocalMessage(t)}},{key:"_deleteLocalMessage",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));this.host.models.Message.eject(e)}},{key:"recall",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t){var n,r;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+a(t));case 4:return this.host.requireUser(),n=(0,Ze.arrayWrap)(t),r=n.map(this.__recallSingle.bind(this)),e.next=9,_.default.all(r);case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"__recallSingle",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t){var n;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:if(n=this._resolveMessage(t),!n){e.next=17;break}if(n.senderId==this.host.currentUserId){e.next=8;break}throw new Ve.default.PermissionDeniedError(n,n.serverId,"recall");case 8:if(n.$synced!==!1){e.next=12;break}this._deleteLocalMessage(n),e.next=15;break;case 12:return e.next=14,this.host.api.messages.destroy(n.serverId);case 14:this._deleteLocalMessage(n);case 15:e.next=19;break;case 17:return e.next=19,this.host.api.messages.destroy(t);case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"retrySend",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t){var n,r;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:if(this.host.requireUser(),n=this._resolveMessage(t)){e.next=8;break}throw new Ve.default.NotFoundError(this.host.models.Message.name,t);case 8:return n.senderId===this.host.currentUserId&&n.senderStatus===je.MessageSenderStatus.FAILED||Me.default.raise("message","invalid","Message to retry must be in a FAILED senderStatus and sent from current user"),e.prev=9,n.senderStatus=je.MessageSenderStatus.RETRYING,this.host.models.Message.inject(n),e.next=14,this.host.api.messages.send({localId:n.id,counterPartyId:n.counterPartyId,body:n.body,senderOrganizationId:n.senderOrganizationId,recipientOrganizationId:n.recipientOrganizationId,attachment:(0,ce.default)(n.attachments,"0.localFile"),priority:n.priority,metadata:n.metadata,ttl:n.ttl,deleteOnRead:n.deleteOnRead});case 14:r=e.sent,(0,O.default)(n,{sortNumber:this.__getNextSortNumber(),serverId:r.serverId,ttl:r.ttl,senderStatus:je.MessageSenderStatus.SENT,$synced:!0}),this.host.models.Message.inject(n),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(9),n.senderStatus=je.MessageSenderStatus.FAILED,this.host.models.Message.inject(n);case 23:case"end":return e.stop()}},e,this,[[9,19]])}));return e}()},{key:"forward",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t,n){var r,o,u,s,c,l,f,d=this,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},y=p.organizationId,h=p.senderOrganizationId,g=void 0===h?y:h,v=p.recipientOrganizationId,m=void 0===v?g:v,b=p.priority,w=p.retrieveMessage,E=void 0!==w&&w,x=(p.preferExistingGroup,p.groupName),_=p.groupMetadata;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||n instanceof Object||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n||n instanceof Object||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+a(n));case 8:if(this.host.requireUser(),r=this._resolveMessage(t),!Array.isArray(n)){e.next=16;break}return o=n.map(function(e){return d._resolveModelIdWithTypes(e,"user")}),e.next=14,this.__prepareGroupForUsers(y,o,x,{groupMetadata:_});case 14:u=e.sent,n=u.id;case 16:if(r){e.next=18;break}throw new Ve.default.NotFoundError(this.host.models.Message.name,t);case 18:return e.next=20,this.__resolveCounterPartyEntityAndOrganizationId(n,!0);case 20:return s=e.sent,c=s.counterParty,l=s.organizationId,l&&(g=m=l),c&&(n=c.serverId),Me.default.notEmpty("entityId",n,"entityId not found"),e.next=28,this.host.api.messages.forward(r.serverId,n,{localId:Ie.default.v4(),senderOrganizationId:g,recipientOrganizationId:m,priority:"undefined"!=typeof b?je.MessagePriority.toServer(b):void 0});case 28:if(f=e.sent,!E){e.next=31;break}return e.abrupt("return",this.find(f.serverId));case 31:return e.abrupt("return",null);case 32:case"end":return e.stop()}},e,this)}));return e}()},{key:"reactToMessageStatusEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=e.data.client_id,n=e.data.is_recalled;n?this.onMessageRecalled(t):this.__setMessageStatusPerRecipientFromServerData(t,(0,ue.default)(e.data,["status","account_id","timestamp"]))&&this.__touchMessage(t)}},{key:"__setMessageStatusPerRecipientFromServerData",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(!(t instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(!(t instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(t));var n=je.MessageRecipientStatus.resolve(t.status),r=t.account_id,o=t.timestamp;return this.setRecipientMessageStatus(e,r,n,o)}},{key:"setRecipientMessageStatus",value:function(e,t,n,r){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if(!(null==r||"string"==typeof r||null==r||r instanceof Date))throw new TypeError('Value of argument "createdAt" violates contract.\n\nExpected:\n?string | ?Date\n\nGot:\n'+i(r));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));if(!(null==r||"string"==typeof r||null==r||r instanceof Date))throw new TypeError('Value of argument "createdAt" violates contract.\n\nExpected:\n?string | ?Date\n\nGot:\n'+a(r));var o=this._getMessageByServerId(e);if(o){n=je.MessageRecipientStatus.resolve(n),this._setSingleUserMessageRecipientMessageStatus(o,n);var u=(0,ae.default)(o.statusesPerRecipient,{userId:t});if(!u||this.__canChangeRecipientStatus(u.status,n)){this.host.models.User.ensureEntity(t,{onlyPlaceholder:!0});var s=o.id+":"+t;return this.host.models.MessageStatusPerRecipient.inject({id:s,messageId:o.id,userId:t,status:n,createdAt:r})}}}},{key:"__touchMessage",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));var t=this._resolveMessage(e);this.host.models.Message.touch(t)}},{key:"_resolveMessage",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));return this.host.models.Message.is(e)?e:this.host.models.Message.get(e)||this._getMessageByServerId(e)}},{key:"_getMessageByServerId",value:function(e){var t;if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));return this.host.models.Message.is(e)?e:(t=this.host.models.Message.getAll(),qe.default).call(t,{serverId:e})}},{key:"_setSingleUserMessageRecipientMessageStatus",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));this.__canChangeRecipientStatus(e.recipientStatus,t)&&this.host.models.Message.inject({id:e.id,recipientStatus:t})}},{key:"__canChangeRecipientStatus",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "fromStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "toStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "fromStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "toStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return e!==t&&(e!==je.MessageRecipientStatus.READ||t!=je.MessageRecipientStatus.DELIVERED)}},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t){var n,r,o,u,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return s=(0,re.default)(s,{includeStatuses:!0,includeCounterParty:!0}),this.host.requireUser(),e.next=8,this.host.api.messages.find(t);
case 8:if(n=e.sent,!s.includeCounterParty){e.next=19;break}return r=n.recipient_token,e.next=13,this.__lookupCounterParty(r);case 13:if(o=e.sent,!o){e.next=18;break}n.counterParty=o,e.next=19;break;case 18:return e.abrupt("return",null);case 19:if(u=this.host.models.Message.inject(n),!s.includeStatuses){e.next=23;break}return e.next=23,this.findStatusesPerRecipient(u);case 23:return e.abrupt("return",u);case 24:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAttachment",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t,n){var r,o,u;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(r=this._resolveMessage(t),o=!1,r){e.next=15;break}return o=!0,e.next=14,this.find(t,{includeStatuses:!1,includeCounterParty:!1});case 14:r=e.sent;case 15:if(u=this.__getMessageAttachment(r,n),u.isLocal){e.next=22;break}if("name"in u||o){e.next=22;break}return e.next=20,this.find(t,{includeStatuses:!1,includeCounterParty:!1});case 20:r=e.sent,u=this.__getMessageAttachment(r,n);case 22:return e.abrupt("return",u);case 23:case"end":return e.stop()}},e,this)}));return e}()},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Message.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Message.getMulti(e)}},{key:"__lookupCounterParty",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t){var n,r,o,u,s,c,l,f,d,p,y,h,g,v,m,b,w,E;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(r=[{model:this.host.models.User,finder:(n=this.host.users).find.bind(n)},{model:this.host.models.Group,finder:(n=this.host.groups).find.bind(n)}],r&&("function"==typeof r[G.default]||Array.isArray(r))){e.next=7;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+a(r));case 7:if(r&&("function"==typeof r[G.default]||Array.isArray(r))){e.next=9;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+i(r));case 9:o=!0,u=!1,s=void 0,e.prev=12,c=(0,A.default)(r);case 14:if(o=(l=c.next()).done){e.next=23;break}if(f=l.value,d=f.model,p=d.get(t),!p){e.next=20;break}return e.abrupt("return",p);case 20:o=!0,e.next=14;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(12),u=!0,s=e.t0;case 29:e.prev=29,e.prev=30,!o&&c.return&&c.return();case 32:if(e.prev=32,!u){e.next=35;break}throw s;case 35:return e.finish(32);case 36:return e.finish(29);case 37:if(r&&("function"==typeof r[G.default]||Array.isArray(r))){e.next=39;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+a(r));case 39:if(r&&("function"==typeof r[G.default]||Array.isArray(r))){e.next=41;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+i(r));case 41:y=!0,h=!1,g=void 0,e.prev=44,v=(0,A.default)(r);case 46:if(y=(m=v.next()).done){e.next=64;break}return b=m.value,w=b.finder,e.prev=49,e.next=52,w(t);case 52:if(E=e.sent,!E){e.next=55;break}return e.abrupt("return",E);case 55:e.next=61;break;case 57:if(e.prev=57,e.t1=e.catch(49),e.t1.code==Ve.default.NotFoundError.CODE){e.next=61;break}throw e.t1;case 61:y=!0,e.next=46;break;case 64:e.next=70;break;case 66:e.prev=66,e.t2=e.catch(44),h=!0,g=e.t2;case 70:e.prev=70,e.prev=71,!y&&v.return&&v.return();case 73:if(e.prev=73,!h){e.next=76;break}throw g;case 76:return e.finish(73);case 77:return e.finish(70);case 78:return e.abrupt("return",null);case 79:case"end":return e.stop()}},e,this,[[12,25,29,37],[30,,32,36],[44,66,70,78],[49,57],[71,,73,77]])}));return e}()},{key:"__getMessageAttachment",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(t));var n=this._resolveMessage(e);if(!n)return null;if(t=t.toString(),n.attachments){var r=(0,ae.default)(n.attachments,{id:t});return r}return null}},{key:"__getAttachmentPath",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(t));return"/message/"+e+"/attachment/"+t}},{key:"downloadAttachmentUrl",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(t));return this._downloadAttachmentBlobAndUrl(e,t).then(function(e){return e.url})}},{key:"downloadAttachment",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t,r){var o,u,s,c,l,f,d,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},y=p.fileName;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof r||"number"==typeof r){e.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(r));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof r||"number"==typeof r){e.next=8;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(r));case 8:e.next=25;break;case 16:return e.next=18,this._downloadAttachmentBlobAndUrl(o.serverId,r);case 18:u=e.sent.blob;case 19:y=y||s.name,y||(y="Attachment",o.sender.$placeholder||(y+=" from "+o.sender.displayName),y+=" at "+(0,_e.default)(o.createdAt).format("YYYY-MM-DD h-mma"),c=n(181),l=(0,ce.default)(c[s.contentType],"extensions.0")||"",l&&(y+="."+l)),f=n(140),d=f.saveAs,d(u,y),e.next=26;break;case 25:Ve.default.TargetNotSupportedError.raise();case 26:case"end":return e.stop()}},e,this)}));return e}()},{key:"_downloadAttachmentBlobAndUrl",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t,n){var r,o,u,s;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||"number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n||"number"==typeof n){e.next=8;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(n));case 8:e.next=27;break;case 13:if(o=e.sent){e.next=16;break}throw new Ve.default.NotFoundError("MessageAttachment",r.serverId+":"+n);case 16:if(!o.isLocal){e.next=23;break}return e.next=19,o.localPathPromise;case 19:return u=e.sent,e.abrupt("return",{blob:o.localFile,url:u});case 23:return s=this.__getAttachmentPath(r.serverId,n),e.abrupt("return",this.httpClient.downloadFileBlobAndUrl(s));case 25:e.next=28;break;case 27:Ve.default.TargetNotSupportedError.raise();case 28:case"end":return e.stop()}},e,this)}));return e}()},{key:"downloadAttachmentToFile",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t,n,r){var o,u;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||"number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "dest" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:if("string"==typeof n||"number"==typeof n){e.next=10;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "dest" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return n=n.toString(),o=this._resolveMessage(t),e.next=17,this.findAttachment(t,n);case 17:if(u=e.sent){e.next=20;break}throw new Ve.default.NotFoundError("MessageAttachment",o.serverId+":"+n);case 20:if(!/(\/|\\)$/.test(r)){e.next=26;break}if(!u.name){e.next=25;break}r+=u.name,e.next=26;break;case 25:throw new Error("missing file name in downloadAttachmentToFile(..., dest)");case 26:return e.abrupt("return",this.httpClient.downloadToFile(this.__getAttachmentPath(o.serverId,n),r));case 29:Ve.default.TargetNotSupportedError.raise();case 30:case"end":return e.stop()}},e,this)}));return e}()},{key:"__tryRetrievingMissingAttachmentName",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t,n){var r;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(r=this.__getMessageAttachment(t,n),!("name"in r)){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,this.find(t.serverId,{includeStatuses:!1,includeCounterParty:!1});case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"destroy",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t){return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return this.host.requireUser(),e.next=7,this.httpClient.delete("/message/:id",{urlParams:{id:t}});case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"getMessageCount",value:function(){return this.host.models.Message.getAll().length}},{key:"getTotalUnreadCount",value:function(){return(0,te.default)(this.host.models.Conversation.getAll(),"unreadCount")}},{key:"markAsRead",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+a(t));case 4:if(r=(0,re.default)(r,{queue:this.host.currentlyServingOfflineMessages}),t=(n=(n=(n=t,Ze.arrayWrapBound).call(n),$e.default).call(n,this._resolveModelId.bind(this)),Be.default).call(n),0!==t.length){e.next=8;break}return e.abrupt("return");case 8:if(!r.queue){e.next=12;break}return e.abrupt("return",this.__queueMessageStatuses({readIds:t}));case 12:return e.abrupt("return",this.__setMessagesStatus({readIds:t}));case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"markAsDelivered",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+a(t));case 4:if(r=(0,re.default)(r,{queue:this.host.currentlyServingOfflineMessages}),t=(n=(n=(n=t,Ze.arrayWrapBound).call(n),$e.default).call(n,this._resolveModelId.bind(this)),Be.default).call(n),0!==t.length){e.next=8;break}return e.abrupt("return");case 8:if(!r.queue){e.next=12;break}return e.abrupt("return",this.__queueMessageStatuses({deliveredIds:t}));case 12:return e.abrupt("return",this.__setMessagesStatus({deliveredIds:t}));case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"markAsReceived",value:function(){function e(){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(){var t=arguments;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.markAsDelivered.apply(this,t));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"__queueMessageStatuses",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t){var n,r=t.deliveredIds,o=t.readIds,u=arguments;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=u[0]&&(null==u[0].deliveredIds||Array.isArray(u[0].deliveredIds)&&u[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(null==u[0].readIds||Array.isArray(u[0].readIds)&&u[0].readIds.every(function(e){return"string"==typeof e}))){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  deliveredIds: ?Array<string>;\n  readIds: ?Array<string>;\n}\n\nGot:\n"+i(u[0]));case 2:if(null!=u[0]&&(null==u[0].deliveredIds||Array.isArray(u[0].deliveredIds)&&u[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(null==u[0].readIds||Array.isArray(u[0].readIds)&&u[0].readIds.every(function(e){return"string"==typeof e}))){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  deliveredIds: ?Array<string>;\n  readIds: ?Array<string>;\n}\n\nGot:\n"+a(u[0]));case 4:if(r&&(this._queuedMessageStatuses.deliveredIds=(0,J.default)(this._queuedMessageStatuses.deliveredIds,r)),o&&(this._queuedMessageStatuses.readIds=(0,J.default)(this._queuedMessageStatuses.readIds,o)),n=this._queuedMessageStatuses.deliveredIds.length+this._queuedMessageStatuses.readIds.length,!(n>=this.config.flushMessageMaxCount)){e.next=12;break}return this.logger.log("reached "+this.config.flushMessageMaxCount+" -- flushing"),e.abrupt("return",this.__flushQueueMessageStatuses());case 12:this._throtelled_flushQueueMessageStatuses();case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"__flushQueueMessageStatuses",value:function(){var e=this._queuedMessageStatuses.deliveredIds.length+this._queuedMessageStatuses.readIds.length;e>0&&(this.__setMessagesStatus(this._queuedMessageStatuses),this._queuedMessageStatuses.deliveredIds=[],this._queuedMessageStatuses.readIds=[])}},{key:"__setMessagesStatus",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t){var n,r,o,a,i=this,u=t.deliveredIds,s=void 0===u?[]:u,c=t.readIds,l=void 0===c?[]:c;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),s=(n=(n=s,$e.default).call(n,this._resolveModelId.bind(this)),Be.default).call(n),l=(n=(n=l,$e.default).call(n,this._resolveModelId.bind(this)),Be.default).call(n),r=s.map(this._resolveMessage).filter(Boolean),o=l.map(this._resolveMessage).filter(Boolean),l=(0,Q.default)(l,(n=Ke.default.call(o,function(e){return e.recipientStatus===je.MessageRecipientStatus.READ}),$e.default).call(n,"id")),s=(0,Q.default)(s,l,(n=Ke.default.call(r,function(e){return e.recipientStatus===je.MessageRecipientStatus.DELIVERED||e.recipientStatus===je.MessageRecipientStatus.READ}),$e.default).call(n,"id")),a={},s.length&&(a.delivered=s),l.length&&(a.read=l,o.forEach(function(e){return i.host.models.Message.inject({id:e.id,recipientStatus:je.MessageRecipientStatus.READ,recipientStatusMarkingAsRead:!0})})),!(0,fe.default)(a.delivered)||!(0,fe.default)(a.read)){e.next=12;break}return e.abrupt("return",!1);case 12:return e.next=14,this.httpClient.post("/message/status",{data:a});case 14:l.length&&(a.read=l,o.forEach(function(e){return i.host.models.Message.inject({id:e.id,recipientStatus:je.MessageRecipientStatus.READ,recipientStatusMarkingAsRead:!1})}),this.__checkForDeleteOnReadMessages(o)),s.length&&r.forEach(function(e){return i.host.models.Message.inject({id:e.id,recipientStatus:je.MessageRecipientStatus.DELIVERED})});case 16:case"end":return e.stop()}},e,this)}));return e}()},{key:"__checkForDeleteOnReadMessages",value:function(e){var t=this;if(!Array.isArray(e)||!e.every(function(e){return e instanceof Object}))throw new TypeError('Value of argument "messages" violates contract.\n\nExpected:\nObject[]\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return e instanceof Object}))throw new TypeError('Value of argument "messages" violates contract.\n\nExpected:\nObject[]\n\nGot:\n'+a(e));Ke.default.call(e,{deleteOnRead:!0}).forEach(function(e){return t.setMessageTTLInMinutes(e,1)})}},{key:"setMessageTTLInMinutes",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("number"!=typeof t)throw new TypeError('Value of argument "ttl" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if("number"!=typeof t)throw new TypeError('Value of argument "ttl" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(t));var n=this._resolveMessage(e);if(n){var r=(0,_e.default)().add(t,"minute").toDate().getTime();this.host.models.Message.inject({id:n.id,ttl:t,expiresAt:r})}}},{key:"deleteExpiredMessages",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();t.getTime&&(t=t.getTime()),this.host.models.Message.getAll().filter(function(e){return e.expiresAt&&e.expiresAt<t}).forEach(function(t){return e.host.models.Message.eject(t)})}},{key:"findStatusesPerRecipient",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,N.default)(z.default.mark(function e(t){var n,r,o,u=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{includeUsers:!1},c=s.includeUsers,l=void 0!==c&&c;return z.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:if(this.host.requireUser(),n=this._resolveMessage(t)){e.next=8;break}return e.abrupt("return",null);case 8:if(n.serverId){e.next=10;break}throw new Error('Message "'+n.id+"\" isn't sent yet");case 10:return e.next=12,this.host.api.messages.findStatusesPerRecipient(n.serverId);case 12:if(r=e.sent,!r.is_recalled){e.next=16;break}return this.onMessageRecalled(n.serverId),e.abrupt("return");case 16:if(o=r.statuses.map(function(e){return u.__setMessageStatusPerRecipientFromServerData(n.serverId,e)}).some(function(e){return e}),o&&this.__touchMessage(n),!l){e.next=22;break}return e.next=21,_.default.all(n.statusesPerRecipient.map(function(e){return u.host.users.find(e.userId,{ignoreNotFound:!0})}));case 21:this.host.models.Message.touch(n);case 22:return e.abrupt("return",n.statusesPerRecipient);case 23:case"end":return e.stop()}},e,this)}));return e}()}]),t}(Ee.default),o(h.prototype,"__resolveCounterPartyEntityAndOrganizationId",[Oe.privateMethod],(0,E.default)(h.prototype,"__resolveCounterPartyEntityAndOrganizationId"),h.prototype),o(h.prototype,"__resolveRemoteCounterPartyEntity",[Oe.privateMethod],(0,E.default)(h.prototype,"__resolveRemoteCounterPartyEntity"),h.prototype),o(h.prototype,"__sendToKnownCounterParty",[Oe.privateMethod],(0,E.default)(h.prototype,"__sendToKnownCounterParty"),h.prototype),o(h.prototype,"__sendToUnknownCounterParty",[Oe.privateMethod],(0,E.default)(h.prototype,"__sendToUnknownCounterParty"),h.prototype),o(h.prototype,"__normalizeSendOptions",[Oe.privateMethod],(0,E.default)(h.prototype,"__normalizeSendOptions"),h.prototype),o(h.prototype,"__ensureOrganization",[Oe.privateMethod],(0,E.default)(h.prototype,"__ensureOrganization"),h.prototype),o(h.prototype,"__validateAttachments",[Oe.privateMethod],(0,E.default)(h.prototype,"__validateAttachments"),h.prototype),o(h.prototype,"__normalizeMetadata",[Oe.privateMethod],(0,E.default)(h.prototype,"__normalizeMetadata"),h.prototype),o(h.prototype,"__getNextSortNumber",[Oe.privateMethod],(0,E.default)(h.prototype,"__getNextSortNumber"),h.prototype),o(h.prototype,"__setLocalMessageAttachments",[Oe.privateMethod],(0,E.default)(h.prototype,"__setLocalMessageAttachments"),h.prototype),o(h.prototype,"__generateAttachmentDescriptor",[Oe.privateMethod],(0,E.default)(h.prototype,"__generateAttachmentDescriptor"),h.prototype),o(h.prototype,"__loadLocalFilePathWithFileReader",[Oe.privateMethod],(0,E.default)(h.prototype,"__loadLocalFilePathWithFileReader"),h.prototype),o(h.prototype,"__sendToGroupOfUsers",[Oe.privateMethod],(0,E.default)(h.prototype,"__sendToGroupOfUsers"),h.prototype),o(h.prototype,"__prepareGroupForUsers",[Oe.privateMethod,u],(0,E.default)(h.prototype,"__prepareGroupForUsers"),h.prototype),o(h.prototype,"_deleteLocalMessage",[Oe.privateMethod],(0,E.default)(h.prototype,"_deleteLocalMessage"),h.prototype),o(h.prototype,"__recallSingle",[Oe.privateMethod],(0,E.default)(h.prototype,"__recallSingle"),h.prototype),o(h.prototype,"__setMessageStatusPerRecipientFromServerData",[Oe.privateMethod],(0,E.default)(h.prototype,"__setMessageStatusPerRecipientFromServerData"),h.prototype),o(h.prototype,"__touchMessage",[Oe.privateMethod],(0,E.default)(h.prototype,"__touchMessage"),h.prototype),o(h.prototype,"_resolveMessage",[Oe.privateMethod,Se.default],(0,E.default)(h.prototype,"_resolveMessage"),h.prototype),o(h.prototype,"_getMessageByServerId",[Oe.privateMethod],(0,E.default)(h.prototype,"_getMessageByServerId"),h.prototype),o(h.prototype,"_setSingleUserMessageRecipientMessageStatus",[Oe.privateMethod],(0,E.default)(h.prototype,"_setSingleUserMessageRecipientMessageStatus"),h.prototype),o(h.prototype,"__canChangeRecipientStatus",[Oe.privateMethod],(0,E.default)(h.prototype,"__canChangeRecipientStatus"),h.prototype),o(h.prototype,"find",[s],(0,E.default)(h.prototype,"find"),h.prototype),o(h.prototype,"__lookupCounterParty",[Oe.privateMethod],(0,E.default)(h.prototype,"__lookupCounterParty"),h.prototype),o(h.prototype,"__getMessageAttachment",[Oe.privateMethod],(0,E.default)(h.prototype,"__getMessageAttachment"),h.prototype),o(h.prototype,"__getAttachmentPath",[Oe.privateMethod],(0,E.default)(h.prototype,"__getAttachmentPath"),h.prototype),o(h.prototype,"downloadAttachmentUrl",[c],(0,E.default)(h.prototype,"downloadAttachmentUrl"),h.prototype),o(h.prototype,"downloadAttachment",[l],(0,E.default)(h.prototype,"downloadAttachment"),h.prototype),o(h.prototype,"_downloadAttachmentBlobAndUrl",[Oe.privateMethod,f],(0,E.default)(h.prototype,"_downloadAttachmentBlobAndUrl"),h.prototype),o(h.prototype,"__tryRetrievingMissingAttachmentName",[Oe.privateMethod],(0,E.default)(h.prototype,"__tryRetrievingMissingAttachmentName"),h.prototype),o(h.prototype,"destroy",[d],(0,E.default)(h.prototype,"destroy"),h.prototype),o(h.prototype,"__queueMessageStatuses",[Oe.privateMethod],(0,E.default)(h.prototype,"__queueMessageStatuses"),h.prototype),o(h.prototype,"__flushQueueMessageStatuses",[Oe.privateMethod,Se.default],(0,E.default)(h.prototype,"__flushQueueMessageStatuses"),h.prototype),o(h.prototype,"__setMessagesStatus",[Oe.privateMethod],(0,E.default)(h.prototype,"__setMessagesStatus"),h.prototype),o(h.prototype,"__checkForDeleteOnReadMessages",[Oe.privateMethod],(0,E.default)(h.prototype,"__checkForDeleteOnReadMessages"),h.prototype),o(h.prototype,"deleteExpiredMessages",[Se.default],(0,E.default)(h.prototype,"deleteExpiredMessages"),h.prototype),o(h.prototype,"findStatusesPerRecipient",[p],(0,E.default)(h.prototype,"findStatusesPerRecipient"),h.prototype),y=h))||y);t.default=He,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g.default)(e);if(!Array.isArray(e)){var o=(0,P.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g.default)(e);if(!Array.isArray(e)){var o=(0,P.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c,l,f,d,p=n(7),y=r(p),h=n(10),g=r(h),v=n(11),m=r(v),b=n(45),w=r(b),E=n(28),x=r(E),_=n(29),k=r(_),O=n(44),T=r(O),I=n(39),j=r(I),A=n(16),M=r(A),G=n(20),V=r(G),z=n(9),S=r(z),C=n(6),P=r(C),N=n(8),R=r(N),U=n(3),q=r(U),F=n(1),$=r(F),L=n(2),B=r(L),D=n(5),K=r(D),Z=n(4),W=r(Z),H=n(69),X=r(H),Q=n(152),Y=r(Q),J=n(176),ee=r(J),te=n(13),ne=r(te),re=n(15),oe=r(re),ae=n(18),ie=n(14),ue=n(19),se=(u=(0,ae.decorator)(),s=(0,
ae.decorator)(),(0,ie.classWithPrivateMethods)((d=f=function(e){function t(){return(0,$.default)(this,t),(0,K.default)(this,(t.__proto__||(0,q.default)(t)).apply(this,arguments))}return(0,W.default)(t,e),(0,B.default)(t,[{key:"fullUpdate",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,R.default)(S.default.mark(function e(t,n,r){return S.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if(n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:if(n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:if(r){e.next=14;break}throw new oe.default.ValidationError("organizationId","required");case 14:if(!(this.host.config.maxMetadataKeyCount>0&&(0,P.default)(n).length>this.host.config.maxMetadataKeyCount)){e.next=16;break}throw new oe.default.ValidationError("entireData","invalid","Total number of metadata keys is "+(0,P.default)(n)+" and should not exceed "+this.host.config.maxMetadataKeyCount);case 16:return this.host.requireUser(),t=this._resolveModelId(t),e.prev=18,e.next=21,this.host.api.metadata.update(t,n,r);case 21:return this.__injectMetadata(t,r,n),e.abrupt("return",n);case 25:if(e.prev=25,e.t0=e.catch(18),!e.t0.response||404!=e.t0.response.status){e.next=31;break}throw new oe.default.NotFoundError("metadata",t);case 31:throw e.t0;case 32:case"end":return e.stop()}},e,this,[[18,25]])}));return e}()},{key:"update",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,R.default)(S.default.mark(function e(t,n,r){var o,u;return S.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if(n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:if(n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:if(r){e.next=14;break}throw new oe.default.ValidationError("organizationId","required");case 14:return e.next=16,this.find(t,r);case 16:return o=e.sent,u=(0,V.default)({},o,n),e.abrupt("return",this.fullUpdate(t,u,r));case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,R.default)(S.default.mark(function e(t,n){var r;return S.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(n){e.next=10;break}throw new oe.default.ValidationError("organizationId","required");case 10:return this.host.requireUser(),t=this._resolveModelId(t),e.prev=12,e.next=15,this.host.api.metadata.find(t,n);case 15:return r=e.sent,this.__injectMetadata(t,n,r),e.abrupt("return",r);case 20:if(e.prev=20,e.t0=e.catch(12),!e.t0.response||404!=e.t0.response.status){e.next=26;break}throw new oe.default.NotFoundError("metadata",t);case 26:throw e.t0;case 27:case"end":return e.stop()}},e,this,[[12,20]])}));return e}()},{key:"findMulti",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,R.default)(S.default.mark(function e(t,n){var r,o,u,s,c=this;return S.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(n){e.next=10;break}throw new oe.default.ValidationError("organizationId","required");case 10:return this.host.requireUser(),t=(0,ee.default)((0,ue.arrayWrap)(t).map(this._resolveModelId.bind(this))),r=(0,Y.default)(t,20),o=r.map(function(e){return c.__findMultiPaged(e,n)}),e.next=16,M.default.all(o);case 16:return u=e.sent,s=X.default.apply(void 0,[{}].concat((0,j.default)(u))),e.abrupt("return",s);case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"__findMultiPaged",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,R.default)(S.default.mark(function e(t,n){var r,o,u,s,c,l,f,d,p,y,h,g,v,m,b,E;return S.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e.prev=8,e.next=11,this.host.api.metadata.findMulti(t,n);case 11:if(r=e.sent,f=(0,T.default)(r),f&&("function"==typeof f[k.default]||Array.isArray(f))){e.next=15;break}throw new TypeError("Expected _Object$entries to be iterable, got "+a(f));case 15:if(f&&("function"==typeof f[k.default]||Array.isArray(f))){e.next=17;break}throw new TypeError("Expected _Object$entries to be iterable, got "+i(f));case 17:for(o=!0,u=!1,s=void 0,e.prev=20,c=(0,x.default)(f);!(o=(l=c.next()).done);o=!0)d=(0,w.default)(l.value,2),p=d[0],y=d[1],y&&this.__injectMetadata(p,n,y);e.next=28;break;case 24:e.prev=24,e.t0=e.catch(20),u=!0,s=e.t0;case 28:e.prev=28,e.prev=29,!o&&c.return&&c.return();case 31:if(e.prev=31,!u){e.next=34;break}throw s;case 34:return e.finish(31);case 35:return e.finish(28);case 36:return e.abrupt("return",r);case 39:if(e.prev=39,e.t1=e.catch(8),!e.t1.response||404!=e.t1.response.status){e.next=84;break}if(h={},t&&("function"==typeof t[k.default]||Array.isArray(t))){e.next=45;break}throw new TypeError("Expected ids to be iterable, got "+a(t));case 45:if(t&&("function"==typeof t[k.default]||Array.isArray(t))){e.next=47;break}throw new TypeError("Expected ids to be iterable, got "+i(t));case 47:g=!0,v=!1,m=void 0,e.prev=50,b=(0,x.default)(t);case 52:if(g=(E=b.next()).done){e.next=67;break}return p=E.value,e.prev=54,e.next=57,this.find(p,n);case 57:h[p]=e.sent,e.next=64;break;case 60:if(e.prev=60,e.t2=e.catch(54),e.t2.code==oe.default.NotFoundError.CODE){e.next=64;break}throw e.t2;case 64:g=!0,e.next=52;break;case 67:e.next=73;break;case 69:e.prev=69,e.t3=e.catch(50),v=!0,m=e.t3;case 73:e.prev=73,e.prev=74,!g&&b.return&&b.return();case 76:if(e.prev=76,!v){e.next=79;break}throw m;case 79:return e.finish(76);case 80:return e.finish(73);case 81:return e.abrupt("return",h);case 84:throw e.t1;case 85:case"end":return e.stop()}},e,this,[[8,39],[20,24,28,36],[29,,31,35],[50,69,73,81],[54,60],[74,,76,80]])}));return e}()},{key:"__injectMetadata",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));var r=e+":"+t;this.host.models.Metadata.inject({id:r,data:n,entityId:e,organizationId:t})}}]),t}(ne.default),f.METADTA_TYPES=["user","group"],l=d,o(l.prototype,"find",[u],(0,m.default)(l.prototype,"find"),l.prototype),o(l.prototype,"findMulti",[s],(0,m.default)(l.prototype,"findMulti"),l.prototype),o(l.prototype,"__findMultiPaged",[ie.privateMethod],(0,m.default)(l.prototype,"__findMultiPaged"),l.prototype),o(l.prototype,"__injectMetadata",[ie.privateMethod],(0,m.default)(l.prototype,"__injectMetadata"),l.prototype),c=l))||c);t.default=se,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p.default)(e);if(!Array.isArray(e)){var o=(0,G.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,p.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p.default)(e);if(!Array.isArray(e)){var o=(0,G.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,p.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c,l=n(7),f=r(l),d=n(10),p=r(d),y=n(11),h=r(y),g=n(9),v=r(g),m=n(8),b=r(m),w=n(3),E=r(w),x=n(1),_=r(x),k=n(2),O=r(k),T=n(5),I=r(T),j=n(4),A=r(j),M=n(6),G=r(M),V=n(138),z=r(V),S=n(35),C=r(S),P=n(13),N=r(P),R=n(149),U=r(R),q=n(14),F=n(18),$=n(27),L=r($),B=n(23),D=r(B),K=n(53),Z=r(K),W={account:"user",group:"group"},H=new z.default((0,G.default)(W)),X=(0,C.default)(W).concat(["conversation"]),Q=525600,Y=(u=(0,F.decorator)(),(0,q.classWithPrivateMethods)((c=function(e){function t(){return(0,_.default)(this,t),(0,I.default)(this,(t.__proto__||(0,E.default)(t)).apply(this,arguments))}return(0,A.default)(t,e),(0,O.default)(t,[{key:"mounted",value:function(){this._muteEntriesByConversationId={},this._fetched=!1}},{key:"dispose",value:function(){this._muteEntriesByConversationId=null,this._fetched=!1}},{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(){var t,n;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetched){e.next=6;break}return e.next=3,this.host.api.mute.findAll();case 3:n=e.sent,(t=n.filter(function(e){return H.has(e.sender_type)}).map(this._parseMuteEntry),U.default).call(t,this._isExpired).forEach(this._addEntry),this._fetched=!0;case 6:return e.abrupt("return",(0,C.default)(this._muteEntriesByConversationId));case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"_parseMuteEntry",value:function(e){var t=+e.mute_duration,n=new Date(1e3*+e.mute_start).getTime(),r=(0,Z.default)(n).add(t,"minute").toDate().getTime(),o=W[e.sender_type],a=e.caller_organization||e.organization_id,i=e.sender_token,u=this.host.conversations.getConversationKey(o,i,a);return{conversationId:u,durationInMinutes:t,startedAt:n,expiresAt:r,organizationId:a,entityId:i,entityType:o}}},{key:"_isExpired",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "entry" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "entry" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));return e.expiresAt<Date.now()}},{key:"_addEntry",value:function(e){var t=e.conversationId,n=e.entityType,r=e.entityId,o=e.organizationId,a=e.durationInMinutes,i=e.startedAt;t=t||this.host.conversations.getConversationKey(n,r,o),i=i||Date.now();var u=(0,Z.default)(i).add(a,"minute").toDate().getTime(),s={conversationId:t,durationInMinutes:a,startedAt:i,expiresAt:u,organizationId:o,entityId:r,entityType:n};return this.host.models.Conversation.touch(t),this._muteEntriesByConversationId[t]=s,s}},{key:"_removeEntry",value:function(e){var t=e.conversationId,n=e.entityType,r=e.entityId,o=e.organizationId;t=t||this.host.conversations.getConversationKey(n,r,o),delete this._muteEntriesByConversationId[t],this.host.models.Conversation.touch(t)}},{key:"_removeAllEntries",value:function(){var e=this;(0,C.default)(this._muteEntriesByConversationId).forEach(function(t){return e._removeEntry(t)})}},{key:"getByConversationId",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));var t=this._muteEntriesByConversationId[e];return t?this._isExpired(t)?(delete this._muteEntriesByConversationId[e],null):t:null}},{key:"unmuteAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(){return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.mute.unmuteAll();case 2:this._removeAllEntries();case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"mute",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(t,n,r){var o;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if(null==r||"string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(r));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:if("number"==typeof n){e.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if(null==r||"string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(r));case 12:if(o=this._resolveEntity(t,X)){e.next=15;break}throw new Error("entity "+t+" not found");case 15:e.t0=o.$entityType,e.next="conversation"===e.t0?18:"user"===e.t0?19:"group"===e.t0?21:"organization"===e.t0?22:23;break;case 18:return e.abrupt("return",this.mute(o.counterParty,n,o.organizationId));case 19:return L.default.notEmpty("organizationId",r),e.abrupt("return",this.muteUser(o,n,r));case 21:return e.abrupt("return",this.muteGroup(o,n));case 22:return e.abrupt("return",this.muteOrganization(o,n));case 23:case"end":return e.stop()}},e,this)}));return e}()},{key:"unmute",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(t,n){var r;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if(null==n||"string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if(null==n||"string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(n));case 8:if(r=this._resolveEntity(t,X)){e.next=11;break}throw new Error("entity "+t+" not found");case 11:e.t0=r.$entityType,e.next="conversation"===e.t0?14:"user"===e.t0?15:"group"===e.t0?17:"organization"===e.t0?18:19;break;case 14:return e.abrupt("return",this.unmute(r.counterParty,r.organizationId));case 15:return L.default.notEmpty("organizationId",n),e.abrupt("return",this.unmuteUser(r,n));case 17:return e.abrupt("return",this.unmuteGroup(r));case 18:return e.abrupt("return",this.unmuteOrganization(r));case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"muteUser",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(t,n,r){return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if("string"==typeof r||r instanceof Object){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(r));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:if("number"==typeof n){e.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if("string"==typeof r||r instanceof Object){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(r));case 12:return this.__validateDurationInMinutes(n),t=this._resolveModelIdWithTypes(t,"user"),r=this._resolveModelId(r),e.next=17,this.host.api.mute.muteUser(t,n,r,{recipientOrganizationId:r});case 17:this._addEntry({entityType:"user",entityId:t,organizationId:r,durationInMinutes:n});case 18:case"end":return e.stop()}},e,this)}));return e}()},{key:"unmuteUser",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(t,n){return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:return t=this._resolveModelIdWithTypes(t,"user"),n=this._resolveModelId(n),e.next=12,this.host.api.mute.unmuteUser(t,n,{recipientOrganizationId:n});case 12:this._removeEntry({entityType:"user",entityId:t,organizationId:n});case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"muteGroup",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(t,n,r){var o;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if(null==r||"string"==typeof r||null==r||r instanceof Object){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+i(r));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:if("number"==typeof n){e.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if(null==r||"string"==typeof r||null==r||r instanceof Object){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(r));case 12:return this.__validateDurationInMinutes(n),o=this._resolveEntity(t,"group"),o?(t=o.id,r=o.organizationId):r=this._resolveModelId(r),L.default.notEmpty("organizationId",r),e.next=18,this.host.api.mute.muteGroup(t,n,r);case 18:this._addEntry({entityType:"group",entityId:t,organizationId:r,durationInMinutes:n});case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"unmuteGroup",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(t,n){var r;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if(null==n||"string"==typeof n||null==n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if(null==n||"string"==typeof n||null==n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(n));case 8:return r=this._resolveEntity(t,"group"),r?(t=r.id,n=r.organizationId):(L.default.notEmpty("organizationId",n),n=this._resolveModelId(n)),e.next=12,this.host.api.mute.unmuteGroup(t,n);case 12:this._removeEntry({entityType:"group",entityId:t,organizationId:n});case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"reactToMuteEvent",value:function(e){if(e.data.token==this.host.currentUser.id){var t=e.data.action;if("clear"===t)return void this._removeAllEntries();var n=this._parseMuteEntry(e.data);switch(t){case"add":this._muteEntriesByConversationId[n.conversationId]=n;break;case"del":delete this._muteEntriesByConversationId[n.conversationId]}}}},{key:"__validateDurationInMinutes",value:function(e){if("number"!=typeof e)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(e));if("number"!=typeof e)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(e));(e<0||e>Q||e%1!==0)&&L.default.raise("durationInMinutes","invalid","should be a positive integer from 1 to "+Q+" (1 year)")}}]),t}(N.default),o(c.prototype,"findAll",[u],(0,h.default)(c.prototype,"findAll"),c.prototype),o(c.prototype,"_parseMuteEntry",[q.privateMethod,D.default],(0,h.default)(c.prototype,"_parseMuteEntry"),c.prototype),o(c.prototype,"_addEntry",[q.privateMethod,D.default],(0,h.default)(c.prototype,"_addEntry"),c.prototype),o(c.prototype,"_removeEntry",[q.privateMethod,D.default],(0,h.default)(c.prototype,"_removeEntry"),c.prototype),o(c.prototype,"_removeAllEntries",[q.privateMethod],(0,h.default)(c.prototype,"_removeAllEntries"),c.prototype),o(c.prototype,"__validateDurationInMinutes",[q.privateMethod],(0,h.default)(c.prototype,"__validateDurationInMinutes"),c.prototype),s=c))||s);t.default=Y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g.default)(e);if(!Array.isArray(e)){var o=(0,y.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g.default)(e);if(!Array.isArray(e)){var o=(0,y.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,g.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c,l,f=n(7),d=r(f),p=n(6),y=r(p),h=n(10),g=r(h),v=n(11),m=r(v),b=n(12),w=r(b),E=n(9),x=r(E),_=n(8),k=r(_),O=n(3),T=r(O),I=n(1),j=r(I),A=n(2),M=r(A),G=n(5),V=r(G),z=n(4),S=r(z),C=n(26),P=r(C),N=n(75),R=r(N),U=n(34),q=r(U),F=n(17),$=r(F),L=n(174),B=r(L),D=n(50),K=r(D),Z=n(13),W=r(Z),H=n(18),X=n(15),Q=r(X),Y=n(33),J=r(Y),ee=n(48),te=r(ee),ne=n(38),re=r(ne),oe=n(78),ae=r(oe),ie=n(23),ue=r(ie),se=n(14),ce=(u=(0,H.decorator)({memoize:!0}),s=(0,H.decorator)(),(0,se.classWithPrivateMethods)((l=function(e){function t(){return(0,j.default)(this,t),(0,V.default)(this,(t.__proto__||(0,T.default)(t)).apply(this,arguments))}return(0,S.default)(t,e),(0,M.default)(t,[{key:"mounted",value:function(){this.host.models.Conversation.on("afterInject",this._onConversationChange),this.host.models.Conversation.on("afterEject",this._onConversationChange)}},{key:"dispose",value:function(){this.host.models.Conversation.off("afterInject",this._onConversationChange),this.host.models.Conversation.off("afterEject",this._onConversationChange),H.decorator.clear(this.findAll)}},{key:"create",value:function(){function e(){return t.apply(this,arguments)}var t=(0,k.default)(x.default.mark(function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:void 0,ttl:void 0,deleteOnRead:void 0,allowPublicGroups:void 0,pinLock:void 0,settingsRestricted:void 0,autologoutTime:void 0,lifecycleCallback:void 0,
groupLifespan:void 0,welcomeEmailSettings:void 0};return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),e.abrupt("return",this.httpClient.post("/organization",{data:n}).then(function(e){var r=e.getHeader("TT-X-Organization-Key"),o=t.host.models.Organization.inject({id:r,name:n.name});return o}));case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"update",value:function(){function e(){return t.apply(this,arguments)}var t=(0,k.default)(x.default.mark(function e(){var t,n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:void 0,name:void 0,ttl:void 0,deleteOnRead:void 0,allowPublicGroups:void 0,pinLock:void 0,settingsRestricted:void 0,autologoutTime:void 0,lifecycleCallback:void 0,groupLifespan:void 0,welcomeEmailSettings:void 0,welcomeEmailLogo:void 0,autoSendWelcomeEmail:void 0};return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),t=re.default.underscoreObject({name:r.name,ttl:r.ttl,deleteOnRead:r.deleteOnRead,allowPublicGroups:r.allowPublicGroups,pinLock:r.pinLock,settingsRestricted:r.settingsRestricted,autologoutTime:r.autologoutTime,lifecycleCallback:r.lifecycleCallback,groupLifespan:r.groupLifespan,welcomeEmailSettings:r.welcomeEmailSettings,welcomeEmailLogo:r.welcomeEmailLogo,autoSendWelcomeEmail:r.autoSendWelcomeEmail}),e.abrupt("return",this.httpClient.post("/organization/:id",{urlParams:{id:r.id},data:t}).then(function(e){var o=n.host.models.Organization.inject((0,w.default)({id:r.id},t));return o}));case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,k.default)(x.default.mark(function e(){var t,n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{onlyApproved:!1};return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),e.next=3,this._findAll();case 3:return t=e.sent,r.onlyApproved&&(t=(0,K.default)(t,{pending:!1})),t=(0,B.default)(t,function(e){return e.name.toLowerCase()}),t.forEach(function(e){return n.__reloadConversations(e)}),e.abrupt("return",t);case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"refreshAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,k.default)(x.default.mark(function e(){return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._findAll();case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"_findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,k.default)(x.default.mark(function e(){var t,n=this;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.organizations.findAllOfUser(this.host.currentUserId);case 2:return t=e.sent,t=t.map(function(e){return n.host.models.Organization.inject(e)}),e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,k.default)(x.default.mark(function e(t){var n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(o=(0,$.default)(o,{ignoreNotFound:!1,bypassCache:!1}),this.host.requireUser(),n=void 0,o.bypassCache){e.next=11;break}if(n=this.host.models.Organization.get(t),!n||n.$placeholder){e.next=11;break}return e.abrupt("return",n);case 11:return e.next=13,this.host.api.organizations.find(this.host.currentUserId,t);case 13:if(r=e.sent,!r){e.next=19;break}n=this.host.models.Organization.inject(r),this.__reloadConversations(n),e.next=21;break;case 19:if(o.ignoreNotFound){e.next=21;break}throw new Q.default.NotFoundError(this.host.models.Organization.name,t);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}},e,this)}));return e}()},{key:"getSettingValue",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));e=this._resolveModelId(e);var n=this.getById(e);return n?n.getSettingValue(t):null}},{key:"getAll",value:function(){return this.host.models.Organization.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Organization.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Organization.getMulti(e)}},{key:"_onConversationChange",value:function(e,t){this.__reloadConversations(t.organization)}},{key:"__reloadConversations",value:function(e){var t;if(e){var n=(0,q.default)(e,["conversations","unreadCount"]),r=(t=(t=this.host.models.Conversation.getAll(),J.default).call(t,{organizationId:e.id}),te.default).call(t,["lastEventMessageSortNumber","_origIndex"],["desc","asc"]),o=(0,R.default)(r,"unreadCount"),a={conversations:r,unreadCount:o},i=!1;(0,P.default)(n,function(t,n){(0,ae.default)(t,a[n])||(e[n]=a[n],i=!0)}),i&&this.host.models.Organization.inject(e)}}}]),t}(W.default),o(l.prototype,"findAll",[u],(0,m.default)(l.prototype,"findAll"),l.prototype),o(l.prototype,"refreshAll",[H.decorator],(0,m.default)(l.prototype,"refreshAll"),l.prototype),o(l.prototype,"_findAll",[se.privateMethod],(0,m.default)(l.prototype,"_findAll"),l.prototype),o(l.prototype,"find",[s],(0,m.default)(l.prototype,"find"),l.prototype),o(l.prototype,"_onConversationChange",[se.privateMethod,ue.default],(0,m.default)(l.prototype,"_onConversationChange"),l.prototype),o(l.prototype,"__reloadConversations",[se.privateMethod],(0,m.default)(l.prototype,"__reloadConversations"),l.prototype),c=l))||c);t.default=ce,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a=n(3),i=r(a),u=n(1),s=r(u),c=n(2),l=r(c),f=n(5),d=r(f),p=n(4),y=r(p),h=n(13),g=r(h),v=n(24),m=n(14),b=n(23),w=(r(b),(0,m.classWithPrivateMethods)(o=function(e){function t(e,n){return(0,s.default)(this,t),(0,d.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n))}return(0,y.default)(t,e),(0,l.default)(t,[{key:"mounted",value:function(){this._data={}}},{key:"dispose",value:function(){this._data=null}},{key:"reactToPresenceEvent",value:function(e){this.set(e.data.from,v.PresenceStatus.resolve(e.data.type))}},{key:"set",value:function(e,t){var n=this._data[e]!==t;if(n){var r=this.host.models.User.get(e);this._data[e]=t,this.emit("change",{userId:e,presence:t,user:r})}}},{key:"get",value:function(e){return e==this.host.currentUserId?v.PresenceStatus.AVAILABLE:this._data[e]||null}}]),t}(g.default))||o);t.default=w,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,i,u=n(11),s=r(u),c=n(9),l=r(c),f=n(16),d=r(f),p=n(6),y=r(p),h=n(8),g=r(h),v=n(3),m=r(v),b=n(1),w=r(b),E=n(2),x=r(E),_=n(5),k=r(_),O=n(4),T=r(O),I=n(26),j=r(I),A=n(165),M=r(A),G=n(162),V=r(G),z=n(156),S=r(z),C=n(42),P=r(C),N=n(72),R=r(N),U=n(35),q=r(U),F=n(13),$=r(F),L=n(18),B=n(15),D=r(B),K=n(38),Z=r(K),W=n(56),H=n(19),X={user:"account",distributionList:"distribution_list",group:"group",organization:"organization",room:"public_group"},Q=(0,q.default)(X),Y=(a=(0,L.decorator)(),i=function(e){function t(){return(0,w.default)(this,t),(0,k.default)(this,(t.__proto__||(0,m.default)(t)).apply(this,arguments))}return(0,T.default)(t,e),(0,x.default)(t,[{key:"query",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,g.default)(l.default.mark(function e(t){var n,r,o,a,i,u,s=this,c=t.types,f=void 0===c?[]:c,p=t.query,h=void 0===p?{}:p,g=t.continuation,v=void 0===g?null:g,m=t.includeDisabled,b=void 0!==m&&m,w=t.excludeIds,E=void 0===w?[]:w,x=t.excludeSelf,_=void 0!==x&&x,k=t.resultsFormat,O=void 0===k?"entities":k,T=t.organizationId,I=void 0===T?null:T,A=t.organizationIds,G=void 0===A?[]:A,z=t.sort,C=void 0===z?[]:z,N=t.includeMetadata,U=void 0!==N&&N;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=f.length){e.next=2;break}throw new D.default.ValidationError("types","required","no types specified");case 2:if(f=f.map(function(e){return X[e]}),n=(0,R.default)(f,Q),!(n.length>0)){e.next=6;break}throw new D.default.ValidationError("types","invalid","invalid types: "+n.join(", "));case 6:if(I&&(G=[I]),0!=G.length){e.next=9;break}throw new D.default.ValidationError("organizationIds","invalid","search must be done in a context of an organization");case 9:return"ids"===O&&(O="tokens"),r={type:f,include_disabled:b,directory:G,results_format:O},v&&(r.continuation=v),C&&C.length&&(r.sort=C),E=(0,H.arrayWrap)(E),h&&(0,y.default)(h).length>0&&(r.bool={must:Z.default.underscoreObject(h)}),e.next=17,this.httpClient.post("/search",{data:r});case 17:if(o=e.sent,a=o.data.results,i=this.host.currentUser.id,u=(0,P.default)(a,function(e,t){var n=t.type,r=t.entity,o=t.organization_id;if(0!=(0,y.default)(r).length){"tigertext:entity:account"===n&&(0,H.replaceKey)(r,"status","account_status");var a=s.host.injectModel(r,n);if(!(E.length&&E.includes(a.id)||_&&a.id===i)){if(!a)return void s.logger.warn("no entity for ",t);var u=new W.SearchResult(a,o);e.push(u)}}},[]),!U){e.next=23;break}return e.delegateYield(l.default.mark(function e(){var t,n,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,S.default)(u,"organizationId"),n=(0,V.default)(u,"entityId"),r=(0,P.default)(t,function(e,t,r){e.push(s.host.metadata.findMulti((0,M.default)(t,"entityId"),r).then(function(e){(0,j.default)(e,function(e,t){return n[t].metadata=e})}))},[]),!(r.length>0)){e.next=6;break}return e.next=6,d.default.all(r);case 6:case"end":return e.stop()}},e,s)})(),"t0",23);case 23:return e.abrupt("return",u);case 24:case"end":return e.stop()}},e,this)}));return e}()}]),t}($.default),o(i.prototype,"query",[a],(0,s.default)(i.prototype,"query"),i.prototype),i);t.default=Y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y.default)(e);if(!Array.isArray(e)){var o=(0,d.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,y.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y.default)(e);if(!Array.isArray(e)){var o=(0,d.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,y.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c=n(7),l=r(c),f=n(6),d=r(f),p=n(10),y=r(p),h=n(11),g=r(h),v=n(12),m=r(v),b=n(9),w=r(b),E=n(8),x=r(E),_=n(3),k=r(_),O=n(1),T=r(O),I=n(2),j=r(I),A=n(5),M=r(A),G=n(4),V=r(G),z=n(35),S=r(z),C=n(13),P=r(C),N=n(67),R=r(N),U=n(47),q=r(U),F=n(25),$=r(F),L=n(23),B=r(L),D=n(14),K="global",Z=(0,D.classWithPrivateMethods)((s=function(e){function t(){return(0,T.default)(this,t),(0,M.default)(this,(t.__proto__||(0,k.default)(t)).apply(this,arguments))}return(0,V.default)(t,e),(0,j.default)(t,[{key:"mounted",value:function(){this._typers={},this._currentUserTyping={},this.host.on("message:sending",this._onMessageSending)}},{key:"dispose",value:function(){var e;(e=(e=(e=(e=this._typers,R.default).call(e),$.default).call(e,S.default),q.default).call(e),$.default).call(e,"timer").forEach(function(e){return clearTimeout(e)}),(e=(e=this._currentUserTyping,R.default).call(e),$.default).call(e,"timer").forEach(function(e){return clearTimeout(e)}),this._typers=null,this.host.removeListener("message:sending",this._onMessageSending)}},{key:"reactToIsTypingEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));this.host.requireUser();var t=e.data.sender_token;if(t!==this.host.currentUserId){var n=e.data.group_token,r=n||K,o="typing"===e.data.status;this.host.models.User.ensureEntity(t,{onlyPlaceholder:!1}),this._setTypingStatusOfUser(r,t,o)}}},{key:"startTyping",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("boolean"==typeof n||"number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "autoStopAfterTimeout" violates contract.\n\nExpected:\nboolean | number\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("boolean"==typeof n||"number"==typeof n){e.next=8;break}throw new TypeError('Value of argument "autoStopAfterTimeout" violates contract.\n\nExpected:\nboolean | number\n\nGot:\n'+a(n));case 8:return t=this._resolveModelId(t),this.host.requireUser(),e.next=12,this.host.api.messages.startTyping(t);case 12:t in this._currentUserTyping&&clearTimeout(this._currentUserTyping[t].timer),this._currentUserTyping[t]={},n&&(this._currentUserTyping[t].timer=this._createClearTimerForCurrentUser(t,"number"==typeof n?n:void 0));case 15:case"end":return e.stop()}},e,this)}));return e}()},{key:"stopTyping",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(t){return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:return t=this._resolveModelId(t),this.host.requireUser(),t in this._currentUserTyping&&(clearTimeout(this._currentUserTyping[t].timer),delete this._currentUserTyping[t]),e.next=9,this.host.api.messages.stopTyping(t);case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"_setTypingStatusOfUser",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("boolean"!=typeof n)throw new TypeError('Value of argument "isTyping" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+i(n));if(null!=r&&"boolean"!=typeof r)throw new TypeError('Value of argument "timedOut" violates contract.\n\nExpected:\n?boolean\n\nGot:\n'+i(r));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("boolean"!=typeof n)throw new TypeError('Value of argument "isTyping" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+a(n));if(null!=r&&"boolean"!=typeof r)throw new TypeError('Value of argument "timedOut" violates contract.\n\nExpected:\n?boolean\n\nGot:\n'+a(r));if(n){this._typers[e]||(this._typers[e]={});var o=t in this._typers[e];if(o&&clearTimeout(this._typers[e][t].timer),this._typers[e][t]={timer:this._createClearTimerForOtherUser(e,t)},o)return}else{if(!this._typers[e]||!this._typers[e][t])return;clearTimeout(this._typers[e][t].timer),delete this._typers[e][t]}var u=(0,m.default)({userId:t},e!==K?{groupId:e}:null,{isTyping:n,timedOut:r});this.emit("change",u)}},{key:"_createClearTimerForOtherUser",value:function(e,t){var n=this;if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return setTimeout(function(){n.logger.info("auto stop typing for other typer",e,t),n._setTypingStatusOfUser(e,t,!1,!0)},this.host.config.clearTypingStatusTimeout)}},{key:"_createClearTimerForCurrentUser",value:function(e,t){var n=this;if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(null!=t&&"number"!=typeof t)throw new TypeError('Value of argument "timeout" violates contract.\n\nExpected:\n?number\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(null!=t&&"number"!=typeof t)throw new TypeError('Value of argument "timeout" violates contract.\n\nExpected:\n?number\n\nGot:\n'+a(t));return setTimeout(function(){n.logger.info("auto stop typing for current user",e),n.stopTyping(e)},"number"==typeof t?t:this.host.config.clearTypingStatusTimeout)}},{key:"isUserTyping",value:function(e){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(e));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(e));return e=this._resolveModelId(e),this._isUserTypingInContext(K,e)}},{key:"isCurrentUserTyping",value:function(e){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(e));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(e));return e=this._resolveModelId(e),e in this._currentUserTyping}},{key:"isUserTypingInGroup",value:function(e,t){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(e));if(!(t instanceof Object||"string"==typeof t))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(t));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(e));if(!(t instanceof Object||"string"==typeof t))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(t));return t=this._resolveModelId(t),e=this._resolveModelId(e),this._isUserTypingInContext(e,t)}},{key:"_isUserTypingInContext",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return!!this._typers[e]&&t in this._typers[e]}},{key:"_onMessageSending",value:function(e){this.stopTyping(e.counterPartyId)}}]),t}(P.default),o(s.prototype,"_setTypingStatusOfUser",[D.privateMethod],(0,g.default)(s.prototype,"_setTypingStatusOfUser"),s.prototype),o(s.prototype,"_createClearTimerForOtherUser",[D.privateMethod],(0,g.default)(s.prototype,"_createClearTimerForOtherUser"),s.prototype),o(s.prototype,"_createClearTimerForCurrentUser",[D.privateMethod],(0,g.default)(s.prototype,"_createClearTimerForCurrentUser"),s.prototype),o(s.prototype,"_isUserTypingInContext",[D.privateMethod],(0,g.default)(s.prototype,"_isUserTypingInContext"),s.prototype),o(s.prototype,"_onMessageSending",[D.privateMethod,B.default],(0,g.default)(s.prototype,"_onMessageSending"),s.prototype),u=s))||u;t.default=Z,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,m.default)(e);if(!Array.isArray(e)){var o=(0,g.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,m.default)(s))?s.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,m.default)(e);if(!Array.isArray(e)){var o=(0,g.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var a="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+a);return o.length>=r&&(u+="\n  "+a+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+a+u+"\n"+a+"}":"{\n  "+a+u+"\n"+a+"}"}if(!(e.length>0))return"Array";var s=function(){if(t>n)return{v:"[...]"};var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof s?"undefined":(0,m.default)(s))?s.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u,s,c,l,f,d,p=n(7),y=r(p),h=n(6),g=r(h),v=n(10),m=r(v),b=n(11),w=r(b),E=n(12),x=r(E),_=n(16),k=r(_),O=n(9),T=r(O),I=n(8),j=r(I),A=n(3),M=r(A),G=n(1),V=r(G),z=n(2),S=r(z),C=n(5),P=r(C),N=n(4),R=r(N),U=n(51),q=r(U),F=n(17),$=r(F),L=n(46),B=r(L),D=n(62),K=r(D),Z=n(13),W=r(Z),H=n(15),X=r(H),Q=n(18),Y=n(14),J=n(66),ee=r(J),te=new K.default.MD5,ne=(u=(0,Q.decorator)(),s=(0,Q.decorator)(),c=(0,Q.decorator)(),l=(0,Q.decorator)(),(0,Y.classWithPrivateMethods)((d=function(e){function t(){return(0,V.default)(this,t),(0,P.default)(this,(t.__proto__||(0,M.default)(t)).apply(this,arguments))}return(0,R.default)(t,e),(0,S.default)(t,[{key:"signIn",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,j.default)(T.default.mark(function e(t,n){var r,o,u,s,c,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{udid:void 0};return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return r={Authorization:this.getSignInAuthHeader(t,n)},o={push_routing:this.config.pushAgent,version:this.config.version,device_id:l.udid,metadata:{tt_product_version:"tigerconnect_"+this.config.version,user_agent:global.navigator&&global.navigator.userAgent}},e.next=12,this.httpClient.post("/login",{headers:r,data:o});case 12:return u=e.sent,s=this.host.models.User.inject(u.data.user),c=u.data.auth,e.abrupt("return",{user:s,auth:c});case 16:case"end":return e.stop()}},e,this)}));return e}()},{key:"getSignInAuthHeader",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return this.host.api.users.getSignInAuthHeader(this.config.productKey,e,t)}},{key:"signUp",value:function(){function e(){return t.apply(this,arguments)}var t=(0,j.default)(T.default.mark(function e(){var t,n,r,o,a,i,u,s,c,l,f,d,p,y,h,g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{udid:void 0,email:void 0,password:void 0,countryCode:void 0,version:void 0};return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config.signUpHashKey,n=this.config.signUpHashSalt,r=g.udid,o=[t,n,r].join(":"),a=te.hex(o),i=[a.substr(0,2),a.substr(a.length-2)].join(""),u=[this.config.productKey,t,n,r,i].join(":"),s=(0,B.default)(u),c="XMPP-Anonymous "+s,l={Authorization:c},f={primary_email:g.email,unique_id:g.email,password:g.password,push_routing:this.config.pushAgent,product:this.config.productKey,country_code:g.countryCode,device_id:g.udid,version:this.config.version},e.next=13,this.httpClient.post("/signup",{headers:l,data:f});case 13:return d=e.sent,p=this.host.models.User.inject(d.data.user),y=d.data.auth,h={user:p,auth:y},this.host.emit("signUp",h),e.abrupt("return",h);case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"signOut",value:function(){function e(){return t.apply(this,arguments)}var t=(0,j.default)(T.default.mark(function e(){return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpClient.post("/logout"));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"findMe",value:function(){function e(){return t.apply(this,arguments)}var t=(0,j.default)(T.default.mark(function e(){var t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),e.next=3,this.host.api.users.findMe();case 3:if(t=e.sent,!t){e.next=9;break}return n=this.host.models.User.inject(t),e.abrupt("return",n);case 9:if(r.ignoreNotFound){e.next=11;break}throw new X.default.NotFoundError(this.host.models.User.name,"me");case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"findMyProfilesForAllOrganizations",value:function(){function e(){return t.apply(this,arguments)}var t=(0,j.default)(T.default.mark(function e(){var t;return arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.organizations.findAll();case 2:return e.t0=function(e){return e.id},t=e.sent.map(e.t0),
e.abrupt("return",this.findProfileForOrganizations(this.host.currentUserId,t));case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,j.default)(T.default.mark(function e(t){var n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(o=(0,$.default)(o,{ignoreNotFound:!1,bypassCache:!1}),this.host.requireUser(),n=null,o.bypassCache){e.next=11;break}if(n=this.host.models.User.get(t),!n||n.$placeholder){e.next=11;break}return e.abrupt("return",n);case 11:return e.next=13,this.host.api.users.find(t);case 13:if(r=e.sent,!r){e.next=19;break}n=this.host.models.User.inject(r),delete n.$placeholder,e.next=21;break;case 19:if(o.ignoreNotFound){e.next=21;break}throw new X.default.NotFoundError(this.host.models.User.name,t);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}},e,this)}));return e}()},{key:"findProfileForOrganizations",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,j.default)(T.default.mark(function e(t,n){var r,o=this,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "organizationIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "organizationIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+a(n));case 8:return u=(0,$.default)(u,{ignoreNotFound:!1,bypassCache:!1}),e.prev=9,e.next=12,k.default.all(n.map(function(e){return o.findProfileForOrganization(t,e,u)}));case 12:e.next=16;break;case 14:e.prev=14,e.t0=e.catch(9);case 16:if(r=this.host.models.User.get(t),r||u.ignoreNotFound){e.next=19;break}throw new X.default.NotFoundError(this.host.models.User.name,t);case 19:return e.abrupt("return",r.profileByOrganizationId);case 20:case"end":return e.stop()}},e,this,[[9,14]])}));return e}()},{key:"findProfileForOrganization",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,j.default)(T.default.mark(function e(t,n){var r,o,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:return this.host.requireUser(),u=(0,$.default)(u,{ignoreNotFound:!0,bypassCache:!1}),n=this._resolveModelId(n),e.next=13,this.find(t,u);case 13:if(r=e.sent,!r||r.$placeholder||!r.profileByOrganizationId||!r.profileByOrganizationId[n]){e.next=16;break}return e.abrupt("return",r.profileByOrganizationId[n]);case 16:return e.next=18,this.host.api.users.find(t,{organizationId:n});case 18:if(o=e.sent,!o){e.next=23;break}this.host.models.User.inject(o),e.next=25;break;case 23:if(u.ignoreNotFound){e.next=25;break}throw new X.default.NotFoundError(this.host.models.User.name,t);case 25:if(r.profileByOrganizationId[n]||u.ignoreNotFound){e.next=27;break}throw new X.default.NotFoundError(this.host.models.User.name+".profileByOrganizationId",t+"/"+n);case 27:return e.abrupt("return",r.profileByOrganizationId[n]);case 28:case"end":return e.stop()}},e,this)}));return e}()},{key:"refresh",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,j.default)(T.default.mark(function e(t){return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.find(t,{ignoreNotFound:!0,bypassCache:!0});case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"update",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,j.default)(T.default.mark(function e(t){var n,r,o,u,s,c=t.firstName,l=t.lastName,f=t.displayName,d=t.status,p=t.dnd,y=t.dndText,h=t.avatarFile,g=t.removeAvatar,v=arguments;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==v[0]||null!=v[0].firstName&&"string"!=typeof v[0].firstName||null!=v[0].lastName&&"string"!=typeof v[0].lastName||null!=v[0].displayName&&"string"!=typeof v[0].displayName||null!=v[0].status&&"string"!=typeof v[0].status||null!=v[0].dnd&&"boolean"!=typeof v[0].dnd||null!=v[0].dndText&&"string"!=typeof v[0].dndText||!(null==v[0].avatarFile||v[0].avatarFile instanceof Object)||null!=v[0].removeAvatar&&"boolean"!=typeof v[0].removeAvatar)){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  firstName: ?string;\n  lastName: ?string;\n  displayName: ?string;\n  status: ?string;\n  dnd: ?boolean;\n  dndText: ?string;\n  avatarFile: ?Object;\n  removeAvatar: ?boolean;\n}\n\nGot:\n"+i(v[0]));case 2:if(!(null==v[0]||null!=v[0].firstName&&"string"!=typeof v[0].firstName||null!=v[0].lastName&&"string"!=typeof v[0].lastName||null!=v[0].displayName&&"string"!=typeof v[0].displayName||null!=v[0].status&&"string"!=typeof v[0].status||null!=v[0].dnd&&"boolean"!=typeof v[0].dnd||null!=v[0].dndText&&"string"!=typeof v[0].dndText||!(null==v[0].avatarFile||v[0].avatarFile instanceof Object)||null!=v[0].removeAvatar&&"boolean"!=typeof v[0].removeAvatar)){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  firstName: ?string;\n  lastName: ?string;\n  displayName: ?string;\n  status: ?string;\n  dnd: ?boolean;\n  dndText: ?string;\n  avatarFile: ?Object;\n  removeAvatar: ?boolean;\n}\n\nGot:\n"+a(v[0]));case 4:return this.host.requireUser(),r=(n={firstName:c,lastName:l,displayName:f,status:d,dnd:p,dndText:y,avatarFile:h,removeAvatar:g},ee.default).call(n,function(e,t){return"undefined"==typeof e}),e.next=8,this.host.api.users.update(this.host.currentUserId,r);case 8:return o=e.sent,u=(0,q.default)(r,"removeAvatar","avatarFile"),g?u.avatarUrl=null:"undefined"!=typeof o.avatarUrl&&(u.avatarUrl=o.avatarUrl),s=this.host.models.User.inject((0,x.default)({id:this.host.currentUserId},u)),e.abrupt("return",s);case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"updatePassword",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return this.host.requireUser(),this.host.api.users.updatePassword(this.host.currentUserId,e,t,this.config.productKey)}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.User.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.User.getMulti(e)}}]),t}(W.default),o(d.prototype,"findMe",[u],(0,w.default)(d.prototype,"findMe"),d.prototype),o(d.prototype,"findMyProfilesForAllOrganizations",[s],(0,w.default)(d.prototype,"findMyProfilesForAllOrganizations"),d.prototype),o(d.prototype,"find",[c],(0,w.default)(d.prototype,"find"),d.prototype),o(d.prototype,"refresh",[l],(0,w.default)(d.prototype,"refresh"),d.prototype),f=d))||f);t.default=ne,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Users:n(126),EventRouter:n(116),Events:n(117),Messages:n(119),Groups:n(118),DistributionLists:n(115),Organizations:n(122),Conversations:n(114),Presence:n(123),Metadata:n(120),Search:n(124),TypingStatus:n(125),Mute:n(121)};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,c.default)(e);if(!Array.isArray(e)){var a=(0,v.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u.default)(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var l=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof l?"undefined":(0,c.default)(l))?l.v:void 0}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,c.default)(e);if(!Array.isArray(e)){var o=(0,v.default)(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var l=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof l?"undefined":(0,c.default)(l))?l.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(7),u=r(i),s=n(10),c=r(s),l=n(9),f=r(l),d=n(8),p=r(d),y=n(12),h=r(y),g=n(6),v=r(g),m=n(30),b=r(m),w=n(135),E=r(w),x=n(20),_=r(x),k=n(1),O=r(k),T=n(2),I=r(T),j=n(35),A=r(j),M=n(26),G=r(M),V=n(41),z=r(V),S=n(51),C=r(S),P=n(34),N=r(P),R=n(170),U=r(R),q=n(154),F=r(q),$=n(171),L=r($),B=n(17),D=r(B),K=n(163),Z=r(K),W=n(155),H=r(W),X=n(42),Q=r(X),Y=n(71),J=r(Y),ee=n(74),te=r(ee),ne=n(64),re=r(ne),oe=n(68),ae=r(oe),ie=n(25),ue=r(ie),se=n(150),ce=r(se),le=n(67),fe=r(le),de=n(47),pe=r(de),ye=n(33),he=r(ye),ge=(n(19),n(32)),ve=r(ge),me=n(130),be=r(me);ve.default.prototype.off=ve.default.prototype.removeListener;var we={idAttribute:"id",parseAttrs:te.default,relations:{belongsTo:{},hasMany:{}},defaultValues:null,computed:{},methods:{}},Ee=function(){function e(t,n){var r,o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,O.default)(this,e),this.options=(0,J.default)({},a,we),this.idAttribute=this.options.idAttribute,this.name=n,this.store=t,this.entitiesById={},this.entitiesList=[],this.transientAttrsStore={},this.options.relations&&this.__initRelations(),this.__initTransientAttrs(),(0,_.default)(this.options.computed,{$entityType:{enumerable:!0,get:function(){return n}},$entityClass:{enumerable:!1,get:function(){return o}}}),this.options.computed=(0,Q.default)(this.options.computed,function(e,t,n){"function"==typeof t?e[n]={get:t,enumerable:!1}:e[n]=t},{}),this._computedKeys=(r=(r=this.options.computed,re.default).call(r),ae.default).call(r,"$entityType","$entityClass","$$transientAttrs"),this._writablePropertyKeys=(r=(r=(r=this.options.computed,ce.default).call(r),he.default).call(r,function(e){return e[1].set}),ue.default).call(r,H.default),this._relationKeys=(r=(r=(r=this.options.relations,fe.default).call(r),ue.default).call(r,Z.default),pe.default).call(r)}return(0,I.default)(e,null,[{key:"create",value:function(e,t,n){return new this(e,t,n)}}]),(0,I.default)(e,[{key:"__initRelations",value:function(){var e=this,t=(0,Q.default)(this.options.relations.belongsTo,function(t,n,r){t[r]={get:function(){return e.store.get(n.type,this[n.foreignKey])},set:function(t){this[n.foreignKey]=e.store.resolveId(n.type,t)}}},{});(0,_.default)(this.options.computed,t);var n=(0,Q.default)(this.options.relations.hasMany,function(t,n,r){t[r]={get:function(){var t=this;if(this.$$transientAttrs.relations||(this.$$transientAttrs.relations={},this.$$transientAttrs.relationsCreated={}),this.$$transientAttrs.relations[r])return this.$$transientAttrs.relations[r];var o=e.store.getAll(n.type).filter(function(r){return r[n.foreignKey]==t[e.options.idAttribute]});return this.$$transientAttrs.relations[r]=o,this.$$transientAttrs.relationsCreated[r]=!0,o},set:function(e){}}},{});(0,_.default)(this.options.computed,n)}},{key:"__initTransientAttrs",value:function(){var e=this,t=this,n={$$transientAttrs:{enumerable:!1,get:function(){var e=this[t.options.idAttribute];return t.transientAttrsStore[e]||(t.transientAttrsStore[e]={})}}},r={};this.options.transientAttrs&&this.options.transientAttrs.forEach(function(t){e.options.defaultValues&&t in e.options.defaultValues&&(r[t]=(0,be.default)(e.options.defaultValues[t]),delete e.options.defaultValues[t]),n[t]={get:function(){return t in this.$$transientAttrs?this.$$transientAttrs[t]:t in r?this.$$transientAttrs[t]=r[t]:void 0},set:function(e){this.$$transientAttrs[t]=e}}}),(0,_.default)(this.options.computed,n)}},{key:"createInstance",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this;t&&(e=this.parseAttrs(e));var r=this[n.options.idAttribute];if(this.entitiesById[r])throw new Error("called createInstance on an existing instance");this.options.defaultValues&&(0,D.default)(e,(0,be.default)(this.options.defaultValues));var o={};return this._writablePropertyKeys.forEach(function(t){t in e&&(o[t]=e[t],delete e[t])}),(0,E.default)(e,this.options.computed),(0,_.default)(e,o),this.options.instanceEvents&&(0,_.default)(e,ve.default.prototype),(0,_.default)(e,this.options.methods),(0,_.default)(e,{toPlainObject:function(e){var t=this,r={};n._computedKeys.forEach(function(e){return r[e]=t[e]});var o=(0,_.default)({},this,r);return delete o.toPlainObject,delete o.setMaxListeners,delete o.emit,delete o.addListener,delete o.on,delete o.once,delete o.removeListener,delete o.removeAllListeners,delete o.listeners,delete o.listenerCount,delete o.off,delete o.toPlainObject,delete o._events,delete o._maxListeners,o}}),this.options.beforeCreateInstance&&this.options.beforeCreateInstance(e),e}},{key:"inject",value:function(e){var t=void 0,n=!0,r=this.is(e);if(r){if(t=e,this.entitiesById[this.resolveId(t)])return this.options.beforeInject&&this.options.beforeInject(t),this.emit("beforeInject",this,t),this.options.afterInject&&this.options.afterInject(t),this.emit("afterInject",this,t),t;n=!1}n&&(e=this.parseAttrs(e));var o=void 0,a=this.resolveId(e);if(!this.isValidId(a))throw new Error("'"+this.options.idAttribute+"' is required");return t=this.entitiesById[a],t?(this.options.beforeInject&&this.options.beforeInject(e,t),this.emit("beforeInject",this,e),(0,_.default)(t,e)):(o=!0,t=r?e:this.createInstance(e,!1),this.options.beforeInject&&this.options.beforeInject(t),this.emit("beforeInject",this,t),this.entitiesById[a]=t,this.entitiesList.push(t)),this.__addToHasManyRelationships(t),this.options.afterInject&&this.options.afterInject(t),this.emit("afterInject",this,t),o&&(this.options.afterCreate&&this.options.afterCreate(t),this.emit("afterCreate",this,t)),t}},{key:"eject",value:function(e){e=this.resolveId(e);var t=this.entitiesById[e];t&&(this.emit("beforeEject",this,t),this.__removeFromHasManyRelationships(t),delete this.entitiesById[e],(0,L.default)(this.entitiesList,t),e in this.transientAttrsStore&&delete this.transientAttrsStore[e],this.emit("afterEject",this,t))}},{key:"touch",value:function(e){e=this.resolveId(e);var t=this.entitiesById[e];t&&this.inject((0,b.default)({},this.options.idAttribute,e))}},{key:"__addToHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"add")}},{key:"__removeFromHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"remove")}},{key:"__updateRelationsIfNeeded",value:function(e,t){var n=this,r=this.store.getParentRelationshipsOfModel(this.name);r&&r.forEach(function(r){var o=n.store.get(r.parent,e[r.foreignKey]);o&&o.$$transientAttrs.relationsCreated&&o.$$transientAttrs.relationsCreated[r.relationKey]&&("add"==t?o[r.relationKey].includes(e)||o[r.relationKey].push(e):"remove"==t&&(0,L.default)(o[r.relationKey],e))})}},{key:"ejectAll",value:function(){var e=this;(0,F.default)(this.entitiesList,function(t){return e.eject(t)})}},{key:"parseAttrs",value:function(e){var t=this,n=(0,U.default)(e,function(e){return t.store.isEntity(e)||t.store.isEntityArray(e)}),r=(0,N.default)(e,this.options.transientAttrs),o=(0,C.default)(e,(0,v.default)(n),this.options.transientAttrs),a=this.options.parseAttrs((0,be.default)(o)),i=(0,h.default)({},a,n,r);return i}},{key:"get",value:function(e){return this.entitiesById[e]||null}},{key:"getAll",value:function(){return this.entitiesList}},{key:"getMulti",value:function(e){return e.map(this.get.bind(this))}},{key:"resolveId",value:function(e){return this.isValidId(e)?e:e[this.options.idAttribute]}},{key:"isValidId",value:function(e){return"string"==typeof e||"number"==typeof e}},{key:"is",value:function(e){return e&&e.$entityClass==this}},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,p.default)(f.default.mark(function e(t){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 4:throw new"not implemented find";case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"refresh",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,p.default)(f.default.mark(function e(t){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(t));case 4:throw t=this.resolveId(t),new"not implemented refresh";case 6:case"end":return e.stop()}},e,this)}));return e}()}]),e}();(0,_.default)(Ee.prototype,ve.default.prototype);var xe=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,O.default)(this,e),this.options=n,this.models={},this.__relationsOfHasManyByContainedItem={},["inject","get","getAll","filter","resolveId","is","find","refresh"].forEach(function(e){t[e]=function(n){for(var r,o=arguments.length,a=Array(o>1?o-1:0),i=1;i<o;i++)a[i-1]=arguments[i];return(r=t.models[n])[e].apply(r,a)}})}return(0,I.default)(e,[{key:"defineModel",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.models[e])throw new Error(e+" already defined");n=(0,h.default)({},this.options,n),this.models[e]=Ee.create(this,e,n);var r=this.models[e].options.relations.hasMany;return(0,z.default)(r)||(0,G.default)(r,function(n,r){t.__relationsOfHasManyByContainedItem[n.type]||(t.__relationsOfHasManyByContainedItem[n.type]=[]),t.__relationsOfHasManyByContainedItem[n.type].push((0,h.default)({},n,{relationKey:r,parent:e}))}),this.models[e]}},{key:"getParentRelationshipsOfModel",value:function(e){return this.__relationsOfHasManyByContainedItem[e]}},{key:"isEntity",value:function(e){return e&&e.$entityClass&&e.$entityClass.constructor===Ee}},{key:"isEntityArray",value:function(e){return e&&Array.isArray(e)&&e.some(this.isEntity)}},{key:"clear",value:function(){(0,A.default)(this.models).forEach(function(e){return e.ejectAll()})}}]),e}();t.default=xe,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(12),a=r(o),i=n(31),u=r(i),s=n(1),c=r(s),l=n(2),f=r(l),d=n(17),p=r(d),y=n(26),h=r(y),g=n(19),v=n(128),m=r(v),b=n(113),w=r(b),E=n(38),x=r(E),_=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.logger,o=(0,u.default)(n,["logger"]);(0,c.default)(this,e),this.host=t,this.options=o,this.logger=r,this.store=new m.default((0,a.default)({},o,{host:t,logger:r})),this.store.host=t}return(0,f.default)(e,[{key:"defineModels",value:function(){var e=this,t={},n=(0,a.default)({},this.options,{host:this.host,logger:this.logger});(0,h.default)(w.default,function(r,o){t[o]=r(e,n)}),this.models=t}},{key:"defineModel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.replaceKeys=t.replaceKeys||{},(0,p.default)(t.replaceKeys,{token:"id"});var n=(this.store,this.store.defineModel(e,(0,a.default)({},t,{beforeCreateInstance:function(e){!e[n.idAttribute]||"serverId"in e||(e.serverId=e[n.idAttribute]),t.beforeCreateInstance&&t.beforeCreateInstance(e)},beforeInject:function(e,n){!n||"serverId"in e||(e.serverId=n.serverId),t.beforeInject&&t.beforeInject(e,n)},afterInject:function(e){var n=Date.now();e.$lastModified==n&&(n+=1e-5),e.$lastModified=n,t.afterInject&&t.afterInject(e)},parseAttrs:function(e){var n=x.default.camelizeObject(e);return(0,h.default)(t.replaceKeys,function(e,t){(0,g.replaceKey)(n,t,e)}),t.parseAttrs&&(n=t.parseAttrs(n,e)),n}})));return n}},{key:"clear",value:function(){this.store.clear()}}]),e}();t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=r(o),i=function(e){return void 0!==e?JSON.parse((0,a.default)(e)):null};t.default=i,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(132),a=r(o),i=a.default.version;i=i.replace("-dev",""),t.default=i,e.exports=t.default},function(e,t){e.exports={name:"tigerconnect",private:!0,version:"0.1.18-patch.1",description:"JS (web and node) SDK for TigerText",homepage:"",repository:"tigerconnect/js-sdk",author:{name:"Elad Ossadon",email:"elad@tigertext.com",url:""},main:"lib/index.js",keywords:["tigertext"],scripts:{test:"NODE_TARGET=node mocha","watch:test":"npm test -- -w","build:clean":"rimraf lib dist","build:js":"babel -d lib/ src/","build:webpack":"webpack","build:webpack:node":"webpack --target node",build:"npm run build:clean && parallelshell 'npm run build:js' 'npm run build:webpack'","build:node":"npm run build:webpack:node","watch:js":"npm run build:js -- -w","watch:webpack":"webpack --watch",watch:"npm run build:clean && parallelshell 'npm run watch:js' 'npm run watch:webpack'","debug:test":"iron-node node_modules/mocha/bin/_mocha",postinstall:"npm run build"},dependencies:{"autobind-decorator":"^1.3.4","babel-polyfill":"~6.16.0","babel-runtime":"~6.11.6",btoa:"^1.1.2",bunyan:"^1.8.1","class-private-method-decorator":"^2.1.2",eventsource:"git+https://git@github.com/tigerconnect/eventsource.git","file-saver":"^1.3.2","file-type":"^3.8.0","humanize-list":"^1.0.1",invariant:"^2.2.1","is-email":"^1.0.0",jshashes:"^1.0.5",lodash:"^4.16.3","lodash-bound":"^1.1.2",mime:"^1.3.4","mime-db":"^1.24.0",moment:"^2.15.1","node-noop":"^1.0.0","node-uuid":"^1.4.7",request:"^2.75.0","reuse-promise":"^1.1.0",shallowequal:"^0.2.2",superagent:"^2.3.0","superagent-prefix":"0.0.2","superagent-retry":"git+https://git@github.com/elado/superagent-retry.git#74c9a6c9ee0ee6c11aafdb10aa8eb5ea0d284cd4"},devDependencies:{"assets-webpack-plugin":"^3.4.0","babel-cli":"~6.16.0","babel-core":"~6.17.0","babel-loader":"^6.2.5","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-conditional-compilation":"0.0.1","babel-plugin-flow-comments":"^6.3.19","babel-plugin-import-asserts":"^2.1.0","babel-plugin-lodash":"^3.2.9","babel-plugin-macros":"^1.0.15","babel-plugin-syntax-flow":"^6.13.0","babel-plugin-transform-class-properties":"~6.16.0","babel-plugin-transform-decorators-legacy":"^1.3.4","babel-plugin-transform-es2015-classes":"^6.14.0","babel-plugin-transform-flow-strip-types":"^6.14.0","babel-plugin-transform-runtime":"~6.15.0","babel-plugin-typecheck":"^3.9.0","babel-preset-es2015":"^6.16.0","babel-preset-stage-0":"^6.16.0",chai:"^3.5.0",decache:"^4.1.0","dom-storage":"^2.0.2",expect:"^1.20.2","expect.js":"^0.3.1",gulp:"^3.9.1","gulp-debug":"^2.1.2","gulp-exec":"^2.1.2","gulp-file":"^0.3.0","gulp-load-plugins":"^1.3.0","gulp-uglify":"^2.0.0","gulp-util":"^3.0.7","json-loader":"^0.5.4","lodash-webpack-plugin":"^0.11.0",mocha:"^2.5.3","mocha-babel":"^3.0.3","mocha-clean":"^1.0.0",nock:"^8.0.0",parallelshell:"^2.0.0","performance-now":"^0.2.0","require-dir":"^0.3.0",rimraf:"^2.5.4",sinon:"^1.17.6",sleep:"^4.0.0","strip-loader":"^0.1.2",timekeeper:"0.1.1",tmatch:"^2.0.1",watch:"^0.19.2",webpack:"^1.13.2","webpack-node-externals":"^1.4.3",yargs:"^6.0.0"},license:{type:"Commercial",url:"http://www.tigertext.com/developer-terms-of-use/"}}},function(e,t,n){function r(e){return n(o(e))}function o(e){return a[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var a={"./node":57,"./node.js":57,"./web":58,"./web.js":58};r.keys=function(){return Object.keys(a)},r.resolve=o,e.exports=r,r.id=133},function(e,t){e.exports=require("babel-polyfill")},function(e,t){e.exports=require("babel-runtime/core-js/object/define-properties")},function(e,t){e.exports=require("babel-runtime/core-js/object/define-property")},function(e,t){e.exports=require("babel-runtime/core-js/object/freeze")},function(e,t){e.exports=require("babel-runtime/core-js/set")},function(e,t){e.exports=require("eventsource")},function(e,t){e.exports=require("file-saver")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("humanize-list")},function(e,t){e.exports=require("invariant")},function(e,t){e.exports=require("lodash-bound/compact")},function(e,t){e.exports=require("lodash-bound/each")},function(e,t){e.exports=require("lodash-bound/find")},function(e,t){e.exports=require("lodash-bound/first")},function(e,t){e.exports=require("lodash-bound/pickBy")},function(e,t){e.exports=require("lodash-bound/reject")},function(e,t){e.exports=require("lodash-bound/toPairs")},function(e,t){e.exports=require("lodash/castArray")},function(e,t){e.exports=require("lodash/chunk")},function(e,t){e.exports=require("lodash/compact")},function(e,t){e.exports=require("lodash/eachRight")},function(e,t){e.exports=require("lodash/first")},function(e,t){e.exports=require("lodash/groupBy")},function(e,t){e.exports=require("lodash/head")},function(e,t){e.exports=require("lodash/includes")},function(e,t){e.exports=require("lodash/invert")},function(e,t){e.exports=require("lodash/isArray")},function(e,t){e.exports=require("lodash/isObject")},function(e,t){e.exports=require("lodash/keyBy")},function(e,t){e.exports=require("lodash/keys")},function(e,t){e.exports=require("lodash/last")},function(e,t){e.exports=require("lodash/map")},function(e,t){e.exports=require("lodash/mapKeys")},function(e,t){e.exports=require("lodash/memoize")},function(e,t){e.exports=require("lodash/noop")},function(e,t){e.exports=require("lodash/orderBy")},function(e,t){e.exports=require("lodash/pickBy")},function(e,t){e.exports=require("lodash/pull")},function(e,t){e.exports=require("lodash/reduce")},function(e,t){e.exports=require("lodash/snakeCase")},function(e,t){e.exports=require("lodash/sortBy")},function(e,t){e.exports=require("lodash/union")},function(e,t){e.exports=require("lodash/uniq")},function(e,t){e.exports=require("lodash/without")},function(e,t){e.exports=require("lodash/xor")},function(e,t){e.exports=require("lodash/zipObject")},function(e,t){e.exports=require("mime")},function(e,t){e.exports=require("mime-db")},function(e,t){e.exports=require("node-noop")},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("superagent-prefix")},function(e,t){e.exports=require("superagent-retry")}]);