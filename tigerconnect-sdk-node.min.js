module.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),global._babelPolyfill||n(131);var r="node";n(130)("./"+r);var o=n(76),a=t.Client=o;a.Client=a,t.default=a,e.exports=a},function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t){e.exports=require("babel-runtime/helpers/createClass")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-prototype-of")},function(e,t){e.exports=require("babel-runtime/helpers/inherits")},function(e,t){e.exports=require("babel-runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("babel-runtime/core-js/object/keys")},function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("babel-runtime/helpers/typeof")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-own-property-descriptor")},function(e,t){e.exports=require("babel-runtime/helpers/extends")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?a.trim()+"[]":"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,c.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var u="  ".repeat(t-1),l=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s.default)(n))+": "+o(e[n],t)+";"}).join("\n  "+u);return i.length>=r&&(l+="\n  "+u+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+u+l+"\n"+u+"}":"{\n  "+u+l+"\n"+u+"}"}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,c.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var u="  ".repeat(t-1),l=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+u);return i.length>=r&&(l+="\n  "+u+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+u+l+"\n"+u+"}":"{\n  "+u+l+"\n"+u+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(7),s=r(i),u=n(6),c=r(u),l=n(28),f=r(l),d=n(29),p=r(d),y=n(10),h=r(y),g=n(18),v=r(g),m=n(1),b=r(m),w=n(2),E=r(w),x=n(72),_=r(x),k=n(31),O=r(k),I=n(27),T=r(I),j=n(22),A=function(){function e(t,n){(0,b.default)(this,e),(0,v.default)(this,n),this.host=t,this.config=t.config,this.httpClient=t.httpClient}return(0,E.default)(e,[{key:"_resolveModelId",value:function(e){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(e));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+o(e));return"string"==typeof e?e:e?e.serverId||e.id||null:null}},{key:"_resolveModelIdWithTypes",value:function(e,t){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(e));if(!("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "allowedEntityTypes" violates contract.\n\nExpected:\nstring | string[]\n\nGot:\n'+a(t));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+o(e));if(!("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "allowedEntityTypes" violates contract.\n\nExpected:\nstring | string[]\n\nGot:\n'+o(t));if(!e)return null;if("string"==typeof e){var n=this._resolveEntity(e);if(!n)return e;e=n}return T.default.oneOf("thing",e.$entityType,(0,j.arrayWrap)(t)),e.serverId||e.id||null}},{key:"_resolveEntity",value:function(e,t){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(e));if(!(null==t||"string"==typeof t||null==t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "types" violates contract.\n\nExpected:\n?string | ?string[]\n\nGot:\n'+a(t));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+o(e));if(!(null==t||"string"==typeof t||null==t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "types" violates contract.\n\nExpected:\n?string | ?string[]\n\nGot:\n'+o(t));if(t||(t=this.host.allModelEntityTypes),t=(0,j.arrayWrap)(t),"object"===("undefined"==typeof e?"undefined":(0,h.default)(e)))return t.includes(e.$entityType)?e:null;if(!t||"function"!=typeof t[p.default]&&!Array.isArray(t))throw new TypeError("Expected types to be iterable, got "+o(t));if(!t||"function"!=typeof t[p.default]&&!Array.isArray(t))throw new TypeError("Expected types to be iterable, got "+a(t));var n=!0,r=!1,i=void 0;try{for(var s,u=(0,f.default)(t);!(n=(s=u.next()).done);n=!0){var c=s.value,l=this.host.modelsByEntityType[c].get(e);if(l)return l;if(l=(0,_.default)(this.host.modelsByEntityType[c].getAll(),{serverId:e}))return l}}catch(e){r=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw i}}return null}},{key:"mounted",value:function(){}},{key:"dispose",value:function(){}}]),e}();t.default=A,(0,v.default)(A.prototype,O.default.prototype),e.exports=t.default},function(e,t){e.exports=require("class-private-method-decorator")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={NotSignedInError:n(90),WrongCredentialsError:n(93),NotFoundError:n(89),PermissionDeniedError:n(91),ValidationError:n(56),TargetNotSupportedError:n(92),ConnectionUnavailableError:n(88)},e.exports=t.default},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("reuse-promise")},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t){e.exports=require("lodash/defaults")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{fallbackValue:null,httpStatusCodes:[404]};return function(t,n,r){var o=r.value;return r.value=function(){var t=(0,u.default)(i.default.mark(function t(){var n,r,a,s=arguments;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(t.prev=0,n=s.length,r=Array(n),a=0;a<n;a++)r[a]=s[a];return t.next=4,o.call.apply(o,[this].concat(r));case 4:return t.abrupt("return",t.sent);case 7:if(t.prev=7,t.t0=t.catch(0),!t.t0.response||!e.httpStatusCodes.includes(t.t0.response.status)){t.next=13;break}return t.abrupt("return",e.fallbackValue);case 13:throw t.t0;case 14:case"end":return t.stop()}},t,this,[[0,7]])}));return function(){return t.apply(this,arguments)}}(),r}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(9),i=r(a),s=n(8),u=r(s),c=n(18),l=r(c),f=n(1),d=r(f);t.recoverFromNotFound=o;var p=n(31),y=r(p),h=function e(t,n){(0,d.default)(this,e),(0,l.default)(this,n),this.config=t.config,this.host=t,this.httpClient=t.httpClient};t.default=h,(0,l.default)(h.prototype,y.default.prototype)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ServerValueEnum=t.default=void 0;var o=n(3),a=r(o),i=n(5),s=r(i),u=n(4),c=r(u),l=n(134),f=r(l),d=n(12),p=r(d),y=n(1),h=r(y),g=n(2),v=r(g),m=n(158),b=r(m),w=n(43),E=r(w),x=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,h.default)(this,e),Array.isArray(t)&&(t=t.reduce(function(e,t){return e[t]={},e},{})),this.keys=[],this.entries=[],this.entriesByKey={},this.defaultValue=n.defaultValue||null;for(var r in t){this[r]=r;var o=(0,p.default)({key:r},t[r]);this.entriesByKey[r]=o,this.entries.push(o),this.keys.push(r)}(0,f.default)(this.keys),(0,f.default)(this.entries),(0,f.default)(this.entriesByKey)}return(0,v.default)(e,[{key:"resolve",value:function(e){return e||this.defaultValue}},{key:"isValid",value:function(e){return!!this.entriesByKey[e]}}]),e}();t.default=x,t.ServerValueEnum=function(e){function t(){return(0,h.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,v.default)(t,[{key:"mapEnumKeyToServerValue",value:function(){return this._mapEnumKeyToServerValue||(this._mapEnumKeyToServerValue=(0,E.default)(this.entries,function(e,t){return e[t.key]=t.serverValue},{}))}},{key:"mapServerValueToEnumKey",value:function(){return this._mapServerValueToEnumKey||(this._mapServerValueToEnumKey=(0,b.default)(this.mapEnumKeyToServerValue()))}},{key:"fromServer",value:function(e){return this.mapServerValueToEnumKey()[e]}},{key:"toServer",value:function(e){return this.mapEnumKeyToServerValue()[this.resolve(e)]}},{key:"resolve",value:function(e){return(this.isValid(e)?e:this.fromServer(e))||this.defaultValue}}]),t}(x)},function(e,t){"use strict";function n(){return r(this)}function r(e){return Array.isArray(e)?e:void 0!==e&&null!==e?[e]:[]}function o(e,t,n){!(n in e)&&t in e&&(e[n]=e[t],delete e[t])}Object.defineProperty(t,"__esModule",{value:!0}),t.arrayWrapBound=n,t.arrayWrap=r,t.replaceKey=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={MessageRecipientStatus:n(57),MessageSenderStatus:n(108),MessageDirection:n(106),PresenceStatus:n(58),GroupType:n(105),MessageType:n(109),MessagePriority:n(107)},e.exports=t.default},function(e,t){e.exports=require("autobind-decorator")},function(e,t){e.exports=require("lodash-bound/map")},function(e,t){e.exports=require("lodash/each")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=r(o),i=n(56),s=r(i),u={isOneOf:function(e,t,n){return n.includes(t)},isNotEmpty:function(e,t){return!!t},raise:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"invalid",n=arguments[2];throw new s.default(e,t,n)}};(0,a.default)(u).forEach(function(e){var t=e.replace(/^is([A-Z])/,function(e,t){return t.toLowerCase()}),n=u[e];u[t]=function(e,t,r){for(var o=arguments.length,a=Array(o>3?o-3:0),i=3;i<o;i++)a[i-3]=arguments[i];n.apply(void 0,[e,t,r].concat(a))||u.raise(e,void 0,r)}}),t.default=u,e.exports=t.default},function(e,t){e.exports=require("babel-runtime/core-js/get-iterator")},function(e,t){e.exports=require("babel-runtime/core-js/symbol/iterator")},function(e,t){e.exports=require("babel-runtime/helpers/objectWithoutProperties")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("lodash-bound/filter")},function(e,t){e.exports=require("lodash/isEmpty")},function(e,t){e.exports=require("lodash/pick")},function(e,t){e.exports=require("lodash/values")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e.get(t);if(o)o.$placeholder?o.$$loading||o.$notFound||r.onlyPlaceholder||a(e,o,r):(r.onExists&&r.onExists(o),r.onFinish&&r.onFinish(o));else{if(n=(0,T.default)((0,O.default)({},e.idAttribute,t),n),r.onMissing&&r.onMissing(),o=e.createInstance(n),Object.defineProperty(o,"$placeholder",{value:!0,configurable:!0}),e.inject(o),r.onlyPlaceholder)return o;a(e,o,r)}}function a(e,t,n){var r=C(t);if(!S[r]){if(!n.placeholderEntityDelayBeforeRefreshing){var o;return M(e,t,n).catch((o=console).error.bind(o))}Object.defineProperty(t,"$$loadingScheduled",{value:!0,configurable:!0}),S[r]=setTimeout(function(){return G(e,t,n)},n.placeholderEntityDelayBeforeRefreshing)}}function i(e,t){var n=t.finder,r=t.defaultPlaceholderAttrs,a=t.defaultNotFoundAttrs,i=t.placeholderEntityDelayBeforeRefreshing,s=t.placeholderEntityAllowLoading,l=t.shouldEnsure;if(null==arguments[1]||null!=arguments[1].finder&&"function"!=typeof arguments[1].finder||!(null==arguments[1].defaultPlaceholderAttrs||arguments[1].defaultPlaceholderAttrs instanceof Object)||!(null==arguments[1].defaultNotFoundAttrs||arguments[1].defaultNotFoundAttrs instanceof Object)||null!=arguments[1].placeholderEntityDelayBeforeRefreshing&&"function"!=typeof arguments[1].placeholderEntityDelayBeforeRefreshing&&null!=arguments[1].placeholderEntityDelayBeforeRefreshing&&"number"!=typeof arguments[1].placeholderEntityDelayBeforeRefreshing||null!=arguments[1].placeholderEntityAllowLoading&&"function"!=typeof arguments[1].placeholderEntityAllowLoading&&null!=arguments[1].placeholderEntityAllowLoading&&"boolean"!=typeof arguments[1].placeholderEntityAllowLoading||null!=arguments[1].shouldEnsure&&"function"!=typeof arguments[1].shouldEnsure)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  finder: ?Function;\n  defaultPlaceholderAttrs: ?Object;\n  defaultNotFoundAttrs: ?Object;\n  placeholderEntityDelayBeforeRefreshing: ?Function | ?number;\n  placeholderEntityAllowLoading: ?Function | ?boolean;\n  shouldEnsure: ?Function;\n}\n\nGot:\n"+c(arguments[1]));if(null==arguments[1]||null!=arguments[1].finder&&"function"!=typeof arguments[1].finder||!(null==arguments[1].defaultPlaceholderAttrs||arguments[1].defaultPlaceholderAttrs instanceof Object)||!(null==arguments[1].defaultNotFoundAttrs||arguments[1].defaultNotFoundAttrs instanceof Object)||null!=arguments[1].placeholderEntityDelayBeforeRefreshing&&"function"!=typeof arguments[1].placeholderEntityDelayBeforeRefreshing&&null!=arguments[1].placeholderEntityDelayBeforeRefreshing&&"number"!=typeof arguments[1].placeholderEntityDelayBeforeRefreshing||null!=arguments[1].placeholderEntityAllowLoading&&"function"!=typeof arguments[1].placeholderEntityAllowLoading&&null!=arguments[1].placeholderEntityAllowLoading&&"boolean"!=typeof arguments[1].placeholderEntityAllowLoading||null!=arguments[1].shouldEnsure&&"function"!=typeof arguments[1].shouldEnsure)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  finder: ?Function;\n  defaultPlaceholderAttrs: ?Object;\n  defaultNotFoundAttrs: ?Object;\n  placeholderEntityDelayBeforeRefreshing: ?Function | ?number;\n  placeholderEntityAllowLoading: ?Function | ?boolean;\n  shouldEnsure: ?Function;\n}\n\nGot:\n"+u(arguments[1]));e.ensureEntity=function(t){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"function"==typeof i&&(i=i()),"function"==typeof s&&(s=s()),o(e,t,(0,T.default)({},r,u.attrs),(0,T.default)({finder:n,notFoundAttributes:a,placeholderEntityDelayBeforeRefreshing:i,placeholderEntityAllowLoading:s},u))},e.waitForEnsuredEntity=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new v.default(function(r,o){e.ensureEntity(t,(0,T.default)({},n,{onFinish:r}))})},e.shouldEnsure=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return"string"==typeof t&&(t=e.get(t)),!t||!(!l||!l(t,n,r))||!(!t.$placeholder||t.$$loading||n)}}function s(){(0,A.default)(S).map(function(e){return clearTimeout(e)}),S={}}function u(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=u(e[0],t);return e.every(function(e){return u(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return u(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,p.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+u(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}function c(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=c(e[0],t);return e.every(function(e){return c(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return c(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,p.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+c(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}Object.defineProperty(t,"__esModule",{value:!0});var l=n(7),f=r(l),d=n(6),p=r(d),y=n(10),h=r(y),g=n(16),v=r(g),m=n(9),b=r(m),w=n(18),E=r(w),x=n(8),_=r(x),k=n(38),O=r(k),I=n(12),T=r(I),j=n(35),A=r(j),M=function(){var e=(0,_.default)(b.default.mark(function e(t,n,r){var o;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.placeholderEntityAllowLoading){e.next=2;break}return e.abrupt("return");case 2:return Object.defineProperty(n,"$$loading",{value:!0,configurable:!0}),o=void 0,e.prev=4,e.next=7,r.finder(n.id);case 7:e.next=18;break;case 9:if(e.prev=9,e.t0=e.catch(4),e.t0.code!==z.default.NotFoundError.CODE){e.next=15;break}o=!0,e.next=18;break;case 15:e.next=18;break;case 18:delete n.$$loading,o?((0,E.default)(n,r.notFoundAttributes),Object.defineProperty(n,"$notFound",{value:!0,configurable:!0}),t.touch(n),r.onNotFound&&r.onNotFound(),r.onLoad&&r.onLoad(null),r.onFinish&&r.onFinish(null)):(delete n.$placeholder,delete n.$notFound,t.touch(n),r.onSuccess&&r.onSuccess(n),r.onLoad&&r.onLoad(n),r.onFinish&&r.onFinish(n));case 20:case"end":return e.stop()}},e,this,[[4,9]])}));return function(t,n,r){return e.apply(this,arguments)}}(),G=function(){var e=(0,_.default)(b.default.mark(function e(t,n,r){return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,delete n.$$loadingScheduled,delete S[C(n)],n.$placeholder){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",M(t,n,r));case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(t,n,r){return e.apply(this,arguments)}}();t.default=i,t.dispose=s;var V=n(15),z=r(V),S={},C=function(e){return e.$entityType+":"+e.id}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return(0,l.default)(e)?e.map(function(e){return o(e,t)}):(0,u.default)(e)?(0,i.default)(e,function(e,n,r){e[t(r)]=o(n,t)},{}):e}Object.defineProperty(t,"__esModule",{value:!0});var a=n(43),i=r(a),s=n(160),u=r(s),c=n(159),l=r(c),f=n(172),d=r(f),p=n(71),y=r(p),h=n(166),g=r(h),v={camelizeKey:(0,g.default)(y.default),underscoreKey:(0,g.default)(d.default),camelizeObject:function(e){return o(e,v.camelizeKey)},underscoreObject:function(e){return o(e,v.underscoreKey)}};t.default=v,e.exports=t.default},function(e,t){e.exports=require("babel-runtime/helpers/defineProperty")},function(e,t){e.exports=require("babel-runtime/helpers/slicedToArray")},function(e,t){e.exports=require("babel-runtime/helpers/toConsumableArray")},function(e,t){e.exports=require("lodash/get")},function(e,t){e.exports=require("lodash/omit")},function(e,t){e.exports=require("lodash/transform")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(21),a=r(o),i=new a.default(["ONLINE","OFFLINE","CONNECTING","UNREACHABLE"]);t.default=i,e.exports=t.default},function(e,t){e.exports=require("babel-runtime/core-js/object/entries")},function(e,t){e.exports=require("btoa")},function(e,t){e.exports=require("lodash-bound/flatten")},function(e,t){e.exports=require("lodash-bound/orderBy")},function(e,t){e.exports=require("lodash-bound/reject")},function(e,t){e.exports=require("lodash-bound/uniq")},function(e,t){e.exports=require("lodash/defaultsDeep")},function(e,t){e.exports=require("lodash/difference")},function(e,t){e.exports=require("lodash/filter")},function(e,t){e.exports=require("lodash/throttle")},function(e,t){e.exports=require("moment")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(3),s=r(i),u=n(1),c=r(u),l=n(5),f=r(l),d=n(4),p=r(d),y=(a=o=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"invalid",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e+" is "+n;(0,c.default)(this,t);var o=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,r));return o.code=t.CODE,o.name=e,o.reason=n,o}return(0,p.default)(t,e),t}(Error),o.CODE="validation",a);t.default=y,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),o=new r.ServerValueEnum({READ:{serverValue:"Read"},DELIVERED:{serverValue:"Delivered"},RECEIVED_ON_CLIENT:{serverValue:"ReceivedOnClient"},NEW:{serverValue:"New"},NA:{key:"NA"}},{defaultValue:"NA"});t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),o=new r.ServerValueEnum({UNKNOWN:{serverValue:"unknown"},AVAILABLE:{serverValue:"available"},UNAVAILABLE:{serverValue:"unavailable"}});t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Event:n(96),SearchResult:n(103)};t.default=r,e.exports=t.default},function(e,t,n){},function(e,t,n){"use strict";!function(){try{var e=n(138).request().constructor.prototype;e.setNoDelay||(e.setNoDelay=function(){}),e.abort||(e.abort=function(){this.xhr&&this.xhr.abort()})}catch(e){}}()},function(e,t){e.exports=require("file-type")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("is-email")},function(e,t){e.exports=require("jshashes")},function(e,t){e.exports=require("lodash-bound/keyBy")},function(e,t){e.exports=require("lodash-bound/omitBy")},function(e,t){e.exports=require("lodash-bound/values")},function(e,t){e.exports=require("lodash-bound/without")},function(e,t){e.exports=require("lodash/assign")},function(e,t){e.exports=require("lodash/camelCase")},function(e,t){e.exports=require("lodash/find")},function(e,t){e.exports=require("lodash/sumBy")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("uuid")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,z.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,z.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0});var s,u,c,l=n(7),f=r(l),d=n(10),p=r(d),y=n(11),h=r(y),g=n(18),v=r(g),m=n(39),b=r(m),w=n(28),E=r(w),x=n(29),_=r(x),k=n(45),O=r(k),I=n(16),T=r(I),j=n(9),A=r(j),M=n(8),G=r(M),V=n(6),z=r(V),S=n(12),C=r(S),P=n(1),N=r(P),R=n(2),U=r(R),q=n(168),F=r(q),$=n(26),L=r($),D=n(71),B=r(D),K=n(165),Z=r(K),W=n(51),H=r(W),X=n(78),Q=r(X),Y=n(77),J=r(Y),ee=n(31),te=r(ee),ne=n(75),re=r(ne),oe=n(15),ae=r(oe),ie=n(87),se=r(ie),ue=n(124),ce=r(ue),le=n(126),fe=r(le),de=n(23),pe=r(de),ye=n(140),he=r(ye),ge=n(24),ve=r(ge),me=n(128),be=r(me),we=n(44),Ee=r(we),xe="UpM28mnfW65vJkbqEATtKvxm",_e={tt:"https://api.tigertext.me/v2",production:"https://developer.tigertext.me/v2",uat:"https://uat-devapi.tigertext.me/v2",qa:"https://qa-devapi.tigertext.me/v2",dev:"https://dev-devapi.tigertext.me/v2",productionOauth:"http://52.41.133.15:8000/tigertextapi/v2",lt:"https://lt-devapi.tigertext.xyz/v2"},ke={events:{autoAck:!1,isTyping:!0,msgDeliveryDelay:0,multiOrg:!0,noOfflineMessages:!1,autoDeliver:!1,hidden:!1,closeAfterMessages:!1},autoAckSuccessfullyHandledEvents:!0,logLevel:"error",serviceLogLevels:{},eventsAutoReconnect:!0,flushAckInterval:2e3,flushAckMaxEvents:500,flushSetMessageStatusInterval:1e3,flushMessageMaxCount:500,conversationReloadDelay:200,eventsAutoReconnectDelay:2e3,clearTypingStatusTimeout:15e3,organizationRostersChangeThrottleDelay:500,placeholderEntityAllowLoading:!0,placeholderEntityDelayBeforeRefreshing:100,consumerOrganizationId:xe,maxMetadataKeyCount:8,pushAgent:"consumer",baseUrl:null,apiEnv:"production",productKey:"bc1oOf3DZXbnaNZ2LCWZGvSg",version:"1.0",autoSignOutOnBrowserUnload:!1,hiddenUsers:[],botUsers:[]},Oe=(c=u=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,N.default)(this,e),this.VERSION=be.default,this.version=be.default,!(null==n||n instanceof Object))throw new TypeError('Value of argument "config" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+i(n));if(!(null==n||n instanceof Object))throw new TypeError('Value of argument "config" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+a(n));this.config=(0,H.default)(n,ke),this.config.baseUrl||(this.config.baseUrl=_e[this.config.apiEnv]),this.config.autoSignOutOnBrowserUnload=!1,this.httpClient=new J.default({baseUrl:this.config.baseUrl,logger:new Q.default({name:"HttpClient",level:this.config.logLevel})}),this.enums=(0,C.default)({},pe.default,{NetworkStatus:Ee.default}),this.store=new fe.default(this,{logger:new Q.default({name:"Store",level:this.config.logLevel})}),this.store.defineModels(),this.models=this.store.models,this.modelsByEntityType=(0,Z.default)(this.store.models,function(e,t){return(0,B.default)(t)}),this.allModelEntityTypes=(0,z.default)(this.modelsByEntityType),this.logger=new Q.default({name:"TigerConnectClient",level:this.config.logLevel}),this.api={},(0,L.default)(se.default,function(e,n){t.api[(0,B.default)(n)]=new e(t,{logger:new Q.default({name:e.name,level:t.config.logLevel})})}),this._services={},(0,L.default)(ce.default,function(e,n){n=(0,B.default)(n),t._services[n]=t[n]=new e(t,{logger:new Q.default({name:e.name,level:t.config.serviceLogLevels[n]||t.config.logLevel})})}),(0,L.default)(this._services,function(e){return e.mounted&&e.mounted()}),this._listenToEvents(),this._startTicker(),this.config.autoSignOutOnBrowserUnload&&this.on("browserUnload",function(e){return e(function(){t.config.autoSignOutOnBrowserUnload&&t.signOut({async:!1,resetClient:!1})},100,"signOut")}),this.currentlyServingOfflineMessages=!1}return(0,U.default)(e,[{key:"_listenToEvents",value:function(){var e=this;this.httpClient.on("networkStatus:change",function(t){var n=t.networkStatus;e.emit("networkStatus:change",{networkStatus:n})}).on("auth:invalid",function(){e.emit("auth:invalid")}),this.on("signedIn",function(t,n){e.logger.info("signedIn",t.id)}).on("signedOut",function(t){var n=t.resetClient;n&&e.reset()}).on("signUp",function(t){var n=t.user,r=t.auth;e.logger.info("signUp",n.id),e._setCurrentUser(n),e._setAuth(r)}),this.events.on("event",function(t){return e.emit("event",t)}),this.conversations.on("message",function(t){return e.emit("message",t)}),this.conversations.on("change",function(t){return e.emit("conversation:change",t)}),this.groups.on("membership:change",function(t){return e.emit("group:membership:change",t)}),this.presence.on("change",function(t){return e.emit("presence:change",t)}),this.typingStatus.on("change",function(t){return e.emit("typing:change",t)}),"undefined"!=typeof window&&window.addEventListener("beforeunload",this._onBrowserUnload)}},{key:"_onBrowserUnload",value:function(){var e=[],t=function(t,n,r){return e.push({fn:t,priority:n,name:r})};this.emit("browserUnload",t),(0,F.default)(e,["priority"],["desc"]).forEach(function(e){var t=e.fn,n=e.priority,r=e.name;console.log("[unload]",n,r),t()})}},{key:"_startTicker",value:function(){this.__ticker=setInterval(this._onTick,1e3)}},{key:"_stopTicker",value:function(){clearInterval(this.__ticker)}},{key:"_onTick",value:function(){this.emit("tick")}},{key:"signIn",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(t,n){var r,o,a,i,s,u,c,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.udid,o=void 0===r?(0,re.default)():r,a=l.refreshUser,i=void 0===a||a,this.emit("signingIn"),e.prev=2,e.next=5,this.users.signIn(t,n,{udid:o
});case 5:if(s=e.sent,u=s.user,c=s.auth,this._setCurrentUser(u),this._setAuth(c),!i){e.next=13;break}return e.next=13,this.users.findMe({bypassCache:!0});case 13:return this.emit("signedIn",u,c),e.abrupt("return",{user:u,auth:c});case 17:throw e.prev=17,e.t0=e.catch(2),e.t0;case 20:case"end":return e.stop()}},e,this,[[2,17]])}));return e}()},{key:"signOut",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{async:!0,resetClient:!0},n=t.async,r=void 0===n||n,o=t.resetClient,s=void 0===o||o;if(!this.isSignedIn)return T.default.resolve();if(this.emit("signingOut"),!r&&"undefined"==typeof XMLHttpRequest)throw new Error("async: false option has to be on the browser.");if(this.events.disconnect(),r)return this.users.signOut({async:r}).then(function(){e._currentUser=null,e._auth=null,e.httpClient.removeAuth(),e.emit("signedOut",{resetClient:s})});var u=new XMLHttpRequest;if(u.open("POST",this.config.baseUrl+"/logout",!1),y=(0,O.default)(this.httpClient.getAuthHeaders()),!y||"function"!=typeof y[_.default]&&!Array.isArray(y))throw new TypeError("Expected _Object$entries to be iterable, got "+a(y));if(!y||"function"!=typeof y[_.default]&&!Array.isArray(y))throw new TypeError("Expected _Object$entries to be iterable, got "+i(y));var c=!0,l=!1,f=void 0;try{for(var d,p=(0,E.default)(y);!(c=(d=p.next()).done);c=!0){var y,h=(0,b.default)(d.value,2),g=h[0],v=h[1];u.setRequestHeader(g,v)}}catch(e){l=!0,f=e}finally{try{!c&&p.return&&p.return()}finally{if(l)throw f}}return u.send(null),this.emit("signedOut",{resetClient:s}),T.default.resolve()}},{key:"wipe",value:function(){function e(){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signOut();case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"authenticate",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return this._authenticateWithParams({key:e,secret:t})}},{key:"authenticateUsingOauth",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{udid:void 0};if("string"!=typeof e)throw new TypeError('Value of argument "bearerToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "bearerToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return t.udid=t.udid||(0,re.default)(),this._authenticateWithParams({bearerToken:e,udid:t.udid})}},{key:"_authenticateWithParams",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,G.default)(A.default.mark(function e(t){var n;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._setAuth(t),e.prev=1,e.next=4,this.users.findMe();case 4:return n=e.sent,this._setCurrentUser(n),this.emit("signedIn",n,t),e.abrupt("return",n);case 10:throw e.prev=10,e.t0=e.catch(1),this._removeAuth(),this._currentUser=null,e.t0;case 15:case"end":return e.stop()}},e,this,[[1,10]])}));return e}()},{key:"_setCurrentUser",value:function(e){this._currentUser=e}},{key:"_setAuth",value:function(e){this._auth=e,this.httpClient.setAuth(e)}},{key:"_removeAuth",value:function(){this._auth=null,this.httpClient.removeAuth()}},{key:"getCurrentUser",value:function(){return this._currentUser||null}},{key:"getAuth",value:function(){return this._auth}},{key:"requireUser",value:function(){if(!this.isSignedIn)throw new ae.default.NotSignedInError}},{key:"reactToAdvisoryEvent",value:function(e,t){var n=this;switch(this.emit("advisory",{type:e,data:t}),e){case"replayStart":this.currentlyServingOfflineMessages=!0,this.emit("messages:offline:start",t);break;case"replayStop":var r=function(){n.currentlyServingOfflineMessages=!1,n.emit("messages:offline:stop"),n.emit("messages:new:start")};this.conversations.hasPendingReloads()?this.conversations.once("_reloadQueueFinished",r):r()}}},{key:"modelByTypeNS",value:function(e){return this.MODEL_BY_TYPE_NS[e]}},{key:"injectModel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.xmlns||e.type,n=this.modelByTypeNS(t);return n?n.inject(e):((0,he.default)(n,"injectModel: Missing class for "+t),null)}},{key:"getEntity",value:function(e,t){return this.modelsByEntityType[e].get(t)}},{key:"getEntities",value:function(e){var t=this;return e.map(function(e){return t.getEntity(e.type,e.id)})}},{key:"dispose",value:function(){this._stopTicker(),(0,L.default)(this._services,function(e){return e.dispose&&e.dispose()}),this.store&&this.store.clear()}},{key:"reset",value:function(){this.dispose(),(0,L.default)(this._services,function(e){return e.mounted&&e.mounted()}),this._startTicker()}},{key:"configure",value:function(e){return(0,v.default)(this.config,e),this}},{key:"setDefaultOrganization",value:function(e){return this.configure({defaultOrganizationId:e})}},{key:"currentUser",get:function(){return this.getCurrentUser()}},{key:"currentUserId",get:function(){return this.getCurrentUser()&&this.getCurrentUser().id}},{key:"isSignedIn",get:function(){return!!this.getAuth()}},{key:"MODEL_BY_TYPE_NS",get:function(){return this._MODEL_BY_TYPE_NS||(this._MODEL_BY_TYPE_NS={"tigertext:entity:account":this.models.User,"tigertext:entity:group":this.models.Group,"tigertext:entity:distribution_list":this.models.DistributionList,"tigertext:entity:list":this.models.DistributionList,"tigertext:iq:message":this.models.Message,"tigertext:iq:group_message":this.models.Message,"tigertext:iq:group:message":this.models.Message}),this._MODEL_BY_TYPE_NS}},{key:"networkStatus",get:function(){return this.httpClient.networkStatus}}]),e}(),u.errors=ae.default,u.VERSION=be.default,u.version=be.default,u.CONSUMER_ORGANIZATION_ID=xe,s=c,o(s.prototype,"_onBrowserUnload",[ve.default],(0,h.default)(s.prototype,"_onBrowserUnload"),s.prototype),o(s.prototype,"_onTick",[ve.default],(0,h.default)(s.prototype,"_onTick"),s.prototype),s);(0,v.default)(Oe.prototype,te.default.prototype),t.default=Oe,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"attachment",r=e.name;if(!r)if("string"==typeof e)r=n(74).basename(e);else if(e instanceof Buffer){var o=(0,q.default)(n(62)(e),"ext");r=t+"."+o}return r}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,d.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),c=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(c+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+c+"\n"+s+"}":"{\n  "+s+c+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,l.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,d.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),c=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,u.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(c+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+c+"\n"+s+"}":"{\n  "+s+c+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0});var s=n(7),u=r(s),c=n(10),l=r(c),f=n(6),d=r(f),p=n(18),y=r(p),h=n(39),g=r(h),v=n(28),m=r(v),b=n(29),w=r(b),E=n(45),x=r(E),_=n(16),k=r(_),O=n(9),I=r(O),T=n(8),j=r(T),A=n(1),M=r(A),G=n(2),V=r(G),z=n(171),S=r(z),C=n(33),P=r(C),N=n(19),R=r(N),U=n(41),q=r(U),F=n(167),$=r(F),L=n(185),D=r(L),B=n(46),K=r(B),Z=n(15),W=r(Z),H=n(182),X=r(H),Q=n(186),Y=r(Q),J=n(17),ee=n(31),te=r(ee),ne=n(44),re=r(ne),oe=n(136),ae=["get","post","put","patch","del"],ie=function(){function e(t){(0,M.default)(this,e),this.downloadFileBlobAndUrl=function(){return W.default.TargetNotSupportedError.raise()},this.config=t,this.logger=t.logger,this._prefixBaseUrl=(0,Y.default)(this.config.baseUrl),this._watchNetworkConnection()}return(0,V.default)(e,[{key:"setAuth",value:function(e){e.key&&e.secret?(this._key=e.key,this._secret=e.secret):e.bearerToken&&(this._bearerToken=e.bearerToken,this._udid=e.udid)}},{key:"removeAuth",value:function(){this._key=null,this._secret=null,this._bearerToken=null,this._udid=null}},{key:"getAuthForKeyAndSecret",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._key,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._secret;if("string"!=typeof e)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(null!=t&&"string"!=typeof t)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(null!=t&&"string"!=typeof t)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(t));return e&&t?(0,K.default)(e+":"+t):null}},{key:"getAuthHeaders",value:function(){return this._key&&this._secret?{Authorization:"Basic "+this.getAuthForKeyAndSecret()}:this._bearerToken&&this._udid?{Authorization:"Bearer "+this._bearerToken,"X-Device-ID":this._udid}:{}}},{key:"getAuthQueryParams",value:function(){return this._key&&this._secret?{auth_basic:this.getAuthForKeyAndSecret()}:this._bearerToken&&this._udid?{auth_bearer:this._bearerToken,udid:this._udid}:{}}},{key:"_contentType",value:function(e){switch(e){case"json":return"application/json";case"event-stream":return"text/event-stream";case"text":default:return"plain/text"}}},{key:"downloadFileBlob",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));W.default.TargetNotSupportedError.raise()}},{key:"downloadToFile",value:function(e,t){var r=this,o=n(63);return new k.default(function(a,i){var s=r.config.baseUrl+e;n(183)({url:s,headers:r.getAuthHeaders()},function(e,t){e||t&&t.statusCode<200||t.statusCode>299?i(new Error("Failed downloading "+s+". Error: "+e.message+" | Status: "+(t?t.statusCode:null))):a()}).pipe(o.createWriteStream(t))})}},{key:"_watchNetworkConnection",value:function(){this.networkStatus=re.default.ONLINE}},{key:"_setNetworkStatus",value:function(e){e!==this.networkStatus&&(e===re.default.UNREACHABLE&&this.networkStatus===re.default.OFFLINE||(this.networkStatus=e,this.emit("networkStatus:change",{networkStatus:this.networkStatus})))}},{key:"createEventSource",value:function(e,t){var n=this,r=t.features,o=t.onOpen,s=t.onMessage,u=t.onError,c=t.onClose;if("string"!=typeof e)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(null==arguments[1]||null!=arguments[1].features&&"string"!=typeof arguments[1].features||null!=arguments[1].onOpen&&"function"!=typeof arguments[1].onOpen||null!=arguments[1].onMessage&&"function"!=typeof arguments[1].onMessage||null!=arguments[1].onError&&"function"!=typeof arguments[1].onError||null!=arguments[1].onClose&&"function"!=typeof arguments[1].onClose)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  features: ?string;\n  onOpen: ?Function;\n  onMessage: ?Function;\n  onError: ?Function;\n  onClose: ?Function;\n}\n\nGot:\n"+i(arguments[1]));if("string"!=typeof e)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(null==arguments[1]||null!=arguments[1].features&&"string"!=typeof arguments[1].features||null!=arguments[1].onOpen&&"function"!=typeof arguments[1].onOpen||null!=arguments[1].onMessage&&"function"!=typeof arguments[1].onMessage||null!=arguments[1].onError&&"function"!=typeof arguments[1].onError||null!=arguments[1].onClose&&"function"!=typeof arguments[1].onClose)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  features: ?string;\n  onOpen: ?Function;\n  onMessage: ?Function;\n  onError: ?Function;\n  onClose: ?Function;\n}\n\nGot:\n"+a(arguments[1]));o=o||$.default,s=s||$.default,u=u||$.default,c=c||$.default;var l=this.getAuthQueryParams();l=X.default.stringify(l),r&&(l=""===l?"features="+r:l+"&features="+r);var f=/https?:/.test(e)?e:this.config.baseUrl+e;""!==l&&(f=f+"?"+l);var d=new oe(f),p=d.once?d.once.bind(d):function(e,t){var n=function n(){t.apply(void 0,arguments),d.removeEventListener(e,n)};d.addEventListener(e,n)};return p("open",function(){n._setNetworkStatus(re.default.ONLINE),o()}),p("error",function(e){e&&(0===e.status?n._setNetworkStatus(re.default.UNREACHABLE):401===e.status&&n.emit("auth:invalid")),u(e)}),p("close",c),d.addEventListener("message",s),d}}]),e}();ae.forEach(function(e){ie.prototype[e]=function(){var t=(0,j.default)(I.default.mark(function t(n){var r,s,u=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return I.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return c=(0,R.default)(c||{},{reqFormat:"json",resFormat:"json"}),c.urlParams&&(n=n.replace(/:([\w\-]+)/g,function(e,t){return encodeURIComponent(c.urlParams[t])})),this.logger&&this.logger.info("start",e.toUpperCase(),n,c),r=(0,y.default)({},c.headers),(0,P.default)(c.files)&&(r["Content-Type"]=r["Content-Type"]||this._contentType(c.reqFormat)),r.Accept=r.Accept||this._contentType(c.resFormat),c.requestId&&(r["Request-ID"]=c.requestId),s=new k.default(function(t,s){var l=D.default[e](n).use(u._prefixBaseUrl).set(r).query(c.query||{});c.retry!==!1&&(l=l.retry(c.retryCount||3)),c.timeout!==!1&&(l=l.timeout(c.timeout===!0?5e3:c.timeout));var f=!(0,P.default)(c.files);if(f?(l=(0,S.default)(c.data,function(e,t,n){return e.field(n,String(t))},l),l=c.files&&(0,d.default)(c.files).length?(0,S.default)(c.files,function(e,t,n,r){return t?e.attach(n,t,o(t,"attachment-"+r)):e.field(n,"")},l):l.send()):l=l.send(c.data||{}),!("Authorization"in r)){if(E=(0,x.default)(u.getAuthHeaders()),!E||"function"!=typeof E[w.default]&&!Array.isArray(E))throw new TypeError("Expected _Object$entries2 to be iterable, got "+a(E));if(!E||"function"!=typeof E[w.default]&&!Array.isArray(E))throw new TypeError("Expected _Object$entries2 to be iterable, got "+i(E));var p=!0,y=!1,h=void 0;try{for(var v,b=(0,m.default)(E);!(p=(v=b.next()).done);p=!0){var E,_=(0,g.default)(v.value,2),k=_[0],O=_[1];l=l.set(k,O)}}catch(e){y=!0,h=e}finally{try{!p&&b.return&&b.return()}finally{if(y)throw h}}}l.end(function(r,o){if(r)return u.logger&&u.logger.info("error",e.toUpperCase(),n,r),void(r.status?401===r.status?(u.emit("auth:invalid"),s(new W.default.WrongCredentialsError)):s(r):(u._setNetworkStatus(re.default.UNREACHABLE),s(new W.default.ConnectionUnavailableError)));switch(u._setNetworkStatus(re.default.ONLINE),c.resFormat){case"json":var a=o.body||{};"reply"in a&&(a=a.reply);var i={data:a,headers:o.headers,getHeader:function(e){return o.headers[e.toLowerCase()]},status:o.status};Object.defineProperty(i,"_origData",{get:function(){return o.body}}),u.logger&&u.logger.info("success",e.toUpperCase(),n,i),t(i);break;default:u.logger&&u.logger.info("success",e.toUpperCase(),n,o.text?o.text.substr(0,80)+"...":"[null]"),t(o.text)}})}),t.abrupt("return",s);case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}),!function(){var e=ie.prototype.get,t=(0,J.decorator)(e);ie.prototype.get=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.reusePromise?t.call(this,n,r):e.call(this,n,r)}}(),(0,y.default)(ie.prototype,te.default.prototype),t.default=ie,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,f.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?a.trim()+"[]":"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,c.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var u="  ".repeat(t-1),l=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s.default)(n))+": "+o(e[n],t)+";"}).join("\n  "+u);return i.length>=r&&(l+="\n  "+u+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+u+l+"\n"+u+"}":"{\n  "+u+l+"\n"+u+"}"}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,f.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,c.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var u="  ".repeat(t-1),l=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+u);return i.length>=r&&(l+="\n  "+u+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+u+l+"\n"+u+"}":"{\n  "+u+l+"\n"+u+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(7),s=r(i),u=n(6),c=r(u),l=n(10),f=r(l),d=n(40),p=r(d),y=n(1),h=r(y),g=n(2),v=r(g),m=function(){function e(t){var n=t.name,r=t.level;if((0,h.default)(this,e),null==arguments[0]||"string"!=typeof arguments[0].name||"string"!=typeof arguments[0].level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  name: string;\n  level: string;\n}\n\nGot:\n"+a(arguments[0]));if(null==arguments[0]||"string"!=typeof arguments[0].name||"string"!=typeof arguments[0].level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  name: string;\n  level: string;\n}\n\nGot:\n"+o(arguments[0]));this.name=n,this.level=r}return(0,v.default)(e,[{key:"setLevel",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));if(this.level=e.toLowerCase(),"string"!=typeof this.level)throw new TypeError('Value of "this.level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(this.level))}}]),e}();t.default=m;var b=["debug","log","info","warn","error"],w=b.reduce(function(e,t,n){return e[t]=n,e},{});b.forEach(function(e){var t=w[e];m.prototype[e]=function(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];t>=w[this.level]&&(r=["["+this.name+"]"].concat((0,p.default)(r)),Function.prototype.apply.call(console[e],console,r))}}),e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,d.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,d.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c=n(7),l=r(c),f=n(6),d=r(f),p=n(10),y=r(p),h=n(11),g=r(h),v=n(9),m=r(v),b=n(8),w=r(b),E=n(3),x=r(E),_=n(1),k=r(_),O=n(2),I=r(O),T=n(5),j=r(T),A=n(4),M=r(A),G=n(20),V=r(G),z=(s=(0,G.recoverFromNotFound)(),u=function(e){function t(){return(0,k.default)(this,t),(0,j.default)(this,(t.__proto__||(0,x.default)(t)).apply(this,arguments))}return(0,M.default)(t,e),(0,I.default)(t,[{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,w.default)(m.default.mark(function e(t){var n;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.get("/dist_list/:id",{urlParams:{id:t}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)}));return e}()}]),t}(V.default),o(u.prototype,"find",[s],(0,g.default)(u.prototype,"find"),u.prototype),u);t.default=z,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,p.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,p.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c,l=n(7),f=r(l),d=n(6),p=r(d),y=n(10),h=r(y),g=n(11),v=r(g),m=n(9),b=r(m),w=n(8),E=r(w),x=n(3),_=r(x),k=n(1),O=r(k),I=n(2),T=r(I),j=n(5),A=r(j),M=n(4),G=r(M),V=n(20),z=r(V),S=(s=(0,V.recoverFromNotFound)(),u=(0,V.recoverFromNotFound)({httpStatusCodes:[404,403]}),c=function(e){function t(){return(0,O.default)(this,t),(0,A.default)(this,(t.__proto__||(0,_.default)(t)).apply(this,arguments))}return(0,G.default)(t,e),(0,T.default)(t,[{key:"create",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t){var n,r,o,a,i,s,u,c=t.name,l=t.avatarFile,f=t.replayHistory,d=void 0!==f&&f,p=t.memberIds,y=void 0===p?[]:p,h=t.organizationId;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},r={name:c,replay_history:d,members:y.join(",")},o={},l&&(o.avatar=l),h&&(n["TT-X-Organization-Key"]=h),e.next=7,this.httpClient.post("/group",{headers:n,data:r,files:o});case 7:return a=e.sent,i=a.getHeader("TT-X-Group-Token"),s=a.getHeader("TT-X-Group-Avatar"),u={id:i,avatarUrl:s,name:c,memberIds:y,organizationId:h},e.abrupt("return",u);case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"update",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t,n){var r,o,a,i,s=n.name,u=void 0===s?void 0:s,c=n.avatarFile,l=void 0===c?void 0:c,f=n.replayHistory,d=void 0===f?void 0:f,p=n.memberIds;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={},o={},"undefined"!=typeof u&&(r.name=u),"undefined"!=typeof p&&(r.members=p.join(",")),"undefined"!=typeof d&&(r.replay_history=d),l&&(o.avatar=l),e.next=8,this.httpClient.post("/group/:id",{urlParams:{id:t},data:r,files:o});case 8:return a=e.sent,i=a.getHeader("TT-X-Group-Avatar"),e.abrupt("return",{id:t,avatarUrl:i});case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t){var n;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.get("/group/:id",{urlParams:{id:t}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"destroy",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t){return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.del("/group/:id",{urlParams:{id:t}});case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"addMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t,n){return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(n));case 8:return e.next=10,this.httpClient.post("/group/:id/members",{urlParams:{id:t},data:{members:n}});case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t,n){return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(n));case 8:return e.next=10,this.httpClient.post("/group/:id/members/remove",{urlParams:{id:t},data:{
members:n}});case 10:case"end":return e.stop()}},e,this)}));return e}()}]),t}(z.default),o(c.prototype,"find",[s],(0,v.default)(c.prototype,"find"),c.prototype),o(c.prototype,"destroy",[u],(0,v.default)(c.prototype,"destroy"),c.prototype),c);t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,f.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,b.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,f.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,b.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c,l=n(6),f=r(l),d=n(10),p=r(d),y=n(11),h=r(y),g=n(9),v=r(g),m=n(7),b=r(m),w=n(12),E=r(w),x=n(8),_=r(x),k=n(3),O=r(k),I=n(1),T=r(I),j=n(2),A=r(j),M=n(5),G=r(M),V=n(4),z=r(V),S=n(20),C=r(S),P=n(64),N=r(P),R=(s=(0,S.recoverFromNotFound)(),u=(0,S.recoverFromNotFound)(),c=function(e){function t(){return(0,T.default)(this,t),(0,G.default)(this,(t.__proto__||(0,O.default)(t)).apply(this,arguments))}return(0,z.default)(t,e),(0,A.default)(t,[{key:"send",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,_.default)(v.default.mark(function e(t){var n,r,o,s,u=t.counterPartyId,c=t.body,l=t.senderOrganizationId,f=t.recipientOrganizationId,d=t.attachment,p=t.metadata,y=t.priority,h=t.ttl,g=t.deleteOnRead,m=t.localId,w=arguments;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==w[0]||"string"!=typeof w[0].counterPartyId||"string"!=typeof w[0].body||"string"!=typeof w[0].senderOrganizationId||"string"!=typeof w[0].recipientOrganizationId||!(null==w[0].attachment||w[0].attachment instanceof Object||null==w[0].attachment||"string"==typeof w[0].attachment)||!(null==w[0].metadata||w[0].metadata instanceof Object)||null!=w[0].priority&&"number"!=typeof w[0].priority||null!=w[0].ttl&&"number"!=typeof w[0].ttl||null!=w[0].deleteOnRead&&"boolean"!=typeof w[0].deleteOnRead||"string"!=typeof w[0].localId)){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  counterPartyId: string;\n  body: string;\n  senderOrganizationId: string;\n  recipientOrganizationId: string;\n  attachment: ?Object | ?string;\n  metadata: ?Object;\n  priority: ?number;\n  ttl: ?number;\n  deleteOnRead: ?boolean;\n  localId: string;\n}\n\nGot:\n"+i(w[0]));case 2:if(!(null==w[0]||"string"!=typeof w[0].counterPartyId||"string"!=typeof w[0].body||"string"!=typeof w[0].senderOrganizationId||"string"!=typeof w[0].recipientOrganizationId||!(null==w[0].attachment||w[0].attachment instanceof Object||null==w[0].attachment||"string"==typeof w[0].attachment)||!(null==w[0].metadata||w[0].metadata instanceof Object)||null!=w[0].priority&&"number"!=typeof w[0].priority||null!=w[0].ttl&&"number"!=typeof w[0].ttl||null!=w[0].deleteOnRead&&"boolean"!=typeof w[0].deleteOnRead||"string"!=typeof w[0].localId)){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  counterPartyId: string;\n  body: string;\n  senderOrganizationId: string;\n  recipientOrganizationId: string;\n  attachment: ?Object | ?string;\n  metadata: ?Object;\n  priority: ?number;\n  ttl: ?number;\n  deleteOnRead: ?boolean;\n  localId: string;\n}\n\nGot:\n"+a(w[0]));case 4:return(0,N.default)(u)&&(u=u.toLowerCase()),f||(f=l),n={recipient:u,body:c},r={},p&&(n.data=p.map(function(e){return(0,E.default)({},e,{payload:(0,b.default)(e.payload)})})),l&&(n.sender_organization=l),f&&(n.recipient_organization=f),"undefined"!=typeof y&&(n.priority=y),d&&(r.attachment=d),h&&(n.ttl=h),g&&(n.dor=g),e.next=17,this.httpClient.post("/message",{data:n,files:r,requestId:m,timeout:!d||6e4});case 17:return o=e.sent,s={serverId:o.getHeader("TT-X-Message-Id"),ttl:+o.getHeader("TT-X-Msg-Ttl")},e.abrupt("return",s);case 20:case"end":return e.stop()}},e,this)}));return e}()},{key:"destroy",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,_.default)(v.default.mark(function e(t){return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.prev=4,e.next=7,this.httpClient.del("/message/:id",{urlParams:{id:t}});case 7:return e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",!1);case 13:case"end":return e.stop()}},e,this,[[4,10]])}));return e}()},{key:"startTyping",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,_.default)(v.default.mark(function e(t){return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.post("/message/typing",{data:{recipient:t}});case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"stopTyping",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,_.default)(v.default.mark(function e(t){return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.del("/message/typing/:recipientId",{urlParams:{recipientId:t}});case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"forward",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,_.default)(v.default.mark(function e(t,n,r){var o,s,u,c=r.senderOrganizationId,l=r.recipientOrganizationId,f=r.priority,d=r.localId,p=arguments;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(!(null==p[2]||null!=p[2].senderOrganizationId&&"string"!=typeof p[2].senderOrganizationId||null!=p[2].recipientOrganizationId&&"string"!=typeof p[2].recipientOrganizationId||null!=p[2].priority&&"number"!=typeof p[2].priority||"string"!=typeof p[2].localId)){e.next=6;break}throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{\n  senderOrganizationId: ?string;\n  recipientOrganizationId: ?string;\n  priority: ?number;\n  localId: string;\n}\n\nGot:\n"+i(p[2]));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if("string"==typeof n){e.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if(!(null==p[2]||null!=p[2].senderOrganizationId&&"string"!=typeof p[2].senderOrganizationId||null!=p[2].recipientOrganizationId&&"string"!=typeof p[2].recipientOrganizationId||null!=p[2].priority&&"number"!=typeof p[2].priority||"string"!=typeof p[2].localId)){e.next=12;break}throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{\n  senderOrganizationId: ?string;\n  recipientOrganizationId: ?string;\n  priority: ?number;\n  localId: string;\n}\n\nGot:\n"+a(p[2]));case 12:return l||(l=c),o={recipient:n},c&&(o.sender_organization=c),l&&(o.recipient_organization=l),"undefined"!=typeof f&&(o.priority=f),e.next=19,this.httpClient.post("/message/:id/forward",{urlParams:{id:t},data:o,requestId:d});case 19:return s=e.sent,u={serverId:s.getHeader("TT-X-Message-Id")},e.abrupt("return",u);case 22:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,_.default)(v.default.mark(function e(t){var n;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.get("/message/:id",{urlParams:{id:t}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"findStatusesPerRecipient",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,_.default)(v.default.mark(function e(t){var n;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.get("/message/:id/status",{urlParams:{id:t}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)}));return e}()}]),t}(C.default),o(c.prototype,"find",[s],(0,h.default)(c.prototype,"find"),c.prototype),o(c.prototype,"findStatusesPerRecipient",[u],(0,h.default)(c.prototype,"findStatusesPerRecipient"),c.prototype),c);t.default=R,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,f.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?a.trim()+"[]":"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,c.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var u="  ".repeat(t-1),l=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s.default)(n))+": "+o(e[n],t)+";"}).join("\n  "+u);return i.length>=r&&(l+="\n  "+u+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+u+l+"\n"+u+"}":"{\n  "+u+l+"\n"+u+"}"}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,f.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,c.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var u="  ".repeat(t-1),l=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+u);return i.length>=r&&(l+="\n  "+u+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+u+l+"\n"+u+"}":"{\n  "+u+l+"\n"+u+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(7),s=r(i),u=n(6),c=r(u),l=n(10),f=r(l),d=n(9),p=r(d),y=n(8),h=r(y),g=n(3),v=r(g),m=n(1),b=r(m),w=n(2),E=r(w),x=n(5),_=r(x),k=n(4),O=r(k),I=n(178),T=r(I),j=n(20),A=r(j),M=function(e){function t(){return(0,b.default)(this,t),(0,_.default)(this,(t.__proto__||(0,v.default)(t)).apply(this,arguments))}return(0,O.default)(t,e),(0,E.default)(t,[{key:"update",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,h.default)(p.default.mark(function e(t,n,r){return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 2:if(n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 8:if(n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:return e.next=14,this.httpClient.post("/metadata/:id",{urlParams:{id:t},data:n,headers:{"TT-X-Organization-Key":r}});case 14:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,h.default)(p.default.mark(function e(t,n){var r;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return e.next=10,this.httpClient.get("/metadata/:id",{urlParams:{id:t},headers:{"TT-X-Organization-Key":n}});case 10:return r=e.sent,e.abrupt("return",r.data);case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"findMulti",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,h.default)(p.default.mark(function e(t,n){var r,i;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+o(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return e.next=10,this.httpClient.post("/metadata_bulk",{data:{entities:t},headers:{"TT-X-Organization-Key":n}});case 10:return r=e.sent,i=(0,T.default)(t,r.data),e.abrupt("return",i);case 13:case"end":return e.stop()}},e,this)}));return e}()}]),t}(A.default);t.default=M,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,b.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,v.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,h.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,b.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,v.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,h.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c,l,f,d,p,y=n(7),h=r(y),g=n(6),v=r(g),m=n(10),b=r(m),w=n(11),E=r(w),x=n(9),_=r(x),k=n(8),O=r(k),I=n(3),T=r(I),j=n(1),A=r(j),M=n(2),G=r(M),V=n(5),z=r(V),S=n(4),C=r(S),P=n(20),N=r(P),R=(s=(0,P.recoverFromNotFound)(),u=(0,P.recoverFromNotFound)(),c=(0,P.recoverFromNotFound)(),l=(0,P.recoverFromNotFound)(),f=(0,P.recoverFromNotFound)(),d=(0,P.recoverFromNotFound)(),p=function(e){function t(){return(0,A.default)(this,t),(0,z.default)(this,(t.__proto__||(0,T.default)(t)).apply(this,arguments))}return(0,C.default)(t,e),(0,G.default)(t,[{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(){var t;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.get("/mute");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"unmuteAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.del("/mute");case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"muteUser",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=o.recipientOrganizationId,u=void 0===s?r:s;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if("number"==typeof n){e.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return e.next=14,this.httpClient.post("/mute/p2p",{data:{sender_token:t,sender_organization:r,receiver_organization:u,duration:n.toString()}});case 14:case"end":return e.stop()}},e,this)}));return e}()},{key:"unmuteUser",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.recipientOrganizationId,s=void 0===o?n:o;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e.next=10,this.httpClient.del("/mute/p2p",{headers:{"TT-X-Sender-Token":t,"TT-X-Sender-Organization":n,"TT-X-Receiver-Organization":s}});case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"muteGroup",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(t,n,r){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if("number"==typeof n){e.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return e.next=14,this.httpClient.post("/mute/group/:groupId",{urlParams:{groupId:t},data:{duration:n.toString(),receiver_organization:r}});case 14:case"end":return e.stop()}},e,this)}));return e}()},{key:"unmuteGroup",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(t,n){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e.next=10,this.httpClient.del("/mute/group/:groupId",{urlParams:{groupId:t},headers:{"TT-X-Receiver-Organization":n}});case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"muteOrganization",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(t,n){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("number"==typeof n){e.next=8;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 8:return e.next=10,this.httpClient.post("/mute/organization/:organizationId",{urlParams:{organizationId:t},data:{duration:n.toString(),receiver_organization:t}});case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"unmuteOrganization",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,O.default)(_.default.mark(function e(t){return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.del("/mute/organization/:organizationId",{urlParams:{organizationId:t},headers:{"TT-X-Receiver-Organization":t}});case 6:case"end":return e.stop()}},e,this)}));return e}()}]),t}(N.default),o(p.prototype,"muteUser",[s],(0,E.default)(p.prototype,"muteUser"),p.prototype),o(p.prototype,"unmuteUser",[u],(0,E.default)(p.prototype,"unmuteUser"),p.prototype),o(p.prototype,"muteGroup",[c],(0,E.default)(p.prototype,"muteGroup"),p.prototype),o(p.prototype,"unmuteGroup",[l],(0,E.default)(p.prototype,"unmuteGroup"),p.prototype),o(p.prototype,"muteOrganization",[f],(0,E.default)(p.prototype,"muteOrganization"),p.prototype),o(p.prototype,"unmuteOrganization",[d],(0,E.default)(p.prototype,"unmuteOrganization"),p.prototype),p);t.default=R,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,p.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,h.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,p.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c,l=n(7),f=r(l),d=n(6),p=r(d),y=n(10),h=r(y),g=n(11),v=r(g),m=n(9),b=r(m),w=n(8),E=r(w),x=n(3),_=r(x),k=n(1),O=r(k),I=n(2),T=r(I),j=n(5),A=r(j),M=n(4),G=r(M),V=n(20),z=r(V),S=(s=(0,V.recoverFromNotFound)(),u=(0,V.recoverFromNotFound)(),c=function(e){function t(){return(0,O.default)(this,t),(0,A.default)(this,(t.__proto__||(0,_.default)(t)).apply(this,arguments))}return(0,G.default)(t,e),(0,T.default)(t,[{key:"find",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t,n){var r;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;
break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e.next=10,this.httpClient.get("/user/:userId/organization/:id",{urlParams:{userId:t,id:n}});case 10:return r=e.sent,e.abrupt("return",r.data);case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAllOfUser",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,E.default)(b.default.mark(function e(t){var n;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return e.next=6,this.httpClient.get("/user/:userId/organization",{urlParams:{userId:t}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)}));return e}()}]),t}(z.default),o(c.prototype,"find",[s],(0,v.default)(c.prototype,"find"),c.prototype),o(c.prototype,"findAllOfUser",[u],(0,v.default)(c.prototype,"findAllOfUser"),c.prototype),c);t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,f.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?a.trim()+"[]":"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,c.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var u="  ".repeat(t-1),l=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s.default)(n))+": "+o(e[n],t)+";"}).join("\n  "+u);return i.length>=r&&(l+="\n  "+u+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+u+l+"\n"+u+"}":"{\n  "+u+l+"\n"+u+"}"}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,f.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,c.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var u="  ".repeat(t-1),l=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+u);return i.length>=r&&(l+="\n  "+u+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+u+l+"\n"+u+"}":"{\n  "+u+l+"\n"+u+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(7),s=r(i),u=n(6),c=r(u),l=n(10),f=r(l),d=n(9),p=r(d),y=n(8),h=r(y),g=n(3),v=r(g),m=n(1),b=r(m),w=n(2),E=r(w),x=n(5),_=r(x),k=n(4),O=r(k),I=n(156),T=r(I),j=n(20),A=r(j),M=["user","distributionList"],G=function(e){function t(){return(0,b.default)(this,t),(0,_.default)(this,(t.__proto__||(0,v.default)(t)).apply(this,arguments))}return(0,O.default)(t,e),(0,E.default)(t,[{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,h.default)(p.default.mark(function e(){var t;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.get("/roster");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"add",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,h.default)(p.default.mark(function e(t,n,r){var i,s;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 8:if("string"==typeof n){e.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:if((0,T.default)(M,t)){e.next=14;break}return e.abrupt("return");case 14:return i={},r&&(i["TT-X-Organization-Key"]=r),s=this.__typeToNS(t),e.next=19,this.httpClient.post("/roster",{headers:i,data:{entity:n,type:s}});case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"remove",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,h.default)(p.default.mark(function e(t,n,r){var i,s;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 8:if("string"==typeof n){e.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:if((0,T.default)(M,t)){e.next=14;break}return e.abrupt("return");case 14:return i={},r&&(i["TT-X-Organization-Key"]=r),s=this.__typeToNS(t),e.next=19,this.httpClient.del("/roster/:counterPartyId",{headers:i,urlParams:{counterPartyId:n},data:{type:s}});case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"__typeToNS",value:function(e){return V[e]}}]),t}(A.default);t.default=G;var V={user:"tigertext:entity:account",distributionList:"tigertext:entity:list"};e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,d.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,d.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c=n(7),l=r(c),f=n(6),d=r(f),p=n(10),y=r(p),h=n(11),g=r(h),v=n(12),m=r(v),b=n(9),w=r(b),E=n(8),x=r(E),_=n(3),k=r(_),O=n(1),I=r(O),T=n(2),j=r(T),A=n(5),M=r(A),G=n(4),V=r(G),z=n(20),S=r(z),C=n(67),P=r(C),N=n(46),R=r(N),U=n(64),q=r(U),F=(s=(0,z.recoverFromNotFound)(),u=function(e){function t(){return(0,I.default)(this,t),(0,M.default)(this,(t.__proto__||(0,k.default)(t)).apply(this,arguments))}return(0,V.default)(t,e),(0,j.default)(t,[{key:"getSignInAuthHeader",value:function(){var e;return(e=this.constructor).getSignInAuthHeader.apply(e,arguments)}},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(t){var n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=o.organizationId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return(0,q.default)(t)&&(t=t.toLowerCase()),n=s?{"TT-X-Organization-Key":s}:null,e.next=8,this.httpClient.get("/user/:id",{urlParams:{id:t},headers:n});case 8:return r=e.sent,e.abrupt("return",r.data);case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"findMe",value:function(){function e(){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(){var t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=r.organizationId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=o?{"TT-X-Organization-Key":o}:null,e.next=3,this.httpClient.get("/user",{headers:t});case 3:return n=e.sent,e.abrupt("return",n.data);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"update",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(t,n){var r,o,s,u=n.firstName,c=void 0===u?void 0:u,l=n.lastName,f=void 0===l?void 0:l,d=n.displayName,p=void 0===d?void 0:d,y=n.status,h=void 0===y?void 0:y,g=n.dnd,v=void 0===g?void 0:g,b=n.dndText,E=void 0===b?void 0:b,x=n.avatarFile,_=void 0===x?void 0:x,k=n.removeAvatar,O=void 0===k?void 0:k;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return o={},O?o.avatar=null:_&&(o.avatar=_),s=(r={first_name:c,last_name:f,display_name:p,status:h,dnd:v,dnd_text:E},P.default).call(r,function(e,t){return"undefined"==typeof e}),e.next=9,this.httpClient.post("/user/:id/settings",{urlParams:{id:t},data:s,files:o});case 9:return e.abrupt("return",(0,m.default)({id:t},_&&_.preview?{avatarUrl:_.preview}:null));case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"updatePassword",value:function(){function e(e,n,r,o){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(t,n,r,o){var s,u;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof o){e.next=8;break}throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(o));case 8:if("string"==typeof t){e.next=10;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 10:if("string"==typeof n){e.next=12;break}throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 12:if("string"==typeof r){e.next=14;break}throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 14:if("string"==typeof o){e.next=16;break}throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(o));case 16:return s={Authorization:this.getSignInAuthHeader(o,t,n)},e.next=19,this.httpClient.post("/user/:id/password",{urlParams:{id:t},headers:s,data:{password:r}});case 19:return u=e.sent,e.abrupt("return",u);case 21:case"end":return e.stop()}},e,this)}));return e}()}],[{key:"getSignInAuthHeader",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=[e,t,n].join(":"),o=(0,R.default)(r),s="XMPP-Simple "+o;return s}}]),t}(S.default),o(u.prototype,"find",[s],(0,g.default)(u.prototype,"find"),u.prototype),u);t.default=F,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Roster:n(85),Users:n(86),Groups:n(80),DistributionLists:n(79),Organizations:n(84),Messages:n(81),Metadata:n(82),Mute:n(83)};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(3),s=r(i),u=n(1),c=r(u),l=n(5),f=r(l),d=n(4),p=r(d),y=(a=o=function(e){function t(){(0,c.default)(this,t);var e=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,"No internet connection"));return e.code=t.CODE,e}return(0,p.default)(t,e),t}(Error),o.CODE="connection-unavailable",a);t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(3),s=r(i),u=n(1),c=r(u),l=n(5),f=r(l),d=n(4),p=r(d),y=(a=o=function(e){function t(e,n,r){(0,c.default)(this,t);var o=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,r));return o.code=t.CODE,o.resource=e,o.id=n,o}return(0,p.default)(t,e),t}(Error),o.CODE="not-found",a);t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(3),s=r(i),u=n(1),c=r(u),l=n(5),f=r(l),d=n(4),p=r(d),y=(a=o=function(e){function t(){var e;(0,c.default)(this,t);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];var a=(0,f.default)(this,(e=t.__proto__||(0,s.default)(t)).call.apply(e,[this].concat(r)));return a.code=t.CODE,a}return(0,p.default)(t,e),t}(Error),o.CODE="not-signed-in",a);t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(3),s=r(i),u=n(1),c=r(u),l=n(5),f=r(l),d=n(4),p=r(d),y=(a=o=function(e){function t(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"can't perform action "+r+" on "+(e.name||e)+" #"+n;(0,c.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,o));return a.code=t.CODE,a.resource=e,a.action=r,a.id=n,a}return(0,p.default)(t,e),t}(Error),o.CODE="permission-denied",a);t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(3),s=r(i),u=n(1),c=r(u),l=n(2),f=r(l),d=n(5),p=r(d),y=n(4),h=r(y),g=(a=o=function(e){function t(e){return(0,c.default)(this,t),(0,p.default)(this,(t.__proto__||(0,s.default)(t)).call(this,"method"+(e?" "+e:"")+" not supported in target node"))}return(0,h.default)(t,e),(0,f.default)(t,null,[{key:"raise",value:function(e){throw new this(e)}}]),t}(Error),o.CODE="target-not-supported",a);t.default=g,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a,i=n(3),s=r(i),u=n(1),c=r(u),l=n(5),f=r(l),d=n(4),p=r(d),y=(a=o=function(e){function t(){var e;(0,c.default)(this,t);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];var a=(0,f.default)(this,(e=t.__proto__||(0,s.default)(t)).call.apply(e,[this].concat(r)));return a.code=t.CODE,a}return(0,p.default)(t,e),t}(Error),o.CODE="wrong-credentials",a);t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(41),a=r(o);t.default=function(e){var t=e.defineModel("conversation",{instanceEvents:!0,fields:{counterPartyType:{type:String,required:!0},counterPartyId:{type:String,required:!0},organizationId:{type:String,required:!0}},transientAttrs:["messages","timeline","lastMessage","unreadCount","unreadMessages","lastEventMessageSortNumber","_counterPartyAddedOnServer","unreadPriorityCount"],defaultValues:{lastEventMessageSortNumber:0,messages:[],timeline:[],unreadMessages:[],unreadCount:0,unreadPriorityCount:0},computed:{counterParty:{enumerable:!0,get:function(){return this.counterPartyType&&this.counterPartyId?e.store.get(this.counterPartyType,this.counterPartyId):null},set:function(e){if(e)switch(e.$entityType){case"user":case"group":case"distributionList":this.counterPartyId=e.id,this.counterPartyType=e.$entityType;break;default:throw new Error("unsupported counterPartyType '"+e.$entityType+"'")}else this.counterPartyId=null,this.counterPartyType=null}},lastMessageId:{enumerable:!0,get:function(){return(0,a.default)(this.lastMessage,"id")}},muteSettings:{enumerable:!0,get:function(){return e.host.mute.getByConversationId(this.id)}},isMuted:{enumerable:!0,get:function(){return!!this.muteSettings}}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}});return t},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.defineModel("distributionList",{replaceKeys:{organizationKey:"organizationId",totalMembers:"memberCount",avatar:"avatarUrl",displayName:"name"},fields:{name:{type:String,required:!0},organizationId:{type:String,required:!0}},defaultValues:{memberCount:0},computed:{displayName:{configurable:!0,enumerable:!0,get:function(){return this.name},set:function(e){return this.name=e}}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}});return(0,a.default)(n,{finder:function(){var e;return(e=t.host.distributionLists).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return e.host.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return e.host.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{name:"Loading Distribution List..."},defaultNotFoundAttrs:{name:"<Distribution List Not Found>"}}),n};var o=n(36),a=r(o);e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(18),a=r(o),i=n(30),s=r(i),u=n(1),c=r(u),l=n(2),f=r(l),d=function(){function e(t,n,r,o){if((0,c.default)(this,e),this.id=t,this.type=n,this.data=r,o){var i=o._origData,u=(0,s.default)(o,["_origData"]);Object.defineProperty(this,"_origData",{get:function(){return i}}),(0,a.default)(this,u)}}return(0,f.default)(e,null,[{key:"is",value:function(e){return e instanceof this}}]),e}();t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(41),a=r(o);t.default=function(e,t){function n(e,n){n&&t.host.groups.ensureMembersWithIds(e,n,{onlyPlaceholder:!0})}var r=e.defineModel("group",{replaceKeys:{organizationKey:"organizationId",createdBy:"createdByUserId",members:"memberIds",avatar:"avatarUrl",displayName:"name",numMembers:"__memberCount",createdTime:"createdAt"},fields:{name:{type:String,required:!0},description:{type:String,required:!0},organizationId:{type:String,required:!0},createdByUserId:{type:String},avatarUrl:{type:String},createdAt:{type:Date},replayHistory:{type:Boolean},isPublic:{type:Boolean},memberIds:{type:[Number]},memberCount:{type:Number},groupType:{type:"enum",enum:u.GroupType}},transientAttrs:["__memberCount"],defaultValues:{memberIds:[],memberCount:0,groupType:u.GroupType.GROUP},validate:function(){l.default.notEmpty("groupType",this.groupType)},__extractGroupTypeFromAttrs:function(e){return e.isPublic?u.GroupType.ROOM:null},parseAttrs:function(e){var t=this.__extractGroupTypeFromAttrs(e);return t&&(e.groupType=t),"createdAt"in e&&(e.createdAt=new Date(e.createdAt)),e},beforeCreateInstance:function(e){n(e.id,e.memberIds)},computed:{memberCount:{enumerable:!0,get:function(){return this.memberIds&&this.memberIds.length||this.__memberCount||0}},metadata:{enumerable:!0,get:function(){var t=e.store.get("metadata",this.id+":"+this.organizationId);return t?t.data:null}},members:{enumerable:!0,get:function(){return this.memberIds?this.memberIds.map(function(t){return e.store.get("user",t)}):[]}},conversation:{enumerable:!0,get:function(){return t.host.conversations.get("group",this.id,this.organizationId)}},conversationId:{enumerable:!0,get:function(){return(0,a.default)(t.host.conversations.get("group",this.id,this.organizationId),"id")}},displayName:{configurable:!0,enumerable:!0,get:function(){return this.name},set:function(e){return this.name=e}}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"},createdByUser:{type:"user",foreignKey:"createdByUserId"}}}});return(0,s.default)(r,{finder:function(){var e;return(e=t.host.groups).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return e.host.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return e.host.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{displayName:"Loading group..."},defaultNotFoundAttrs:{displayName:"<Group Not Found>"},shouldEnsure:function(e,n,r){var o=r.groupMembersOnlyPlaceholder;return e.members.some(function(e){return t.host.models.User.shouldEnsure(e,o)})}}),r};var i=n(36),s=r(i),u=n(23),c=n(27),l=r(c);e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.defineModel("groupMembersChange",{fields:{action:{type:String,required:!0}},computed:{members:{enumerable:!0,get:function(){return this.memberIds?this.memberIds.map(function(t){return e.store.get("user",t)}):[]}}}});return t},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=r(o),i=n(148),s=r(i);t.default=function(e){var t=e.defineModel("message",{replaceKeys:{messageId:"id",clientId:"id",senderToken:"senderId",sender:"senderId",recipientToken:"recipientId",recipient:"recipientId",senderOrganization:"senderOrganizationId",recipientOrganization:"recipientOrganizationId",groupToken:"groupId",originalSender:"originalSenderId",originalTimestamp:"originalForwardedMessageCreatedAt",status:"recipientStatus",data:"metadata",dor:"deleteOnRead",createdTime:"createdAt"},fields:{conversationId:{type:String,required:!0},messageType:{type:"enum",enum:u.MessageType,required:!0},counterPartyId:{type:String,required:!0},counterPartyType:{type:"enum",enum:["user","group","distributionList"],required:!0},body:{type:String},senderOrganizationId:{type:String,required:!0},recipientOrganizationId:{type:String,required:!0},sortNumber:{type:Number,required:!0},createdAt:{type:Date,required:!0},senderId:{type:String,required:!0},direction:{type:"enum",enum:u.MessageDirection,required:!0},senderStatus:{type:"enum",enum:u.MessageSenderStatus,required:!0},recipientStatus:{type:"enum",enum:u.MessageRecipientStatus},$synced:{type:Boolean,required:!0},serverId:{type:String},metadata:{type:Array},priority:{type:"enum",enum:u.MessagePriority},deleteOnRead:{type:Boolean},ttl:{type:Number},groupId:{type:String},recipientId:{type:String},distributionListId:{type:String}},transientAttrs:["groupMembersChange"],defaultValues:{recipientStatus:u.MessageRecipientStatus.NEW,senderStatus:u.MessageRecipientStatus.NEW,sortNumber:0,messageType:u.MessageType.USER_SENT},skipCamelizationForKeys:["metadata"],parseAttrs:function(e){if(e.recipientStatus&&(e.recipientStatus=u.MessageRecipientStatus.resolve(e.recipientStatus)),"attachmentName"in e){var t=e.attachmentName;delete e.attachmentName,"undefined"!==t&&Array.isArray(e.attachments)&&e.attachments.length>0&&t&&(e.attachments[0].name=t)}if(Array.isArray(e.attachments)&&e.attachments.forEach(function(e,t){return e.id=""+(t+1)}),"priority"in e&&(e.priority=u.MessagePriority.resolve(e.priority)),"createdAt"in e&&"string"==typeof e.createdAt&&(e.createdAt=new Date(e.createdAt)),"ttl"in e&&e.createdAt){var n=(0,l.default)(e.createdAt).add(e.ttl,"minute").toDate().getTime();e.expiresAt=n}return"metadata"in e&&(e.metadata=(0,s.default)(e.metadata).map(function(e){if("application/json"===e.mimetype&&"string"==typeof e.payload){var t=void 0;try{t=JSON.parse(e.payload)}catch(t){return console.warn("Payload invalid",e),null}return(0,a.default)({},e,{payload:t})}return e}).filter(Boolean)),e},beforeInject:function(e,t){t&&"group"===t.counterPartyType&&t.recipientStatus!==u.MessageRecipientStatus.NEW&&e.recipientStatus===u.MessageRecipientStatus.NEW&&delete e.recipientStatus},relations:{belongsTo:{sender:{type:"user",foreignKey:"senderId"},recipient:{type:"user",foreignKey:"recipientId"},originalSender:{type:"user",foreignKey:"originalSenderId"},senderOrganization:{type:"organization",foreignKey:"senderOrganizationId"},recipientOrganization:{type:"organization",foreignKey:"recipientOrganizationId"},group:{type:"group",foreignKey:"groupId"},distributionList:{type:"distributionList",foreignKey:"distributionListId"},conversation:{type:"conversation",foreignKey:"conversationId"}},hasMany:{statusesPerRecipient:{type:"messageStatusPerRecipient",foreignKey:"messageId"}}},computed:{counterParty:{enumerable:!0,get:function(){return this.counterPartyType&&this.counterPartyId?e.store.get(this.counterPartyType,this.counterPartyId):null},set:function(e){if(e){switch(e.$entityType){case"user":this.recipientId=e.id;break;case"group":this.groupId=e.id;break;case"distributionList":this.distributionListId=e.id;break;default:throw new Error("unsupported counterPartyType '"+e.$entityType+"'")}this.counterPartyId=e.id,this.counterPartyType=e.$entityType}else this.counterPartyId=null,this.counterPartyType=null}}}});return t};var u=n(23),c=n(55),l=r(c);e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.defineModel("messageStatusPerRecipient",{replaceKeys:{accountId:"userId",timestamp:"createdAt"},defaultValues:{status:a.default.NEW},fields:{userId:{type:String,required:!0},messageId:{type:String,required:!0},status:{type:"enum",enum:a.default,required:!0},createdAt:{type:Date,required:!0}},parseAttrs:function(e){return e.status&&(e.status=a.default.resolve(e.status)),e},relations:{belongsTo:{message:{type:"message",foreignKey:"messageId"},user:{type:"user",foreignKey:"userId"}}}});return t};var o=n(57),a=r(o);e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.defineModel("metadata",{fields:{entityId:{type:String,required:!0},organizationId:{type:String,required:!0},data:{type:Object,required:!0}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}},parseAttrs:function(e,t){return e.data=t.data,e}});return n},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.defineModel("organization",{instanceEvents:!0,replaceKeys:{members:"memberCount",dor:"deleteOnRead"},fields:{name:{type:String,required:!0}},defaultValues:{conversations:[],settings:{}},transientAttrs:["conversations","unreadCount","unreadPriorityCount"],parseAttrs:function(e){if(e.settings){var t;e.settings=(t=(t=e.settings,c.default).call(t,function(e){return s.default.camelizeKey(e.name)}),f.default).call(t,function(e){isFinite(e.value)&&(e.value=+e.value),"true"===e.value&&(e.value=!0),"false"===e.value&&(e.value=!1)})}return e},methods:{getSettingValue:function(e){return this.settings&&e in this.settings?this.settings[e].value:null},getSettingEntry:function(e){return this.settings&&e in this.settings?this.settings[e]:null}}});return(0,a.default)(n,{finder:function(){var e;return(e=t.host.organizations).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return e.host.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return e.host.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{name:"Loading Organization..."},defaultNotFoundAttrs:{displayName:"<Organization Not Found>"}}),n};var o=n(36),a=r(o),i=n(37),s=r(i),u=n(66),c=r(u),l=n(141),f=r(l);
e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(1),a=r(o),i=n(2),s=r(i),u=function(){function e(t,n){(0,a.default)(this,e),this.id="searchResult:"+n+":"+t.id,this.entityType=t.$entityType,this.entityId=t.id,this.entity=t,this.organizationId=n}return(0,s.default)(e,null,[{key:"is",value:function(e){return e instanceof this}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=r(o),i=n(33),s=r(i),u=n(34),c=r(u);t.default=function(e,t){var n=e.defineModel("user",{transientAttrs:[],replaceKeys:{avatar:"avatarUrl",organizationToken:"organizationId",organizationKey:"organizationId",timeToLive:"messagesTTL"},fields:{displayName:{type:String,required:!0},status:{type:String},timeToLive:{type:String},deleteOnRead:{type:Boolean},firstName:{type:String},lastName:{type:String},username:{type:String},avatarUrl:{type:String},dnd:{type:Boolean},dndText:{type:String},distinguishedName:{type:String},title:{type:String},department:{type:String}},defaultValues:{profileByOrganizationId:{}},parseAttrs:function(e){var t=e.organizationId;if(t){delete e.organizationId;var n=(0,a.default)({},(0,c.default)(e,w),{organizationId:t});(0,s.default)(n)||(e.profileByOrganizationId||(e.profileByOrganizationId={}),e.profileByOrganizationId[t]=n)}return e},beforeInject:function(e,t){t&&e.profileByOrganizationId&&(e.profileByOrganizationId=(0,a.default)({},t.profileByOrganizationId,e.profileByOrganizationId))},computed:{metadataByOrganizationId:{enumerable:!0,get:function(){var t;return(t=(t=(t=e.store.getAll("metadata"),h.default).call(t,{entityId:this.id}),v.default).call(t,"organizationId"),b.default).call(t,"data")}},presence:{enumerable:!0,get:function(){return e.host.presence.get(this.id)||p.default.UNKNOWN}}}});return(0,f.default)(n,{finder:function(){var e;return(e=t.host.users).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return e.host.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return e.host.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{displayName:"Loading..."},defaultNotFoundAttrs:{displayName:"<User Not Found>"}}),n};var l=n(36),f=r(l),d=n(58),p=r(d),y=n(32),h=r(y),g=n(66),v=r(g),m=n(145),b=r(m),w=["title","department"];e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(21),a=r(o),i=new a.default(["GROUP","ROOM"]);t.default=i,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(21),a=r(o),i=new a.default(["INCOMING","OUTGOING"]);t.default=i,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),o=new r.ServerValueEnum({LOW:{serverValue:-1},NORMAL:{serverValue:0},HIGH:{serverValue:1}},{defaultValue:"NORMAL"});t.default=o,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(21),a=r(o),i=new a.default(["SENDING","SENT","FAILED","RETRYING","NEW","NA"]);t.default=i,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(21),a=r(o),i=new a.default(["USER_SENT","GROUP_MEMBERSHIP_CHANGE"]);t.default=i,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={User:n(104),Group:n(97),DistributionList:n(95),Organization:n(102),Message:n(99),MessageStatusPerRecipient:n(100),GroupMembersChange:n(98),Conversation:n(94),Metadata:n(101)};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,E.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,b.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,v.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,E.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,b.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,v.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c,l,f,d,p,y,h,g=n(7),v=r(g),m=n(6),b=r(m),w=n(10),E=r(w),x=n(11),_=r(x),k=n(30),O=r(k),I=n(9),T=r(I),j=n(16),A=r(j),M=n(39),G=r(M),V=n(8),z=r(V),S=n(3),C=r(S),P=n(1),N=r(P),R=n(2),U=r(R),q=n(5),F=r(q),$=n(4),L=r($),D=n(38),B=r(D),K=n(70),Z=r(K),W=n(163),H=r(W),X=n(53),Q=r(X),Y=n(51),J=r(Y),ee=n(19),te=r(ee),ne=n(54),re=r(ne),oe=n(13),ae=r(oe),ie=n(17),se=n(65),ue=r(se),ce=n(24),le=r(ce),fe=n(14),de=n(23),pe=n(139),ye=r(pe),he=n(27),ge=r(he),ve=n(25),me=r(ve),be=n(50),we=r(be),Ee=n(32),xe=r(Ee),_e=n(49),ke=r(_e),Oe=n(48),Ie=r(Oe),Te=n(69),je=r(Te),Ae=n(22),Me="tigertext:entity:account",Ge=new ue.default.MD5,Ve=(s={},(0,B.default)(s,"ADD","added"),(0,B.default)(s,"REMOVE","removed"),(0,B.default)(s,"LEAVE","left"),(0,B.default)(s,"JOIN","joined"),s),ze=(u={},(0,B.default)(u,"ADD","to"),(0,B.default)(u,"REMOVE","from"),u),Se=(c={},(0,B.default)(c,"GROUP","group"),(0,B.default)(c,"ROOM","room"),c),Ce=(l=(0,ie.decorator)(),f=(0,ie.decorator)(),d=(0,ie.decorator)(),p=(0,ie.decorator)(),(0,fe.classWithPrivateMethods)((h=function(e){function t(){var e;(0,N.default)(this,t);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];var a=(0,F.default)(this,(e=t.__proto__||(0,C.default)(t)).call.apply(e,[this].concat(r)));return a._throttled__flushConversationsToReload=a.config.conversationReloadDelay?(0,re.default)(a.__flushConversationsToReload,a.config.conversationReloadDelay,{leading:!1}):a.__flushConversationsToReload,a}return(0,L.default)(t,e),(0,U.default)(t,[{key:"mounted",value:function(){this._fetched=!1,this.host.on("message:sending",this._onMessageSending),this.host.on("message:sent",this._onMessageSent),this.host.models.Message.on("afterInject",this._onMessageChange),this.host.models.Message.on("afterEject",this._onMessageChange),this.host.models.Group.on("afterEject",this._onGroupDelete),this.__queuedConversationsToReload=[]}},{key:"dispose",value:function(){this._fetched=!1,this.host.removeListener("message:sending",this._onMessageSending),this.host.removeListener("message:sent",this._onMessageSent),this.host.models.Message.off("afterInject",this._onMessageChange),this.host.models.Message.off("afterEject",this._onMessageChange),this.host.models.Group.off("afterEject",this._onGroupDelete),this.__queuedConversationsToReload=null,this._throttled__flushConversationsToReload.cancel&&this._throttled__flushConversationsToReload.cancel()}},{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,z.default)(T.default.mark(function e(){var t,n,r,o,a,i=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(0,te.default)(s,{includeMutes:!0}),!this._fetched){e.next=3;break}return e.abrupt("return",this.getAll());case 3:return e.next=5,A.default.all([this.host.api.roster.findAll(),s.includeMutes?this.host.mute.findAll():A.default.resolve()]);case 5:return t=e.sent,n=(0,G.default)(t,1),r=n[0],o=r.slice(),r.forEach(function(e,t){e.type===Me&&(o[t]={counterParty:i.host.injectModel(e),organizationId:e.organization_key})}),r.forEach(function(e,t){e.type!==Me&&(o[t]={counterParty:i.host.injectModel(e),organizationId:e.organization_key})}),a=o.filter(Boolean).map(function(e){var t=e.counterParty,n=e.organizationId;delete t.$placeholder;var r=i.ensureConversation(t.$entityType,t.id,n,{ensureEntities:{organization:"full"}});return r._counterPartyAddedOnServer=!0,r}),this._fetched=!0,e.abrupt("return",a);case 14:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,z.default)(T.default.mark(function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(r=(0,J.default)(r,{ensureEntities:{counterParty:"full",organization:"full",messageCounterParties:"full",groupMembers:"full",touchOnRelatedEntityLoad:!1}}),n=this.getById(t),!n){e.next=10;break}return e.next=9,this.__ensureEntities(n,r.ensureEntities);case 9:return e.abrupt("return",n);case 10:return e.next=12,this.findAll();case 12:if(n=this.getById(t)){e.next=15;break}throw new errors.NotFoundError(this.host.models.Conversation.name,t);case 15:return e.next=17,this.__ensureEntities(n,r.ensureEntities);case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}},e,this)}));return e}()},{key:"refetch",value:function(){function e(){return t.apply(this,arguments)}var t=(0,z.default)(T.default.mark(function e(){return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._fetched=!1,e.abrupt("return",this.findAll());case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"markAllMessagesAsRead",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,z.default)(T.default.mark(function e(t){var n;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:if(t=this._resolveModelId(t),n=this.getById(t)){e.next=8;break}return e.abrupt("return");case 8:return e.abrupt("return",this.host.messages.markAsRead(n.unreadMessages));case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"add",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,z.default)(T.default.mark(function e(t,n,r){var o;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if("string"==typeof n){e.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return o=this.ensureConversation(t,n,r),e.prev=13,e.next=16,this.host.api.roster.add(t,n,r);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(13),this.logger.warn("can't add "+n+" "+t,e.t0);case 21:o._counterPartyAddedOnServer=!0;case 22:case"end":return e.stop()}},e,this,[[13,18]])}));return e}()},{key:"remove",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,z.default)(T.default.mark(function e(t,n,r){return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if("string"==typeof n){e.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return this.ejectConversation(t,n,r),e.prev=13,e.next=16,this.host.api.roster.remove(t,n,r);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(13),this.logger.warn("can't remove "+n+" "+t);case 21:case"end":return e.stop()}},e,this,[[13,18]])}));return e}()},{key:"ensureConversation",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));r=(0,J.default)(r,{ensureEntities:{counterParty:!1,organization:!1,messageCounterParties:!1,groupMembers:!1,touchOnRelatedEntityLoad:!0}});var o=this.getConversationKey(e,t,n),s=this.get(e,t,n);return s?(this.__ensureEntities(s,r.ensureEntities),s):(s=this.host.models.Conversation.createInstance({id:o,counterPartyType:e,counterPartyId:t,organizationId:n,_origIndex:this.host.models.Conversation.getAll().length}),this.__ensureEntities(s,r.ensureEntities),this.host.models.Conversation.inject(s),this.__notifyOrganizationChange(s.organizationId),s)}},{key:"ejectConversation",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=this.get(e,t,n);return r&&(this.host.models.Conversation.eject(r),this.__notifyOrganizationChange(r.organizationId)),r}},{key:"reactToMessageEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.host.currentUserId,n=this.host.models.Message.parseAttrs(e.data);n.messageType=de.MessageType.USER_SENT,n.direction=n.senderId===t?de.MessageDirection.OUTGOING:de.MessageDirection.INCOMING,n.groupId?(n.counterPartyType="group",n.counterPartyId=n.groupId):n.recipientId&&(n.counterPartyType="user",n.counterPartyId=n.senderId===t?n.recipientId:n.senderId),n.direction===de.MessageDirection.OUTGOING?n.senderStatus=de.MessageSenderStatus.SENT:n.senderStatus=de.MessageSenderStatus.NA;var r=this.host.conversations.ensureConversation(n.counterPartyType,n.counterPartyId,n.recipientOrganizationId,{ensureEntities:{counterParty:"placeholder",groupMembers:"placeholder",organization:"full"}});n.conversationId=r.id;var o=this.host.models.Message.createInstance(n),s=o.senderId===t?o.recipientId:o.senderId;s&&this.__ensureMessageCounterParty(r,s,{messageCounterParties:this.host.currentlyServingOfflineMessages?"placeholder":"full",touchOnRelatedEntityLoad:!0}),this.host.models.Message.inject(o),this.emit("message",o),this.__addConversationCounterPartyToServerRosterIfShould(r),this.__queueReload(r),r.emit("message",o),this.__notifyOrganizationChange(r.organizationId),o.senderId!==t&&o.recipientStatus!==de.MessageRecipientStatus.READ&&o.recipientStatus!==de.MessageRecipientStatus.DELIVERED&&this.host.messages.markAsReceived(o)}},{key:"reactToFriendsEvent",value:function(e){var t=e.data.friend,n=t.action,r=t.organization_id,o=(0,O.default)(t,["action","organization_id"]),a=r,i=this.host.modelByTypeNS(o.xmlns);if(!i)return void this.logger.error("Class "+o.xmlns+" not found");switch(n){case"add":"group"===i.name&&(o.organizationId=a);var s=this.host.injectModel(o);this.__addedByCounterParty(s,a);break;case"del":this.__removedByCounterParty(i.name,o.token,a);break;default:this.logger.error("friends action not implemented",n,e.data)}}},{key:"_onMessageSending",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId,{ensureEntities:{counterParty:"full",organization:"full",messageCounterParties:"full",groupMembers:"full",touchOnRelatedEntityLoad:!0}});this.__addConversationCounterPartyToServerRosterIfShould(t),this.__reloadConversation(t),this.__notifyOrganizationChange(t.organizationId)}},{key:"_onMessageSent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=this.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId);this.__reloadConversation(t),t.emit("message",e)}},{key:"_onMessageChange",value:function(e,t){t.conversation&&this.__queueReload(t.conversation)}},{key:"_onGroupDelete",value:function(e,t){this.ejectConversation("group",t.id,t.organizationId)}},{key:"__queueReload",value:function(e){!this.__queuedConversationsToReload.includes(e)&&this.__queuedConversationsToReload.push(e),this._throttled__flushConversationsToReload()}},{key:"__flushConversationsToReload",value:function(){var e=this;this.__queuedConversationsToReload.forEach(function(t){return e.__reloadConversation(t)}),this.__queuedConversationsToReload.length=0,this.emit("_reloadQueueFinished")}},{key:"hasPendingReloads",value:function(){return this.__queuedConversationsToReload&&this.__queuedConversationsToReload.length>0}},{key:"__reloadConversation",value:function(e){var t,n=this,r={},o=(t=(t=(t=this.host.models.Message.getAll(),xe.default).call(t,{conversationId:e.id}),ke.default).call(t,function(e){return n.host.config.hiddenUsers.length>0&&(n.host.config.hiddenUsers.includes(e.senderId)||n.host.config.hiddenUsers.includes(e.conversation.counterPartyId))}),Ie.default).call(t,["sortNumber"],["asc"]),a=(0,Q.default)(o,{messageType:de.MessageType.USER_SENT});r.timeline=o,r.messages=a,r.lastMessage=(0,H.default)(a),r.unreadMessages=a.filter(function(e){return e.direction===de.MessageDirection.INCOMING&&(e.recipientStatus===de.MessageRecipientStatus.NEW||e.recipientStatus===de.MessageRecipientStatus.DELIVERED)}),r.unreadCount=r.unreadMessages.length,r.lastEventMessageSortNumber=r.lastMessage&&r.lastMessage.sortNumber||0,r.unreadPriorityCount=a.filter(function(e){return e.direction===de.MessageDirection.INCOMING&&"HIGH"===e.priority&&(e.recipientStatus===de.MessageRecipientStatus.NEW||e.recipientStatus===de.MessageRecipientStatus.DELIVERED)}).length,(0,Z.default)(e,r),this.__touch(e.id),e.emit("change"),this.emit("change",e)}},{key:"__notifyOrganizationChange",value:function(e){var t=this.host.models.Organization.get(e);t&&t.emit("change")}},{key:"__addConversationCounterPartyToServerRosterIfShould",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));e&&(e._counterPartyAddedOnServer||this.add(e.counterPartyType,e.counterPartyId,e.organizationId))}},{key:"addMembershipChangeLog",value:function(e){var t=void 0;if(e.actorId===this.host.currentUserId&&"LEAVE"===e.action){if(t=this.get("group",e.group.id,e.group.organizationId),!t)return}else t=this.ensureConversation("group",e.group.id,e.group.organizationId);var n=this.host.models.GroupMembersChange.inject({id:e.id+":groupMembersChange",action:e.action,memberIds:e.memberIds});this.host.models.Message.inject({id:e.id,conversationId:t.id,groupId:e.groupId,sortNumber:e.sortNumber,messageType:de.MessageType.GROUP_MEMBERSHIP_CHANGE,senderId:e.actorId,recipient:this.host.currentUser,direction:de.MessageDirection.INCOMING,groupMembersChange:n,body:this.__generateGroupMembershipChangeBody(e),createdAt:e.createdAt}),this.__reloadConversation(t)}},{key:"__generateGroupMembershipChangeBody",value:function(e){var t=Ve[e.action],n=ze[e.action]||"",r=null;return"ADD"!==e.action&&"REMOVE"!==e.action||(r=(0,ye.default)(e.members.filter(Boolean).map(function(e){return e.displayName}))),[e.actor.displayName,t,r,n,"this",Se[e.group.groupType]].filter(Boolean).join(" ")}},{key:"getMessageConversationKey",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if(e.groupId)return this.conversationHashForListEnityId(e.groupId);if(e.distributionListId)return this.conversationHashForListEnityId(e.distributionListId);var t=e.senderId===this.host.currentUserId?e.recipientId:e.senderId;return this.conversationHashForUserMessage(t,e.senderOrganizationId,e.recipientOrganizationId)}},{key:"getConversationKey",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(n));if(null!=r&&"string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(r));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(n));if(null!=r&&"string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(r));switch(e){case"user":return this.conversationHashForUserMessage(t,n,r);case"group":case"distributionList":return this.conversationHashForListEnityId(t);default:throw new Error("type "+e+" not supported in conversation")}}},{key:"conversationHashForUserMessage",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(n));var r=[e,t,n].join(":");return Ge.b64(r)}},{key:"conversationHashForListEnityId",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return Ge.b64(e)}},{key:"conversationHashForGroupId",value:function(){return this.conversationHashForListEnityId.apply(this,arguments)}},{key:"conversationHashForDistributionListId",value:function(){return this.conversationHashForListEnityId.apply(this,arguments)}},{key:"looksLikeConversationId",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return/^[a-zA-Z0-9\/+=]{24}$/.test(e)}},{key:"findConversationWithUser",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,z.default)(T.default.mark(function e(t,n){return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e.abrupt("return",this.get(this.host.models.User.name,t,n));case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"findConversationWithGroup",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,z.default)(T.default.mark(function e(t,n){return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e.abrupt("return",this.get(this.host.models.Group.name,t,n));case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAllGroupConversationsWithMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,z.default)(T.default.mark(function e(t,n){var r,o=this;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return t=(0,Ae.arrayWrap)(t).map(this._resolveModelId.bind(this)),e.next=11,this.host.groups.findAllWithSpecificMembers(t,n);case 11:return r=e.sent,e.abrupt("return",r.map(function(e){return o.get(o.host.models.Group.name,e.id,n)}));case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"getWithUser",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{createIfNotFound:!1},r=n.createIfNotFound,o=void 0!==r&&r;if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));
if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));e=this._resolveModelId(e),t=this._resolveModelId(t);var s=this.conversationHashForUserMessage(e,t),u=this.getById(s);return!u&&o&&(u=this.ensureConversation("user",e,t)),u||null}},{key:"getWithListEntity",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{createIfNotFound:!1},r=n.createIfNotFound,o=void 0!==r&&r,s=n.organizationId;if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));t=this._resolveModelId(t);var u=this.conversationHashForListEnityId(t),c=this.getById(u);if(!c&&o){var l=this._resolveEntity(t,e);l?s=l.organizationId:ge.default.notEmpty("organizationId",s,"required when using createIfNotFound"),c=this.ensureConversation(e,t,s)}return c||null}},{key:"getWithGroup",value:function(e){return this.getWithListEntity("group",e)}},{key:"getWithDistributionList",value:function(e){return this.getWithListEntity("distributionList",e)}},{key:"get",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));var r=this.getConversationKey(e,t,n),o=this.host.models.Conversation.get(r);return o||null}},{key:"getAll",value:function(){return this.host.models.Conversation.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Conversation.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Conversation.getMulti(e)}},{key:"__addedByCounterParty",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));this.ensureConversation(e.$entityType,e.id,t)}},{key:"__removedByCounterParty",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));this.ejectConversation(e,t,n)}},{key:"__ensureEntities",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var r=[];return n.organization&&r.push(this.__ensureOrganization(e,n)),n.counterParty&&r.push(this.__ensureCounterParty(e,n)),n.messageCounterParties&&r.push(this.__ensureAllMessagesCounterParties(e,n)),r=r.filter(Boolean),r.length>0?A.default.all(r).then(function(){n.onLoad&&n.onLoad(),t.__touch(e)}).catch(function(e){return console.error(e)}):A.default.resolve()}},{key:"__ensureOrganization",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));return this.host.models.Organization.shouldEnsure(e.organization,"full"!==n.organization)?new A.default(function(r,o){t.host.models.Organization.ensureEntity(e.organizationId,{onlyPlaceholder:"placeholder"===n.organization,onMissing:function(){t.logger.info("org "+e.organizationId+" not found, created placeholder org"),e.$loadingOrganization=!0},onLoad:function(){t.logger.info("org "+e.organizationId+" loaded"),e.$loadingOrganization=!1,n.touchOnRelatedEntityLoad&&t.__touch(e)},onFinish:r})}):null}},{key:"__ensureCounterParty",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var r=this.host.modelsByEntityType[e.counterPartyType];return r.shouldEnsure(e.counterParty,"full"!==n.counterParty,{groupMembersOnlyPlaceholder:"full"!==n.groupMembers})?new A.default(function(o,a){var i={};switch(e.counterPartyType){case"user":break;case"group":case"distributionList":i.organizationId=e.organizationId;break;default:throw new Error("unsupported counterPartyType",e.counterPartyType)}var s=function(e){if("placeholder"!==n.counterParty&&"group"===r.name&&n.groupMembers)return t.host.groups.ensureMembers(e,{onlyPlaceholder:"placeholder"===n.groupMembers})};r.ensureEntity(e.counterPartyId,{attrs:i,onlyPlaceholder:"placeholder"===n.counterParty,onMissing:function(){t.logger.info("entry "+e.counterPartyId+" not found, created placeholder on org "+e.organizationId),e.$loadingCounterParty=!0},onLoad:function(){e.$loadingCounterParty=!1,n.touchOnRelatedEntityLoad&&t.__touch(e)},onFinish:function(){var e=(0,z.default)(T.default.mark(function e(n){return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n,!e.t0){e.next=4;break}return e.next=4,s(n);case 4:o();case 5:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}()})}):null}},{key:"__ensureAllMessagesCounterParties",value:function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var o=(t=(t=(t=e.messages,me.default).call(t,"senderId"),we.default).call(t),je.default).call(t,this.host.currentUserId,e.counterPartyId);return A.default.all(o.map(function(t){return n.__ensureMessageCounterParty(e,t,r)}))}},{key:"__ensureMessageCounterParty",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "messageOtherUserId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "messageOtherUserId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));var o=this.host.models.User.get(t);return this.host.models.User.shouldEnsure(o,"full"!==r.messageCounterParties)?new A.default(function(o,a){n.host.models.User.ensureEntity(t,{onlyPlaceholder:"placeholder"===r.messageCounterParties,onMissing:function(){n.logger.info("entry "+e.counterPartyId+" not found, created placeholder on org "+e.organizationId)},onLoad:function(){r.touchOnRelatedEntityLoad&&n.__touch(e)},onFinish:o})}):null}},{key:"__touch",value:function(e){this.host.models.Conversation.touch(e)}}]),t}(ae.default),o(h.prototype,"findAll",[l],(0,_.default)(h.prototype,"findAll"),h.prototype),o(h.prototype,"find",[f],(0,_.default)(h.prototype,"find"),h.prototype),o(h.prototype,"add",[d],(0,_.default)(h.prototype,"add"),h.prototype),o(h.prototype,"remove",[p],(0,_.default)(h.prototype,"remove"),h.prototype),o(h.prototype,"_onMessageSending",[fe.privateMethod,le.default],(0,_.default)(h.prototype,"_onMessageSending"),h.prototype),o(h.prototype,"_onMessageSent",[fe.privateMethod,le.default],(0,_.default)(h.prototype,"_onMessageSent"),h.prototype),o(h.prototype,"_onMessageChange",[fe.privateMethod,le.default],(0,_.default)(h.prototype,"_onMessageChange"),h.prototype),o(h.prototype,"_onGroupDelete",[fe.privateMethod,le.default],(0,_.default)(h.prototype,"_onGroupDelete"),h.prototype),o(h.prototype,"__queueReload",[fe.privateMethod],(0,_.default)(h.prototype,"__queueReload"),h.prototype),o(h.prototype,"__flushConversationsToReload",[fe.privateMethod,le.default],(0,_.default)(h.prototype,"__flushConversationsToReload"),h.prototype),o(h.prototype,"__reloadConversation",[fe.privateMethod],(0,_.default)(h.prototype,"__reloadConversation"),h.prototype),o(h.prototype,"__notifyOrganizationChange",[fe.privateMethod],(0,_.default)(h.prototype,"__notifyOrganizationChange"),h.prototype),o(h.prototype,"__addConversationCounterPartyToServerRosterIfShould",[fe.privateMethod],(0,_.default)(h.prototype,"__addConversationCounterPartyToServerRosterIfShould"),h.prototype),o(h.prototype,"__generateGroupMembershipChangeBody",[fe.privateMethod],(0,_.default)(h.prototype,"__generateGroupMembershipChangeBody"),h.prototype),o(h.prototype,"__addedByCounterParty",[fe.privateMethod],(0,_.default)(h.prototype,"__addedByCounterParty"),h.prototype),o(h.prototype,"__removedByCounterParty",[fe.privateMethod],(0,_.default)(h.prototype,"__removedByCounterParty"),h.prototype),o(h.prototype,"__ensureEntities",[fe.privateMethod],(0,_.default)(h.prototype,"__ensureEntities"),h.prototype),o(h.prototype,"__ensureOrganization",[fe.privateMethod],(0,_.default)(h.prototype,"__ensureOrganization"),h.prototype),o(h.prototype,"__ensureCounterParty",[fe.privateMethod],(0,_.default)(h.prototype,"__ensureCounterParty"),h.prototype),o(h.prototype,"__ensureAllMessagesCounterParties",[fe.privateMethod],(0,_.default)(h.prototype,"__ensureAllMessagesCounterParties"),h.prototype),o(h.prototype,"__ensureMessageCounterParty",[fe.privateMethod],(0,_.default)(h.prototype,"__ensureMessageCounterParty"),h.prototype),o(h.prototype,"__touch",[fe.privateMethod],(0,_.default)(h.prototype,"__touch"),h.prototype),y=h))||y);t.default=Ce,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,y.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,y.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c,l,f=n(7),d=r(f),p=n(6),y=r(p),h=n(10),g=r(h),v=n(11),m=r(v),b=n(9),w=r(b),E=n(8),x=r(E),_=n(3),k=r(_),O=n(1),I=r(O),T=n(2),j=r(T),A=n(5),M=r(A),G=n(4),V=r(G),z=n(19),S=r(z),C=n(13),P=r(C),N=n(15),R=r(N),U=n(17),q=n(14),F=(s=(0,U.decorator)(),u=(0,U.decorator)(),(0,q.classWithPrivateMethods)((l=function(e){function t(){return(0,I.default)(this,t),(0,M.default)(this,(t.__proto__||(0,k.default)(t)).apply(this,arguments))}return(0,V.default)(t,e),(0,j.default)(t,[{key:"mounted",value:function(){this._fetched=!1}},{key:"dispose",value:function(){this._fetched=!1}},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(t){var n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(o=(0,S.default)(o,{ignoreNotFound:!1,bypassCache:!1,includeMembers:!1,includeMetadata:!1}),this.host.requireUser(),n=null,o.bypassCache){e.next=11;break}if(n=this.host.models.DistributionList.get(t),!n){e.next=11;break}return e.abrupt("return",n);case 11:return e.next=13,this.host.api.distributionLists.find(t);case 13:if(r=e.sent,!r){e.next=19;break}n=this.host.models.DistributionList.inject(r),delete n.$placeholder,e.next=21;break;case 19:if(o.ignoreNotFound){e.next=21;break}throw new R.default.NotFoundError(this.host.models.DistributionList.name,t);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(){var t,n,r;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._fetched){e.next=2;break}return e.abrupt("return",this.getAll());case 2:if(t=this.host.models.Organization.getAll(),0!==t.length){e.next=7;break}return e.next=6,this.host.organizations.findAll();case 6:t=e.sent;case 7:return e.next=9,this.host.search.query({types:["distributionList"],organizationIds:t.map(function(e){return e.id}),query:{displayName:""}});case 9:return n=e.sent,r=n.map(function(e){return e.entity}),this._fetched=!0,e.abrupt("return",r);case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"getAll",value:function(){return this.host.models.DistributionList.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.DistributionList.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.DistributionList.getMulti(e)}}]),t}(P.default),o(l.prototype,"find",[s],(0,m.default)(l.prototype,"find"),l.prototype),o(l.prototype,"findAll",[u],(0,m.default)(l.prototype,"findAll"),l.prototype),c=l))||c);t.default=F,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(38),a=r(o),i=n(30),s=r(i),u=n(3),c=r(u),l=n(1),f=r(l),d=n(2),p=r(d),y=n(5),h=r(y),g=n(4),v=r(g),m=n(26),b=r(m),w=n(13),E=r(w),x=n(181),_=function(e){function t(e,n){var r;(0,f.default)(this,t);var o=(0,h.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e,n));o.EVENTS=(r={},(0,a.default)(r,"client_advisory",function(e){switch(e.data.advisory.name){case"replay_start":this.host.reactToAdvisoryEvent("replayStart",{replayMessageCount:e.data.advisory.replay_message_count});break;case"replay_stop":this.host.reactToAdvisoryEvent("replayStop")}}),(0,a.default)(r,"message|group_message",function(e){this.host.conversations.reactToMessageEvent(e)}),(0,a.default)(r,"message:status|group:message:status",function(e){this.host.messages.reactToMessageStatusEvent(e)}),(0,a.default)(r,"friends",function(e){this.host.conversations.reactToFriendsEvent(e)}),(0,a.default)(r,"presence",function(e){this.host.presence.reactToPresenceEvent(e)}),(0,a.default)(r,"bang",function(e){this.host.groups.reactToBangEvent(e)}),(0,a.default)(r,"update",function(e){var t=e.data,n=t.type,r=(0,s.default)(t,["type"]);this.host.injectModel(r,n)}),(0,a.default)(r,"account:settings",function(e){var t=this;e.data.services.forEach(function(n){switch(n.xmlns){case"tigertext:iq:update:account":var r=n.account||e.data.token;t.host.users.refresh(r);break;case"tigertext:iq:update:org_settings":t.host.organizations.refreshAll();break;default:t.logger.warn("unhandled account:settings service type "+n.xmlns)}})}),(0,a.default)(r,"message:is_typing",function(e){this.host.typingStatus.reactToIsTypingEvent(e)}),(0,a.default)(r,"remote_wipe",function(e){this.host.wipe()}),(0,a.default)(r,"validated",function(e){this.logger.warn("validated not implemented")}),(0,a.default)(r,"msg:metadata_update",function(e){this.logger.warn("msg:metadata_update not implemented")}),(0,a.default)(r,"conversation_mute",function(e){this.host.mute.reactToMuteEvent(e)}),(0,a.default)(r,"reconnect",function(e){this.host.events.reconnect()}),(0,a.default)(r,"push:credentials",x.noop),(0,a.default)(r,"sse:heartbeat",x.noop),r);var i=[];return(0,b.default)(o.EVENTS,function(e,t){t.includes("|")&&(i.push(t),t.split("|").forEach(function(t){return o.EVENTS[t]=e}))}),i.forEach(function(e){return delete o.EVENTS[e]}),o}return(0,v.default)(t,e),(0,p.default)(t,[{key:"emit",value:function(e){this.EVENTS[e.type]?this.EVENTS[e.type].call(this,e):this.logger.error("unhandled event: "+e.type,e.data)}}]),t}(E.default);t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r){n&&(0,l.default)(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function a(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,s,u,c=n(133),l=r(c),f=n(11),d=r(f),p=n(9),y=r(p),h=n(8),g=r(h),v=n(40),m=r(v),b=n(6),w=r(b),E=n(16),x=r(E),_=n(3),k=r(_),O=n(1),I=r(O),T=n(2),j=r(T),A=n(5),M=r(A),G=n(4),V=r(G),z=n(54),S=r(z),C=n(13),P=r(C),N=n(14),R=n(59),U=n(146),q=r(U),F=n(25),$=r(F),L=n(22),D=n(44),B=r(D),K=["00000000-0000-0000-0000-000000000001"],Z={isTyping:"is-typing",msgDeliveryDelay:"msg_delivery_delay",multiOrg:"multi-org",noOfflineMessages:"no-offline-messages",autoDeliver:"auto-deliver",hidden:"hidden",closeAfterMessages:"close-after-messages"},W=(0,N.classWithPrivateMethods)((s=function(e){function t(e,n){(0,I.default)(this,t);var r=(0,M.default)(this,(t.__proto__||(0,k.default)(t)).call(this,e,n));return o(r,"onNetworkStatusChanged",u,r),r._throttled_flushQueuedAcks=(0,S.default)(r._flushQueuedAcks.bind(r),r.config.flushAckInterval,{leading:!1}),r._connectionRetryCount=0,r}return(0,V.default)(t,e),(0,j.default)(t,[{key:"mounted",value:function(){this._queuedAcks=[],this.config.autoAckSuccessfullyHandledEvents||(this._processedEventIds=[])}},{key:"dispose",value:function(){this._queuedAcks=null,this._processedEventIds=null,this._throttled_flushQueuedAcks.cancel&&this._throttled_flushQueuedAcks.cancel(),this._cancelScheduledConnectionRetry()}},{key:"connect",value:function(){var e,t=this;if(this.host.requireUser(),this.eventSource)return this.logger.warn("already connected"),x.default.resolve();var n=(e=(e=this.config.events,q.default).call(e,function(e){return 0===e||!!e}),$.default).call(e,function(e,t){var n=Z[t];return e===!0?n:n+":"+e}).join(",");return this.logger.info("connecting events. networkStatus=",this.host.httpClient.networkStatus,"features="+n),this.host.httpClient.networkStatus===B.default.OFFLINE?(this._scheduleConnectRetry(),x.default.resolve()):(this._watchNetworkConnection(),new x.default(function(e,r){var o=void 0;t.eventSource=t.httpClient.createEventSource("/events",{features:n,onOpen:function(){t.logger.info("open"),t._connectionRetryCount=0,t._cancelScheduledConnectionRetry(),o=!0,e()},onMessage:t._onEvent.bind(t),onError:function(e){if(!o)if(e&&e.message)r(e);else{var n=new Error("Could not establish /events connection");e&&(n.status=e.status),r(n)}t._onError(e)},onClose:function(){t.logger.info("close",err)}})}))}},{key:"disconnect",value:function(){this._cancelScheduledConnectionRetry(),this._unwatchNetworkConnection(),this.eventSource&&this.eventSource.close(),this.eventSource=null}},{key:"reconnect",value:function(){this.eventSource&&this.disconnect(),this.connect()}},{key:"_onEvent",value:function(e){var t=this,n=e.data;if(n.includes("\n"))return void n.split("\n").forEach(function(e){return t._onEvent({data:e})});var r=n;try{n=JSON.parse(r)}catch(e){throw this.logger.error("error parsing ",r),e}var o=n.event_id;if(this.config.autoAckSuccessfullyHandledEvents||!this._processedEventIds.includes(o)||K.includes(o)){var a=(0,w.default)(n.event)[0],i=a.replace("tigertext:iq:",""),s=n.event[a];this.logger.debug("incoming",i,s);var u=new R.Event(o,i,s,{_origData:r});try{this.host.eventRouter.emit(u),this.emit("event",u),this.config.autoAckSuccessfullyHandledEvents?this.__queueAck(o):this._processedEventIds.push(o)}catch(e){throw this.logger.error("error in event "+i,e,e.stack,{data:s}),e}}}},{key:"_onError",value:function(e){this.logger.info("error",e,e.message||"",e.status||""),this.disconnect(),this.config.eventsAutoReconnect&&this._scheduleConnectRetry()}},{key:"__queueAck",value:function(e){var t;e=(0,L.arrayWrap)(e),(t=this._queuedAcks).push.apply(t,(0,m.default)(e)),e.length>=this.config.flushAckMaxEvents?(this.logger.log("reached "+this.config.flushAckMaxEvents+" -- flushing"),this._flushQueuedAcks()):this._throttled_flushQueuedAcks()}},{key:"_flushQueuedAcks",value:function(){this._queuedAcks.length>0&&(this.ack(this._queuedAcks),this._queuedAcks.length=0)}},{key:"_scheduleConnectRetry",value:function(){var e=this;this._connectionRetryCount++,this._cancelScheduledConnectionRetry(),this.logger.info("scheduleConnectRetry",this._connectionRetryCount),this._scheduleConnectRetryTimeout=setTimeout(function(){e.connect().catch(function(){})},this.config.eventsAutoReconnectDelay*this._connectionRetryCount)}},{key:"_cancelScheduledConnectionRetry",value:function(){this._scheduleConnectRetryTimeout&&clearTimeout(this._scheduleConnectRetryTimeout)}},{key:"_watchNetworkConnection",value:function(){this._watchingNetworkConnection||(this._watchingNetworkConnection=!0,this.host.on("networkStatus:change",this.onNetworkStatusChanged))}},{key:"_unwatchNetworkConnection",value:function(){this._watchingNetworkConnection&&(this.host.off("networkStatus:change",this.onNetworkStatusChanged),this._watchingNetworkConnection=!1)}},{key:"ack",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,g.default)(y.default.mark(function e(t){return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),t=(0,L.arrayWrap)(t),this.logger.log("ack",t),e.prev=3,e.next=6,this.httpClient.post("/events/ack",{data:{events:t}});case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),this.logger.warn("some events not acked",t);case 11:case"end":return e.stop()}},e,this,[[3,8]])}));return e}()},{key:"isConnected",get:function(){return!!this.eventSource}}]),t}(P.default),a(s.prototype,"_onEvent",[N.privateMethod],(0,d.default)(s.prototype,"_onEvent"),s.prototype),a(s.prototype,"_onError",[N.privateMethod],(0,d.default)(s.prototype,"_onError"),s.prototype),a(s.prototype,"__queueAck",[N.privateMethod],(0,d.default)(s.prototype,"__queueAck"),s.prototype),a(s.prototype,"_flushQueuedAcks",[N.privateMethod],(0,d.default)(s.prototype,"_flushQueuedAcks"),s.prototype),a(s.prototype,"_scheduleConnectRetry",[N.privateMethod],(0,d.default)(s.prototype,"_scheduleConnectRetry"),s.prototype),a(s.prototype,"_cancelScheduledConnectionRetry",[N.privateMethod],(0,d.default)(s.prototype,"_cancelScheduledConnectionRetry"),s.prototype),a(s.prototype,"_watchNetworkConnection",[N.privateMethod],(0,d.default)(s.prototype,"_watchNetworkConnection"),s.prototype),a(s.prototype,"_unwatchNetworkConnection",[N.privateMethod],(0,d.default)(s.prototype,"_unwatchNetworkConnection"),s.prototype),u=a(s.prototype,"onNetworkStatusChanged",[N.privateMethod],{enumerable:!0,initializer:function(){var e=this;return function(t){var n=t.networkStatus;n!==B.default.OFFLINE&&n!==B.default.UNREACHABLE||(e.disconnect(),e._scheduleConnectRetry())}}}),i=s))||i;t.default=W,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,m.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,g.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,m.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,g.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c,l,f,d,p=n(7),y=r(p),h=n(6),g=r(h),v=n(10),m=r(v),b=n(11),w=r(b),E=n(40),x=r(E),_=n(16),k=r(_),O=n(12),I=r(O),T=n(9),j=r(T),A=n(8),M=r(A),G=n(3),V=r(G),z=n(1),S=r(z),C=n(2),P=r(C),N=n(5),R=r(N),U=n(4),q=r(U),F=n(157),$=r(F),L=n(52),D=r(L),B=n(177),K=r(B),Z=n(53),W=r(Z),H=n(176),X=r(H),Q=n(19),Y=r(Q),J=n(13),ee=r(J),te=n(15),ne=r(te),re=n(17),oe=n(14),ae=n(25),ie=r(ae),se=n(47),ue=r(se),ce=n(50),le=r(ce),fe=n(22),de=(s=(0,re.decorator)(),u=(0,re.decorator)(),c=(0,re.decorator)(),l=(0,re.decorator)(),(0,oe.classWithPrivateMethods)((d=function(e){function t(){return(0,S.default)(this,t),(0,R.default)(this,(t.__proto__||(0,V.default)(t)).apply(this,arguments))}return(0,q.default)(t,e),(0,P.default)(t,[{
key:"mounted",value:function(){this._fetched=!1}},{key:"dispose",value:function(){this._fetched=!1}},{key:"create",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t){var n,r,o=t.organizationId,a=t.name,i=t.avatarFile,s=t.replayHistory,u=void 0===s||s,c=t.memberIds,l=void 0===c?[]:c,f=t.metadata;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),o){e.next=3;break}throw new ne.default.ValidationError("organizationId","required");case 3:return l=l.map(this._resolveModelId.bind(this)),l.includes(this.host.currentUserId)||l.unshift(this.host.currentUserId),e.next=7,this.host.api.groups.create({name:a,avatarFile:i,replayHistory:u,memberIds:l,organizationId:o});case 7:if(n=e.sent,r=this.host.models.Group.inject(n),!f){e.next=12;break}return e.next=12,this.host.metadata.update(r.id,f,o);case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"update",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){var r,o,s,u=n.name,c=n.avatarFile,l=n.replayHistory,f=n.memberIds,d=n.metadata;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:return this.host.requireUser(),t=this._resolveModelId(t),r={},"undefined"!=typeof u&&(r.name=u),"undefined"!=typeof l&&(r.replayHistory=l),"undefined"!=typeof f&&(r.memberIds=f),e.next=12,this.host.api.groups.update(t,{name:u,avatarFile:c,replayHistory:l,memberIds:f});case 12:if(o=e.sent,"undefined"!=typeof o.avatarUrl&&(r.avatarUrl=o.avatarUrl),s=this.host.models.Group.inject((0,I.default)({id:t},r)),!d){e.next=18;break}return e.next=18,this.host.metadata.update(t,d,s.organizationId);case 18:return e.abrupt("return",s);case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t){var n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(o=(0,Y.default)(o,{ignoreNotFound:!1,bypassCache:!1,includeMembers:!1,includeMetadata:!1}),this.host.requireUser(),n=null,o.bypassCache){e.next=13;break}if(n=this.host.models.Group.get(t),!n||n.$placeholder){e.next=13;break}return e.next=12,this.__ensureEntitiesLoaded(n.id,o);case 12:return e.abrupt("return",n);case 13:return e.next=15,this.host.api.groups.find(t);case 15:if(r=e.sent,!r){e.next=21;break}n=this.host.models.Group.inject(r),delete n.$placeholder,e.next=23;break;case 21:if(o.ignoreNotFound){e.next=23;break}throw new ne.default.NotFoundError(this.host.models.Group.name,t);case 23:if(!n){e.next=26;break}return e.next=26,this.__ensureEntitiesLoaded(n.id,o);case 26:return e.abrupt("return",n);case 27:case"end":return e.stop()}},e,this)}));return e}()},{key:"__ensureEntitiesLoaded",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){var r,o;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return r=this.host.models.Group.get(t),o=[],n.includeMetadata&&o.push(this.host.metadata.find(t,r.organizationId)),n.includeMembers&&o.push(this.ensureMembers(r)),e.next=10,k.default.all(o);case 10:this.host.models.Group.touch(t);case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(){var t,n,r,o,a,i,s,u=this,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=c.includeMembers,f=void 0!==l&&l,d=c.includeMetadata,p=void 0!==d&&d;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._fetched){e.next=2;break}return e.abrupt("return",this.getAll());case 2:if(t=this.host.models.Organization.getAll(),0!==t.length){e.next=7;break}return e.next=6,this.host.organizations.findAll();case 6:t=e.sent;case 7:return e.next=9,this.host.search.query({types:["group"],organizationIds:t.map(function(e){return e.id}),query:{displayName:""},includeMetadata:p});case 9:if(n=e.sent,r=n.map(function(e){return e.entity}),!f){e.next=19;break}if(i=[],s=(o=(o=ie.default.call(r,"memberIds"),ue.default).call(o),le.default).call(o),(a=i).push.apply(a,(0,x.default)(s.map(function(e){return u.host.users.find(e,{ignoreNotFound:!0})}))),i=i.filter(Boolean),!(i.length>0)){e.next=19;break}return e.next=19,k.default.all(i);case 19:return this._fetched=!0,e.abrupt("return",r);case 21:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAllWithSpecificMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){var r;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:if(n=this._resolveModelId(n),t=(0,fe.arrayWrap)(t).map(this._resolveModelId.bind(this)),!t.includes(this.host.currentUserId)&&t.push(this.host.currentUserId),r=this.__findAllLocalWithSpecificMembers(t,n),0!==r.length){e.next=16;break}return e.next=15,this.findAll();case 15:r=this.__findAllLocalWithSpecificMembers(t,n);case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}},e,this)}));return e}()},{key:"ensureMembers",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(t));case 2:if(t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(t));case 4:return e.abrupt("return",this.ensureMembersWithIds(t.id,t.memberIds,n));case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"ensureMembersWithIds",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){var r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(n));case 8:if(this.host.requireUser(),n=(0,X.default)(n,this.host.currentUserId),0!==n.length){e.next=12;break}return e.abrupt("return");case 12:return o=(0,Y.default)(o,{onlyPlaceholder:!1}),e.next=15,k.default.all(n.map(function(e){return r.__ensureMember(e,o)}).filter(Boolean));case 15:this.host.models.Group.touch(t);case 16:case"end":return e.stop()}},e,this)}));return e}()},{key:"__ensureMember",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.User.shouldEnsure(e,t.onlyPlaceholder)?this.host.models.User.waitForEnsuredEntity(e,t):null}},{key:"getAll",value:function(){return this.host.models.Group.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Group.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Group.getMulti(e)}},{key:"__findAllLocalWithSpecificMembers",value:function(e,t){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));var n=this.host.models.Group.getAll(),r=(0,W.default)(n,function(n){return n.organizationId===t&&0===(0,K.default)(n.memberIds,e).length});return r}},{key:"destroy",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t){var n;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:return this.host.requireUser(),t=this._resolveModelId(t),e.next=8,this.host.api.groups.destroy(t);case 8:if(n=e.sent){e.next=11;break}throw new ne.default.NotFoundError(this.host.models.Group.name,t);case 11:return this.host.models.Group.eject(t),e.abrupt("return",null);case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAllMemberIds",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t){var n;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:return this.host.requireUser(),t=this._resolveModelId(t),e.next=8,this.httpClient.get("/group/:id/members",{urlParams:{id:t}});case 8:return n=e.sent,e.abrupt("return",n.data);case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"addMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){var r;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(n));case 8:if(this.host.requireUser(),t=this._resolveModelId(t),n=(0,fe.arrayWrap)(n).map(this._resolveModelId.bind(this)),r=this.getById(t),r&&(n=(0,D.default)(n,r.memberIds)),0!==n.length){e.next=15;break}return e.abrupt("return");case 15:return e.next=17,this.host.api.groups.addMembers(t,n);case 17:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeMembers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){var r;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+a(n));case 8:if(this.host.requireUser(),t=this._resolveModelId(t),n=(0,fe.arrayWrap)(n).map(this._resolveModelId.bind(this)),r=this.getById(t),r&&(n=(0,$.default)(n,r.memberIds)),0!==n.length){e.next=15;break}return e.abrupt("return");case 15:return e.next=17,this.host.api.groups.removeMembers(t,n);case 17:n.includes(this.host.currentUserId)&&this.host.models.Group.eject(t);case 18:case"end":return e.stop()}},e,this)}));return e}()},{key:"addMember",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:return e.abrupt("return",this.addMembers(t,[n]));case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeMember",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t,n){return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:return e.abrupt("return",this.removeMembers(t,[n]));case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"join",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t){return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:return e.abrupt("return",this.addMembers(t,[this.host.currentUserId]));case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"leave",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,M.default)(j.default.mark(function e(t){var n;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:if(t=this._resolveModelId(t),n=this.getById(t)){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,this.host.conversations.remove("group",t,n.organizationId);case 10:return e.next=12,this.removeMember(t,this.host.currentUserId);case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"reactToBangEvent",value:function(e){switch(e.data.event){case"added":this.__addedToGroup(e);break;case"removed":this.__removedFromGroup(e)}}},{key:"__addedToGroup",value:function(e){var t=e.data.caller_entity,n=e.data.subject_entity,r=e.data.target_entity;if(t&&t.token&&r&&r.token&&n&&n.token){var o=this.host.injectModel(t),a=this.host.injectModel(n),i=this.host.models.Group.get(r.token);if(i){var s=a.id===o.id?"JOIN":"ADD",u={id:e.id,sortNumber:+e.data.sort_number,createdAt:new Date(e.data.created_on),action:s,actor:o,actorId:o.id,group:i,groupId:i.id,members:[a],memberIds:[a.id]};this.host.conversations.addMembershipChangeLog(u),i.memberIds.includes(a.id)||(this.host.models.Group.touch(i),this.emit("membership:change",u))}}}},{key:"__removedFromGroup",value:function(e){var t=e.data.caller_entity,n=e.data.subject_entity,r=e.data.target_entity;if(t&&t.token&&r&&r.token&&n&&n.token){var o=this.host.injectModel(t),a=this.host.models.Group.get(r.token);if(a&&a.memberIds){var i=this.host.injectModel(n),s=i.id===o.id?"LEAVE":"REMOVE",u={id:e.id,sortNumber:+e.data.sort_number,createdAt:new Date(e.data.created_on),action:s,actor:o,actorId:o.id,group:a,groupId:a.id,members:[i],memberIds:[i.id]};this.host.conversations.addMembershipChangeLog(u),a.memberIds.includes(i.id)&&this.emit("membership:change",u)}}}}]),t}(ee.default),o(d.prototype,"find",[s],(0,w.default)(d.prototype,"find"),d.prototype),o(d.prototype,"__ensureEntitiesLoaded",[u],(0,w.default)(d.prototype,"__ensureEntitiesLoaded"),d.prototype),o(d.prototype,"findAll",[c],(0,w.default)(d.prototype,"findAll"),d.prototype),o(d.prototype,"findAllWithSpecificMembers",[l],(0,w.default)(d.prototype,"findAllWithSpecificMembers"),d.prototype),o(d.prototype,"__findAllLocalWithSpecificMembers",[oe.privateMethod],(0,w.default)(d.prototype,"__findAllLocalWithSpecificMembers"),d.prototype),o(d.prototype,"__addedToGroup",[oe.privateMethod],(0,w.default)(d.prototype,"__addedToGroup"),d.prototype),o(d.prototype,"__removedFromGroup",[oe.privateMethod],(0,w.default)(d.prototype,"__removedFromGroup"),d.prototype),f=d))||f);t.default=de,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,W.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,m.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,g.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,W.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,m.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,g.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c,l,f,d,p,y,h=n(7),g=r(h),v=n(6),m=r(v),b=n(11),w=r(b),E=n(16),x=r(E),_=n(18),k=r(_),O=n(30),I=r(O),T=n(28),j=r(T),A=n(29),M=r(A),G=n(9),V=r(G),z=n(12),S=r(z),C=n(8),P=r(C),N=n(3),R=r(N),U=n(1),q=r(U),F=n(2),$=r(F),L=n(5),D=r(L),B=n(4),K=r(B),Z=n(10),W=r(Z),H=n(52),X=r(H),Q=n(174),Y=r(Q),J=n(73),ee=r(J),te=n(19),ne=r(te),re=n(72),oe=r(re),ae=n(34),ie=r(ae),se=n(41),ue=r(se),ce=n(33),le=r(ce),fe=n(154),de=r(fe),pe=n(150),ye=r(pe),he=n(42),ge=r(he),ve=n(54),me=r(ve),be=n(13),we=r(be),Ee=n(55),xe=r(Ee),_e=n(17),ke=n(14),Oe=n(75),Ie=r(Oe),Te=n(23),je=n(27),Ae=r(je),Me=n(15),Ge=r(Me),Ve=n(24),ze=r(Ve),Se=n(48),Ce=r(Se),Pe=n(143),Ne=r(Pe),Re=n(142),Ue=r(Re),qe=n(25),Fe=r(qe),$e=n(50),Le=r($e),De=n(32),Be=r(De),Ke=n(22),Ze=["user","group","distributionList"],We=(s=(0,_e.decorator)(),u=(0,_e.decorator)(),c=(0,_e.decorator)({memoize:!0}),l=(0,_e.decorator)({memoize:!0}),f=(0,_e.decorator)({memoize:!0}),d=(0,_e.decorator)({serializeArguments:function(e){return"object"===(0,W.default)(e[0])?e[0].id:e[0]}}),(0,ke.classWithPrivateMethods)((y=function(e){function t(){var e;(0,q.default)(this,t);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];var a=(0,D.default)(this,(e=t.__proto__||(0,R.default)(t)).call.apply(e,[this].concat(r)));return a._throttled_flushQueueMessageStatuses=a.config.flushSetMessageStatusInterval?(0,me.default)(a.__flushQueueMessageStatuses,a.config.flushSetMessageStatusInterval,{leading:!1}):a.__flushQueueMessageStatuses,a}return(0,K.default)(t,e),(0,$.default)(t,[{key:"mounted",value:function(){this._queuedMessageStatuses={deliveredIds:[],readIds:[]},this.host.on("tick",this.deleteExpiredMessages)}},{key:"dispose",value:function(){this._queuedMessageStatuses=null,this._downloadAttachmentBlobAndUrl&&_e.decorator.clear(this._downloadAttachmentBlobAndUrl),this.downloadAttachmentUrl&&_e.decorator.clear(this.downloadAttachmentUrl),this.downloadAttachment&&_e.decorator.clear(this.downloadAttachment),this._throttled_flushQueueMessageStatuses.cancel&&this._throttled_flushQueueMessageStatuses.cancel(),this.host.off("tick",this.deleteExpiredMessages)}},{key:"send",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t,n){var r,o,s,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||t instanceof Object||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | string[] | Object | Object[]\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(null==u||u instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+i(u));case 6:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||t instanceof Object||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | string[] | Object | Object[]\n\nGot:\n'+a(t));case 8:if("string"==typeof n){e.next=10;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if(null==u||u instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+a(u));case 12:if(!Array.isArray(t)){e.next=14;break}return e.abrupt("return",this.__sendToGroupOfUsers(t,n,u));case 14:return e.next=16,this.__resolveCounterPartyEntityAndOrganizationId(t,!1);case 16:if(r=e.sent,o=r.counterParty,s=r.organizationId,s&&(u=(0,S.default)({},(0,ge.default)(u,"organizationId","senderOrganizationId","recipientOrganizationId"),{organizationId:s})),!o){e.next=24;break}return e.abrupt("return",this.__sendToKnownCounterParty(o.$entityType,o.serverId,n,u));case 24:return e.abrupt("return",this.__sendToUnknownCounterParty(t,n,u));case 25:case"end":return e.stop()}},e,this)}));return e}()},{key:"__resolveCounterPartyEntityAndOrganizationId",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t){var n,r,o,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("boolean"==typeof s){e.next=4;break}throw new TypeError('Value of argument "fallbackRemote" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+i(s));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("boolean"==typeof s){e.next=8;break}throw new TypeError('Value of argument "fallbackRemote" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+a(s));case 8:if(n=this._resolveEntity(t,[].concat(Ze,["conversation"])),r=null,n){e.next=16;break}if(!this.host.conversations.looksLikeConversationId(t)){e.next=16;break}return e.next=14,this.host.conversations.find(t);case 14:o=e.sent,o&&(n=o.counterParty,r=o.organizationId);case 16:if(n||!s){e.next=20;break}return e.next=19,this.__resolveRemoteCounterPartyEntity(t);case 19:n=e.sent;case 20:return n&&(n.organizationId&&(r=n.organizationId),"conversation"===n.$entityType&&(n=n.counterParty)),e.abrupt("return",{counterParty:n,organizationId:r});case 22:case"end":return e.stop()}},e,this)}));return e}()},{key:"__resolveRemoteCounterPartyEntity",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t){var n,r,o,s,u,c,l,f,d=this;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(n=null,r=(0,ye.default)([(0,P.default)(V.default.mark(function e(){return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.host.users.find(t));case 1:case"end":return e.stop()}},e,d)})),(0,P.default)(V.default.mark(function e(){return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.host.groups.find(t));case 1:case"end":return e.stop()}},e,d)})),(0,P.default)(V.default.mark(function e(){return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.host.distributionLists.find(t));case 1:case"end":return e.stop()}},e,d)}))]),r&&("function"==typeof r[M.default]||Array.isArray(r))){e.next=8;break}throw new TypeError("Expected resolvers to be iterable, got "+a(r));case 8:if(r&&("function"==typeof r[M.default]||Array.isArray(r))){e.next=10;break}throw new TypeError("Expected resolvers to be iterable, got "+i(r));case 10:o=!0,s=!1,u=void 0,e.prev=13,c=(0,j.default)(r);case 15:if(o=(l=c.next()).done){e.next=32;break}return f=l.value,e.prev=17,e.next=20,f();case 20:if(n=e.sent,!n){e.next=23;break}return e.abrupt("break",32);case 23:e.next=29;break;case 25:if(e.prev=25,e.t0=e.catch(17),e.t0.code===Ge.default.NotFoundError.CODE){e.next=29;break}throw e.t0;case 29:o=!0,e.next=15;break;
case 32:e.next=38;break;case 34:e.prev=34,e.t1=e.catch(13),s=!0,u=e.t1;case 38:e.prev=38,e.prev=39,!o&&c.return&&c.return();case 41:if(e.prev=41,!s){e.next=44;break}throw u;case 44:return e.finish(41);case 45:return e.finish(38);case 46:return e.abrupt("return",n);case 47:case"end":return e.stop()}},e,this,[[13,34,38,46],[17,25],[39,,41,45]])}));return e}()},{key:"__sendToKnownCounterParty",value:function(){function e(e,n,r,o){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t,n,r,o){var s,u,c,l,f=o.organizationId,d=o.senderOrganizationId,p=void 0===d?f:d,y=o.recipientOrganizationId,h=void 0===y?p:y,g=(0,I.default)(o,["organizationId","senderOrganizationId","recipientOrganizationId"]);return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t){e.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 8:if("string"==typeof n){e.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:this.host.requireUser(),Ae.default.oneOf("counterPartyType",t,["user","group","distributionList"]),Ae.default.notEmpty("counterPartyId",n),s=this.__getNextSortNumber(),p=this.__ensureOrganization(p),h=h||p,g=this.__normalizeSendOptions(g,p),u=this.host.conversations.ensureConversation(t,n,p),c=this.host.models.Message.createInstance({id:Ie.default.v4(),conversationId:u.id,messageType:Te.MessageType.USER_SENT,counterPartyId:n,counterPartyType:t,body:r,senderOrganizationId:p,recipientOrganizationId:h,sortNumber:s,createdAt:new Date,senderId:this.host.currentUserId,direction:Te.MessageDirection.OUTGOING,senderStatus:Te.MessageSenderStatus.SENDING,$synced:!1,serverId:null,metadata:g.metadata,priority:g.priority,deleteOnRead:g.deleteOnRead,ttl:g.ttl}),g.attachmentFiles&&this.__setLocalMessageAttachments(c,g.attachmentFiles),e.t0=t,e.next="group"===e.t0?25:"user"===e.t0?28:"distributionList"===e.t0?31:34;break;case 25:return c.groupId=n,c.recipientStatus=Te.MessageRecipientStatus.NA,e.abrupt("break",34);case 28:return c.recipientId=n,c.recipientStatus=Te.MessageRecipientStatus.NEW,e.abrupt("break",34);case 31:return c.distributionListId=n,c.recipientStatus=Te.MessageRecipientStatus.NA,e.abrupt("break",34);case 34:return this.host.models.Message.inject(c),this.host.emit("message:sending",c),e.prev=36,e.next=39,this.host.api.messages.send({localId:c.id,counterPartyId:n,body:r,senderOrganizationId:p,recipientOrganizationId:h,attachment:(0,de.default)(g.attachmentFiles),priority:Te.MessagePriority.toServer(g.priority),metadata:g.metadata,ttl:g.ttl,deleteOnRead:g.deleteOnRead});case 39:l=e.sent,(0,k.default)(c,{serverId:l.serverId,ttl:l.ttl,senderStatus:Te.MessageSenderStatus.SENT,$synced:!0}),e.next=46;break;case 43:e.prev=43,e.t1=e.catch(36),c.senderStatus=Te.MessageSenderStatus.FAILED;case 46:return this.host.models.Message.inject(c),this.host.emit("message:sent",c),e.abrupt("return",c);case 49:case"end":return e.stop()}},e,this,[[36,43]])}));return e}()},{key:"__sendToUnknownCounterParty",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t,n){var r,o,s,u,c,l,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=f.organizationId,p=f.senderOrganizationId,y=void 0===p?d:p,h=f.recipientOrganizationId,g=void 0===h?y:h,v=(0,I.default)(f,["organizationId","senderOrganizationId","recipientOrganizationId"]);return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return r=Ie.default.v4(),o=this.__getNextSortNumber(),y=this.__ensureOrganization(y),g=g||y,v=this.__normalizeSendOptions(v,y),e.next=15,this.host.api.messages.send({localId:r,counterPartyId:t,body:n,senderOrganizationId:y,recipientOrganizationId:g,attachment:(0,de.default)(v.attachmentFiles),priority:Te.MessagePriority.toServer(v.priority),metadata:v.metadata,ttl:v.ttl,deleteOnRead:v.deleteOnRead});case 15:return s=e.sent,e.next=18,this.__resolveRemoteCounterPartyEntity(t);case 18:return u=e.sent,c=this.host.conversations.ensureConversation(u.$entityType,u.serverId,y,{ensureEntities:{counterParty:"full",groupMembers:"full"}}),l=this.host.models.Message.inject({id:s.serverId,serverId:s.serverId,$synced:!0,conversationId:c.id,counterParty:u,messageType:Te.MessageType.USER_SENT,body:n,senderOrganizationId:y,recipientOrganizationId:g,sortNumber:o,createdAt:new Date,senderId:this.host.currentUserId,direction:Te.MessageDirection.OUTGOING,senderStatus:Te.MessageSenderStatus.SENT,recipientStatus:Te.MessageRecipientStatus.NEW,metadata:v.metadata,priority:v.priority,ttl:s.ttl,deleteOnRead:v.deleteOnRead}),v.attachmentFiles&&this.__setLocalMessageAttachments(l,v.attachmentFiles),this.host.emit("message:sending",l),this.host.emit("message:sent",l),e.abrupt("return",l);case 25:case"end":return e.stop()}},e,this)}));return e}()},{key:"__normalizeSendOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.metadata,n=e.attachmentFiles,r=e.attachmentFile,o=e.priority,s=e.ttl,u=e.deleteOnRead,c=arguments[1];if("string"!=typeof c)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(c));if("string"!=typeof c)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(c));return t&&(t=this.__normalizeMetadata(t)),n=this.__validateAttachments(n||r),"undefined"==typeof s&&(s=this.host.organizations.getSettingValue(c,"ttl")||-1),{metadata:t,attachmentFiles:n,priority:o,ttl:s,deleteOnRead:u}}},{key:"__ensureOrganization",value:function(e){if(null!=e&&"string"!=typeof e)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(e));if(null!=e&&"string"!=typeof e)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(e));return e?e:this.host.config.defaultOrganizationId?this.host.config.defaultOrganizationId:void Ae.default.raise("organizationId","required","Message is sent in the context of an organization. Provide `organizationId` or set a default one with client.setDefaultOrganization(...)")}},{key:"__validateAttachments",value:function(e){return e=(0,Ke.arrayWrap)(e),!(0,le.default)(e)&&e.length>1&&Ae.default.raise("attachmentFiles","invalid","currently only a single attachment is supported"),e}},{key:"__normalizeMetadata",value:function(e){return e?(0,Ke.arrayWrap)(e).map(function(e){return(0,S.default)({mimetype:"application/json"},e)}):null}},{key:"__getNextSortNumber",value:function(){var e,t=(e=(e=this.host.models.Message.getAll(),Ce.default).call(e,["sortNumber"],["desc"]),Ne.default).call(e),n=t?t.sortNumber:0,r=n+1e-6;return r}},{key:"__setLocalMessageAttachments",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!Array.isArray(t)||!t.every(function(e){return"string"==typeof e||e instanceof Object}))throw new TypeError('Value of argument "attachmentFiles" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if(!Array.isArray(t)||!t.every(function(e){return"string"==typeof e||e instanceof Object}))throw new TypeError('Value of argument "attachmentFiles" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+a(t));e.attachments=t.map(this.__generateAttachmentDescriptor.bind(this))}},{key:"__generateAttachmentDescriptor",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "attachment" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "attachment" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));var t="local:"+Ie.default.v4();"string"==typeof e||e instanceof Buffer||Ae.default.raise("attachment","invalid","attachment (string or Buffer) is invalid");var r=void 0,o=void 0,s=void 0,u=n(63),c=n(74),l=n(179),f=n(62);if("string"==typeof e)r=u.statSync(e).size,o=l.lookup(e),s=c.basename(e);else{var d=f(e);if(d){var p=d.ext,y=d.mime;s="attachment."+p,o=y}r=e.byteLength}var h={id:t,localPath:"string"==typeof e?e:null,localFile:e instanceof Buffer?e:null,name:s,size:r,contentType:o,isLocal:!0};return h}},{key:"__loadLocalFilePathWithFileReader",value:function(e){return new x.default(function(t,n){var r=new FileReader;r.addEventListener("load",function(){t(r.result)},!1),r.addEventListener("error",function(e){n(e)},!1),r.readAsDataURL(e)})}},{key:"previewMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!(null==t||t instanceof Object))throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+i(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if(!(null==t||t instanceof Object))throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+a(t));var n=this._resolveMessage(e);return this.host.models.Message.inject((0,S.default)({},n,{id:"message-preview",conversationId:null},t))}},{key:"endPreviewMessage",value:function(){var e=this._resolveMessage("message-preview");this.host.models.Message.eject(e)}},{key:"sendToUser",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.send.apply(this,[e].concat(n))}},{key:"sendToGroup",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.send.apply(this,[e].concat(n))}},{key:"sendToConversation",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.send.apply(this,[e].concat(n))}},{key:"sendToDistributionList",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "distributionListId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "distributionListId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.send.apply(this,[e].concat(n))}},{key:"sendToNewGroup",value:function(e){if(!(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})))throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+i(e));if(!(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})))throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+a(e));for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.send.apply(this,[e].concat(n))}},{key:"__sendToGroupOfUsers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t,n){var r,o=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=s.organizationId,c=s.preferExistingGroup,l=void 0!==c&&c,f=s.groupName,d=s.groupMetadata,p=(0,I.default)(s,["organizationId","preferExistingGroup","groupName","groupMetadata"]);return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(t=t.map(function(e){return o._resolveModelIdWithTypes(e,"user")}),0===t.length&&Ae.default.raise("userIds","required"),r=void 0,!l){e.next=15;break}throw new Error("not implemented");case 15:return e.next=17,this.__prepareGroupForUsers(u,t,f,{groupMetadata:d});case 17:r=e.sent;case 18:return e.abrupt("return",this.sendToGroup(r,n,(0,S.default)({organizationId:u},p)));case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"__prepareGroupForUsers",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t,n,r){var o,a,i=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=s.groupMetadata;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=[this.host.currentUser].concat(n.map(function(e){return i.host.models.User.get(e)}).filter(Boolean)),r||(r=o.map(function(e){return e.displayName}).filter(Boolean).join(", ")||"Group"),e.next=4,this.host.groups.create({organizationId:t,name:r,replayHistory:!0,memberIds:n,metadata:u});case 4:return a=e.sent,e.abrupt("return",a);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"onMessageRecalled",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));this.host.requireUser();var t=this._getMessageByServerId(e);t&&this._deleteLocalMessage(t)}},{key:"_deleteLocalMessage",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));this.host.models.Message.eject(e)}},{key:"recall",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t){var n,r;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+a(t));case 4:return this.host.requireUser(),n=(0,Ke.arrayWrap)(t).filter(Boolean),r=n.map(this.__recallSingle.bind(this)),e.next=9,x.default.all(r);case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"__recallSingle",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t){var n;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:if(n=this._resolveMessage(t),!n){e.next=17;break}if(n.senderId===this.host.currentUserId){e.next=8;break}throw new Ge.default.PermissionDeniedError(n,n.serverId,"recall");case 8:if(n.$synced!==!1&&n.serverId){e.next=12;break}this._deleteLocalMessage(n),e.next=15;break;case 12:return e.next=14,this.host.api.messages.destroy(n.serverId);case 14:this._deleteLocalMessage(n);case 15:e.next=19;break;case 17:return e.next=19,this.host.api.messages.destroy(t);case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"retrySend",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t){var n,r;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:if(this.host.requireUser(),n=this._resolveMessage(t)){e.next=8;break}throw new Ge.default.NotFoundError(this.host.models.Message.name,t);case 8:return n.senderId===this.host.currentUserId&&n.senderStatus===Te.MessageSenderStatus.FAILED||Ae.default.raise("message","invalid","Message to retry must be in a FAILED senderStatus and sent from current user"),e.prev=9,n.senderStatus=Te.MessageSenderStatus.RETRYING,this.host.models.Message.inject(n),e.next=14,this.host.api.messages.send({localId:n.id,counterPartyId:n.counterPartyId,body:n.body,senderOrganizationId:n.senderOrganizationId,recipientOrganizationId:n.recipientOrganizationId,attachment:(0,ue.default)(n.attachments,"0.localFile"),priority:Te.MessagePriority.toServer(n.priority),metadata:n.metadata,ttl:n.ttl,deleteOnRead:n.deleteOnRead});case 14:r=e.sent,(0,k.default)(n,{sortNumber:this.__getNextSortNumber(),serverId:r.serverId,ttl:r.ttl,senderStatus:Te.MessageSenderStatus.SENT,$synced:!0}),this.host.models.Message.inject(n),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(9),n.senderStatus=Te.MessageSenderStatus.FAILED,this.host.models.Message.inject(n);case 23:case"end":return e.stop()}},e,this,[[9,19]])}));return e}()},{key:"resend",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t){var n,r,o,s,u,c,l,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:if(n=this._resolveMessage(t),r=f.priority,o=void 0===r?n.priority:r,!n.isForwarded){e.next=10;break}this.forward(t,n.counterPartyId,{organizationId:n.recipientOrganizationId,priority:o}),e.next=23;break;case 10:s=[],e.t0=V.default.keys(n.attachments);case 12:if((e.t1=e.t0()).done){e.next=22;break}return u=e.t1.value,c=n.attachments[u],e.next=17,this._downloadAttachmentBlobAndUrl(t,c.id);case 17:l=e.sent.blob,l.name=c.name,s.push(l),e.next=12;break;case 22:this.__sendToKnownCounterParty(n.counterPartyType,n.counterPartyId,n.body,{priority:o,deleteOnRead:n.dnd,ttl:n.ttl,organizationId:n.recipientOrganizationId,attachmentFiles:s});case 23:case"end":return e.stop()}},e,this)}));return e}()},{key:"forward",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t,n){var r,o,s,u,c,l,f,d=this,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},y=p.organizationId,h=p.senderOrganizationId,g=void 0===h?y:h,v=p.recipientOrganizationId,m=void 0===v?g:v,b=p.priority,w=p.retrieveMessage,E=void 0!==w&&w,x=(p.preferExistingGroup,p.groupName),_=p.groupMetadata;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||n instanceof Object||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n||n instanceof Object||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+a(n));case 8:if(this.host.requireUser(),r=this._resolveMessage(t),!Array.isArray(n)){e.next=16;break}return o=n.map(function(e){return d._resolveModelIdWithTypes(e,"user")}),e.next=14,this.__prepareGroupForUsers(y,o,x,{groupMetadata:_});case 14:s=e.sent,n=s.id;case 16:if(r){e.next=18;break}throw new Ge.default.NotFoundError(this.host.models.Message.name,t);case 18:return e.next=20,this.__resolveCounterPartyEntityAndOrganizationId(n,!0);case 20:return u=e.sent,c=u.counterParty,l=u.organizationId,l&&(g=m=l),c&&(n=c.serverId),Ae.default.notEmpty("entityId",n,"entityId not found"),e.next=28,this.host.api.messages.forward(r.serverId,n,{localId:Ie.default.v4(),senderOrganizationId:g,recipientOrganizationId:m,priority:Te.MessagePriority.toServer(b)});case 28:if(f=e.sent,!E){e.next=31;break}return e.abrupt("return",this.find(f.serverId));case 31:return e.abrupt("return",null);case 32:case"end":return e.stop()}},e,this)}));return e}()},{key:"reactToMessageStatusEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));var t=e.data.client_id,n=e.data.is_recalled;n?this.onMessageRecalled(t):this.__setMessageStatusPerRecipientFromServerData(t,(0,ie.default)(e.data,["status","account_id","timestamp"]))&&this.__touchMessage(t)}},{key:"__setMessageStatusPerRecipientFromServerData",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(!(t instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(!(t instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(t));var n=Te.MessageRecipientStatus.resolve(t.status),r=t.account_id,o=t.timestamp;return this.setRecipientMessageStatus(e,r,n,o)}},{key:"setRecipientMessageStatus",value:function(e,t,n,r){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if(!(null==r||"string"==typeof r||null==r||r instanceof Date))throw new TypeError('Value of argument "createdAt" violates contract.\n\nExpected:\n?string | ?Date\n\nGot:\n'+i(r));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("string"!=typeof n)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));if(!(null==r||"string"==typeof r||null==r||r instanceof Date))throw new TypeError('Value of argument "createdAt" violates contract.\n\nExpected:\n?string | ?Date\n\nGot:\n'+a(r));var o=this._getMessageByServerId(e);if(o){n=Te.MessageRecipientStatus.resolve(n),this._setSingleUserMessageRecipientMessageStatus(o,n);var s=(0,oe.default)(o.statusesPerRecipient,{userId:t});if(!s||this.__canChangeRecipientStatus(s.status,n)){this.host.models.User.ensureEntity(t,{onlyPlaceholder:!0});var u=o.id+":"+t;return this.host.models.MessageStatusPerRecipient.inject({id:u,messageId:o.id,userId:t,status:n,createdAt:r})}}}},{key:"__touchMessage",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));var t=this._resolveMessage(e);this.host.models.Message.touch(t)}},{key:"_resolveMessage",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));return this.host.models.Message.is(e)?e:this.host.models.Message.get(e)||this._getMessageByServerId(e)}},{key:"_getMessageByServerId",value:function(e){var t;if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));return this.host.models.Message.is(e)?e:(t=this.host.models.Message.getAll(),Ue.default).call(t,{serverId:e})}},{key:"_setSingleUserMessageRecipientMessageStatus",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));this.__canChangeRecipientStatus(e.recipientStatus,t)&&this.host.models.Message.inject({id:e.id,recipientStatus:t})}},{key:"__canChangeRecipientStatus",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "fromStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "toStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "fromStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "toStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return e!==t&&(e!==Te.MessageRecipientStatus.READ||t!==Te.MessageRecipientStatus.DELIVERED)}},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t){var n,r,o,s,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:return u=(0,ne.default)(u,{includeStatuses:!0,includeCounterParty:!0}),this.host.requireUser(),e.next=8,this.host.api.messages.find(t);case 8:if(n=e.sent,!u.includeCounterParty){e.next=19;break}return r=n.recipient_token,e.next=13,this.__lookupCounterParty(r);case 13:if(o=e.sent,!o){e.next=18;break}n.counterParty=o,e.next=19;break;case 18:return e.abrupt("return",null);case 19:if(s=this.host.models.Message.inject(n),!u.includeStatuses){e.next=23;break}return e.next=23,this.findStatusesPerRecipient(s);case 23:return e.abrupt("return",s);case 24:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAttachment",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t,n){var r,o,s;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));
case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(r=this._resolveMessage(t),o=!1,r){e.next=15;break}return o=!0,e.next=14,this.find(t,{includeStatuses:!1,includeCounterParty:!1});case 14:r=e.sent;case 15:if(s=this.__getMessageAttachment(r,n),s.isLocal){e.next=23;break}if("name"in s||o){e.next=23;break}return e.next=20,this.find(t,{includeStatuses:!1,includeCounterParty:!1});case 20:r=e.sent,s=this.__getMessageAttachment(r,n),s.name||(s.name=null);case 23:return e.abrupt("return",s);case 24:case"end":return e.stop()}},e,this)}));return e}()},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Message.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Message.getMulti(e)}},{key:"__lookupCounterParty",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t){var n,r,o,s,u,c,l,f,d,p,y,h,g,v,m,b,w,E;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(r=[{model:this.host.models.User,finder:(n=this.host.users).find.bind(n)},{model:this.host.models.Group,finder:(n=this.host.groups).find.bind(n)}],r&&("function"==typeof r[M.default]||Array.isArray(r))){e.next=7;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+a(r));case 7:if(r&&("function"==typeof r[M.default]||Array.isArray(r))){e.next=9;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+i(r));case 9:o=!0,s=!1,u=void 0,e.prev=12,c=(0,j.default)(r);case 14:if(o=(l=c.next()).done){e.next=23;break}if(f=l.value,d=f.model,p=d.get(t),!p){e.next=20;break}return e.abrupt("return",p);case 20:o=!0,e.next=14;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(12),s=!0,u=e.t0;case 29:e.prev=29,e.prev=30,!o&&c.return&&c.return();case 32:if(e.prev=32,!s){e.next=35;break}throw u;case 35:return e.finish(32);case 36:return e.finish(29);case 37:if(r&&("function"==typeof r[M.default]||Array.isArray(r))){e.next=39;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+a(r));case 39:if(r&&("function"==typeof r[M.default]||Array.isArray(r))){e.next=41;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+i(r));case 41:y=!0,h=!1,g=void 0,e.prev=44,v=(0,j.default)(r);case 46:if(y=(m=v.next()).done){e.next=64;break}return b=m.value,w=b.finder,e.prev=49,e.next=52,w(t);case 52:if(E=e.sent,!E){e.next=55;break}return e.abrupt("return",E);case 55:e.next=61;break;case 57:if(e.prev=57,e.t1=e.catch(49),e.t1.code===Ge.default.NotFoundError.CODE){e.next=61;break}throw e.t1;case 61:y=!0,e.next=46;break;case 64:e.next=70;break;case 66:e.prev=66,e.t2=e.catch(44),h=!0,g=e.t2;case 70:e.prev=70,e.prev=71,!y&&v.return&&v.return();case 73:if(e.prev=73,!h){e.next=76;break}throw g;case 76:return e.finish(73);case 77:return e.finish(70);case 78:return e.abrupt("return",null);case 79:case"end":return e.stop()}},e,this,[[12,25,29,37],[30,,32,36],[44,66,70,78],[49,57],[71,,73,77]])}));return e}()},{key:"__getMessageAttachment",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(t));var n=this._resolveMessage(e);if(!n)return null;if(t=t.toString(),n.attachments){var r=(0,oe.default)(n.attachments,{id:t});return r}return null}},{key:"__getAttachmentPath",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(t));return"/message/"+e+"/attachment/"+t}},{key:"downloadAttachmentUrl",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(t));return this._downloadAttachmentBlobAndUrl(e,t).then(function(e){return e.url})}},{key:"downloadAttachment",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t,r){var o,s,u,c,l,f,d,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},y=p.fileName;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof r||"number"==typeof r){e.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(r));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof r||"number"==typeof r){e.next=8;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(r));case 8:e.next=25;break;case 16:return e.next=18,this._downloadAttachmentBlobAndUrl(o.serverId,r);case 18:s=e.sent.blob;case 19:y=y||u.name,y||(y="Attachment",o.sender.$placeholder||(y+=" from "+o.sender.displayName),y+=" at "+(0,xe.default)(o.createdAt).format("YYYY-MM-DD h-mma"),c=n(180),l=(0,ue.default)(c[u.contentType],"extensions.0")||"",l&&(y+="."+l)),f=n(137),d=f.saveAs,d(s,y),e.next=26;break;case 25:Ge.default.TargetNotSupportedError.raise();case 26:case"end":return e.stop()}},e,this)}));return e}()},{key:"_downloadAttachmentBlobAndUrl",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t,n){var r,o,s,u;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||"number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n||"number"==typeof n){e.next=8;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(n));case 8:e.next=27;break;case 13:if(o=e.sent){e.next=16;break}throw new Ge.default.NotFoundError("MessageAttachment",r.serverId+":"+n);case 16:if(!o.isLocal){e.next=23;break}return e.next=19,o.localPathPromise;case 19:return s=e.sent,e.abrupt("return",{blob:o.localFile,url:s});case 23:return u=this.__getAttachmentPath(r.serverId,n),e.abrupt("return",this.httpClient.downloadFileBlobAndUrl(u));case 25:e.next=28;break;case 27:Ge.default.TargetNotSupportedError.raise();case 28:case"end":return e.stop()}},e,this)}));return e}()},{key:"downloadAttachmentToFile",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t,n,r){var o,s;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||"number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "dest" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:if("string"==typeof n||"number"==typeof n){e.next=10;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "dest" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return n=n.toString(),o=this._resolveMessage(t),e.next=17,this.findAttachment(t,n);case 17:if(s=e.sent){e.next=20;break}throw new Ge.default.NotFoundError("MessageAttachment",o.serverId+":"+n);case 20:if(!/(\/|\\)$/.test(r)){e.next=26;break}if(!s.name){e.next=25;break}r+=s.name,e.next=26;break;case 25:throw new Error("missing file name in downloadAttachmentToFile(..., dest)");case 26:return e.abrupt("return",this.httpClient.downloadToFile(this.__getAttachmentPath(o.serverId,n),r));case 29:Ge.default.TargetNotSupportedError.raise();case 30:case"end":return e.stop()}},e,this)}));return e}()},{key:"__tryRetrievingMissingAttachmentName",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t,n){var r;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(r=this.__getMessageAttachment(t,n),!("name"in r)){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,this.find(t.serverId,{includeStatuses:!1,includeCounterParty:!1});case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"getMessageCount",value:function(){return this.host.models.Message.getAll().length}},{key:"getTotalUnreadCount",value:function(){return(0,ee.default)(this.host.models.Conversation.getAll(),"unreadCount")}},{key:"markAsRead",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+a(t));case 4:if(r=(0,ne.default)(r,{queue:this.host.currentlyServingOfflineMessages}),t=(n=(n=(n=t,Ke.arrayWrapBound).call(n),Fe.default).call(n,this._resolveModelId.bind(this)),Le.default).call(n),0!==t.length){e.next=8;break}return e.abrupt("return");case 8:if(!r.queue){e.next=12;break}return e.abrupt("return",this.__queueMessageStatuses({readIds:t}));case 12:return e.abrupt("return",this.__setMessagesStatus({readIds:t}));case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"markAsDelivered",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+a(t));case 4:if(r=(0,ne.default)(r,{queue:this.host.currentlyServingOfflineMessages}),t=(n=(n=(n=t,Ke.arrayWrapBound).call(n),Fe.default).call(n,this._resolveModelId.bind(this)),Le.default).call(n),0!==t.length){e.next=8;break}return e.abrupt("return");case 8:if(!r.queue){e.next=12;break}return e.abrupt("return",this.__queueMessageStatuses({deliveredIds:t}));case 12:return e.abrupt("return",this.__setMessagesStatus({deliveredIds:t}));case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"markAsReceived",value:function(){function e(){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(){var t=arguments;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.markAsDelivered.apply(this,t));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"__queueMessageStatuses",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t){var n,r=t.deliveredIds,o=t.readIds,s=arguments;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=s[0]&&(null==s[0].deliveredIds||Array.isArray(s[0].deliveredIds)&&s[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(null==s[0].readIds||Array.isArray(s[0].readIds)&&s[0].readIds.every(function(e){return"string"==typeof e}))){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  deliveredIds: ?Array<string>;\n  readIds: ?Array<string>;\n}\n\nGot:\n"+i(s[0]));case 2:if(null!=s[0]&&(null==s[0].deliveredIds||Array.isArray(s[0].deliveredIds)&&s[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(null==s[0].readIds||Array.isArray(s[0].readIds)&&s[0].readIds.every(function(e){return"string"==typeof e}))){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  deliveredIds: ?Array<string>;\n  readIds: ?Array<string>;\n}\n\nGot:\n"+a(s[0]));case 4:if(r&&(this._queuedMessageStatuses.deliveredIds=(0,Y.default)(this._queuedMessageStatuses.deliveredIds,r)),o&&(this._queuedMessageStatuses.readIds=(0,Y.default)(this._queuedMessageStatuses.readIds,o)),n=this._queuedMessageStatuses.deliveredIds.length+this._queuedMessageStatuses.readIds.length,!(n>=this.config.flushMessageMaxCount)){e.next=12;break}return this.logger.log("reached "+this.config.flushMessageMaxCount+" -- flushing"),e.abrupt("return",this.__flushQueueMessageStatuses());case 12:this._throttled_flushQueueMessageStatuses();case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"__flushQueueMessageStatuses",value:function(){var e=this._queuedMessageStatuses.deliveredIds.length+this._queuedMessageStatuses.readIds.length;e>0&&(this.__setMessagesStatus(this._queuedMessageStatuses),this._queuedMessageStatuses.deliveredIds=[],this._queuedMessageStatuses.readIds=[])}},{key:"__setMessagesStatus",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t){var n,r,o,a,i=this,s=t.deliveredIds,u=void 0===s?[]:s,c=t.readIds,l=void 0===c?[]:c;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),u=(n=(n=u,Fe.default).call(n,this._resolveModelId.bind(this)),Le.default).call(n),l=(n=(n=l,Fe.default).call(n,this._resolveModelId.bind(this)),Le.default).call(n),r=u.map(this._resolveMessage).filter(Boolean),o=l.map(this._resolveMessage).filter(Boolean),l=(0,X.default)(l,(n=Be.default.call(o,function(e){return e.recipientStatus===Te.MessageRecipientStatus.READ}),Fe.default).call(n,"id")),u=(0,X.default)(u,l,(n=Be.default.call(r,function(e){return e.recipientStatus===Te.MessageRecipientStatus.DELIVERED||e.recipientStatus===Te.MessageRecipientStatus.READ}),Fe.default).call(n,"id")),a={},u.length&&(a.delivered=u),l.length&&(a.read=l,o.forEach(function(e){return i.host.models.Message.inject({id:e.id,recipientStatus:Te.MessageRecipientStatus.READ,recipientStatusMarkingAsRead:!0})})),!(0,le.default)(a.delivered)||!(0,le.default)(a.read)){e.next=12;break}return e.abrupt("return",!1);case 12:return e.next=14,this.httpClient.post("/message/status",{data:a});case 14:l.length&&(a.read=l,o.forEach(function(e){return i.host.models.Message.inject({id:e.id,recipientStatus:Te.MessageRecipientStatus.READ,recipientStatusMarkingAsRead:!1})}),this.__checkForDeleteOnReadMessages(o)),u.length&&r.forEach(function(e){return i.host.models.Message.inject({id:e.id,recipientStatus:Te.MessageRecipientStatus.DELIVERED})});case 16:case"end":return e.stop()}},e,this)}));return e}()},{key:"__checkForDeleteOnReadMessages",value:function(e){var t=this;if(!Array.isArray(e)||!e.every(function(e){return e instanceof Object}))throw new TypeError('Value of argument "messages" violates contract.\n\nExpected:\nObject[]\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return e instanceof Object}))throw new TypeError('Value of argument "messages" violates contract.\n\nExpected:\nObject[]\n\nGot:\n'+a(e));Be.default.call(e,{deleteOnRead:!0}).forEach(function(e){return t.setMessageTTLInMinutes(e,1)})}},{key:"setMessageTTLInMinutes",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("number"!=typeof t)throw new TypeError('Value of argument "ttl" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));if("number"!=typeof t)throw new TypeError('Value of argument "ttl" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(t));var n=this._resolveMessage(e);if(n){var r=(0,xe.default)().add(t,"minute").toDate().getTime();this.host.models.Message.inject({id:n.id,ttl:t,expiresAt:r})}}},{key:"deleteExpiredMessages",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();t.getTime&&(t=t.getTime()),this.host.models.Message.getAll().filter(function(e){return e.expiresAt&&e.expiresAt<t}).forEach(function(t){return e.host.models.Message.eject(t)})}},{key:"findStatusesPerRecipient",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,P.default)(V.default.mark(function e(t){var n,r,o,s=this,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{includeUsers:!1},c=u.includeUsers,l=void 0!==c&&c;return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:if(this.host.requireUser(),n=this._resolveMessage(t)){e.next=8;break}return e.abrupt("return",null);case 8:if(n.serverId){e.next=10;break}throw new Error('Message "'+n.id+"\" isn't sent yet");case 10:return e.next=12,this.host.api.messages.findStatusesPerRecipient(n.serverId);case 12:if(r=e.sent,!r.is_recalled){e.next=16;break}return this.onMessageRecalled(n.serverId),e.abrupt("return");case 16:if(o=r.statuses.map(function(e){return s.__setMessageStatusPerRecipientFromServerData(n.serverId,e)}).some(function(e){return e}),o&&this.__touchMessage(n),!l){e.next=22;break}return e.next=21,x.default.all(n.statusesPerRecipient.map(function(e){return s.host.users.find(e.userId,{ignoreNotFound:!0})}));case 21:this.host.models.Message.touch(n);case 22:return e.abrupt("return",n.statusesPerRecipient);case 23:case"end":return e.stop()}},e,this)}));return e}()}]),t}(we.default),o(y.prototype,"__resolveCounterPartyEntityAndOrganizationId",[ke.privateMethod],(0,w.default)(y.prototype,"__resolveCounterPartyEntityAndOrganizationId"),y.prototype),o(y.prototype,"__resolveRemoteCounterPartyEntity",[ke.privateMethod],(0,w.default)(y.prototype,"__resolveRemoteCounterPartyEntity"),y.prototype),o(y.prototype,"__sendToKnownCounterParty",[ke.privateMethod],(0,w.default)(y.prototype,"__sendToKnownCounterParty"),y.prototype),o(y.prototype,"__sendToUnknownCounterParty",[ke.privateMethod],(0,w.default)(y.prototype,"__sendToUnknownCounterParty"),y.prototype),o(y.prototype,"__normalizeSendOptions",[ke.privateMethod],(0,w.default)(y.prototype,"__normalizeSendOptions"),y.prototype),o(y.prototype,"__ensureOrganization",[ke.privateMethod],(0,w.default)(y.prototype,"__ensureOrganization"),y.prototype),o(y.prototype,"__validateAttachments",[ke.privateMethod],(0,w.default)(y.prototype,"__validateAttachments"),y.prototype),o(y.prototype,"__normalizeMetadata",[ke.privateMethod],(0,w.default)(y.prototype,"__normalizeMetadata"),y.prototype),o(y.prototype,"__getNextSortNumber",[ke.privateMethod],(0,w.default)(y.prototype,"__getNextSortNumber"),y.prototype),o(y.prototype,"__setLocalMessageAttachments",[ke.privateMethod],(0,w.default)(y.prototype,"__setLocalMessageAttachments"),y.prototype),o(y.prototype,"__generateAttachmentDescriptor",[ke.privateMethod],(0,w.default)(y.prototype,"__generateAttachmentDescriptor"),y.prototype),o(y.prototype,"__loadLocalFilePathWithFileReader",[ke.privateMethod],(0,w.default)(y.prototype,"__loadLocalFilePathWithFileReader"),y.prototype),o(y.prototype,"__sendToGroupOfUsers",[ke.privateMethod],(0,w.default)(y.prototype,"__sendToGroupOfUsers"),y.prototype),o(y.prototype,"__prepareGroupForUsers",[ke.privateMethod,s],(0,w.default)(y.prototype,"__prepareGroupForUsers"),y.prototype),o(y.prototype,"_deleteLocalMessage",[ke.privateMethod],(0,w.default)(y.prototype,"_deleteLocalMessage"),y.prototype),o(y.prototype,"__recallSingle",[ke.privateMethod],(0,w.default)(y.prototype,"__recallSingle"),y.prototype),o(y.prototype,"__setMessageStatusPerRecipientFromServerData",[ke.privateMethod],(0,w.default)(y.prototype,"__setMessageStatusPerRecipientFromServerData"),y.prototype),o(y.prototype,"__touchMessage",[ke.privateMethod],(0,w.default)(y.prototype,"__touchMessage"),y.prototype),o(y.prototype,"_resolveMessage",[ke.privateMethod,ze.default],(0,w.default)(y.prototype,"_resolveMessage"),y.prototype),o(y.prototype,"_getMessageByServerId",[ke.privateMethod],(0,w.default)(y.prototype,"_getMessageByServerId"),y.prototype),o(y.prototype,"_setSingleUserMessageRecipientMessageStatus",[ke.privateMethod],(0,w.default)(y.prototype,"_setSingleUserMessageRecipientMessageStatus"),y.prototype),o(y.prototype,"__canChangeRecipientStatus",[ke.privateMethod],(0,w.default)(y.prototype,"__canChangeRecipientStatus"),y.prototype),o(y.prototype,"find",[u],(0,w.default)(y.prototype,"find"),y.prototype),o(y.prototype,"__lookupCounterParty",[ke.privateMethod],(0,w.default)(y.prototype,"__lookupCounterParty"),y.prototype),o(y.prototype,"__getMessageAttachment",[ke.privateMethod],(0,w.default)(y.prototype,"__getMessageAttachment"),y.prototype),o(y.prototype,"__getAttachmentPath",[ke.privateMethod],(0,w.default)(y.prototype,"__getAttachmentPath"),y.prototype),o(y.prototype,"downloadAttachmentUrl",[c],(0,w.default)(y.prototype,"downloadAttachmentUrl"),y.prototype),o(y.prototype,"downloadAttachment",[l],(0,w.default)(y.prototype,"downloadAttachment"),y.prototype),o(y.prototype,"_downloadAttachmentBlobAndUrl",[ke.privateMethod,f],(0,w.default)(y.prototype,"_downloadAttachmentBlobAndUrl"),y.prototype),o(y.prototype,"__tryRetrievingMissingAttachmentName",[ke.privateMethod],(0,w.default)(y.prototype,"__tryRetrievingMissingAttachmentName"),y.prototype),o(y.prototype,"__queueMessageStatuses",[ke.privateMethod],(0,w.default)(y.prototype,"__queueMessageStatuses"),y.prototype),o(y.prototype,"__flushQueueMessageStatuses",[ke.privateMethod,ze.default],(0,w.default)(y.prototype,"__flushQueueMessageStatuses"),y.prototype),o(y.prototype,"__setMessagesStatus",[ke.privateMethod],(0,w.default)(y.prototype,"__setMessagesStatus"),y.prototype),o(y.prototype,"__checkForDeleteOnReadMessages",[ke.privateMethod],(0,w.default)(y.prototype,"__checkForDeleteOnReadMessages"),y.prototype),o(y.prototype,"deleteExpiredMessages",[ze.default],(0,w.default)(y.prototype,"deleteExpiredMessages"),y.prototype),o(y.prototype,"findStatusesPerRecipient",[d],(0,w.default)(y.prototype,"findStatusesPerRecipient"),y.prototype),p=y))||p);t.default=We,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,P.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,P.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c,l,f,d,p=n(7),y=r(p),h=n(10),g=r(h),v=n(11),m=r(v),b=n(39),w=r(b),E=n(28),x=r(E),_=n(29),k=r(_),O=n(45),I=r(O),T=n(40),j=r(T),A=n(16),M=r(A),G=n(18),V=r(G),z=n(9),S=r(z),C=n(6),P=r(C),N=n(8),R=r(N),U=n(3),q=r(U),F=n(1),$=r(F),L=n(2),D=r(L),B=n(5),K=r(B),Z=n(4),W=r(Z),H=n(70),X=r(H),Q=n(149),Y=r(Q),J=n(175),ee=r(J),te=n(13),ne=r(te),re=n(15),oe=r(re),ae=n(17),ie=n(14),se=n(22),ue=(s=(0,ae.decorator)(),u=(0,ae.decorator)(),(0,ie.classWithPrivateMethods)((d=f=function(e){function t(){return(0,$.default)(this,t),(0,K.default)(this,(t.__proto__||(0,q.default)(t)).apply(this,arguments))}return(0,W.default)(t,e),(0,D.default)(t,[{key:"fullUpdate",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,R.default)(S.default.mark(function e(t,n,r){return S.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if(n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:if(n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:if(r){e.next=14;break}throw new oe.default.ValidationError("organizationId","required");case 14:if(!(this.host.config.maxMetadataKeyCount>0&&(0,P.default)(n).length>this.host.config.maxMetadataKeyCount)){e.next=16;break}throw new oe.default.ValidationError("entireData","invalid","Total number of metadata keys is "+(0,P.default)(n)+" and should not exceed "+this.host.config.maxMetadataKeyCount);case 16:return this.host.requireUser(),t=this._resolveModelId(t),e.prev=18,e.next=21,this.host.api.metadata.update(t,n,r);case 21:return this.__injectMetadata(t,r,n),e.abrupt("return",n);case 25:
if(e.prev=25,e.t0=e.catch(18),!e.t0.response||404!==e.t0.response.status){e.next=31;break}throw new oe.default.NotFoundError("metadata",t);case 31:throw e.t0;case 32:case"end":return e.stop()}},e,this,[[18,25]])}));return e}()},{key:"update",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,R.default)(S.default.mark(function e(t,n,r){var o,s;return S.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if(n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));case 4:if("string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:if(n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));case 10:if("string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:if(r){e.next=14;break}throw new oe.default.ValidationError("organizationId","required");case 14:return e.next=16,this.find(t,r);case 16:return o=e.sent,s=(0,V.default)({},o,n),e.abrupt("return",this.fullUpdate(t,s,r));case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,R.default)(S.default.mark(function e(t,n){var r;return S.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(n){e.next=10;break}throw new oe.default.ValidationError("organizationId","required");case 10:return this.host.requireUser(),t=this._resolveModelId(t),e.prev=12,e.next=15,this.host.api.metadata.find(t,n);case 15:return r=e.sent,this.__injectMetadata(t,n,r),e.abrupt("return",r);case 20:if(e.prev=20,e.t0=e.catch(12),!e.t0.response||404!==e.t0.response.status){e.next=26;break}throw new oe.default.NotFoundError("metadata",t);case 26:throw e.t0;case 27:case"end":return e.stop()}},e,this,[[12,20]])}));return e}()},{key:"findMulti",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,R.default)(S.default.mark(function e(t,n){var r,o,s,u,c=this;return S.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:if(n){e.next=10;break}throw new oe.default.ValidationError("organizationId","required");case 10:return this.host.requireUser(),t=(0,ee.default)((0,se.arrayWrap)(t).map(this._resolveModelId.bind(this))),r=(0,Y.default)(t,20),o=r.map(function(e){return c.__findMultiPaged(e,n)}),e.next=16,M.default.all(o);case 16:return s=e.sent,u=X.default.apply(void 0,[{}].concat((0,j.default)(s))),e.abrupt("return",u);case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"__findMultiPaged",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,R.default)(S.default.mark(function e(t,n){var r,o,s,u,c,l,f,d,p,y,h,g,v,m,b,E;return S.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return e.prev=8,e.next=11,this.host.api.metadata.findMulti(t,n);case 11:if(r=e.sent,f=(0,I.default)(r),f&&("function"==typeof f[k.default]||Array.isArray(f))){e.next=15;break}throw new TypeError("Expected _Object$entries to be iterable, got "+a(f));case 15:if(f&&("function"==typeof f[k.default]||Array.isArray(f))){e.next=17;break}throw new TypeError("Expected _Object$entries to be iterable, got "+i(f));case 17:for(o=!0,s=!1,u=void 0,e.prev=20,c=(0,x.default)(f);!(o=(l=c.next()).done);o=!0)d=(0,w.default)(l.value,2),p=d[0],y=d[1],y&&this.__injectMetadata(p,n,y);e.next=28;break;case 24:e.prev=24,e.t0=e.catch(20),s=!0,u=e.t0;case 28:e.prev=28,e.prev=29,!o&&c.return&&c.return();case 31:if(e.prev=31,!s){e.next=34;break}throw u;case 34:return e.finish(31);case 35:return e.finish(28);case 36:return e.abrupt("return",r);case 39:if(e.prev=39,e.t1=e.catch(8),!e.t1.response||404!==e.t1.response.status){e.next=84;break}if(h={},t&&("function"==typeof t[k.default]||Array.isArray(t))){e.next=45;break}throw new TypeError("Expected ids to be iterable, got "+a(t));case 45:if(t&&("function"==typeof t[k.default]||Array.isArray(t))){e.next=47;break}throw new TypeError("Expected ids to be iterable, got "+i(t));case 47:g=!0,v=!1,m=void 0,e.prev=50,b=(0,x.default)(t);case 52:if(g=(E=b.next()).done){e.next=67;break}return p=E.value,e.prev=54,e.next=57,this.find(p,n);case 57:h[p]=e.sent,e.next=64;break;case 60:if(e.prev=60,e.t2=e.catch(54),e.t2.code===oe.default.NotFoundError.CODE){e.next=64;break}throw e.t2;case 64:g=!0,e.next=52;break;case 67:e.next=73;break;case 69:e.prev=69,e.t3=e.catch(50),v=!0,m=e.t3;case 73:e.prev=73,e.prev=74,!g&&b.return&&b.return();case 76:if(e.prev=76,!v){e.next=79;break}throw m;case 79:return e.finish(76);case 80:return e.finish(73);case 81:return e.abrupt("return",h);case 84:throw e.t1;case 85:case"end":return e.stop()}},e,this,[[8,39],[20,24,28,36],[29,,31,35],[50,69,73,81],[54,60],[74,,76,80]])}));return e}()},{key:"__injectMetadata",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));var r=e+":"+t;this.host.models.Metadata.inject({id:r,data:n,entityId:e,organizationId:t})}}]),t}(ne.default),f.METADTA_TYPES=["user","group"],l=d,o(l.prototype,"find",[s],(0,m.default)(l.prototype,"find"),l.prototype),o(l.prototype,"findMulti",[u],(0,m.default)(l.prototype,"findMulti"),l.prototype),o(l.prototype,"__findMultiPaged",[ie.privateMethod],(0,m.default)(l.prototype,"__findMultiPaged"),l.prototype),o(l.prototype,"__injectMetadata",[ie.privateMethod],(0,m.default)(l.prototype,"__injectMetadata"),l.prototype),c=l))||c);t.default=ue,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,G.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,G.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,f.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c,l=n(7),f=r(l),d=n(10),p=r(d),y=n(11),h=r(y),g=n(9),v=r(g),m=n(8),b=r(m),w=n(3),E=r(w),x=n(1),_=r(x),k=n(2),O=r(k),I=n(5),T=r(I),j=n(4),A=r(j),M=n(6),G=r(M),V=n(135),z=r(V),S=n(35),C=r(S),P=n(13),N=r(P),R=n(49),U=r(R),q=n(14),F=n(17),$=n(27),L=r($),D=n(24),B=r(D),K=n(55),Z=r(K),W={account:"user",group:"group"},H=new z.default((0,G.default)(W)),X=(0,C.default)(W).concat(["conversation"]),Q=525600,Y=(s=(0,F.decorator)(),(0,q.classWithPrivateMethods)((c=function(e){function t(){return(0,_.default)(this,t),(0,T.default)(this,(t.__proto__||(0,E.default)(t)).apply(this,arguments))}return(0,A.default)(t,e),(0,O.default)(t,[{key:"mounted",value:function(){this._muteEntriesByConversationId={},this._fetched=!1}},{key:"dispose",value:function(){this._muteEntriesByConversationId=null,this._fetched=!1}},{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(){var t,n;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetched){e.next=6;break}return e.next=3,this.host.api.mute.findAll();case 3:n=e.sent,(t=n.filter(function(e){return H.has(e.sender_type)}).map(this._parseMuteEntry),U.default).call(t,this._isExpired).forEach(this._addEntry),this._fetched=!0;case 6:return e.abrupt("return",(0,C.default)(this._muteEntriesByConversationId));case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"_parseMuteEntry",value:function(e){var t=+e.mute_duration,n=new Date(1e3*+e.mute_start).getTime(),r=(0,Z.default)(n).add(t,"minute").toDate().getTime(),o=W[e.sender_type],a=e.caller_organization||e.organization_id,i=e.sender_token,s=this.host.conversations.getConversationKey(o,i,a);return{conversationId:s,durationInMinutes:t,startedAt:n,expiresAt:r,organizationId:a,entityId:i,entityType:o}}},{key:"_isExpired",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "entry" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "entry" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));return e.expiresAt<Date.now()}},{key:"_addEntry",value:function(e){var t=e.conversationId,n=e.entityType,r=e.entityId,o=e.organizationId,a=e.durationInMinutes,i=e.startedAt;t=t||this.host.conversations.getConversationKey(n,r,o),i=i||Date.now();var s=(0,Z.default)(i).add(a,"minute").toDate().getTime(),u={conversationId:t,durationInMinutes:a,startedAt:i,expiresAt:s,organizationId:o,entityId:r,entityType:n};return this.host.models.Conversation.touch(t),this._muteEntriesByConversationId[t]=u,u}},{key:"_removeEntry",value:function(e){var t=e.conversationId,n=e.entityType,r=e.entityId,o=e.organizationId;t=t||this.host.conversations.getConversationKey(n,r,o),delete this._muteEntriesByConversationId[t],this.host.models.Conversation.touch(t)}},{key:"_removeAllEntries",value:function(){var e=this;(0,C.default)(this._muteEntriesByConversationId).forEach(function(t){return e._removeEntry(t)})}},{key:"getByConversationId",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));var t=this._muteEntriesByConversationId[e];return t?this._isExpired(t)?(delete this._muteEntriesByConversationId[e],null):t:null}},{key:"unmuteAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(){return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.mute.unmuteAll();case 2:this._removeAllEntries();case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"mute",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(t,n,r){var o;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if(null==r||"string"==typeof r){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(r));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:if("number"==typeof n){e.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if(null==r||"string"==typeof r){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(r));case 12:if(o=this._resolveEntity(t,X)){e.next=15;break}throw new Error("entity "+t+" not found");case 15:e.t0=o.$entityType,e.next="conversation"===e.t0?18:"user"===e.t0?19:"group"===e.t0?21:"organization"===e.t0?22:23;break;case 18:return e.abrupt("return",this.mute(o.counterParty,n,o.organizationId));case 19:return L.default.notEmpty("organizationId",r),e.abrupt("return",this.muteUser(o,n,r));case 21:return e.abrupt("return",this.muteGroup(o,n));case 22:return e.abrupt("return",this.muteOrganization(o,n));case 23:case"end":return e.stop()}},e,this)}));return e}()},{key:"unmute",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(t,n){var r;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if(null==n||"string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if(null==n||"string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+a(n));case 8:if(r=this._resolveEntity(t,X)){e.next=11;break}throw new Error("entity "+t+" not found");case 11:e.t0=r.$entityType,e.next="conversation"===e.t0?14:"user"===e.t0?15:"group"===e.t0?17:"organization"===e.t0?18:19;break;case 14:return e.abrupt("return",this.unmute(r.counterParty,r.organizationId));case 15:return L.default.notEmpty("organizationId",n),e.abrupt("return",this.unmuteUser(r,n));case 17:return e.abrupt("return",this.unmuteGroup(r));case 18:return e.abrupt("return",this.unmuteOrganization(r));case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"muteUser",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(t,n,r){return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if("string"==typeof r||r instanceof Object){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(r));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:if("number"==typeof n){e.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if("string"==typeof r||r instanceof Object){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(r));case 12:return this.__validateDurationInMinutes(n),t=this._resolveModelIdWithTypes(t,"user"),r=this._resolveModelId(r),e.next=17,this.host.api.mute.muteUser(t,n,r,{recipientOrganizationId:r});case 17:this._addEntry({entityType:"user",entityId:t,organizationId:r,durationInMinutes:n});case 18:case"end":return e.stop()}},e,this)}));return e}()},{key:"unmuteUser",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(t,n){return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:return t=this._resolveModelIdWithTypes(t,"user"),n=this._resolveModelId(n),e.next=12,this.host.api.mute.unmuteUser(t,n,{recipientOrganizationId:n});case 12:this._removeEntry({entityType:"user",entityId:t,organizationId:n});case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"muteGroup",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(t,n,r){var o;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));case 4:if(null==r||"string"==typeof r||null==r||r instanceof Object){e.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+i(r));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 8:if("number"==typeof n){e.next=10;break}throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(n));case 10:if(null==r||"string"==typeof r||null==r||r instanceof Object){e.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(r));case 12:return this.__validateDurationInMinutes(n),o=this._resolveEntity(t,"group"),o?(t=o.id,r=o.organizationId):r=this._resolveModelId(r),L.default.notEmpty("organizationId",r),e.next=18,this.host.api.mute.muteGroup(t,n,r);case 18:this._addEntry({entityType:"group",entityId:t,organizationId:r,durationInMinutes:n});case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"unmuteGroup",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,b.default)(v.default.mark(function e(t,n){var r;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if(null==n||"string"==typeof n||null==n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if(null==n||"string"==typeof n||null==n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+a(n));case 8:return r=this._resolveEntity(t,"group"),r?(t=r.id,n=r.organizationId):(L.default.notEmpty("organizationId",n),n=this._resolveModelId(n)),e.next=12,this.host.api.mute.unmuteGroup(t,n);case 12:this._removeEntry({entityType:"group",entityId:t,organizationId:n});case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"reactToMuteEvent",value:function(e){if(e.data.token===this.host.currentUser.id){var t=e.data.action;if("clear"===t)return void this._removeAllEntries();var n=this._parseMuteEntry(e.data);switch(t){case"add":this._muteEntriesByConversationId[n.conversationId]=n;break;case"del":delete this._muteEntriesByConversationId[n.conversationId]}}}},{key:"__validateDurationInMinutes",value:function(e){if("number"!=typeof e)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(e));if("number"!=typeof e)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+a(e));(e<0||e>Q||e%1!==0)&&L.default.raise("durationInMinutes","invalid","should be a positive integer from 1 to "+Q+" (1 year)")}}]),t}(N.default),o(c.prototype,"findAll",[s],(0,h.default)(c.prototype,"findAll"),c.prototype),o(c.prototype,"_parseMuteEntry",[q.privateMethod,B.default],(0,h.default)(c.prototype,"_parseMuteEntry"),c.prototype),o(c.prototype,"_addEntry",[q.privateMethod,B.default],(0,h.default)(c.prototype,"_addEntry"),c.prototype),o(c.prototype,"_removeEntry",[q.privateMethod,B.default],(0,h.default)(c.prototype,"_removeEntry"),c.prototype),o(c.prototype,"_removeAllEntries",[q.privateMethod],(0,h.default)(c.prototype,"_removeAllEntries"),c.prototype),o(c.prototype,"__validateDurationInMinutes",[q.privateMethod],(0,h.default)(c.prototype,"__validateDurationInMinutes"),c.prototype),u=c))||u);t.default=Y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,y.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,y.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c,l,f=n(7),d=r(f),p=n(6),y=r(p),h=n(10),g=r(h),v=n(11),m=r(v),b=n(12),w=r(b),E=n(9),x=r(E),_=n(8),k=r(_),O=n(3),I=r(O),T=n(1),j=r(T),A=n(2),M=r(A),G=n(5),V=r(G),z=n(4),S=r(z),C=n(26),P=r(C),N=n(73),R=r(N),U=n(34),q=r(U),F=n(19),$=r(F),L=n(173),D=r(L),B=n(53),K=r(B),Z=n(13),W=r(Z),H=n(17),X=n(15),Q=r(X),Y=n(32),J=r(Y),ee=n(49),te=r(ee),ne=n(48),re=r(ne),oe=n(37),ae=r(oe),ie=n(184),se=r(ie),ue=n(24),ce=r(ue),le=n(14),fe=(s=(0,H.decorator)({memoize:!0}),u=(0,H.decorator)(),(0,le.classWithPrivateMethods)((l=function(e){function t(){return(0,j.default)(this,t),(0,V.default)(this,(t.__proto__||(0,I.default)(t)).apply(this,arguments))}return(0,S.default)(t,e),(0,M.default)(t,[{key:"mounted",value:function(){this.host.models.Conversation.on("afterInject",this._onConversationChange),this.host.models.Conversation.on("afterEject",this._onConversationChange)}},{key:"dispose",value:function(){this.host.models.Conversation.off("afterInject",this._onConversationChange),this.host.models.Conversation.off("afterEject",this._onConversationChange),H.decorator.clear(this._findAll)}},{key:"create",value:function(){function e(){return t.apply(this,arguments)}var t=(0,k.default)(x.default.mark(function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:void 0,ttl:void 0,deleteOnRead:void 0,allowPublicGroups:void 0,pinLock:void 0,settingsRestricted:void 0,autologoutTime:void 0,lifecycleCallback:void 0,groupLifespan:void 0,welcomeEmailSettings:void 0};return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),e.abrupt("return",this.httpClient.post("/organization",{data:n}).then(function(e){var r=e.getHeader("TT-X-Organization-Key"),o=t.host.models.Organization.inject({id:r,name:n.name});return o}));case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"update",value:function(){function e(){return t.apply(this,arguments)}var t=(0,k.default)(x.default.mark(function e(){var t,n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:void 0,name:void 0,ttl:void 0,deleteOnRead:void 0,allowPublicGroups:void 0,pinLock:void 0,settingsRestricted:void 0,autologoutTime:void 0,lifecycleCallback:void 0,groupLifespan:void 0,welcomeEmailSettings:void 0,welcomeEmailLogo:void 0,autoSendWelcomeEmail:void 0};return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),t=ae.default.underscoreObject({name:r.name,ttl:r.ttl,deleteOnRead:r.deleteOnRead,allowPublicGroups:r.allowPublicGroups,pinLock:r.pinLock,settingsRestricted:r.settingsRestricted,autologoutTime:r.autologoutTime,lifecycleCallback:r.lifecycleCallback,groupLifespan:r.groupLifespan,welcomeEmailSettings:r.welcomeEmailSettings,welcomeEmailLogo:r.welcomeEmailLogo,autoSendWelcomeEmail:r.autoSendWelcomeEmail}),e.abrupt("return",this.httpClient.post("/organization/:id",{urlParams:{id:r.id},data:t}).then(function(e){var o=n.host.models.Organization.inject((0,w.default)({id:r.id},t));return o}));case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,k.default)(x.default.mark(function e(){var t,n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{onlyApproved:!1};return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),e.next=3,this._findAll();case 3:return t=e.sent,r.onlyApproved&&(t=(0,K.default)(t,{pending:!1})),t=(0,D.default)(t,function(e){return e.name.toLowerCase()}),t.forEach(function(e){return n.__reloadConversations(e)}),e.abrupt("return",t);case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"refreshAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,k.default)(x.default.mark(function e(){return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return H.decorator.clear(this._findAll),
e.next=3,this._findAll();case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"_findAll",value:function(){function e(){return t.apply(this,arguments)}var t=(0,k.default)(x.default.mark(function e(){var t,n=this;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.organizations.findAllOfUser(this.host.currentUserId);case 2:return t=e.sent,t=t.map(function(e){return n.host.models.Organization.inject(e)}),e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,k.default)(x.default.mark(function e(t){var n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(o=(0,$.default)(o,{ignoreNotFound:!1,bypassCache:!1}),this.host.requireUser(),n=void 0,o.bypassCache){e.next=11;break}if(n=this.host.models.Organization.get(t),!n||n.$placeholder){e.next=11;break}return e.abrupt("return",n);case 11:return e.next=13,this.host.api.organizations.find(this.host.currentUserId,t);case 13:if(r=e.sent,!r){e.next=19;break}n=this.host.models.Organization.inject(r),this.__reloadConversations(n),e.next=21;break;case 19:if(o.ignoreNotFound){e.next=21;break}throw new Q.default.NotFoundError(this.host.models.Organization.name,t);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}},e,this)}));return e}()},{key:"getSettingValue",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));e=this._resolveModelId(e);var n=this.getById(e);return n?n.getSettingValue(t):null}},{key:"getAll",value:function(){return this.host.models.Organization.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.Organization.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.Organization.getMulti(e)}},{key:"_onConversationChange",value:function(e,t){this.__reloadConversations(t.organization)}},{key:"__reloadConversations",value:function(e){var t,n=this;if(e){var r=(0,q.default)(e,["conversations","unreadCount","unreadPriorityCount"]),o=(t=(t=(t=this.host.models.Conversation.getAll(),J.default).call(t,{organizationId:e.id}),te.default).call(t,function(e){return n.host.config.hiddenUsers.length>0&&n.host.config.hiddenUsers.includes(e.counterPartyId)}),re.default).call(t,["lastEventMessageSortNumber","_origIndex"],["desc","asc"]),a=(0,R.default)(o,"unreadCount"),i=(0,R.default)(o,"unreadPriorityCount"),s={conversations:o,unreadCount:a,unreadPriorityCount:i},u=!1;(0,P.default)(r,function(t,n){(0,se.default)(t,s[n])||(e[n]=s[n],u=!0)}),u&&this.host.models.Organization.inject(e)}}}]),t}(W.default),o(l.prototype,"findAll",[H.decorator],(0,m.default)(l.prototype,"findAll"),l.prototype),o(l.prototype,"refreshAll",[H.decorator],(0,m.default)(l.prototype,"refreshAll"),l.prototype),o(l.prototype,"_findAll",[le.privateMethod,s],(0,m.default)(l.prototype,"_findAll"),l.prototype),o(l.prototype,"find",[u],(0,m.default)(l.prototype,"find"),l.prototype),o(l.prototype,"_onConversationChange",[le.privateMethod,ce.default],(0,m.default)(l.prototype,"_onConversationChange"),l.prototype),o(l.prototype,"__reloadConversations",[le.privateMethod],(0,m.default)(l.prototype,"__reloadConversations"),l.prototype),c=l))||c);t.default=fe,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a=n(3),i=r(a),s=n(1),u=r(s),c=n(2),l=r(c),f=n(5),d=r(f),p=n(4),y=r(p),h=n(13),g=r(h),v=n(23),m=n(14),b=(0,m.classWithPrivateMethods)(o=function(e){function t(e,n){return(0,u.default)(this,t),(0,d.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n))}return(0,y.default)(t,e),(0,l.default)(t,[{key:"mounted",value:function(){this._data={}}},{key:"dispose",value:function(){this._data=null}},{key:"reactToPresenceEvent",value:function(e){this.set(e.data.from,v.PresenceStatus.resolve(e.data.type))}},{key:"set",value:function(e,t){var n=this._data[e]!==t;if(n){var r=this.host.models.User.get(e);this._data[e]=t,this.emit("change",{userId:e,presence:t,user:r})}}},{key:"get",value:function(e){return e===this.host.currentUserId?v.PresenceStatus.AVAILABLE:this._data[e]||null}}]),t}(g.default))||o;t.default=b,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,i,s=n(11),u=r(s),c=n(9),l=r(c),f=n(16),d=r(f),p=n(6),y=r(p),h=n(8),g=r(h),v=n(3),m=r(v),b=n(1),w=r(b),E=n(2),x=r(E),_=n(5),k=r(_),O=n(4),I=r(O),T=n(26),j=r(T),A=n(164),M=r(A),G=n(161),V=r(G),z=n(153),S=r(z),C=n(43),P=r(C),N=n(52),R=r(N),U=n(35),q=r(U),F=n(13),$=r(F),L=n(17),D=n(15),B=r(D),K=n(37),Z=r(K),W=n(59),H=n(22),X={user:"account",distributionList:"distribution_list",group:"group",organization:"organization",room:"public_group"},Q=(0,q.default)(X),Y=(a=(0,L.decorator)(),i=function(e){function t(){return(0,w.default)(this,t),(0,k.default)(this,(t.__proto__||(0,m.default)(t)).apply(this,arguments))}return(0,I.default)(t,e),(0,x.default)(t,[{key:"query",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,g.default)(l.default.mark(function e(t){var n,r,o,a,i,s,u,c,f,p=this,h=t.types,g=void 0===h?[]:h,v=t.query,m=void 0===v?{}:v,b=t.continuation,w=void 0===b?null:b,E=t.includeDisabled,x=void 0!==E&&E,_=t.excludeIds,k=void 0===_?[]:_,O=t.excludeSelf,I=void 0!==O&&O,T=t.resultsFormat,A=void 0===T?"entities":T,G=t.organizationId,z=void 0===G?null:G,C=t.organizationIds,N=void 0===C?[]:C,U=t.sort,q=void 0===U?[]:U,F=t.includeMetadata,$=void 0!==F&&F;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==g.length){e.next=2;break}throw new B.default.ValidationError("types","required","no types specified");case 2:if(g=g.map(function(e){return X[e]}),n=(0,R.default)(g,Q),!(n.length>0)){e.next=6;break}throw new B.default.ValidationError("types","invalid","invalid types: "+n.join(", "));case 6:if(z&&(N=[z]),0!==N.length){e.next=9;break}throw new B.default.ValidationError("organizationIds","invalid","search must be done in a context of an organization");case 9:return"ids"===A&&(A="tokens"),r={type:g,include_disabled:x,directory:N,results_format:A},w&&(r.continuation=w),q&&q.length&&(r.sort=q),k=(0,H.arrayWrap)(k),m&&(0,y.default)(m).length>0&&(r.bool={must:Z.default.underscoreObject(m)}),e.next=17,this.httpClient.post("/search",{data:r});case 17:if(o=e.sent,a=o.data.results,i=this.host.currentUser.id,s=(0,P.default)(a,function(e,t){var n=t.type,r=t.entity,o=t.organization_id;if(0!==(0,y.default)(r).length){"tigertext:entity:account"===n&&(0,H.replaceKey)(r,"status","account_status");var a=p.host.injectModel(r,n);if(!(k.length&&k.includes(a.id)||I&&a.id===i)){if(!a)return void p.logger.warn("no entity for ",t);var s=new W.SearchResult(a,o);e.push(s)}}},[]),!$){e.next=28;break}if(u=(0,S.default)(s,"organizationId"),c=(0,V.default)(s,"entityId"),f=(0,P.default)(u,function(e,t,n){e.push(p.host.metadata.findMulti((0,M.default)(t,"entityId"),n).then(function(e){(0,j.default)(e,function(e,t){return c[t].metadata=e})}))},[]),!(f.length>0)){e.next=28;break}return e.next=28,d.default.all(f);case 28:return e.abrupt("return",s);case 29:case"end":return e.stop()}},e,this)}));return e}()}]),t}($.default),o(i.prototype,"query",[a],(0,u.default)(i.prototype,"query"),i.prototype),i);t.default=Y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,d.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,d.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c=n(7),l=r(c),f=n(6),d=r(f),p=n(10),y=r(p),h=n(11),g=r(h),v=n(12),m=r(v),b=n(9),w=r(b),E=n(8),x=r(E),_=n(3),k=r(_),O=n(1),I=r(O),T=n(2),j=r(T),A=n(5),M=r(A),G=n(4),V=r(G),z=n(35),S=r(z),C=n(13),P=r(C),N=n(68),R=r(N),U=n(47),q=r(U),F=n(25),$=r(F),L=n(24),D=r(L),B=n(14),K="global",Z=(0,B.classWithPrivateMethods)((u=function(e){function t(){return(0,I.default)(this,t),(0,M.default)(this,(t.__proto__||(0,k.default)(t)).apply(this,arguments))}return(0,V.default)(t,e),(0,j.default)(t,[{key:"mounted",value:function(){this._typers={},this._currentUserTyping={},this.host.on("message:sending",this._onMessageSending)}},{key:"dispose",value:function(){var e;(e=(e=(e=(e=this._typers,R.default).call(e),$.default).call(e,S.default),q.default).call(e),$.default).call(e,"timer").forEach(function(e){return clearTimeout(e)}),(e=(e=this._currentUserTyping,R.default).call(e),$.default).call(e,"timer").forEach(function(e){return clearTimeout(e)}),this._typers=null,this.host.removeListener("message:sending",this._onMessageSending)}},{key:"reactToIsTypingEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "event" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(e));this.host.requireUser();var t=e.data.sender_token;if(t!==this.host.currentUserId){var n=e.data.group_token,r=n||K,o="typing"===e.data.status;this.host.models.User.ensureEntity(t,{onlyPlaceholder:!1}),this._setTypingStatusOfUser(r,t,o)}}},{key:"startTyping",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("boolean"==typeof n||"number"==typeof n){e.next=4;break}throw new TypeError('Value of argument "autoStopAfterTimeout" violates contract.\n\nExpected:\nboolean | number\n\nGot:\n'+i(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 6:if("boolean"==typeof n||"number"==typeof n){e.next=8;break}throw new TypeError('Value of argument "autoStopAfterTimeout" violates contract.\n\nExpected:\nboolean | number\n\nGot:\n'+a(n));case 8:return t=this._resolveModelId(t),this.host.requireUser(),e.next=12,this.host.api.messages.startTyping(t);case 12:t in this._currentUserTyping&&clearTimeout(this._currentUserTyping[t].timer),this._currentUserTyping[t]={},n&&(this._currentUserTyping[t].timer=this._createClearTimerForCurrentUser(t,"number"==typeof n?n:void 0));case 15:case"end":return e.stop()}},e,this)}));return e}()},{key:"stopTyping",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,x.default)(w.default.mark(function e(t){return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 4:return t=this._resolveModelId(t),this.host.requireUser(),t in this._currentUserTyping&&(clearTimeout(this._currentUserTyping[t].timer),delete this._currentUserTyping[t]),e.next=9,this.host.api.messages.stopTyping(t);case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"_setTypingStatusOfUser",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("boolean"!=typeof n)throw new TypeError('Value of argument "isTyping" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+i(n));if(null!=r&&"boolean"!=typeof r)throw new TypeError('Value of argument "timedOut" violates contract.\n\nExpected:\n?boolean\n\nGot:\n'+i(r));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));if("boolean"!=typeof n)throw new TypeError('Value of argument "isTyping" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+a(n));if(null!=r&&"boolean"!=typeof r)throw new TypeError('Value of argument "timedOut" violates contract.\n\nExpected:\n?boolean\n\nGot:\n'+a(r));if(n){this._typers[e]||(this._typers[e]={});var o=t in this._typers[e];if(o&&clearTimeout(this._typers[e][t].timer),this._typers[e][t]={timer:this._createClearTimerForOtherUser(e,t)},o)return}else{if(!this._typers[e]||!this._typers[e][t])return;clearTimeout(this._typers[e][t].timer),delete this._typers[e][t]}var s=(0,m.default)({userId:t},e!==K?{groupId:e}:null,{isTyping:n,timedOut:r});this.emit("change",s)}},{key:"_createClearTimerForOtherUser",value:function(e,t){var n=this;if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return setTimeout(function(){n.logger.info("auto stop typing for other typer",e,t),n._setTypingStatusOfUser(e,t,!1,!0)},this.host.config.clearTypingStatusTimeout)}},{key:"_createClearTimerForCurrentUser",value:function(e,t){var n=this;if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(null!=t&&"number"!=typeof t)throw new TypeError('Value of argument "timeout" violates contract.\n\nExpected:\n?number\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if(null!=t&&"number"!=typeof t)throw new TypeError('Value of argument "timeout" violates contract.\n\nExpected:\n?number\n\nGot:\n'+a(t));return setTimeout(function(){n.logger.info("auto stop typing for current user",e),n.stopTyping(e)},"number"==typeof t?t:this.host.config.clearTypingStatusTimeout)}},{key:"isUserTyping",value:function(e){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(e));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(e));return e=this._resolveModelId(e),this._isUserTypingInContext(K,e)}},{key:"isCurrentUserTyping",value:function(e){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(e));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(e));return e=this._resolveModelId(e),e in this._currentUserTyping}},{key:"isUserTypingInGroup",value:function(e,t){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(e));if(!(t instanceof Object||"string"==typeof t))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+i(t));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(e));if(!(t instanceof Object||"string"==typeof t))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+a(t));return t=this._resolveModelId(t),e=this._resolveModelId(e),this._isUserTypingInContext(e,t)}},{key:"_isUserTypingInContext",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return!!this._typers[e]&&t in this._typers[e]}},{key:"_onMessageSending",value:function(e){this.stopTyping(e.counterPartyId)}}]),t}(P.default),o(u.prototype,"_setTypingStatusOfUser",[B.privateMethod],(0,g.default)(u.prototype,"_setTypingStatusOfUser"),u.prototype),o(u.prototype,"_createClearTimerForOtherUser",[B.privateMethod],(0,g.default)(u.prototype,"_createClearTimerForOtherUser"),u.prototype),o(u.prototype,"_createClearTimerForCurrentUser",[B.privateMethod],(0,g.default)(u.prototype,"_createClearTimerForCurrentUser"),u.prototype),o(u.prototype,"_isUserTypingInContext",[B.privateMethod],(0,g.default)(u.prototype,"_isUserTypingInContext"),u.prototype),o(u.prototype,"_onMessageSending",[B.privateMethod,D.default],(0,g.default)(u.prototype,"_onMessageSending"),u.prototype),s=u))||s;t.default=Z,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,m.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,g.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+s);return i.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,m.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=i(e[0],t);return e.every(function(e){return i(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var a=(0,g.default)(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var s="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,y.default)(n))+": "+i(e[n],t)+";"}).join("\n  "+s);return a.length>=r&&(u+="\n  "+s+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+s+u+"\n"+s+"}":"{\n  "+s+u+"\n"+s+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,u,c,l,f,d,p=n(7),y=r(p),h=n(6),g=r(h),v=n(10),m=r(v),b=n(11),w=r(b),E=n(12),x=r(E),_=n(16),k=r(_),O=n(9),I=r(O),T=n(8),j=r(T),A=n(3),M=r(A),G=n(1),V=r(G),z=n(2),S=r(z),C=n(5),P=r(C),N=n(4),R=r(N),U=n(42),q=r(U),F=n(19),$=r(F),L=n(46),D=r(L),B=n(65),K=r(B),Z=n(13),W=r(Z),H=n(15),X=r(H),Q=n(17),Y=n(14),J=n(67),ee=r(J),te=new K.default.MD5,ne=(s=(0,Q.decorator)(),u=(0,Q.decorator)(),c=(0,Q.decorator)(),l=(0,Q.decorator)(),(0,Y.classWithPrivateMethods)((d=function(e){function t(){return(0,V.default)(this,t),(0,P.default)(this,(t.__proto__||(0,M.default)(t)).apply(this,arguments))}return(0,R.default)(t,e),(0,S.default)(t,[{key:"signIn",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,j.default)(I.default.mark(function e(t,n){var r,o,s,u,c,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{udid:void 0};return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n){e.next=4;break}throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("string"==typeof n){e.next=8;break}throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return r={Authorization:this.getSignInAuthHeader(t,n)},o={push_routing:this.config.pushAgent,version:this.config.version,device_id:l.udid,metadata:{tt_product_version:"tigerconnect_"+this.config.version,user_agent:global.navigator&&global.navigator.userAgent}},e.next=12,this.httpClient.post("/login",{headers:r,data:o});case 12:return s=e.sent,u=this.host.models.User.inject(s.data.user),c=s.data.auth,e.abrupt("return",{user:u,auth:c});case 16:case"end":return e.stop()}},e,this)}));return e}()},{key:"getSignInAuthHeader",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return this.host.api.users.getSignInAuthHeader(this.config.productKey,e,t)}},{key:"signUp",value:function(){function e(){return t.apply(this,arguments)}var t=(0,j.default)(I.default.mark(function e(){var t,n,r,o,a,i,s,u,c,l,f,d,p,y,h,g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{udid:void 0,email:void 0,password:void 0,countryCode:void 0,version:void 0};return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config.signUpHashKey,n=this.config.signUpHashSalt,r=g.udid,o=[t,n,r].join(":"),a=te.hex(o),i=[a.substr(0,2),a.substr(a.length-2)].join(""),s=[this.config.productKey,t,n,r,i].join(":"),u=(0,D.default)(s),c="XMPP-Anonymous "+u,l={Authorization:c},f={primary_email:g.email,unique_id:g.email,password:g.password,push_routing:this.config.pushAgent,product:this.config.productKey,country_code:g.countryCode,device_id:g.udid,version:this.config.version},e.next=13,this.httpClient.post("/signup",{headers:l,data:f});case 13:return d=e.sent,p=this.host.models.User.inject(d.data.user),y=d.data.auth,h={user:p,auth:y},this.host.emit("signUp",h),e.abrupt("return",h);case 19:case"end":return e.stop()}},e,this)}));return e}()},{key:"signOut",value:function(){function e(){return t.apply(this,arguments)}var t=(0,j.default)(I.default.mark(function e(){return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpClient.post("/logout"));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"findMe",value:function(){function e(){return t.apply(this,arguments)}var t=(0,j.default)(I.default.mark(function e(){var t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),e.next=3,this.host.api.users.findMe();case 3:if(t=e.sent,!t){e.next=9;break}return n=this.host.models.User.inject(t),e.abrupt("return",n);case 9:if(r.ignoreNotFound){e.next=11;break}throw new X.default.NotFoundError(this.host.models.User.name,"me");case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"findMyProfilesForAllOrganizations",value:function(){function e(){return t.apply(this,arguments)}var t=(0,j.default)(I.default.mark(function e(){var t;return arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.organizations.findAll();case 2:return e.t0=function(e){return e.id},t=e.sent.map(e.t0),e.abrupt("return",this.findProfileForOrganizations(this.host.currentUserId,t));case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,j.default)(I.default.mark(function e(t){var n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 4:if(o=(0,$.default)(o,{ignoreNotFound:!1,bypassCache:!1}),this.host.requireUser(),n=null,o.bypassCache){e.next=11;break}if(n=this.host.models.User.get(t),!n||n.$placeholder){e.next=11;break}return e.abrupt("return",n);case 11:return e.next=13,this.host.api.users.find(t);case 13:if(r=e.sent,!r){e.next=19;break}n=this.host.models.User.inject(r),delete n.$placeholder,e.next=21;break;case 19:if(o.ignoreNotFound){e.next=21;break}throw new X.default.NotFoundError(this.host.models.User.name,t);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}},e,this)}));return e}()},{key:"findProfileForOrganizations",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,j.default)(I.default.mark(function e(t,n){var r,o=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "organizationIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "organizationIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+a(n));case 8:return s=(0,$.default)(s,{ignoreNotFound:!1,bypassCache:!1}),e.prev=9,e.next=12,k.default.all(n.map(function(e){return o.findProfileForOrganization(t,e,s)}));case 12:e.next=16;break;case 14:e.prev=14,e.t0=e.catch(9);case 16:if(r=this.host.models.User.get(t),r||s.ignoreNotFound){e.next=19;break}throw new X.default.NotFoundError(this.host.models.User.name,t);case 19:return e.abrupt("return",r.profileByOrganizationId);
case 20:case"end":return e.stop()}},e,this,[[9,14]])}));return e}()},{key:"findProfileForOrganization",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,j.default)(I.default.mark(function e(t,n){var r,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof t){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(n));case 8:return this.host.requireUser(),s=(0,$.default)(s,{ignoreNotFound:!0,bypassCache:!1}),n=this._resolveModelId(n),e.next=13,this.find(t,s);case 13:if(r=e.sent,!r||r.$placeholder||!r.profileByOrganizationId||!r.profileByOrganizationId[n]){e.next=16;break}return e.abrupt("return",r.profileByOrganizationId[n]);case 16:return e.next=18,this.host.api.users.find(t,{organizationId:n});case 18:if(o=e.sent,!o){e.next=23;break}this.host.models.User.inject(o),e.next=25;break;case 23:if(s.ignoreNotFound){e.next=25;break}throw new X.default.NotFoundError(this.host.models.User.name,t);case 25:if(r.profileByOrganizationId[n]||s.ignoreNotFound){e.next=27;break}throw new X.default.NotFoundError(this.host.models.User.name+".profileByOrganizationId",t+"/"+n);case 27:return e.abrupt("return",r.profileByOrganizationId[n]);case 28:case"end":return e.stop()}},e,this)}));return e}()},{key:"refresh",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,j.default)(I.default.mark(function e(t){return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.find(t,{ignoreNotFound:!0,bypassCache:!0});case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"update",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,j.default)(I.default.mark(function e(t){var n,r,o,s,u,c=t.firstName,l=t.lastName,f=t.displayName,d=t.status,p=t.dnd,y=t.dndText,h=t.avatarFile,g=t.removeAvatar,v=arguments;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==v[0]||null!=v[0].firstName&&"string"!=typeof v[0].firstName||null!=v[0].lastName&&"string"!=typeof v[0].lastName||null!=v[0].displayName&&"string"!=typeof v[0].displayName||null!=v[0].status&&"string"!=typeof v[0].status||null!=v[0].dnd&&"boolean"!=typeof v[0].dnd||null!=v[0].dndText&&"string"!=typeof v[0].dndText||!(null==v[0].avatarFile||v[0].avatarFile instanceof Object)||null!=v[0].removeAvatar&&"boolean"!=typeof v[0].removeAvatar)){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  firstName: ?string;\n  lastName: ?string;\n  displayName: ?string;\n  status: ?string;\n  dnd: ?boolean;\n  dndText: ?string;\n  avatarFile: ?Object;\n  removeAvatar: ?boolean;\n}\n\nGot:\n"+i(v[0]));case 2:if(!(null==v[0]||null!=v[0].firstName&&"string"!=typeof v[0].firstName||null!=v[0].lastName&&"string"!=typeof v[0].lastName||null!=v[0].displayName&&"string"!=typeof v[0].displayName||null!=v[0].status&&"string"!=typeof v[0].status||null!=v[0].dnd&&"boolean"!=typeof v[0].dnd||null!=v[0].dndText&&"string"!=typeof v[0].dndText||!(null==v[0].avatarFile||v[0].avatarFile instanceof Object)||null!=v[0].removeAvatar&&"boolean"!=typeof v[0].removeAvatar)){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  firstName: ?string;\n  lastName: ?string;\n  displayName: ?string;\n  status: ?string;\n  dnd: ?boolean;\n  dndText: ?string;\n  avatarFile: ?Object;\n  removeAvatar: ?boolean;\n}\n\nGot:\n"+a(v[0]));case 4:return this.host.requireUser(),r=(n={firstName:c,lastName:l,displayName:f,status:d,dnd:p,dndText:y,avatarFile:h,removeAvatar:g},ee.default).call(n,function(e,t){return"undefined"==typeof e}),e.next=8,this.host.api.users.update(this.host.currentUserId,r);case 8:return o=e.sent,s=(0,q.default)(r,"removeAvatar","avatarFile"),g?s.avatarUrl=null:"undefined"!=typeof o.avatarUrl&&(s.avatarUrl=o.avatarUrl),u=this.host.models.User.inject((0,x.default)({id:this.host.currentUserId},s)),e.abrupt("return",u);case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"updatePassword",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));if("string"!=typeof t)throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));return this.host.requireUser(),this.host.api.users.updatePassword(this.host.currentUserId,e,t,this.config.productKey)}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));return this.host.models.User.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+a(e));return this.host.models.User.getMulti(e)}}]),t}(W.default),o(d.prototype,"findMe",[s],(0,w.default)(d.prototype,"findMe"),d.prototype),o(d.prototype,"findMyProfilesForAllOrganizations",[u],(0,w.default)(d.prototype,"findMyProfilesForAllOrganizations"),d.prototype),o(d.prototype,"find",[c],(0,w.default)(d.prototype,"find"),d.prototype),o(d.prototype,"refresh",[l],(0,w.default)(d.prototype,"refresh"),d.prototype),f=d))||f);t.default=ne,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Users:n(123),EventRouter:n(113),Events:n(114),Messages:n(116),Groups:n(115),DistributionLists:n(112),Organizations:n(119),Conversations:n(111),Presence:n(120),Metadata:n(117),Search:n(121),TypingStatus:n(122),Mute:n(118)};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,c.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?a.trim()+"[]":"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,v.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var u="  ".repeat(t-1),l=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s.default)(n))+": "+o(e[n],t)+";"}).join("\n  "+u);return i.length>=r&&(l+="\n  "+u+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+u+l+"\n"+u+"}":"{\n  "+u+l+"\n"+u+"}"}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,c.default)(e);if(Array.isArray(e)){if(e.length>0){if(t>n)return"[...]";var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?o.trim()+"[]":"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}return"Array"}var i=(0,v.default)(e);if(!i.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var u="  ".repeat(t-1),l=i.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s.default)(n))+": "+a(e[n],t)+";"}).join("\n  "+u);return i.length>=r&&(l+="\n  "+u+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+u+l+"\n"+u+"}":"{\n  "+u+l+"\n"+u+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(7),s=r(i),u=n(10),c=r(u),l=n(9),f=r(l),d=n(8),p=r(d),y=n(12),h=r(y),g=n(6),v=r(g),m=n(38),b=r(m),w=n(132),E=r(w),x=n(18),_=r(x),k=n(1),O=r(k),I=n(2),T=r(I),j=n(35),A=r(j),M=n(26),G=r(M),V=n(33),z=r(V),S=n(42),C=r(S),P=n(34),N=r(P),R=n(169),U=r(R),q=n(151),F=r(q),$=n(170),L=r($),D=n(19),B=r(D),K=n(162),Z=r(K),W=n(152),H=r(W),X=n(43),Q=r(X),Y=n(51),J=r(Y),ee=n(155),te=r(ee),ne=n(144),re=r(ne),oe=n(69),ae=r(oe),ie=n(25),se=r(ie),ue=n(147),ce=r(ue),le=n(68),fe=r(le),de=n(47),pe=r(de),ye=n(32),he=r(ye),ge=n(31),ve=r(ge),me=n(127),be=r(me);ve.default.prototype.off=ve.default.prototype.removeListener;var we={idAttribute:"id",parseAttrs:te.default,relations:{belongsTo:{},hasMany:{}},defaultValues:null,computed:{},methods:{}},Ee=function(){function e(t,n){var r,o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,O.default)(this,e),this.options=(0,J.default)({},a,we),this.idAttribute=this.options.idAttribute,this.name=n,this.store=t,this.entitiesById={},this.entitiesList=[],this.transientAttrsStore={},this.options.relations&&this.__initRelations(),this.__initTransientAttrs(),(0,_.default)(this.options.computed,{$entityType:{enumerable:!0,get:function(){return n}},$entityClass:{enumerable:!1,get:function(){return o}}}),this.options.computed=(0,Q.default)(this.options.computed,function(e,t,n){"function"==typeof t?e[n]={get:t,enumerable:!1}:e[n]=t},{}),this._computedKeys=(r=(r=this.options.computed,re.default).call(r),ae.default).call(r,"$entityType","$entityClass","$$transientAttrs"),this._writablePropertyKeys=(r=(r=(r=this.options.computed,ce.default).call(r),he.default).call(r,function(e){return e[1].set}),se.default).call(r,H.default),this._relationKeys=(r=(r=(r=this.options.relations,fe.default).call(r),se.default).call(r,Z.default),pe.default).call(r)}return(0,T.default)(e,null,[{key:"create",value:function(e,t,n){return new this(e,t,n)}}]),(0,T.default)(e,[{key:"__initRelations",value:function(){var e=this,t=(0,Q.default)(this.options.relations.belongsTo,function(t,n,r){t[r]={get:function(){return e.store.get(n.type,this[n.foreignKey])},set:function(t){this[n.foreignKey]=e.store.resolveId(n.type,t)}}},{});(0,_.default)(this.options.computed,t);var n=(0,Q.default)(this.options.relations.hasMany,function(t,n,r){t[r]={get:function(){var t=this;if(this.$$transientAttrs.relations||(this.$$transientAttrs.relations={},this.$$transientAttrs.relationsCreated={}),this.$$transientAttrs.relations[r])return this.$$transientAttrs.relations[r];var o=e.store.getAll(n.type).filter(function(r){return r[n.foreignKey]===t[e.options.idAttribute]});return this.$$transientAttrs.relations[r]=o,this.$$transientAttrs.relationsCreated[r]=!0,o},set:function(e){}}},{});(0,_.default)(this.options.computed,n)}},{key:"__initTransientAttrs",value:function(){var e=this,t=this,n={$$transientAttrs:{enumerable:!1,get:function(){var e=this[t.options.idAttribute];return t.transientAttrsStore[e]||(t.transientAttrsStore[e]={})}}},r={};this.options.transientAttrs&&this.options.transientAttrs.forEach(function(t){e.options.defaultValues&&t in e.options.defaultValues&&(r[t]=(0,be.default)(e.options.defaultValues[t]),delete e.options.defaultValues[t]),n[t]={get:function(){return t in this.$$transientAttrs?this.$$transientAttrs[t]:t in r?this.$$transientAttrs[t]=r[t]:void 0},set:function(e){this.$$transientAttrs[t]=e}}}),(0,_.default)(this.options.computed,n)}},{key:"createInstance",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this;t&&(e=this.parseAttrs(e));var r=this[n.options.idAttribute];if(this.entitiesById[r])throw new Error("called createInstance on an existing instance");this.options.defaultValues&&(0,B.default)(e,(0,be.default)(this.options.defaultValues));var o={};return this._writablePropertyKeys.forEach(function(t){t in e&&(o[t]=e[t],delete e[t])}),(0,E.default)(e,this.options.computed),(0,_.default)(e,o),this.options.instanceEvents&&(0,_.default)(e,ve.default.prototype),(0,_.default)(e,this.options.methods),(0,_.default)(e,{toPlainObject:function(e){var t=this,r={};n._computedKeys.forEach(function(e){return r[e]=t[e]});var o=(0,_.default)({},this,r);return delete o.toPlainObject,delete o.setMaxListeners,delete o.emit,delete o.addListener,delete o.on,delete o.once,delete o.removeListener,delete o.removeAllListeners,delete o.listeners,delete o.listenerCount,delete o.off,delete o.toPlainObject,delete o._events,delete o._maxListeners,o}}),this.options.beforeCreateInstance&&this.options.beforeCreateInstance(e),e}},{key:"inject",value:function(e){var t=void 0,n=!0,r=this.is(e);if(r){if(t=e,this.entitiesById[this.resolveId(t)])return this.options.beforeInject&&this.options.beforeInject(t),this.emit("beforeInject",this,t),this.options.afterInject&&this.options.afterInject(t),this.emit("afterInject",this,t),t;n=!1}n&&(e=this.parseAttrs(e));var o=void 0,a=this.resolveId(e);if(!this.isValidId(a))throw new Error("'"+this.options.idAttribute+"' is required");return t=this.entitiesById[a],t?(this.options.beforeInject&&this.options.beforeInject(e,t),this.emit("beforeInject",this,e),(0,_.default)(t,e)):(o=!0,t=r?e:this.createInstance(e,!1),this.options.beforeInject&&this.options.beforeInject(t),this.emit("beforeInject",this,t),this.entitiesById[a]=t,this.entitiesList.push(t)),this.__addToHasManyRelationships(t),this.options.afterInject&&this.options.afterInject(t),this.emit("afterInject",this,t),o&&(this.options.afterCreate&&this.options.afterCreate(t),this.emit("afterCreate",this,t)),t}},{key:"eject",value:function(e){e=this.resolveId(e);var t=this.entitiesById[e];t&&(this.emit("beforeEject",this,t),this.__removeFromHasManyRelationships(t),delete this.entitiesById[e],(0,L.default)(this.entitiesList,t),e in this.transientAttrsStore&&delete this.transientAttrsStore[e],this.emit("afterEject",this,t))}},{key:"touch",value:function(e){e=this.resolveId(e);var t=this.entitiesById[e];t&&this.inject((0,b.default)({},this.options.idAttribute,e))}},{key:"__addToHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"add")}},{key:"__removeFromHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"remove")}},{key:"__updateRelationsIfNeeded",value:function(e,t){var n=this,r=this.store.getParentRelationshipsOfModel(this.name);r&&r.forEach(function(r){var o=n.store.get(r.parent,e[r.foreignKey]);o&&o.$$transientAttrs.relationsCreated&&o.$$transientAttrs.relationsCreated[r.relationKey]&&("add"===t?o[r.relationKey].includes(e)||o[r.relationKey].push(e):"remove"===t&&(0,L.default)(o[r.relationKey],e))})}},{key:"ejectAll",value:function(){var e=this;(0,F.default)(this.entitiesList,function(t){return e.eject(t)})}},{key:"parseAttrs",value:function(e){var t=this,n=(0,U.default)(e,function(e){return t.store.isEntity(e)||t.store.isEntityArray(e)}),r=(0,N.default)(e,this.options.transientAttrs),o=(0,C.default)(e,(0,v.default)(n),this.options.transientAttrs),a=this.options.parseAttrs((0,be.default)(o)),i=(0,h.default)({},a,n,r);return i}},{key:"get",value:function(e){return this.entitiesById[e]||null}},{key:"getAll",value:function(){return this.entitiesList}},{key:"getMulti",value:function(e){return e.map(this.get.bind(this))}},{key:"resolveId",value:function(e){return this.isValidId(e)?e:e[this.options.idAttribute]}},{key:"isValidId",value:function(e){return"string"==typeof e||"number"==typeof e}},{key:"is",value:function(e){return e&&e.$entityClass===this}},{key:"find",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,p.default)(f.default.mark(function e(t){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(t));case 2:if("string"==typeof t){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));case 4:throw new Error("not implemented find");case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"refresh",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,p.default)(f.default.mark(function e(t){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(t));case 4:throw t=this.resolveId(t),new Error("not implemented refresh");case 6:case"end":return e.stop()}},e,this)}));return e}()}]),e}();(0,_.default)(Ee.prototype,ve.default.prototype);var xe=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,O.default)(this,e),this.options=n,this.models={},this.__relationsOfHasManyByContainedItem={},["inject","get","getAll","filter","resolveId","is","find","refresh"].forEach(function(e){t[e]=function(n){for(var r,o=arguments.length,a=Array(o>1?o-1:0),i=1;i<o;i++)a[i-1]=arguments[i];return(r=t.models[n])[e].apply(r,a)}})}return(0,T.default)(e,[{key:"defineModel",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.models[e])throw new Error(e+" already defined");n=(0,h.default)({},this.options,n),this.models[e]=Ee.create(this,e,n);var r=this.models[e].options.relations.hasMany;return(0,z.default)(r)||(0,G.default)(r,function(n,r){t.__relationsOfHasManyByContainedItem[n.type]||(t.__relationsOfHasManyByContainedItem[n.type]=[]),t.__relationsOfHasManyByContainedItem[n.type].push((0,h.default)({},n,{relationKey:r,parent:e}))}),this.models[e]}},{key:"getParentRelationshipsOfModel",value:function(e){return this.__relationsOfHasManyByContainedItem[e]}},{key:"isEntity",value:function(e){return e&&e.$entityClass&&e.$entityClass.constructor===Ee}},{key:"isEntityArray",value:function(e){return e&&Array.isArray(e)&&e.some(this.isEntity)}},{key:"clear",value:function(){(0,A.default)(this.models).forEach(function(e){return e.ejectAll()})}}]),e}();t.default=xe,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(12),a=r(o),i=n(30),s=r(i),u=n(1),c=r(u),l=n(2),f=r(l),d=n(34),p=r(d),y=n(42),h=r(y),g=n(33),v=r(g),m=n(19),b=r(m),w=n(26),E=r(w),x=n(22),_=n(125),k=r(_),O=n(110),I=r(O),T=n(37),j=r(T),A=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.logger,o=(0,s.default)(n,["logger"]);(0,c.default)(this,e),this.host=t,this.options=o,this.logger=r,this.store=new k.default((0,a.default)({},o,{host:t,logger:r})),this.store.host=t}return(0,f.default)(e,[{key:"defineModels",value:function(){var e=this,t={},n=(0,a.default)({},this.options,{host:this.host,logger:this.logger});(0,E.default)(I.default,function(r,o){t[o]=r(e,n)}),this.models=t}},{key:"defineModel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,b.default)(t,{replaceKeys:{},skipCamelizationForKeys:null}),(0,b.default)(t.replaceKeys,{token:"id"});var n=this.store.defineModel(e,(0,a.default)({},t,{beforeCreateInstance:function(e){!e[n.idAttribute]||"serverId"in e||(e.serverId=e[n.idAttribute]),t.beforeCreateInstance&&t.beforeCreateInstance(e)},beforeInject:function(e,n){!n||"serverId"in e||(e.serverId=n.serverId),t.beforeInject&&t.beforeInject(e,n)},afterInject:function(e){var n=Date.now();e.$lastModified===n&&(n+=1e-5),e.$lastModified=n,t.afterInject&&t.afterInject(e)},parseAttrs:function(e){var n=void 0;if((0,v.default)(t.skipCamelizationForKeys))n=j.default.camelizeObject(e);else{var r=(0,h.default)(e,t.skipCamelizationForKeys),o=(0,p.default)(e,t.skipCamelizationForKeys);n=(0,a.default)({},j.default.camelizeObject(r),o)}return(0,E.default)(t.replaceKeys,function(e,t){(0,x.replaceKey)(n,t,e)}),t.parseAttrs&&(n=t.parseAttrs(n,e)),n}}));return n}},{key:"clear",value:function(){this.store.clear()}}]),e}();t.default=A,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=r(o),i=function(e){return void 0!==e?JSON.parse((0,a.default)(e)):null};t.default=i,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(129),a=r(o),i=a.default.version;i=i.replace("-dev",""),t.default=i,e.exports=t.default},function(e,t){e.exports={name:"tigerconnect",private:!0,version:"1.0.2-dev",description:"JS (web and node) SDK for TigerText",homepage:"",repository:"tigertext/js-sdk",author:{name:"TigerText Developers",email:"developersupport@tigertext.com",url:"https://developer.tigertext.com/"},main:"lib/index.js",keywords:["tigertext"],scripts:{"build:clean":"rimraf lib dist","build:js":"babel -d lib/ src/","build:travis":"run-s lint coverage:travis build","build:webpack":"webpack","build:webpack:node":"webpack --target node",prebuild:"run-s build:clean",build:"run-p build:js build:webpack","build:node":"run-s build:webpack:node",coverage:"run-s coverage:test coverage:report:html","coverage:check":"nyc check-coverage","coverage:open":"open-cli coverage/index.html","coverage:report":"run-s coverage:report:*","precoverage:report:html":"rimraf coverage","coverage:report:html":"nyc report --reporter=html","coverage:report:coveralls":"nyc report --reporter=text-lcov | coveralls","coverage:test":'cross-env NODE_TARGET=node nyc mocha "test/**/*.test.js"',"coverage:travis":"run-s coverage:test coverage:report coverage:check",deps:"npm-check -s","deps:update":"npm-check -u",lint:"eslint . --ext .js","lint:fix":"eslint . --ext .js --fix","watch:js":"npm run build:js -- -w","watch:webpack":"webpack --watch",test:'cross-env NODE_TARGET=node mocha "test/**/*.test.js"',"debug:test":"iron-node node_modules/mocha/bin/_mocha","watch:test":"npm test -- -w",prewatch:"run-s build:clean",watch:"run-p watch:js watch:webpack"},nyc:{statements:80,branches:60,lines:80,include:["src/**/*.js"],exclude:["test/**/*.test.js"],cache:!0},dependencies:{"autobind-decorator":"^1.3.4","babel-polyfill":"~6.20.0",btoa:"^1.1.2","class-private-method-decorator":"^2.1.2","event-source-polyfill":"git+https://git@github.com/tigertext/yaffle-eventsource.git",eventsource:"git+https://git@github.com/tigertext/eventsource.git","file-saver":"^1.3.3","file-type":"^4.0.0","humanize-list":"^1.0.1",invariant:"^2.2.2","is-email":"^1.0.0",jshashes:"^1.0.6",lodash:"^4.17.2","lodash-bound":"^1.1.2",mime:"^1.3.4","mime-db":"^1.25.0",moment:"^2.17.0","node-noop":"^1.0.0",qs:"^6.1.0",request:"^2.79.0","reuse-promise":"^1.1.0",shallowequal:"^0.2.2",superagent:"^3.5.1","superagent-prefix":"0.0.2",uuid:"^3.0.0"},devDependencies:{"assets-webpack-plugin":"^3.5.0","babel-cli":"~6.18.0","babel-core":"~6.21.0","babel-eslint":"^7.1.1","babel-loader":"^6.2.8","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-conditional-compilation":"0.0.1","babel-plugin-flow-comments":"^6.3.19","babel-plugin-import-asserts":"^3.0.0","babel-plugin-lodash":"^3.2.10","babel-plugin-macros":"^1.0.15","babel-plugin-syntax-flow":"^6.18.0","babel-plugin-transform-class-properties":"~6.19.0","babel-plugin-transform-decorators-legacy":"^1.3.4","babel-plugin-transform-es2015-classes":"^6.18.0","babel-plugin-transform-flow-strip-types":"^6.18.0","babel-plugin-transform-runtime":"~6.15.0","babel-plugin-typecheck":"^3.9.0","babel-preset-es2015":"^6.18.0","babel-preset-stage-0":"^6.16.0",chai:"^3.5.0","chai-as-promised":"^6.0.0","chai-deep-match":"^1.0.2",coveralls:"^2.12.0","cross-env":"^3.2.4",decache:"^4.1.0","dom-storage":"^2.0.2",eslint:"^3.17.1",gulp:"^3.9.1","gulp-debug":"^3.0.0","gulp-exec":"^2.1.3","gulp-file":"^0.3.0","gulp-load-plugins":"^1.4.0","gulp-uglify":"^2.0.0","gulp-util":"^3.0.7","json-loader":"^0.5.4","lodash-webpack-plugin":"^0.11.2",mocha:"^2.5.3","mocha-clean":"^1.0.0",nock:"^9.0.2","npm-check":"^5.4.0","npm-run-all":"^4.0.2",nyc:"^10.1.2","open-cli":"^1.0.5","performance-now":"^2.0.0","require-dir":"^0.3.1",rimraf:"^2.5.4",sinon:"^1.17.6","sinon-chai":"^2.8.0",sleep:"^5.0.0","strip-loader":"^0.1.2",timekeeper:"1.0.0",tmatch:"^3.0.0",watch:"^1.0.1",webpack:"^1.13.3","webpack-node-externals":"^1.5.4",yargs:"^6.4.0"},license:{type:"Commercial",url:"http://www.tigertext.com/developer-terms-of-use/"}}},function(e,t,n){function r(e){return n(o(e))}function o(e){return a[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var a={"./node":60,"./node.js":60,"./web":61,"./web.js":61};r.keys=function(){return Object.keys(a)},r.resolve=o,e.exports=r,r.id=130},function(e,t){e.exports=require("babel-polyfill")},function(e,t){e.exports=require("babel-runtime/core-js/object/define-properties")},function(e,t){e.exports=require("babel-runtime/core-js/object/define-property")},function(e,t){e.exports=require("babel-runtime/core-js/object/freeze")},function(e,t){e.exports=require("babel-runtime/core-js/set")},function(e,t){e.exports=require("eventsource")},function(e,t){e.exports=require("file-saver")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("humanize-list")},function(e,t){e.exports=require("invariant")},function(e,t){e.exports=require("lodash-bound/each")},function(e,t){e.exports=require("lodash-bound/find")},function(e,t){e.exports=require("lodash-bound/first")},function(e,t){e.exports=require("lodash-bound/keys")},function(e,t){e.exports=require("lodash-bound/mapValues")},function(e,t){e.exports=require("lodash-bound/pickBy")},function(e,t){e.exports=require("lodash-bound/toPairs")},function(e,t){e.exports=require("lodash/castArray")},function(e,t){e.exports=require("lodash/chunk")},function(e,t){e.exports=require("lodash/compact")},function(e,t){e.exports=require("lodash/eachRight")},function(e,t){e.exports=require("lodash/first")},function(e,t){e.exports=require("lodash/groupBy")},function(e,t){e.exports=require("lodash/head")},function(e,t){e.exports=require("lodash/identity")},function(e,t){e.exports=require("lodash/includes")},function(e,t){e.exports=require("lodash/intersection")},function(e,t){e.exports=require("lodash/invert")},function(e,t){e.exports=require("lodash/isArray")},function(e,t){e.exports=require("lodash/isObject")},function(e,t){e.exports=require("lodash/keyBy")},function(e,t){e.exports=require("lodash/keys")},function(e,t){e.exports=require("lodash/last")},function(e,t){e.exports=require("lodash/map")},function(e,t){e.exports=require("lodash/mapKeys")},function(e,t){e.exports=require("lodash/memoize")},function(e,t){e.exports=require("lodash/noop")},function(e,t){e.exports=require("lodash/orderBy")},function(e,t){e.exports=require("lodash/pickBy")},function(e,t){e.exports=require("lodash/pull")},function(e,t){e.exports=require("lodash/reduce")},function(e,t){e.exports=require("lodash/snakeCase")},function(e,t){e.exports=require("lodash/sortBy")},function(e,t){e.exports=require("lodash/union")},function(e,t){e.exports=require("lodash/uniq")},function(e,t){e.exports=require("lodash/without")},function(e,t){e.exports=require("lodash/xor")},function(e,t){e.exports=require("lodash/zipObject")},function(e,t){e.exports=require("mime")},function(e,t){e.exports=require("mime-db")},function(e,t){e.exports=require("node-noop")},function(e,t){e.exports=require("qs")},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("shallowequal")},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("superagent-prefix")}]);