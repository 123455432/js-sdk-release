module.exports=function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),global._babelPolyfill||n(1);var r="node";n(2)("./"+r);var a=n(6);t.Client=a},function(e,t){e.exports=require("babel-polyfill")},function(e,t,n){function r(e){return n(a(e))}function a(e){return o[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var o={"./node":3,"./node.js":3,"./web":4,"./web.js":4};r.keys=function(){return Object.keys(o)},r.resolve=a,e.exports=r,r.id=2},function(e,t,n){"use strict"},function(e,t,n){"use strict";!function(){try{var e=n(5).request().__proto__;e.setNoDelay||(e.setNoDelay=function(){}),e.abort||(e.abort=function(){this.xhr&&this.xhr.abort()})}catch(t){}}()},function(e,t){e.exports=require("http")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p["default"])(e);if(!Array.isArray(e)){var o=(0,d["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,c["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,p["default"])(u))?u.v:void 0}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p["default"])(e);if(!Array.isArray(e)){var a=(0,d["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,c["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,p["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var i,s,u=n(7),c=r(u),f=n(8),d=r(f),l=n(9),p=r(l),h=n(10),y=r(h),g=n(11),v=r(g),m=n(12),b=r(m),w=n(13),E=r(w),x=n(14),_=r(x),k=n(15),j=r(k),I=n(16),O=r(I),T=n(18),A=r(T),M=n(33),G=r(M),V=n(31),z=r(V),C=n(21),S=r(C),P=n(34),$=r(P),q=n(43),R=r(q),N=n(76),U=r(N),D=n(56),L=r(D),B=n(91),K=r(B);n(92)(z["default"]);var F="UpM28mnfW65vJkbqEATtKvxm",Z={eventsFeatures:"is-typing",autoAckEvents:!0,logLevel:"error",eventsAutoReconnect:!0,flushAckInterval:2e3,flushAckMaxEvents:500,flushSetMessageStatusInterval:1e3,flushMessageMaxCount:500,conversationReloadDelay:200,eventsAutoReconnectDelay:2e3,organizationRostersChangeThrottleDelay:500,temporaryEntityDelayBeforeRefreshing:100,enableEnsureEntityWithTemp:!0,enableEnsureEntityFindMissing:!0,consumerOrganizationId:F,maxMetadataKeyCount:8,pushAgent:"consumer",baseUrl:"https://developer.tigertext.me/v2",productKey:"bc1oOf3DZXbnaNZ2LCWZGvSg",clientVersion:"1.0"},H=(s=i=function(){function e(){var t=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if((0,_["default"])(this,e),!(null==n||n instanceof Object))throw new TypeError('Value of argument "config" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+o(n));if(!(null==n||n instanceof Object))throw new TypeError('Value of argument "config" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+a(n));this.config=z["default"].defaults(n,Z),this.httpClient=new A["default"]({baseUrl:this.config.baseUrl,logger:new O["default"]({name:"HttpClient",level:this.config.logLevel})}),this.enums=L["default"],this.store=new U["default"](this,{logger:new O["default"]({name:"Store",level:this.config.logLevel})}),this.store.defineModels(),this.models=this.store.models,this.modelsByEntityType=z["default"].mapKeys(this.store.models,function(e,t){return z["default"].snakeCase(t)}),this.logger=new O["default"]({name:"TigerConnectClient",level:this.config.logLevel}),this.api={},z["default"].each($["default"],function(e,n){t.api[z["default"].camelCase(n)]=new e(t,{logger:new O["default"]({name:e.name,level:t.config.logLevel})})}),this._services={},z["default"].each(R["default"],function(e,n){n=z["default"].camelCase(n),t._services[n]=t[n]=new e(t,{logger:new O["default"]({name:e.name,level:t.config.logLevel})})}),z["default"].each(this._services,function(e){return e.mounted&&e.mounted()}),this._listenToEvents()}return(0,j["default"])(e,[{key:"_listenToEvents",value:function(){var e=this;this.on("signedIn",function(t,n){e.logger.info("signedIn",t.id)}).on("signedOut",function(){e.reset()}).on("signUp",function(t){var n=t.user,r=t.auth;e.logger.info("signUp",n.id),e._setCurrentUser(n,r)}),this.events.on("event",function(t){return e.emit("event",t)}),this.conversations.on("message",function(t){return e.emit("message",t)}),this.conversations.on("change",function(t){return e.emit("conversation:change",t)})}},{key:"signIn",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e,n){var r,a,o,i=arguments.length<=2||void 0===arguments[2]?{udid:void 0}:arguments[2];return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.users.signIn(e,n,i);case 3:return r=t.sent,a=r.user,o=r.auth,this._setCurrentUser(a,o),t.next=9,this.users.me({bypassCache:!0});case 9:return this.emit("signedIn",a,o),t.abrupt("return",{user:a,auth:o});case 13:throw t.prev=13,t.t0=t["catch"](0),t.t0;case 17:case"end":return t.stop()}},t,this,[[0,13]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"signOut",value:function(){var e=(0,E["default"])(b["default"].mark(function t(){var e,n,r=arguments.length<=0||void 0===arguments[0]?{async:!0}:arguments[0],a=r.async,o=void 0===a?!0:a;return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isSignedIn()){t.next=2;break}return t.abrupt("return",v["default"].resolve());case 2:if(o||"undefined"!=typeof XMLHttpRequest){t.next=4;break}throw new Error("async: false option has to be on the browser.");case 4:if(!o){t.next=15;break}return e=this.users.signOut({async:o}),t.next=8,e;case 8:this._currentUser=null,this._auth=null,this.httpClient.removeAuth(),this.events.disconnect(),this.emit("signedOut"),t.next=21;break;case 15:return n=new XMLHttpRequest,n.open("POST",this.config.baseUrl+"/logout",!1),n.setRequestHeader("Authorization",this.httpClient.getAuthHeader()),n.send(null),this.emit("signedOut"),t.abrupt("return",v["default"].resolve());case 21:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"authenticate",value:function(){var e=(0,E["default"])(b["default"].mark(function t(e,n){var r,a,o;return b["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this._setAuth(e,n),t.prev=1,t.next=4,this.httpClient.get("/user");case 4:t.next=25;break;case 6:if(t.prev=6,t.t0=t["catch"](1),r=t.t0.response&&t.t0.response.get("TT_Log_Account_Token")){t.next=11;break}throw new S["default"].WrongCredentialsError;case 11:return t.prev=11,t.next=14,this.users.find(r);case 14:return a=t.sent,o={key:e,secret:n},this._setCurrentUser(a,o),this.emit("signedIn",a,o),t.abrupt("return",a);case 21:throw t.prev=21,t.t1=t["catch"](11),this._removeAuth(),t.t1;case 25:case"end":return t.stop()}},t,this,[[1,6],[11,21]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"_setCurrentUser",value:function(e,t){this._currentUser=e,this._setAuth(t.key,t.secret,t.resource)}},{key:"_setAuth",value:function(e,t,n){this._auth={key:e,secret:t,resource:n},this.httpClient.setAuth(e,t)}},{key:"_removeAuth",value:function(){this._auth=null,this.httpClient.removeAuth()}},{key:"getCurrentUser",value:function(){return this._currentUser||null}},{key:"getAuth",value:function(){return this._auth}},{key:"isSignedIn",value:function(){return null!=this.getAuth()}},{key:"requireUser",value:function(){if(!this.isSignedIn())throw new S["default"].NotSignedInError}},{key:"reactToAdvisoryEvent",value:function(e,t){switch(this.emit("advisory",{type:e,data:t}),e){case"replayStart":this.emit("messages:offline:start",t);break;case"replayStop":this.emit("messages:offline:stop"),this.emit("messages:new:start")}}},{key:"modelByTypeNS",value:function(e){return this.MODEL_BY_TYPE_NS[e]}},{key:"injectModel",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?e.xmlns||e.type:arguments[1],n=this.modelByTypeNS(t);return n?n.inject(e):((0,K["default"])(n,"injectModel: Missing class for "+t),null)}},{key:"getEntity",value:function(e,t){return this.modelsByEntityType[e].get(t)}},{key:"getEntities",value:function(e){var t=this;return e.map(function(e){return t.getEntity(e.type,e.id)})}},{key:"typeNSByModelName",value:function(e){return this.TYPE_NS_BY_MODEL_NAME[e]}},{key:"reset",value:function(){this.emit("reset"),z["default"].each(this._services,function(e){e.dispose&&e.dispose(),e.mounted&&e.mounted()}),this.store&&this.store.clear()}},{key:"configure",value:function(e){return(0,y["default"])(this.config,e),this}},{key:"setDefaultOrganization",value:function(e){return this.configure({defaultOrganizationId:e})}},{key:"MODEL_BY_TYPE_NS",get:function(){return this._MODEL_BY_TYPE_NS||(this._MODEL_BY_TYPE_NS={"tigertext:entity:account":this.models.User,"tigertext:entity:group":this.models.Group,"tigertext:entity:list":this.models.Group,"tigertext:iq:message":this.models.Message,"tigertext:iq:group_message":this.models.Message,"tigertext:iq:group:message":this.models.Message}),this._MODEL_BY_TYPE_NS}},{key:"TYPE_NS_BY_MODEL_NAME",get:function(){return this._TYPE_NS_BY_MODEL_NAME||(this._TYPE_NS_BY_MODEL_NAME=z["default"].reduce(this.MODEL_BY_TYPE_NS,function(e,t,n){return e[t.name]=n,e[z["default"].capitalize(t.name)]=n,e},{})),this._TYPE_NS_BY_MODEL_NAME}}]),e}(),i.errors=S["default"],i.VERSION="0.1.5",i.CONSUMER_ORGANIZATION_ID=F,s);(0,y["default"])(H.prototype,G["default"].prototype),t["default"]=H,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/core-js/object/keys")},function(e,t){e.exports=require("babel-runtime/helpers/typeof")},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t){e.exports=require("babel-runtime/helpers/createClass")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),s=r(i),u=n(8),c=r(u),f=n(9),d=r(f),l=n(17),p=r(l),h=n(14),y=r(h),g=n(15),v=r(g),m=function(){function e(t){var n=t.name,r=t.level;if((0,y["default"])(this,e),null==arguments[0]||"string"!=typeof arguments[0].name||"string"!=typeof arguments[0].level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ name: string;\n  level: string;\n}\n\nGot:\n"+o(arguments[0]));if(null==arguments[0]||"string"!=typeof arguments[0].name||"string"!=typeof arguments[0].level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ name: string;\n  level: string;\n}\n\nGot:\n"+a(arguments[0]));this.name=n,this.level=r}return(0,v["default"])(e,[{key:"setLevel",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));this.level=e}}]),e}(),b=["debug","log","info","warn","error"],w=b.reduce(function(e,t,n){return e[t]=n,e},{});b.forEach(function(e){var t=w[e];m.prototype[e]=function(){for(var n=arguments.length,r=Array(n),a=0;n>a;a++)r[a]=arguments[a];t<w[this.level]||(r=["["+this.name+"]"].concat((0,p["default"])(r)),Function.prototype.apply.call(console[e],console,r))}}),t["default"]=m,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/helpers/toConsumableArray")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(10),o=r(a),i=n(12),s=r(i),u=n(11),c=r(u),f=n(13),d=r(f),l=n(14),p=r(l),h=n(15),y=r(h),g=n(19),v=r(g),m=n(20),b=r(m),w=n(21),E=r(w),x=n(30),_=r(x),k=n(31),j=r(k),I=n(32),O=["get","post","put","patch","del"],T=function(){function e(t){(0,p["default"])(this,e),this.config=t,this.logger=t.logger,this._prefixBaseUrl=(0,_["default"])(this.config.baseUrl)}return(0,y["default"])(e,[{key:"setAuth",value:function(e,t){this._key=e,this._secret=t}},{key:"removeAuth",value:function(){this._key=null,this._secret=null}},{key:"getAuthHeader",value:function(){return this.getAuthHeaderForKeyAndSecret(this._key,this._secret)}},{key:"getAuthHeaderForKeyAndSecret",value:function(e,t){return e&&t?"Basic "+(0,b["default"])(e+":"+t):null}},{key:"_contentType",value:function(e){switch(e){case"json":return"application/json";case"event-stream":return"text/event-stream";case"text":default:return"plain/text"}}},{key:"downloadImageBlob",value:function(){var e=(0,d["default"])(s["default"].mark(function t(e){var n=this;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("undefined"!=typeof XMLHttpRequest){t.next=2;break}throw new Error("must have XMLHttpRequest");case 2:return t.abrupt("return",new c["default"](function(t,r){var a=new XMLHttpRequest,o=n.config.baseUrl+e;a.open("GET",o,!0),a.setRequestHeader("Authorization",n.getAuthHeader()),a.responseType="blob",a.onreadystatechange=function(){4==a.readyState&&(a.status<200||a.status>299?r(new Error("Failed downloading "+o+". Status = "+a.status)):t(a.response))},a.send(null)}));case 3:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"downloadImageAndGetURL",value:function(){var e=(0,d["default"])(s["default"].mark(function t(e){var n,r;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.downloadImageBlob(e);case 2:return n=t.sent,r=URL.createObjectURL(n),t.abrupt("return",r);case 5:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();O.forEach(function(e){T.prototype[e]=function(){var t=(0,d["default"])(s["default"].mark(function n(t){var r,a,i=this,u=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return s["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return u=j["default"].defaults(u||{},{reqFormat:"json",resFormat:"json"}),u.urlParams&&(t=t.replace(/:([\w\-]+)/g,function(e,t){return encodeURIComponent(u.urlParams[t])})),this.logger&&this.logger.info("start",e.toUpperCase(),t,u),r=(0,o["default"])({},u.headers),r["Content-Type"]=r["Content-Type"]||this._contentType(u.reqFormat),r.Accept=r.Accept||this._contentType(u.resFormat),u.requestId&&(r["Request-ID"]=u.requestId),a=new c["default"](function(n,a){var o=v["default"][e](t).use(i._prefixBaseUrl).set(r).query(u.query||{}).send(u.data||{});i._key&&i._secret&&(o=o.auth(i._key,i._secret)),o.end(function(r,o){if(r)return i.logger&&i.logger.info("error",e.toUpperCase(),t,r),401==r.status&&a(new E["default"].WrongCredentialsError),void a(r);switch(u.resFormat){case"json":var s=o.body||{};"reply"in s&&(s=s.reply);var c={data:s,headers:o.headers,getHeader:function(e){return o.headers[e.toLowerCase()]},status:o.status};Object.defineProperty(c,"_origData",{get:function(){return o.body}}),i.logger&&i.logger.info("success",e.toUpperCase(),t,c),n(c);break;default:i.logger&&i.logger.info("success",e.toUpperCase(),t,o.text?o.text.substr(0,80)+"...":"[null]"),n(o.text)}})}),n.abrupt("return",a);case 9:case"end":return n.stop()}},n,this)}));return function(e,n){return t.apply(this,arguments)}}()}),!function(){var e=T.prototype.get,t=(0,I.decorator)(e);T.prototype.get=function(n){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return r.reusePromise?t.call(this,n,r):e.call(this,n,r)}}(),t["default"]=T,e.exports=t["default"]},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("btoa")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={NotSignedInError:n(22),WrongCredentialsError:n(26),NotFoundError:n(27),PermissionDeniedError:n(28),ValidationError:n(29)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a,o,i=n(23),s=r(i),u=n(14),c=r(u),f=n(24),d=r(f),l=n(25),p=r(l),h=(o=a=function(e){function t(){var e;(0,c["default"])(this,t);for(var n=arguments.length,r=Array(n),a=0;n>a;a++)r[a]=arguments[a];var o=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(r)));return o.code=t.CODE,o}return(0,p["default"])(t,e),t}(Error),a.CODE="not-signed-in",o);t["default"]=h,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/object/get-prototype-of")},function(e,t){e.exports=require("babel-runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("babel-runtime/helpers/inherits")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a,o,i=n(23),s=r(i),u=n(14),c=r(u),f=n(24),d=r(f),l=n(25),p=r(l),h=(o=a=function(e){function t(){var e;(0,c["default"])(this,t);for(var n=arguments.length,r=Array(n),a=0;n>a;a++)r[a]=arguments[a];var o=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(r)));return o.code=t.CODE,o}return(0,p["default"])(t,e),t}(Error),a.CODE="wrong-credentials",o);t["default"]=h,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a,o,i=n(23),s=r(i),u=n(14),c=r(u),f=n(24),d=r(f),l=n(25),p=r(l),h=(o=a=function(e){function t(e,n,r){(0,c["default"])(this,t);var a=(0,d["default"])(this,(0,s["default"])(t).call(this,r));return a.code=t.CODE,a.resource=e,a.id=n,a}return(0,p["default"])(t,e),t}(Error),a.CODE="not-found",o);t["default"]=h,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a,o,i=n(23),s=r(i),u=n(14),c=r(u),f=n(24),d=r(f),l=n(25),p=r(l),h=(o=a=function(e){function t(e,n,r){var a=arguments.length<=3||void 0===arguments[3]?"can't perform action "+r+" on "+(e.name||e)+" #"+n:arguments[3];(0,c["default"])(this,t);var o=(0,d["default"])(this,(0,s["default"])(t).call(this,a));return o.code=t.CODE,o.resource=e,o.action=r,o.id=n,o}return(0,p["default"])(t,e),t}(Error),a.CODE="permission-denied",o);t["default"]=h,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a,o,i=n(23),s=r(i),u=n(14),c=r(u),f=n(24),d=r(f),l=n(25),p=r(l),h=(o=a=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?"invalid":arguments[1],r=arguments.length<=2||void 0===arguments[2]?e+" is "+n:arguments[2];(0,c["default"])(this,t);var a=(0,d["default"])(this,(0,s["default"])(t).call(this,r));return a.code=t.CODE,a.name=e,a.reason=n,a}return(0,p["default"])(t,e),t}(Error),a.CODE="validation",o);t["default"]=h,e.exports=t["default"]},function(e,t){e.exports=require("superagent-prefix")},function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t=(0,f["default"])({memoize:!1},t);var n=function(){for(var n=arguments.length,r=Array(n),a=0;n>a;a++)r[a]=arguments[a];var o=r,i=["memoized",o],s=p.get(e,o);if(s)return s;if(t.memoize){var c=p.get(e,i);if(c)return u["default"].resolve(c)}var f=function(){p.del(e,o)},d=e.apply(this,r),l=d.then(function(n){return t.memoize&&p.set(e,i,n),f(),n},function(e){throw f(),e});return p.set(e,o,l),l};return n.__reusePromise__origFn=e,n.__reusePromise__clear=function(){a.clear(e)},n}function o(){var e=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0];void 0==e?p.clear():p.del(e.__reusePromise__origFn||e)}function i(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return function(t,n,r){return r.value=a(r.value,e),r}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(11),u=r(s),c=n(10),f=r(c),d=n(7),l=r(d);t["default"]=a,t.clear=o,t.decorator=i;var p=function(){function e(e){return(0,l["default"])(e)}function t(e,t,n){return e[s]==t&&e[u]==n}function n(e,n){for(var r=0,a=f.length;a>r;r++){var o=f[r];if(t(o,e,n))return r}return-1}function r(t,r){var a=e(r),o=n(t,a);return f[o]?f[o][c]:null}function a(t,r,a){var o=e(r),i=n(t,o);if(i>-1)f[i][c]=a;else{var d=[];d[s]=t,d[u]=o,d[c]=a,f.push(d)}return a}function o(t,r){if(void 0===r)for(var a=f.length-1;a>=0;a--){var o=f[a];o[s]==t&&f.splice(a,1)}else{var i=e(r),a=n(t,i);a>-1&&f.splice(a,1)}}function i(){f.length=0}var s=0,u=1,c=2,f=[];return{get:r,set:a,del:o,clear:i}}();i.clear=o,a.clear=o},function(e,t){e.exports=require("events")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Roster:n(35),Users:n(37),Groups:n(38),Organizations:n(39),Messages:n(40),Metadata:n(42)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),s=r(i),u=n(8),c=r(u),f=n(9),d=r(f),l=n(12),p=r(l),h=n(13),y=r(h),g=n(23),v=r(g),m=n(14),b=r(m),w=n(15),E=r(w),x=n(24),_=r(x),k=n(25),j=r(k),I=n(36),O=r(I),T=n(31),A=r(T),M=["user","distributionList"],G=function(e){function t(){return(0,b["default"])(this,t),(0,_["default"])(this,(0,v["default"])(t).apply(this,arguments))}return(0,j["default"])(t,e),(0,E["default"])(t,[{key:"findAll",value:function(){var e=(0,y["default"])(p["default"].mark(function t(){var e;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.httpClient.get("/roster");case 2:return e=t.sent,t.abrupt("return",e.data);case 4:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=(0,y["default"])(p["default"].mark(function t(e,n,r){var i,s;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:if(A["default"].includes(M,e)){t.next=14;break}return t.abrupt("return");case 14:return i={},r&&(i["TT-X-Organization-Key"]=r),s=this.host.typeNSByModelName(e),t.next=19,this.httpClient.post("/roster",{headers:i,data:{entity:n,type:s}});case 19:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,y["default"])(p["default"].mark(function t(e,n,r){var i,s;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:if(A["default"].includes(M,e)){t.next=14;break}return t.abrupt("return");case 14:return i={},r&&(i["TT-X-Organization-Key"]=r),s=this.host.typeNSByModelName(e),t.next=19,this.httpClient.del("/roster/:counterPartyId",{headers:i,urlParams:{counterPartyId:n},data:{type:s}});case 19:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()}]),t}(O["default"]);t["default"]=G,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a=n(10),o=r(a),i=n(14),s=r(i),u=n(33),c=r(u),f=function d(e,t){(0,s["default"])(this,d),(0,o["default"])(this,t),this.config=e.config,this.host=e,this.httpClient=e.httpClient};t["default"]=f,(0,o["default"])(f.prototype,c["default"].prototype),e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}";
}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),s=r(i),u=n(8),c=r(u),f=n(9),d=r(f),l=n(12),p=r(l),h=n(13),y=r(h),g=n(23),v=r(g),m=n(14),b=r(m),w=n(15),E=r(w),x=n(24),_=r(x),k=n(25),j=r(k),I=n(36),O=r(I),T=n(31),A=(r(T),function(e){function t(){return(0,b["default"])(this,t),(0,_["default"])(this,(0,v["default"])(t).apply(this,arguments))}return(0,j["default"])(t,e),(0,E["default"])(t,[{key:"find",value:function(){var e=(0,y["default"])(p["default"].mark(function t(e){var n;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return t.prev=4,t.next=7,this.httpClient.get("/user/:id",{urlParams:{id:e}});case 7:return n=t.sent,t.abrupt("return",n.data);case 11:if(t.prev=11,t.t0=t["catch"](4),!t.t0.response||404!=t.t0.response.status){t.next=17;break}return t.abrupt("return",null);case 17:throw t.t0;case 18:case"end":return t.stop()}},t,this,[[4,11]])}));return function(t){return e.apply(this,arguments)}}()}]),t}(O["default"]));t["default"]=A,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),s=r(i),u=n(8),c=r(u),f=n(9),d=r(f),l=n(12),p=r(l),h=n(13),y=r(h),g=n(23),v=r(g),m=n(14),b=r(m),w=n(15),E=r(w),x=n(24),_=r(x),k=n(25),j=r(k),I=n(36),O=r(I),T=n(31),A=(r(T),function(e){function t(){return(0,b["default"])(this,t),(0,_["default"])(this,(0,v["default"])(t).apply(this,arguments))}return(0,j["default"])(t,e),(0,E["default"])(t,[{key:"create",value:function(){var e=(0,y["default"])(p["default"].mark(function t(e){var n,r,a,o,i,s,u=e.name,c=(e.avatarFile,e.replayHistory),f=void 0===c?!0:c,d=e.memberIds,l=void 0===d?[]:d,h=e.organizationId;return p["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},h&&(n["TT-X-Organization-Key"]=h),r={name:u,replay_history:f,members:l},e.next=5,this.httpClient.post("/group",{headers:n,data:r});case 5:return a=e.sent,o=a.getHeader("TT-X-Group-Token"),i=a.getHeader("TT-X-Group-Avatar"),s={id:o,avatarUrl:i,name:u,memberIds:l,organizationId:h},e.abrupt("return",s);case 10:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,y["default"])(p["default"].mark(function t(e,n){var r,a,o=n.name,i=void 0===o?void 0:o,s=(n.avatarFile,n.replayHistory),u=void 0===s?void 0:s,c=n.memberIds,f=void 0===c?[]:c;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={},"undefined"!=typeof i&&(r.name=i),"undefined"!=typeof f&&(r.members=f),"undefined"!=typeof u&&(r.replay_history=u),t.next=6,this.httpClient.post("/group/:id",{urlParams:{id:e},data:r});case 6:return a=t.sent,t.abrupt("return",!0);case 8:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,y["default"])(p["default"].mark(function t(e){var n;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return t.prev=4,t.next=7,this.httpClient.get("/group/:id",{urlParams:{id:e}});case 7:return n=t.sent,t.abrupt("return",n.data);case 11:if(t.prev=11,t.t0=t["catch"](4),!t.t0.response||404!=t.t0.response.status){t.next=17;break}return t.abrupt("return",null);case 17:throw t.t0;case 18:case"end":return t.stop()}},t,this,[[4,11]])}));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=(0,y["default"])(p["default"].mark(function t(e){return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return t.prev=4,t.next=7,this.httpClient.del("/group/:id",{urlParams:{id:e}});case 7:return t.abrupt("return",!0);case 10:if(t.prev=10,t.t0=t["catch"](4),!t.t0.response||404!=t.t0.response.status&&403!=t.t0.response.status){t.next=16;break}return t.abrupt("return",!1);case 16:throw t.t0;case 17:case"end":return t.stop()}},t,this,[[4,10]])}));return function(t){return e.apply(this,arguments)}}()}]),t}(O["default"]));t["default"]=A,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),s=r(i),u=n(8),c=r(u),f=n(9),d=r(f),l=n(12),p=r(l),h=n(13),y=r(h),g=n(23),v=r(g),m=n(14),b=r(m),w=n(15),E=r(w),x=n(24),_=r(x),k=n(25),j=r(k),I=n(36),O=r(I),T=n(31),A=(r(T),function(e){function t(){return(0,b["default"])(this,t),(0,_["default"])(this,(0,v["default"])(t).apply(this,arguments))}return(0,j["default"])(t,e),(0,E["default"])(t,[{key:"find",value:function(){var e=(0,y["default"])(p["default"].mark(function t(e,n){var r;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return t.prev=8,t.next=11,this.httpClient.get("/user/:userId/organization/:id",{urlParams:{userId:e,id:n}});case 11:return r=t.sent,t.abrupt("return",r.data);case 15:if(t.prev=15,t.t0=t["catch"](8),!t.t0.response||404!=t.t0.response.status){t.next=21;break}return t.abrupt("return",null);case 21:throw t.t0;case 22:case"end":return t.stop()}},t,this,[[8,15]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findAllOfUser",value:function(){var e=(0,y["default"])(p["default"].mark(function t(e){var n;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return t.prev=4,t.next=7,this.httpClient.get("/user/:userId/organization",{urlParams:{userId:e}});case 7:return n=t.sent,t.abrupt("return",n.data);case 11:if(t.prev=11,t.t0=t["catch"](4),!t.t0.response||404!=t.t0.response.status){t.next=17;break}return t.abrupt("return",null);case 17:throw t.t0;case 18:case"end":return t.stop()}},t,this,[[4,11]])}));return function(t){return e.apply(this,arguments)}}()}]),t}(O["default"]));t["default"]=A,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,c["default"])(e);if(!Array.isArray(e)){var o=(0,s["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,c["default"])(f))?f.v:void 0}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,c["default"])(e);if(!Array.isArray(e)){var a=(0,s["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,c["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(8),s=r(i),u=n(9),c=r(u),f=n(12),d=r(f),l=n(7),p=r(l),h=n(41),y=r(h),g=n(13),v=r(g),m=n(23),b=r(m),w=n(14),E=r(w),x=n(15),_=r(x),k=n(24),j=r(k),I=n(25),O=r(I),T=n(36),A=r(T),M=function(e){function t(){return(0,E["default"])(this,t),(0,j["default"])(this,(0,b["default"])(t).apply(this,arguments))}return(0,O["default"])(t,e),(0,_["default"])(t,[{key:"send",value:function(){var e=(0,v["default"])(d["default"].mark(function t(e){var n,r,a,o=e.counterPartyId,i=e.body,s=e.senderOrganizationId,u=e.recipientOrganizationId,c=e.metadata,f=e.localId;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u||(u=s),n={recipient:o,body:i},c&&(n.data=c.map(function(e){return(0,y["default"])({},e,{payload:(0,p["default"])(e.payload)})})),s&&(n.sender_organization=s),u&&(n.recipient_organization=u),e.prev=5,e.next=8,this.httpClient.post("/message",{data:n,requestId:f});case 8:return r=e.sent,a={serverId:r.getHeader("TT-X-Message-Id"),ttl:r.getHeader("TT-X-Msg-Ttl")},e.abrupt("return",a);case 13:throw e.prev=13,e.t0=e["catch"](5),e.t0;case 16:case"end":return e.stop()}},t,this,[[5,13]])}));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=(0,v["default"])(d["default"].mark(function t(e){return d["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:return t.prev=4,t.next=7,this.httpClient.del("/message/:id",{urlParams:{id:e}});case 7:return t.abrupt("return",!0);case 10:return t.prev=10,t.t0=t["catch"](4),t.abrupt("return",!1);case 13:case"end":return t.stop()}},t,this,[[4,10]])}));return function(t){return e.apply(this,arguments)}}()}]),t}(A["default"]);t["default"]=M,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/helpers/extends")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),s=r(i),u=n(8),c=r(u),f=n(9),d=r(f),l=n(12),p=r(l),h=n(13),y=r(h),g=n(23),v=r(g),m=n(14),b=r(m),w=n(15),E=r(w),x=n(24),_=r(x),k=n(25),j=r(k),I=n(36),O=r(I),T=n(31),A=r(T),M=function(e){function t(){return(0,b["default"])(this,t),(0,_["default"])(this,(0,v["default"])(t).apply(this,arguments))}return(0,j["default"])(t,e),(0,E["default"])(t,[{key:"update",value:function(){var e=(0,y["default"])(p["default"].mark(function t(e,n,r){return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 2:if(n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 8:if(n instanceof Object){t.next=10;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+a(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(r));case 12:return t.next=14,this.httpClient.post("/metadata/:id",{urlParams:{id:e},data:n,headers:{"TT-X-Organization-Key":r}});case 14:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,y["default"])(p["default"].mark(function t(e,n){var r;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return t.next=10,this.httpClient.get("/metadata/:id",{urlParams:{id:e},headers:{"TT-X-Organization-Key":n}});case 10:return r=t.sent,t.abrupt("return",r.data);case 12:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findMulti",value:function(){var e=(0,y["default"])(p["default"].mark(function t(e,n){var r,i;return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+o(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){t.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+a(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(n));case 8:return t.next=10,this.httpClient.post("/metadata_bulk",{data:{entities:e},headers:{"TT-X-Organization-Key":n}});case 10:return r=t.sent,i=A["default"].zipObject(e,r.data),t.abrupt("return",i);case 13:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),t}(O["default"]);t["default"]=M,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Users:n(44),EventRouter:n(48),Events:n(50),Messages:n(52),Groups:n(66),Organizations:n(67),Conversations:n(70),Presence:n(71),Metadata:n(72),Search:n(75)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n,r,a){var o={};return Object.keys(r).forEach(function(e){o[e]=r[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var a=(0,p["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,y["default"])(u))?u.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var a=(0,p["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var o="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+o);return a.length>=r&&(s+="\n  "+o+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+o+s+"\n"+o+"}":"{\n  "+o+s+"\n"+o+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=i(e[0],t);return e.every(function(e){return i(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,y["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var s,u,c,f=n(7),d=r(f),l=n(8),p=r(l),h=n(9),y=r(h),g=n(45),v=r(g),m=n(11),b=r(m),w=n(12),E=r(w),x=n(13),_=r(x),k=n(23),j=r(k),I=n(14),O=r(I),T=n(15),A=r(T),M=n(24),G=r(M),V=n(25),z=r(V),C=n(20),S=r(C),P=n(31),$=r(P),q=n(46),R=r(q),N=n(47),U=r(N),D=n(21),L=r(D),B=n(32),K=new R["default"].MD5,F=(s=(0,B.decorator)(),u=(0,B.decorator)(),c=function(e){function t(){return(0,O["default"])(this,t),(0,G["default"])(this,(0,j["default"])(t).apply(this,arguments))}return(0,z["default"])(t,e),(0,A["default"])(t,[{key:"signIn",value:function(){var e=(0,_["default"])(E["default"].mark(function t(e,n){var r,a,s,u,c,f=arguments.length<=2||void 0===arguments[2]?{udid:void 0}:arguments[2];return E["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return r={Authorization:this.getSignInAuthHeader(e,n)},a={user_id:e,password:n,push_routing:this.config.pushAgent,version:this.config.clientVersion,device_id:f.udid},t.next=12,this.httpClient.post("/login",{headers:r,data:a});case 12:return s=t.sent,u=this.host.models.User.inject(s.data.user),c=s.data.auth,t.abrupt("return",{user:u,auth:c});case 16:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSignInAuthHeader",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));return this.constructor.getSignInAuthHeader(this.config.productKey,e,t)}},{key:"signUp",value:function(){var e=(0,_["default"])(E["default"].mark(function t(){var e,n,r,a,o,i,s,u,c,f,d,l,p,h,y,g=arguments.length<=0||void 0===arguments[0]?{udid:void 0,email:void 0,password:void 0,countryCode:void 0,version:void 0}:arguments[0];return E["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.config.signUpHashKey,n=this.config.signUpHashSalt,r=g.udid,a=[e,n,r].join(":"),o=K.hex(a),i=[o.substr(0,2),o.substr(o.length-2)].join(""),s=[this.config.productKey,e,n,r,i].join(":"),u=(0,S["default"])(s),c="XMPP-Anonymous "+u,f={Authorization:c},d={primary_email:g.email,unique_id:g.email,password:g.password,push_routing:this.config.pushAgent,product:this.config.productKey,country_code:g.countryCode,device_id:g.udid,version:this.config.clientVersion},t.next=13,this.httpClient.post("/signup",{headers:f,data:d});case 13:return l=t.sent,p=this.host.models.User.inject(l.data.user),h=l.data.auth,y={user:p,auth:h},this.host.emit("signUp",y),t.abrupt("return",y);case 19:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"signOut",value:function(){var e=(0,_["default"])(E["default"].mark(function t(){return E["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpClient.post("/logout"));case 1:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"me",value:function(){var e=(0,_["default"])(E["default"].mark(function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return E["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.host.isSignedIn()){t.next=2;break}return t.abrupt("return",b["default"].reject(new L["default"].NotSignedInError));case 2:return t.abrupt("return",this.find(this.host.getCurrentUser().id,e));case 3:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,_["default"])(E["default"].mark(function t(e){var n,r,a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return E["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:if(a=$["default"].defaults(a,{ignoreNotFound:!1,bypassCache:!1}),this.host.requireUser(),n=null,a.bypassCache){t.next=11;break}if(n=this.host.models.User.get(e),!n||n.$temporary){t.next=11;break}return t.abrupt("return",n);case 11:return t.next=13,this.host.api.users.find(e);case 13:if(r=t.sent,!r){t.next=19;break}n=this.host.models.User.inject(r),delete n.$temporary,t.next=21;
break;case 19:if(a.ignoreNotFound){t.next=21;break}throw new L["default"].NotFoundError(this.host.models.User.name,e);case 21:return t.abrupt("return",n);case 22:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));return this.host.models.User.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+o(e));return this.host.models.User.getMulti(e)}}],[{key:"getSignInAuthHeader",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));var r=[e,t,n].join(":"),a=(0,S["default"])(r),s="XMPP-Simple "+a;return s}}]),t}(U["default"]),a(c.prototype,"me",[s],(0,v["default"])(c.prototype,"me"),c.prototype),a(c.prototype,"find",[u],(0,v["default"])(c.prototype,"find"),c.prototype),c);t["default"]=F,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/object/get-own-property-descriptor")},function(e,t){e.exports=require("jshashes")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a=n(10),o=r(a),i=n(14),s=r(i),u=n(15),c=r(u),f=n(33),d=r(f),l=function(){function e(t,n){(0,s["default"])(this,e),(0,o["default"])(this,n),this.host=t,this.config=t.config,this.httpClient=t.httpClient}return(0,c["default"])(e,[{key:"_resolveModelId",value:function(e){return"string"==typeof e?e:e.serverId?e.serverId:e.id?e.id:null}},{key:"_resolveEntity",value:function(e,t){for(var n=0;n<t.length;n++){var r=t[n],a=this.host.modelsByEntityType[r].get(e);if(a)return a}return null}},{key:"_resolveEntityType",value:function(e,t){var n=this._resolveEntity(e,t);return n?n.$entityType:null}},{key:"mounted",value:function(){}},{key:"dispose",value:function(){}}]),e}();t["default"]=l,(0,o["default"])(l.prototype,d["default"].prototype),e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a=n(49),o=r(a),i=n(14),s=r(i),u=n(15),c=r(u),f=n(31),d=r(f),l=function(){function e(t){var n=this;(0,s["default"])(this,e),this.EVENTS={client_advisory:function(e){switch(e.advisory.name){case"replay_start":this.host.reactToAdvisoryEvent("replayStart",{replayMessageCount:e.advisory.replay_message_count});break;case"replay_stop":this.host.reactToAdvisoryEvent("replayStop")}},"message|group_message":function(e){this.host.conversations.reactToIncomingMessageEvent(e)},"message:status|group:message:status":function(e){this.host.messages.reactToMessageStatusEvent(e)},friends:function(e){this.host.conversations.reactToFriendsEvent(e)},presence:function(e){this.host.presence.reactToPresenceEvent(e)},"push:credentials:requested":function(e){},bang:function(e){this.host.groups.reactToBangEvent(e)},update:function(e){var t=e.type,n=(0,o["default"])(e,["type"]);this.host.injectModel(n,t)},"account:settings":function(e){},"message:is_typing":function(e){},"push:credentials":function(e){},remote_wipe:function(e){},validated:function(e){},conversation_mute:function(e){}},this.host=t;var r=[];d["default"].each(this.EVENTS,function(e,t){t.includes("|")&&(r.push(t),t.split("|").forEach(function(t){return n.EVENTS[t]=e}))}),r.forEach(function(e){return delete n.EVENTS[e]})}return(0,c["default"])(e,[{key:"emit",value:function(e){this.EVENTS[e.type]?this.EVENTS[e.type].call(this,e.data):this.logger&&this.logger.error("unhandled event: "+e.type,e.data)}}]),e}();t["default"]=l,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/helpers/objectWithoutProperties")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a=n(17),o=r(a),i=n(8),s=r(i),u=n(12),c=r(u),f=n(11),d=r(f),l=n(13),p=r(l),h=n(23),y=r(h),g=n(14),v=r(g),m=n(15),b=r(m),w=n(24),E=r(w),x=n(25),_=r(x),k=n(47),j=r(k),I=n(51),O=r(I),T=n(31),A=r(T),M=function(e){function t(e,n){(0,v["default"])(this,t);var r=(0,E["default"])(this,(0,y["default"])(t).call(this,e,n));return r._throtelled_flushQueuedAcks=A["default"].throttle(r._flushQueuedAcks.bind(r),r.config.flushAckInterval,{leading:!1}),r}return(0,_["default"])(t,e),(0,b["default"])(t,[{key:"mounted",value:function(){this._queuedAcks=[],this._statsByEventType={}}},{key:"dispose",value:function(){this._queuedAcks=null,this._statsByEventType=null,this._throtelled_flushQueuedAcks.cancel&&this._throtelled_flushQueuedAcks.cancel()}},{key:"connect",value:function(){var e=(0,p["default"])(c["default"].mark(function t(){var e,n=this;return c["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.host.requireUser(),!this.eventSource){t.next=4;break}return this.logger.warn("already connected"),t.abrupt("return");case 4:return e=this.config.baseUrl+"/events",this.logger.info("connecting events"),this.eventSource=new O["default"](e,{headers:{Authorization:this.httpClient.getAuthHeader(),"TT-X-Features":this.config.eventsFeatures}}),t.abrupt("return",new d["default"](function(e,t){var r=void 0;n.eventSource.addEventListener("open",function(){n.logger.info("open"),r=!0,e()}),n.eventSource.addEventListener("message",n._onEvent.bind(n)),n.eventSource.addEventListener("error",function(e){r||t(),n._onError(e)}),n.eventSource.addEventListener("close",function(){n.logger.info("close")})}));case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){this.eventSource&&this.eventSource.close(),this.eventSource=null}},{key:"reconnect",value:function(){this.eventSource&&this.disconnect(),this.connect()}},{key:"_onEvent",value:function(e){var t=this,n=e.data;if(n.includes("\n"))return void n.split("\n").forEach(function(e){return t._onEvent({data:e})});var r=n;try{n=JSON.parse(r)}catch(a){throw this.logger.error("error parsing ",r),a}var o=n.event_id,i=(0,s["default"])(n.event)[0],u=i.replace("tigertext:iq:",""),c=n.event[i];this._statsByEventType[u]||(this._statsByEventType[u]={count:0}),this._statsByEventType[u].count++,this.logger.info("incoming",u,c);var f=new this.host.models.Event(o,u,c,{_origData:r});try{this.host.eventRouter.emit(f),this.emit("event",f),this.config.autoAckEvents&&this.__queueAck(o)}catch(a){throw this.logger.error("error in event "+u,a,a.stack,{data:c}),a}}},{key:"_onError",value:function(e){var t=this;this.logger.warn("error",e,e.message||"",e.status||""),this.disconnect(),this.config.eventsAutoReconnect&&setTimeout(function(){t.connect()},this.config.eventsAutoReconnectDelay)}},{key:"__queueAck",value:function(e){var t;e=A["default"].arrayWrap(e),(t=this._queuedAcks).push.apply(t,(0,o["default"])(e)),e.length>=this.config.flushAckMaxEvents?(this.logger.log("reached "+this.config.flushAckMaxEvents+" -- flushing"),this._flushQueuedAcks()):this._throtelled_flushQueuedAcks()}},{key:"_flushQueuedAcks",value:function(){this._queuedAcks.length>0&&(this.ack(this._queuedAcks),this._queuedAcks.length=0)}},{key:"ack",value:function(){var e=(0,p["default"])(c["default"].mark(function t(e){return c["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.host.requireUser(),e=A["default"].arrayWrap(e),this.logger.log("ack",e),t.prev=3,t.next=6,this.httpClient.post("/events/ack",{data:{events:e}});case 6:t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](3),this.logger.warn("some events not acked",e);case 11:case"end":return t.stop()}},t,this,[[3,8]])}));return function(t){return e.apply(this,arguments)}}()}]),t}(j["default"]);t["default"]=M,e.exports=t["default"]},function(e,t){e.exports=require("eventsource")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n,r,a){var o={};return Object.keys(r).forEach(function(e){o[e]=r[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,m["default"])(e);if(!Array.isArray(e)){var a=(0,g["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,h["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,m["default"])(u))?u.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,m["default"])(e);if(!Array.isArray(e)){var a=(0,g["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var o="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,h["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+o);return a.length>=r&&(s+="\n  "+o+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+o+s+"\n"+o+"}":"{\n  "+o+s+"\n"+o+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=i(e[0],t);return e.every(function(e){return i(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,m["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var s,u,c,f,d,l,p=n(7),h=r(p),y=n(8),g=r(y),v=n(9),m=r(v),b=n(45),w=r(b),E=n(53),x=r(E),_=n(54),k=r(_),j=n(11),I=r(j),O=n(10),T=r(O),A=n(41),M=r(A),G=n(12),V=r(G),z=n(13),C=r(z),S=n(23),P=r(S),$=n(14),q=r($),R=n(15),N=r(R),U=n(24),D=r(U),L=n(25),B=r(L),K=n(47),F=r(K),Z=n(31),H=r(Z),W=n(32),Y=n(55),X=r(Y),Q=n(56),J=n(64),ee=r(J),te=n(21),ne=r(te),re=n(65),ae=r(re),oe=(s=(0,W.decorator)(),u=(0,W.decorator)(),c=(0,W.decorator)({memoize:!0}),f=(0,W.decorator)(),d=(0,W.decorator)(),l=function(e){function t(){var e;(0,q["default"])(this,t);for(var n=arguments.length,r=Array(n),a=0;n>a;a++)r[a]=arguments[a];var o=(0,D["default"])(this,(e=(0,P["default"])(t)).call.apply(e,[this].concat(r)));return o._throtelled_flushQueueMessageStatuses=o.config.flushSetMessageStatusInterval?H["default"].throttle(o.__flushQueueMessageStatuses,o.config.flushSetMessageStatusInterval,{leading:!1}):o.__flushQueueMessageStatuses,o}return(0,B["default"])(t,e),(0,N["default"])(t,[{key:"mounted",value:function(){this._queuedMessageStatuses={deliveredIds:[],readIds:[]}}},{key:"dispose",value:function(){this._queuedMessageStatuses=null,W.decorator.clear(this.downloadAttachmentURL)}},{key:"sendToUser",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e,n){var r,a=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=a.organizationId,u=a.senderOrganizationId,c=a.recipientOrganizationId,f=a.metadata;return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:if(s?(u&&ee["default"].raise("senderOrganizationId","invalid","Cannot set senderOrganizationId if organizationId is set"),c&&ee["default"].raise("recipientOrganizationId","invalid","Cannot set recipientOrganizationId if organizationId is set"),u=c=s):u?c||(c=u):this.host.config.defaultOrganizationId?u=c=this.host.config.defaultOrganizationId:ee["default"].raise("senderOrganizationId or organizationId","required","Message is sent in the context of an organization. Provide `senderOrganizationId` or `organizationId` or set a default one with client.setDefaultOrganization(...)"),e=this._resolveModelId(e),this.host.users.getById(e)){t.next=23;break}return t.prev=11,t.next=14,this.host.users.find(e);case 14:r=t.sent,e=r.id,t.next=23;break;case 18:if(t.prev=18,t.t0=t["catch"](11),t.t0.code===ne["default"].NotFoundError.CODE){t.next=22;break}throw t.t0;case 22:return t.abrupt("return",this.__sendToUnknownUser(e,n,{organizationId:s,senderOrganizationId:u,recipientOrganizationId:c,metadata:f}));case 23:return t.abrupt("return",this.__send("user",e,n,{senderOrganizationId:u,recipientOrganizationId:c,metadata:f}));case 24:case"end":return t.stop()}},t,this,[[11,18]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"__sendToUnknownUser",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e,n){var r,a,s,u,c,f,d=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],l=(d.organizationId,d.senderOrganizationId),p=d.recipientOrganizationId,h=d.metadata;return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return r=X["default"].v4(),h&&(h=this.__normalizeMetadata(h)),p||(p=l),a=this.__getNextSortNumber(),t.next=14,this.host.api.messages.send({counterPartyId:e,body:n,senderOrganizationId:l,recipientOrganizationId:p,metadata:h,localId:r});case 14:return s=t.sent,t.next=17,this.host.users.find(e);case 17:return u=t.sent,c=this.host.conversations.ensureConversation("user",u.id,l),f=this.host.models.Message.inject({id:s.serverId,conversationId:c.id,counterParty:u,body:n,senderOrganizationId:l,recipientOrganizationId:p,sortNumber:a,createdAt:new Date,senderId:this.host.getCurrentUser().id,direction:Q.MessageDirection.OUTGOING,senderStatus:Q.MessageSenderStatus.SENT,recipientStatus:Q.MessageRecipientStatus.NEW,serverId:null,metadata:h,ttl:s.ttl}),this.host.emit("message:sending",f),this.host.emit("message:sent",f),t.abrupt("return",f);case 23:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendToGroup",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e,n){var r,a=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=a.organizationId,u=a.metadata;return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return e=this._resolveModelId(e),r=this.host.models.Group.get(e),r?s=r.organizationId:s||(this.host.config.defaultOrganizationId?s=this.host.config.defaultOrganizationId:ee["default"].raise("organizationId","required","Message is sent in the context of an organization. Provide `organizationId` or set a default one with client.setDefaultOrganization(...)")),t.abrupt("return",this.__send("group",e,n,{senderOrganizationId:s,metadata:u}));case 12:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendToNewGroup",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e,n){var r,a=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=a.organizationId,u=a.groupName,c=a.groupMetadata;return a.metadata,V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=6;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return e=e.map(this._resolveModelId.bind(this)),0==e.length&&ee["default"].raise("userIds","required"),s||(this.host.config.defaultOrganizationId?s=this.host.config.defaultOrganizationId:ee["default"].raise("organizationId","required","Message is sent in the context of an organization. Provide `organizationId` or set a default one with client.setDefaultOrganization(...)")),t.next=13,this.__prepareGroupForUsers(s,e,u,{groupMetadata:c});case 13:return r=t.sent,t.abrupt("return",this.sendToGroup(r,n,{organizationId:s}));case 15:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"__normalizeMetadata",value:function(e){return e?H["default"].arrayWrap(e).map(function(e){return(0,M["default"])({mimetype:"application/json"},e)}):null}},{key:"__getNextSortNumber",value:function(){var e=(0,H["default"])(this.host.models.Message.getAll()).orderBy(["sortNumber"],["desc"]).first(),t=e?e.sortNumber:0,n=t+1e-6;return n}},{key:"__send",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e,n,r,a){var s,u,c,f,d,l=a.senderOrganizationId,p=a.recipientOrganizationId,h=a.metadata,y=arguments;return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if(null!=y[3]&&"string"==typeof y[3].senderOrganizationId&&(null==y[3].recipientOrganizationId||"string"==typeof y[3].recipientOrganizationId)&&(null==y[3].metadata||Array.isArray(y[3].metadata)||null==y[3].metadata||y[3].metadata instanceof Object)){t.next=8;break}throw new TypeError("Value of argument 3 violates contract.\n\nExpected:\n{ senderOrganizationId: string;\n  recipientOrganizationId: ?string;\n  metadata: ?Array | ?Object;\n}\n\nGot:\n"+i(y[3]));case 8:if("string"==typeof e){t.next=10;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 10:if("string"==typeof n){t.next=12;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 12:if("string"==typeof r){t.next=14;break}throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 14:if(null!=y[3]&&"string"==typeof y[3].senderOrganizationId&&(null==y[3].recipientOrganizationId||"string"==typeof y[3].recipientOrganizationId)&&(null==y[3].metadata||Array.isArray(y[3].metadata)||null==y[3].metadata||y[3].metadata instanceof Object)){t.next=16;break}throw new TypeError("Value of argument 3 violates contract.\n\nExpected:\n{ senderOrganizationId: string;\n  recipientOrganizationId: ?string;\n  metadata: ?Array | ?Object;\n}\n\nGot:\n"+o(y[3]));case 16:return this.host.requireUser(),ee["default"].oneOf("counterPartyType",e,["user","group"]),ee["default"].notEmpty("counterPartyId",n),h&&(h=this.__normalizeMetadata(h)),p||(p=l),s=this.__getNextSortNumber(),u=this.host.conversations.ensureConversation(e,n,l),c=this.host.models.Message.createInstance({id:X["default"].v4(),conversationId:u.id,counterPartyId:n,counterPartyType:e,body:r,senderOrganizationId:l,recipientOrganizationId:p,sortNumber:s,createdAt:new Date,senderId:this.host.getCurrentUser().id,direction:Q.MessageDirection.OUTGOING,senderStatus:Q.MessageSenderStatus.SENDING,$synced:!1,serverId:null,metadata:h}),"group"==e?(c.groupId=n,c.recipientStatus=Q.MessageRecipientStatus.NA):(c.recipientId=n,c.recipientStatus=Q.MessageRecipientStatus.NEW),this.host.models.Message.inject(c),this.host.emit("message:sending",c),t.next=29,this.host.api.messages.send({counterPartyId:n,body:r,senderOrganizationId:l,recipientOrganizationId:p,metadata:h,localId:c.id});case 29:if(f=t.sent,(0,T["default"])(c,{serverId:f.serverId,ttl:f.ttl,senderStatus:Q.MessageSenderStatus.SENT,$synced:!0}),"group"!=e){t.next=37;break}if(c.group&&!c.group.$temporary){t.next=35;break}return t.next=35,this.host.groups.find(c.groupId,{includeMembers:!0,bypassCache:!0});case 35:t.next=43;break;case 37:if(c.recipient&&!c.recipient.$temporary){t.next=43;break}return t.next=40,this.host.users.find(c.recipientId,{bypassCache:!0});case 40:d=t.sent,c.recipientId=d.id,c.counterPartyId=d.id;case 43:return this.host.models.Message.inject(c),this.host.emit("message:sent",c),t.abrupt("return",c);case 46:case"end":return t.stop()}},t,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"__prepareGroupForUsers",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e,n,r,a){var o,i,s=this,u=a.groupMetadata;return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=[this.host.getCurrentUser()].concat(n.map(function(e){return s.host.models.User.get(e)}).filter(Boolean)),r||(r=o.map(function(e){return e.displayName}).filter(Boolean).join(", ")||"Group"),t.next=4,this.host.groups.create({organizationId:e,name:r,replayHistory:!0,memberIds:n,metadata:u});case 4:return i=t.sent,t.abrupt("return",i);case 6:case"end":return t.stop()}},t,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"onMessageRecalled",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));this.host.requireUser();var t=this._getMessageByServerId(e);t&&this._deleteLocalMessage(t)}},{key:"_deleteLocalMessage",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(e));this.host.models.Message.eject(e)}},{key:"recall",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e){var n,r;return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+o(e));case 4:return this.host.requireUser(),n=H["default"].arrayWrap(e),r=n.map(this.__recallSingle.bind(this)),t.next=9,I["default"].all(r);case 9:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"__recallSingle",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e){var n;return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 4:if(n=this._resolveMessage(e),!n){t.next=17;break}if(n.senderId==this.host.getCurrentUser().id){t.next=8;break}throw new ne["default"].PermissionDeniedError(n,n.serverId,"recall");case 8:if(n.$synced!==!1){t.next=12;break}this._deleteLocalMessage(n),t.next=15;break;case 12:return t.next=14,this.host.api.messages.destroy(n.serverId);case 14:this._deleteLocalMessage(n);case 15:t.next=19;break;case 17:return t.next=19,this.host.api.messages.destroy(e);case 19:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"reactToMessageStatusEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(e));var t=e.client_id,n=e.is_recalled;n?this.onMessageRecalled(t):this.__setMessageStatusPerRecipientFromServerData(t,H["default"].pick(e,["status","account_id","timestamp"]))&&this.__touchMessage(t)}},{key:"__setMessageStatusPerRecipientFromServerData",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(!(t instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));if(!(t instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(t));var n=Q.MessageRecipientStatus.resolve(t.status),r=t.account_id,a=t.timestamp;return this.setRecipientMessageStatus(e,r,n,a)}},{key:"setRecipientMessageStatus",value:function(e,t,n,r){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if(!(null==r||"string"==typeof r||null==r||r instanceof Date))throw new TypeError('Value of argument "createdAt" violates contract.\n\nExpected:\n?string | ?Date\n\nGot:\n'+i(r));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageServerId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));if("string"!=typeof n)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));if(!(null==r||"string"==typeof r||null==r||r instanceof Date))throw new TypeError('Value of argument "createdAt" violates contract.\n\nExpected:\n?string | ?Date\n\nGot:\n'+o(r));var a=this._getMessageByServerId(e);if(a){n=Q.MessageRecipientStatus.resolve(n),this._setSingleUserMessageRecipientMessageStatus(a,n);var s=H["default"].find(a.statusesPerRecipient,{userId:t});if(!s||this.__canChangeRecipientStatus(s.status,n)){var u=a.id+":"+t;return this.host.models.MessageStatusPerRecipient.inject({id:u,messageId:a.id,userId:t,status:n,createdAt:r})}}}},{key:"__touchMessage",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));var t=this._resolveMessage(e);this.host.models.Message.inject({id:t.id})}},{key:"_resolveMessage",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));return this.host.models.Message.is(e)?e:this.host.models.Message.get(e)||this._getMessageByServerId(e)}},{key:"_getMessageByServerId",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));
return this.host.models.Message.is(e)?e:(0,H["default"])(this.host.models.Message.getAll()).find({serverId:e})}},{key:"_setSingleUserMessageRecipientMessageStatus",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(e));if("string"!=typeof t)throw new TypeError('Value of argument "recipientStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));this.__canChangeRecipientStatus(e.recipientStatus,t)&&this.host.models.Message.inject({id:e.id,recipientStatus:t})}},{key:"__canChangeRecipientStatus",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "fromStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "toStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof e)throw new TypeError('Value of argument "fromStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));if("string"!=typeof t)throw new TypeError('Value of argument "toStatus" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));return e===t?!1:e!==Q.MessageRecipientStatus.READ||t!=Q.MessageRecipientStatus.DELIVERED}},{key:"find",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e){var n,r,a,s,u;return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return this.host.requireUser(),t.next=7,this.httpClient.get("/message/:id",{urlParams:{id:e}});case 7:return n=t.sent,r=n.data,a=n.data.recipient_token,t.next=12,this.__lookupCounterParty(a);case 12:if(s=t.sent,!s){t.next=17;break}r.counterParty=s,t.next=18;break;case 17:return t.abrupt("return",null);case 18:return u=this.host.models.Message.inject(r),t.next=21,this.findStatusesPerRecipient(u);case 21:return t.abrupt("return",u);case 22:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));return this.host.models.Message.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+o(e));return this.host.models.Message.getMulti(e)}},{key:"__lookupCounterParty",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e){var n,r,a,s,u,c,f,d,l,p,h,y,g,v,m;return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:if(r=[{model:this.host.models.User,finder:(n=this.host.users).find.bind(n)},{model:this.host.models.Group,finder:(n=this.host.groups).find.bind(n)}],r&&("function"==typeof r[k["default"]]||Array.isArray(r))){t.next=7;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+o(r));case 7:if(r&&("function"==typeof r[k["default"]]||Array.isArray(r))){t.next=9;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+i(r));case 9:a=!0,s=!1,u=void 0,t.prev=12,c=(0,x["default"])(r);case 14:if(a=(f=c.next()).done){t.next=22;break}if(d=f.value.model,l=d.get(e),!l){t.next=19;break}return t.abrupt("return",l);case 19:a=!0,t.next=14;break;case 22:t.next=28;break;case 24:t.prev=24,t.t0=t["catch"](12),s=!0,u=t.t0;case 28:t.prev=28,t.prev=29,!a&&c["return"]&&c["return"]();case 31:if(t.prev=31,!s){t.next=34;break}throw u;case 34:return t.finish(31);case 35:return t.finish(28);case 36:if(r&&("function"==typeof r[k["default"]]||Array.isArray(r))){t.next=38;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+o(r));case 38:if(r&&("function"==typeof r[k["default"]]||Array.isArray(r))){t.next=40;break}throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+i(r));case 40:p=!0,h=!1,y=void 0,t.prev=43,g=(0,x["default"])(r);case 45:if(p=(v=g.next()).done){t.next=62;break}return m=v.value.finder,t.prev=47,t.next=50,m(e);case 50:if(l=t.sent,!l){t.next=53;break}return t.abrupt("return",l);case 53:t.next=59;break;case 55:if(t.prev=55,t.t1=t["catch"](47),t.t1.code==ne["default"].NotFoundError.CODE){t.next=59;break}throw t.t1;case 59:p=!0,t.next=45;break;case 62:t.next=68;break;case 64:t.prev=64,t.t2=t["catch"](43),h=!0,y=t.t2;case 68:t.prev=68,t.prev=69,!p&&g["return"]&&g["return"]();case 71:if(t.prev=71,!h){t.next=74;break}throw y;case 74:return t.finish(71);case 75:return t.finish(68);case 76:return t.abrupt("return",null);case 77:case"end":return t.stop()}},t,this,[[12,24,28,36],[29,,31,35],[43,64,68,76],[47,55],[69,,71,75]])}));return function(t){return e.apply(this,arguments)}}()},{key:"downloadAttachmentURL",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e,n){var r,a;return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||"number"==typeof n){t.next=4;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 6:if("string"==typeof n||"number"==typeof n){t.next=8;break}throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+o(n));case 8:return r=this._resolveMessage(e),n=n.toString(),t.next=12,this.httpClient.downloadImageAndGetURL("/message/"+r.serverId+"/attachment/"+n);case 12:return a=t.sent,t.abrupt("return",a);case 14:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e){return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return this.host.requireUser(),t.next=7,this.httpClient["delete"]("/message/:id",{urlParams:{id:e}});case 7:return t.abrupt("return",null);case 8:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getMessageCount",value:function(){return this.host.models.Message.getAll().length}},{key:"getTotalUnreadCount",value:function(){return H["default"].sumBy(this.host.models.Conversation.getAll(),"unreadCount")}},{key:"markAsRead",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=n.queue,a=void 0===r?!0:r;return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+o(e));case 4:if(e=(0,H["default"])(e).chain().arrayWrap().map(this._resolveModelId.bind(this)).uniq().value(),!a){t.next=9;break}return t.abrupt("return",this.__queueMessageStatuses({readIds:e}));case 9:return t.abrupt("return",this.__setMessagesStatus({readIds:e}));case 10:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"markAsDelivered",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=n.queue,a=void 0===r?!0:r;return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object||Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+o(e));case 4:if(e=(0,H["default"])(e).chain().arrayWrap().map(this._resolveModelId.bind(this)).uniq().value(),!a){t.next=9;break}return t.abrupt("return",this.__queueMessageStatuses({deliveredIds:e}));case 9:return t.abrupt("return",this.__setMessagesStatus({deliveredIds:e}));case 10:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"markAsReceived",value:function(){var e=(0,C["default"])(V["default"].mark(function t(){var e=arguments;return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.markAsDelivered.apply(this,e));case 1:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"__queueMessageStatuses",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e){var n,r=e.deliveredIds,a=e.readIds,s=arguments;return V["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=s[0]&&(null==s[0].deliveredIds||Array.isArray(s[0].deliveredIds)&&s[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(null==s[0].readIds||Array.isArray(s[0].readIds)&&s[0].readIds.every(function(e){return"string"==typeof e}))){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ deliveredIds: ?Array<string>;\n  readIds: ?Array<string>;\n}\n\nGot:\n"+i(s[0]));case 2:if(null!=s[0]&&(null==s[0].deliveredIds||Array.isArray(s[0].deliveredIds)&&s[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(null==s[0].readIds||Array.isArray(s[0].readIds)&&s[0].readIds.every(function(e){return"string"==typeof e}))){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{ deliveredIds: ?Array<string>;\n  readIds: ?Array<string>;\n}\n\nGot:\n"+o(s[0]));case 4:if(r&&(this._queuedMessageStatuses.deliveredIds=H["default"].union(this._queuedMessageStatuses.deliveredIds,r)),a&&(this._queuedMessageStatuses.readIds=H["default"].union(this._queuedMessageStatuses.readIds,a)),n=this._queuedMessageStatuses.deliveredIds.length+this._queuedMessageStatuses.readIds.length,!(n>=this.config.flushMessageMaxCount)){e.next=12;break}return this.logger.log("reached "+this.config.flushMessageMaxCount+" -- flushing"),e.abrupt("return",this.__flushQueueMessageStatuses());case 12:this._throtelled_flushQueueMessageStatuses();case 13:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"__flushQueueMessageStatuses",value:function(){var e=this._queuedMessageStatuses.deliveredIds.length+this._queuedMessageStatuses.readIds.length;e>0&&(this.__setMessagesStatus(this._queuedMessageStatuses),this._queuedMessageStatuses.deliveredIds=[],this._queuedMessageStatuses.readIds=[])}},{key:"__setMessagesStatus",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e){var n,r,a,o=this,i=e.deliveredIds,s=void 0===i?[]:i,u=e.readIds,c=void 0===u?[]:u;return V["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),s=(0,H["default"])(s).chain().map(this._resolveModelId.bind(this)).uniq().value(),c=(0,H["default"])(c).chain().map(this._resolveModelId.bind(this)).uniq().value(),n=s.map(this._resolveMessage).filter(Boolean),r=c.map(this._resolveMessage).filter(Boolean),c=H["default"].difference(c,(0,H["default"])(r).filter(function(e){return e.recipientStatus===Q.MessageRecipientStatus.READ||e.recipientStatus==Q.MessageRecipientStatus.TO_BE_READ}).map("id").value()),s=H["default"].difference(s,c,(0,H["default"])(n).filter(function(e){return e.recipientStatus===Q.MessageRecipientStatus.DELIVERED||e.recipientStatus===Q.MessageRecipientStatus.READ||e.recipientStatus==Q.MessageRecipientStatus.TO_BE_READ}).map("id").value()),a={},s.length&&(a.delivered=s),c.length&&(a.read=c,r.forEach(function(e){return o.host.models.Message.inject({id:e.id,recipientStatus:Q.MessageRecipientStatus.TO_BE_READ})})),!H["default"].isEmpty(a.delivered)||!H["default"].isEmpty(a.read)){e.next=12;break}return e.abrupt("return",!1);case 12:return e.next=14,this.httpClient.post("/message/status",{data:a});case 14:c.length&&(a.read=c,r.forEach(function(e){return o.host.models.Message.inject({id:e.id,recipientStatus:Q.MessageRecipientStatus.READ})})),s.length&&n.forEach(function(e){return o.host.models.Message.inject({id:e.id,recipientStatus:Q.MessageRecipientStatus.DELIVERED})});case 16:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findStatusesPerRecipient",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e){var n,r,a,s,u=this;return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 4:if(this.host.requireUser(),n=this._resolveMessage(e)){t.next=8;break}return t.abrupt("return",null);case 8:t.t0=n.counterPartyType,t.next="group"===t.t0?11:"user"===t.t0?21:23;break;case 11:return t.next=13,this.httpClient.get("/message/:id/status",{urlParams:{id:n.serverId}});case 13:if(r=t.sent,a=r.data,!a.is_recalled){t.next=18;break}return this.onMessageRecalled(n.serverId),t.abrupt("return");case 18:return s=a.statuses.map(function(e){return u.__setMessageStatusPerRecipientFromServerData(n.serverId,e)}).some(function(e){return e}),s&&this.__touchMessage(n),t.abrupt("break",23);case 21:return this.setRecipientMessageStatus(n.serverId,n.counterPartyId,n.recipientStatus,null)&&this.__touchMessage(n),t.abrupt("break",23);case 23:return t.abrupt("return",n.statusesPerRecipient);case 24:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"startTyping",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e){return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return this.host.requireUser(),t.abrupt("return",this.httpClient.post("/message/typing",{data:{recipient:e}}));case 6:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"endTyping",value:function(){var e=(0,C["default"])(V["default"].mark(function t(e){return V["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:return this.host.requireUser(),t.abrupt("return",this.httpClient["delete"]("/message/typing/:recipientId",{urlParams:{recipientId:e}}));case 6:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(F["default"]),a(l.prototype,"__prepareGroupForUsers",[s],(0,w["default"])(l.prototype,"__prepareGroupForUsers"),l.prototype),a(l.prototype,"_resolveMessage",[ae["default"]],(0,w["default"])(l.prototype,"_resolveMessage"),l.prototype),a(l.prototype,"find",[u],(0,w["default"])(l.prototype,"find"),l.prototype),a(l.prototype,"downloadAttachmentURL",[c],(0,w["default"])(l.prototype,"downloadAttachmentURL"),l.prototype),a(l.prototype,"destroy",[f],(0,w["default"])(l.prototype,"destroy"),l.prototype),a(l.prototype,"__flushQueueMessageStatuses",[ae["default"]],(0,w["default"])(l.prototype,"__flushQueueMessageStatuses"),l.prototype),a(l.prototype,"findStatusesPerRecipient",[d],(0,w["default"])(l.prototype,"findStatusesPerRecipient"),l.prototype),l);t["default"]=oe,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/get-iterator")},function(e,t){e.exports=require("babel-runtime/core-js/symbol/iterator")},function(e,t){e.exports=require("node-uuid")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={MessageRecipientStatus:n(57),MessageSenderStatus:n(60),MessageDirection:n(61),PresenceStatus:n(62),GroupType:n(63)},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(31),o=r(a),i=n(58),s=r(i),u=new s["default"]({READ:{serverKey:"Read"},TO_BE_READ:{serverKey:"ToBeRead"},DELIVERED:{serverKey:"Delivered"},RECEIVED_ON_CLIENT:{serverKey:"ReceivedOnClient"},NEW:{serverKey:"New"},NA:{key:"NA"}}),c=o["default"].reduce(u.entries,function(e,t){return e[t.key]=t.serverKey,e},{}),f=o["default"].invert(c);u.fromServer=function(e){return f[e]},u.toServer=function(e){return c[e]||f[e]},u.resolve=function(e){return this.isValid(e)?e:this.fromServer(e)},t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a=n(59),o=r(a),i=n(41),s=r(i),u=n(14),c=r(u),f=n(15),d=r(f),l=function(){function e(t){(0,c["default"])(this,e),Array.isArray(t)&&(t=t.reduce(function(e,t){return e[t]={},e},{})),this.keys=[],this.entries=[],this.entriesByKey={};for(var n in t){this[n]=n;var r=(0,s["default"])({key:n},t[n]);this.entriesByKey[n]=r,this.entries.push(r),this.keys.push(n)}(0,o["default"])(this.keys),(0,o["default"])(this.entries),(0,o["default"])(this.entriesByKey)}return(0,d["default"])(e,[{key:"resolve",value:function(e){return e}},{key:"isValid",value:function(e){return!!this.entriesByKey[e]}}]),e}();t["default"]=l,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/object/freeze")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(58),o=r(a),i=new o["default"](["SENDING","SENT","FAILED","NEW","NA"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(58),o=r(a),i=new o["default"](["INCOMING","OUTGOING"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(31),o=r(a),i=n(58),s=r(i),u=new s["default"]({UNKNOWN:{serverKey:"unknown"},AVAILABLE:{serverKey:"available"},UNAVAILABLE:{serverKey:"unavailable"}}),c=o["default"].reduce(u.entries,function(e,t){return e[t.key]=t.serverKey,e},{}),f=o["default"].invert(c);u.fromServer=function(e){return f[e]},u.resolve=function(e){return this.isValid(e)?e:this.fromServer(e)},t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(58),o=r(a),i=new o["default"](["GROUP","ROOM","DISTRIBUTION_LIST"]);t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),o=r(a),i=n(29),s=r(i),u={isOneOf:function(e,t,n){return n.includes(t)},isNotEmpty:function(e,t){return!!t},raise:function(e){var t=arguments.length<=1||void 0===arguments[1]?"invalid":arguments[1],n=arguments[2];throw new s["default"](e,t,n)}};(0,o["default"])(u).forEach(function(e){var t=e.replace(/^is([A-Z])/,function(e,t){return t.toLowerCase()}),n=u[e];u[t]=function(e,t,r){for(var a=arguments.length,o=Array(a>3?a-3:0),i=3;a>i;i++)o[i-3]=arguments[i];n.apply(void 0,[e,t,r].concat(o))||u.raise(e,void 0,r)}}),t["default"]=u,e.exports=t["default"]},function(e,t){e.exports=require("autobind-decorator")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n,r,a){var o={};return Object.keys(r).forEach(function(e){o[e]=r[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var a=(0,h["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,g["default"])(u))?u.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var a=(0,h["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var o="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+o);return a.length>=r&&(s+="\n  "+o+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+o+s+"\n"+o+"}":"{\n  "+o+s+"\n"+o+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=i(e[0],t);return e.every(function(e){return i(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,g["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var s,u,c,f,d=n(7),l=r(d),p=n(8),h=r(p),y=n(9),g=r(y),v=n(45),m=r(v),b=n(41),w=r(b),E=n(11),x=r(E),_=n(17),k=r(_),j=n(12),I=r(j),O=n(13),T=r(O),A=n(23),M=r(A),G=n(14),V=r(G),z=n(15),C=r(z),S=n(24),P=r(S),$=n(25),q=r($),R=n(47),N=r(R),U=n(21),D=r(U),L=n(31),B=r(L),K=n(32),F=(s=(0,K.decorator)(),u=(0,K.decorator)({memoize:!0}),c=(0,K.decorator)(),f=function(e){function t(){return(0,V["default"])(this,t),(0,P["default"])(this,(0,M["default"])(t).apply(this,arguments))}return(0,q["default"])(t,e),(0,C["default"])(t,[{key:"dispose",value:function(){K.decorator.clear(this.findAll)}},{key:"create",value:function(){var e=(0,T["default"])(I["default"].mark(function t(e){var n,r,a=e.organizationId,o=e.name,i=e.avatarFile,s=e.replayHistory,u=void 0===s?!0:s,c=e.memberIds,f=void 0===c?[]:c,d=e.metadata;return I["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),a){e.next=3;break}throw new D["default"].ValidationError("organizationId","required");case 3:return f=f.map(this._resolveModelId.bind(this)),f.includes(this.host.getCurrentUser().id)||f.unshift(this.host.getCurrentUser().id),e.next=7,this.host.api.groups.create({name:o,avatarFile:i,replayHistory:u,memberIds:f,organizationId:a});case 7:if(n=e.sent,r=this.host.models.Group.inject(n),!d){e.next=12;break}return e.next=12,this.host.metadata.update(r.id,d,a);case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,T["default"])(I["default"].mark(function t(e,n){var r,a=n.name,s=n.avatarFile,u=n.replayHistory,c=n.memberIds,f=n.metadata;return I["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 4:return this.host.requireUser(),e=this._resolveModelId(e),c.includes(this.host.getCurrentUser().id)||c.unshift(this.host.getCurrentUser().id),t.next=9,this.host.api.groups.update(e,{name:a,avatarFile:s,replayHistory:u,memberIds:c});case 9:if(r=this.host.models.Group.inject({id:e,name:a,replayHistory:u,memberIds:c}),!f){t.next=13;break}return t.next=13,this.host.metadata.update(e,f,r.organizationId);case 13:return t.abrupt("return",r);case 14:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,T["default"])(I["default"].mark(function t(e){var n,r,a,s=this,u=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return I["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:if(u=B["default"].defaults(u,{ignoreNotFound:!1,bypassCache:!1,includeMembers:!1,includeMetadata:!1}),this.host.requireUser(),n=null,u.bypassCache){t.next=11;break}if(n=this.host.models.Group.get(e),!n){t.next=11;break}return t.abrupt("return",n);case 11:return t.next=13,this.host.api.groups.find(e);case 13:if(r=t.sent,!r){t.next=19;break}n=this.host.models.Group.inject(r),delete n.$temporary,t.next=21;break;case 19:if(u.ignoreNotFound){t.next=21;break}throw new D["default"].NotFoundError(this.host.models.Group.name,e);case 21:if(!n){t.next=28;break}if(a=[],u.includeMetadata&&a.push(this.host.metadata.find(e,n.organizationId)),u.includeMembers&&a.push.apply(a,(0,k["default"])(n.memberIds.map(function(e){return s.host.users.find(e,{ignoreNotFound:!0})}))),!(a.length>0)){t.next=28;break}return t.next=28,x["default"].all(a);case 28:return t.abrupt("return",n);case 29:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findAll",value:function(){var e=(0,T["default"])(I["default"].mark(function t(){var e,n,r,a,o,i=this,s=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],u=s.includeMembers,c=void 0===u?!1:u,f=s.includeMetadata,d=void 0===f?!1:f;return I["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.host.models.Organization.getAll(),0!=e.length){t.next=5;break}return t.next=4,this.host.organizations.findAll();case 4:e=t.sent;case 5:return t.next=7,this.host.search.query({types:["group"],organizationIds:e.map(function(e){return e.id}),query:{displayName:""},includeMetadata:d});case 7:if(n=t.sent,r=n.map(function(e){return e.entity}),!c){t.next=16;break}if(a=[],o=(0,B["default"])(r).map("memberIds").flatten().uniq().value(),a.push.apply(a,(0,k["default"])(o.map(function(e){return i.host.users.find(e,{ignoreNotFound:!0})}))),!(a.length>0)){t.next=16;break}return t.next=16,x["default"].all(a);case 16:return t.abrupt("return",r);case 17:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findAllWithSpecificMembers",value:function(){var e=(0,T["default"])(I["default"].mark(function t(e,n){var r;return I["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(e));case 2:if("string"==typeof n||n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=6;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+o(e));case 6:if("string"==typeof n||n instanceof Object){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(n));case 8:if(n=this._resolveModelId(n),e=B["default"].arrayWrap(e).map(this._resolveModelId.bind(this)),B["default"].contain(e,this.host.getCurrentUser().id),r=this.__findAllLocalWithSpecificMembers(e,n),0!==r.length){t.next=16;break}return t.next=15,this.findAll();case 15:r=this.__findAllLocalWithSpecificMembers(e,n);case 16:return t.abrupt("return",r);case 17:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"ensureMembers",value:function(){var e=(0,T["default"])(I["default"].mark(function t(e){var n=this;return I["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));case 2:if(e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(e));
case 4:e.memberIds.forEach(function(e){var t;n.host.models.User.ensureEntityOrCreateTemporaryAndFind({id:e,displayName:"Loading..."},{finder:(t=n.host.users).find.bind(t)})});case 5:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));return this.host.models.Group.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+o(e));return this.host.models.Group.getMulti(e)}},{key:"__findAllLocalWithSpecificMembers",value:function(e,t){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+o(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));var n=this.host.models.Group.getAll(),r=B["default"].filter(n,function(n){return n.organizationId==t&&0==B["default"].xor(n.memberIds,e).length});return r}},{key:"destroy",value:function(){var e=(0,T["default"])(I["default"].mark(function t(e){var n;return I["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 4:return this.host.requireUser(),e=this._resolveModelId(e),t.next=8,this.host.api.groups.destroy(e);case 8:if(n=t.sent){t.next=11;break}throw new D["default"].NotFoundError(this.host.models.Group.name,e);case 11:return this.host.models.Group.eject(e),t.abrupt("return",null);case 13:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findAllMemberIds",value:function(){var e=(0,T["default"])(I["default"].mark(function t(e){var n;return I["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 4:return this.host.requireUser(),e=this._resolveModelId(e),t.next=8,this.httpClient.get("/group/:id/members",{urlParams:{id:e}});case 8:return n=t.sent,t.abrupt("return",n.data);case 10:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addMembers",value:function(){var e=(0,T["default"])(I["default"].mark(function t(e,n){return I["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 6:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){t.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+o(n));case 8:return this.host.requireUser(),e=this._resolveModelId(e),n=B["default"].arrayWrap(n).map(this._resolveModelId.bind(this)),t.next=13,this.httpClient.post("/group/:id/members",{urlParams:{id:e},data:{members:n}});case 13:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeMembers",value:function(){var e=(0,T["default"])(I["default"].mark(function t(e,n){return I["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){t.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 6:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){t.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+o(n));case 8:return this.host.requireUser(),e=this._resolveModelId(e),n=B["default"].arrayWrap(n).map(this._resolveModelId.bind(this)),t.next=13,this.httpClient.post("/group/:id/members/remove",{urlParams:{id:e},data:{members:n}});case 13:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"addMember",value:function(){var e=(0,T["default"])(I["default"].mark(function t(e,n){return I["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 6:if("string"==typeof n||n instanceof Object){t.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(n));case 8:return t.abrupt("return",this.addMembers(e,[n]));case 9:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeMember",value:function(){var e=(0,T["default"])(I["default"].mark(function t(e,n){return I["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n||n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 6:if("string"==typeof n||n instanceof Object){t.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(n));case 8:return t.abrupt("return",this.removeMembers(e,[n]));case 9:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"reactToBangEvent",value:function(e){switch(e.event){case"added":this.__addedToGroup(e);break;case"removed":this.__removedFromGroup(e)}}},{key:"__addedToGroup",value:function(e){var t=e.caller_entity,n=e.subject_entity,r=e.target_entity;if(t&&t.token&&r&&r.token&&n&&n.token){var a=this.host.injectModel(t),o=this.host.injectModel(n),i=this.host.injectModel((0,w["default"])({organizationId:e.organization_id},r)),s=B["default"].map([a,o],"id");i.memberIds=B["default"].contain.apply(B["default"],[i.memberIds||[]].concat((0,k["default"])(s)))}}},{key:"__removedFromGroup",value:function(e){var t=e.subject_entity,n=e.target_entity;if(n&&n.token&&t&&t.token){var r=this.host.models.Group.get(n.token),a=t.token;r&&r.memberIds&&(r.memberIds=B["default"].pull(r.memberIds,a))}}}]),t}(N["default"]),a(f.prototype,"find",[s],(0,m["default"])(f.prototype,"find"),f.prototype),a(f.prototype,"findAll",[u],(0,m["default"])(f.prototype,"findAll"),f.prototype),a(f.prototype,"findAllWithSpecificMembers",[c],(0,m["default"])(f.prototype,"findAllWithSpecificMembers"),f.prototype),f);t["default"]=F,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n,r,a){var o={};return Object.keys(r).forEach(function(e){o[e]=r[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var a=(0,p["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,y["default"])(u))?u.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var a=(0,p["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var o="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,d["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+o);return a.length>=r&&(s+="\n  "+o+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+o+s+"\n"+o+"}":"{\n  "+o+s+"\n"+o+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=i(e[0],t);return e.every(function(e){return i(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,y["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var s,u,c,f=n(7),d=r(f),l=n(8),p=r(l),h=n(9),y=r(h),g=n(45),v=r(g),m=n(41),b=r(m),w=n(12),E=r(w),x=n(13),_=r(x),k=n(23),j=r(k),I=n(14),O=r(I),T=n(15),A=r(T),M=n(24),G=r(M),V=n(25),z=r(V),C=n(47),S=r(C),P=n(32),$=n(21),q=r($),R=n(31),N=r(R),U=n(68),D=r(U),L=n(69),B=r(L),K=n(65),F=r(K),Z=(s=(0,P.decorator)({memoize:!0}),u=(0,P.decorator)(),c=function(e){function t(){return(0,O["default"])(this,t),(0,G["default"])(this,(0,j["default"])(t).apply(this,arguments))}return(0,z["default"])(t,e),(0,A["default"])(t,[{key:"mounted",value:function(){this.host.models.Conversation.on("afterInject",this._onConversationChange),this.host.models.Conversation.on("afterEject",this._onConversationChange)}},{key:"dispose",value:function(){this.host.models.Conversation.off("afterInject",this._onConversationChange),this.host.models.Conversation.off("afterEject",this._onConversationChange),P.decorator.clear(this.findAll)}},{key:"create",value:function(){var e=(0,_["default"])(E["default"].mark(function t(){var e=this,n=arguments.length<=0||void 0===arguments[0]?{name:void 0,ttl:void 0,dor:void 0,allowPublicGroups:void 0,pinLock:void 0,settingsRestricted:void 0,autologoutTime:void 0,lifecycleCallback:void 0,groupLifespan:void 0,welcomeEmailSettings:void 0}:arguments[0];return E["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.host.requireUser(),t.abrupt("return",this.httpClient.post("/organization",{data:n}).then(function(t){var r=t.getHeader("TT-X-Organization-Key"),a=e.host.models.Organization.inject({id:r,name:n.name});return a}));case 2:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,_["default"])(E["default"].mark(function t(){var e,n=this,r=arguments.length<=0||void 0===arguments[0]?{id:void 0,name:void 0,ttl:void 0,dor:void 0,allowPublicGroups:void 0,pinLock:void 0,settingsRestricted:void 0,autologoutTime:void 0,lifecycleCallback:void 0,groupLifespan:void 0,welcomeEmailSettings:void 0,welcomeEmailLogo:void 0,autoSendWelcomeEmail:void 0}:arguments[0];return E["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.host.requireUser(),e=D["default"].underscoreObject({name:r.name,ttl:r.ttl,dor:r.dor,allowPublicGroups:r.allowPublicGroups,pinLock:r.pinLock,settingsRestricted:r.settingsRestricted,autologoutTime:r.autologoutTime,lifecycleCallback:r.lifecycleCallback,groupLifespan:r.groupLifespan,welcomeEmailSettings:r.welcomeEmailSettings,welcomeEmailLogo:r.welcomeEmailLogo,autoSendWelcomeEmail:r.autoSendWelcomeEmail}),t.abrupt("return",this.httpClient.post("/organization/:id",{urlParams:{id:r.id},data:e}).then(function(t){var a=n.host.models.Organization.inject((0,b["default"])({id:r.id},e));return a}));case 3:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findAll",value:function(){var e=(0,_["default"])(E["default"].mark(function t(){var e,n=this,r=arguments.length<=0||void 0===arguments[0]?{onlyApproved:!1}:arguments[0];return E["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.host.requireUser(),t.next=3,this.host.api.organizations.findAllOfUser(this.host.getCurrentUser().id);case 3:return e=t.sent,e=e.map(function(e){return n.host.models.Organization.inject(e)}),r.onlyApproved&&(e=N["default"].filter(e,{pending:!1})),e=N["default"].sortBy(e,function(e){return e.name.toLowerCase()}),e.forEach(function(e){return n.__reloadConversations(e)}),t.abrupt("return",e);case 9:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,_["default"])(E["default"].mark(function t(e){var n,r,a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return E["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 4:if(a=N["default"].defaults(a,{ignoreNotFound:!1,bypassCache:!1}),this.host.requireUser(),n=void 0,a.bypassCache){t.next=11;break}if(n=this.host.models.Organization.get(e),!n){t.next=11;break}return t.abrupt("return",n);case 11:return t.next=13,this.host.api.organizations.find(this.host.getCurrentUser().id,e);case 13:if(r=t.sent,!r){t.next=19;break}n=this.host.models.Organization.inject(r),this.__reloadConversations(n),t.next=21;break;case 19:if(a.ignoreNotFound){t.next=21;break}throw new q["default"].NotFoundError(this.host.models.Organization.name,e);case 21:return t.abrupt("return",n);case 22:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));return this.host.models.Organization.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+o(e));return this.host.models.Organization.getMulti(e)}},{key:"_onConversationChange",value:function(e,t){this.__reloadConversations(t.organization)}},{key:"__reloadConversations",value:function(e){if(e){var t=N["default"].pick(e,["conversations","unreadCount"]),n=(0,N["default"])(this.host.models.Conversation.getAll()).filter({organizationId:e.id}).orderBy(["lastEventMessageSortNumber","_origIndex"],["desc","asc"]).value(),r=N["default"].sumBy(n,function(e){return e.unreadCount}),a={conversations:n,unreadCount:r},o=!1;N["default"].each(t,function(t,n){(0,B["default"])(t,a[n])||(e[n]=a[n],o=!0)}),o&&this.host.models.Organization.inject(e)}}}]),t}(S["default"]),a(c.prototype,"findAll",[s],(0,v["default"])(c.prototype,"findAll"),c.prototype),a(c.prototype,"find",[u],(0,v["default"])(c.prototype,"find"),c.prototype),a(c.prototype,"_onConversationChange",[F["default"]],(0,v["default"])(c.prototype,"_onConversationChange"),c.prototype),c);t["default"]=Z,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return s["default"].isArray(e)?e.map(function(e){return a(e,t)}):s["default"].isObject(e)?s["default"].transform(e,function(e,n,r){e[t(r)]=a(n,t)},{}):e}Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),i=(r(o),n(31)),s=r(i),u={camelizeKey:s["default"].memoize(s["default"].camelCase),underscoreKey:s["default"].memoize(s["default"].snakeCase),camelizeObject:function(e){return a(e,u.camelizeKey)},underscoreObject:function(e){return a(e,u.underscoreKey)}};t["default"]=u,e.exports=t["default"]},function(e,t){e.exports=require("shallowequal")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n,r,a){var o={};return Object.keys(r).forEach(function(e){o[e]=r[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var a=(0,h["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,g["default"])(u))?u.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,g["default"])(e);if(!Array.isArray(e)){var a=(0,h["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var o="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,l["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+o);return a.length>=r&&(s+="\n  "+o+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+o+s+"\n"+o+"}":"{\n  "+o+s+"\n"+o+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=i(e[0],t);return e.every(function(e){return i(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,g["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var s,u,c,f,d=n(7),l=r(d),p=n(8),h=r(p),y=n(9),g=r(y),v=n(45),m=r(v),b=n(49),w=r(b),E=n(12),x=r(E),_=n(13),k=r(_),j=n(23),I=r(j),O=n(14),T=r(O),A=n(15),M=r(A),G=n(24),V=r(G),z=n(25),C=r(z),S=n(47),P=r(S),$=n(32),q=n(31),R=r(q),N=n(46),U=r(N),D=n(56),L=n(69),B=r(L),K=n(65),F=r(K),Z=new U["default"].MD5,H=(s=(0,$.decorator)(),u=(0,$.decorator)(),c=(0,$.decorator)(),f=function(e){function t(){var e;(0,T["default"])(this,t);for(var n=arguments.length,r=Array(n),a=0;n>a;a++)r[a]=arguments[a];var o=(0,V["default"])(this,(e=(0,I["default"])(t)).call.apply(e,[this].concat(r)));return o._fetched=!1,o._throtelled__flushConversationsToReload=o.config.conversationReloadDelay?o._throtelled__flushConversationsToReload=R["default"].throttle(o.__flushConversationsToReload,o.config.conversationReloadDelay,{leading:!1}):o.__flushConversationsToReload,o}return(0,C["default"])(t,e),(0,M["default"])(t,[{key:"mounted",value:function(){this.host.on("message:sending",this._onMessageSending),this.host.on("message:sent",this._onMessageSent),this.host.models.Message.on("afterInject",this._onMessageChange),this.host.models.Message.on("afterEject",this._onMessageChange),this.host.models.Group.on("afterEject",this._onGroupDelete),this.__queuedConversationsToReload=[]}},{key:"dispose",value:function(){this._fetched=!1,this.host.removeListener("message:sending",this._onMessageSending),this.host.removeListener("message:sent",this._onMessageSent),this.host.models.Message.off("afterInject",this._onMessageChange),this.host.models.Message.off("afterEject",this._onMessageChange),this.host.models.Group.off("afterEject",this._onGroupDelete),this.__queuedConversationsToReload=null,this._throtelled__flushConversationsToReload.cancel&&this._throtelled__flushConversationsToReload.cancel()}},{key:"findAll",value:function(){var e=(0,k["default"])(x["default"].mark(function t(){var e,n,r=this;return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._fetched){t.next=2;break}return t.abrupt("return",this.getAll());case 2:return t.next=4,this.host.api.roster.findAll();case 4:return e=t.sent,n=e.map(function(e){var t=r.host.injectModel(e);delete t.$temporary;var n=e.organization_key;return{counterParty:t,organizationId:n}}).map(function(e){var t=e.counterParty,n=e.organizationId,a=r.ensureConversation(t.$entityType,t.id,n);return a._counterPartyAddedOnServer=!0,a}),this._fetched=!0,t.abrupt("return",n);case 8:case"end":return t.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"refetch",value:function(){var e=(0,k["default"])(x["default"].mark(function t(){return x["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._fetched=!1,e.abrupt("return",this.findAll());case 2:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=(0,k["default"])(x["default"].mark(function t(e,n,r){var a,s,u;return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:return a={},r&&(a["TT-X-Organization-Key"]=r),s=this.host.typeNSByModelName(e),u=this.ensureConversation(e,n,r),t.prev=16,t.next=19,this.host.api.roster.add(e,n,r);case 19:t.next=24;break;case 21:t.prev=21,t.t0=t["catch"](16),this.logger.warn("can't add "+n+" "+s);case 24:u._counterPartyAddedOnServer=!0;case 25:case"end":return t.stop()}},t,this,[[16,21]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,k["default"])(x["default"].mark(function t(e,n,r){var a,s;return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e){t.next=8;break}throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 8:if("string"==typeof n){t.next=10;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:return a={},r&&(a["TT-X-Organization-Key"]=r),s=this.host.typeNSByModelName(e),t.prev=15,t.next=18,this.host.api.roster.remove(e,n,r);case 18:this.ejectConversation(e,n,r),t.next=24;break;case 21:t.prev=21,t.t0=t["catch"](15),this.logger.warn("can't remove "+n+" "+s);case 24:case"end":return t.stop()}},t,this,[[15,21]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"ensureConversation",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));var r=this.getConversationKey(e,t,n),a=this.get(e,t,n);return a?(this.__ensureEntities(a),a):(a=this.host.models.Conversation.createInstance({id:r,counterPartyType:e,counterPartyId:t,organizationId:n,_origIndex:this.host.models.Conversation.getAll().length}),this.__ensureEntities(a),this.host.models.Conversation.inject(a),this.__notifyOrganizationChange(a.organizationId),a)}},{key:"ejectConversation",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));var r=this.get(e,t,n);return r&&(this.host.models.Conversation.eject(r),this.__notifyOrganizationChange(r.organizationId)),r}},{key:"reactToIncomingMessageEvent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(e));var t=this.host.getCurrentUser().id,n=this.host.models.Message.parseAttrs(e);n.direction=n.senderId==t?D.MessageDirection.OUTGOING:D.MessageDirection.INCOMING,n.groupId?(n.counterPartyType="group",n.counterPartyId=n.groupId):n.recipientId&&(n.counterPartyType="user",n.counterPartyId=n.senderId==t?n.recipientId:n.senderId),n.direction==D.MessageDirection.OUTGOING?n.senderStatus=D.MessageSenderStatus.SENT:n.senderStatus=D.MessageSenderStatus.NA;var r=this.host.conversations.ensureConversation(n.counterPartyType,n.counterPartyId,n.senderOrganizationId);n.conversationId=r.id;var a=this.host.models.Message.createInstance(n);this.__ensureMessageEntities(a),this.host.models.Message.inject(a),this.emit("message",a),this.__addConversationCounterPartyToServerRosterIfShould(r),this.__queueReload(r),r.emit("message",a),this.__notifyOrganizationChange(r.organizationId),a.senderId!=t&&a.recipientStatus!=D.MessageRecipientStatus.READ&&a.recipientStatus!=D.MessageRecipientStatus.DELIVERED&&this.host.messages.markAsReceived(a)}},{key:"reactToFriendsEvent",value:function(e){var t=e.friend,n=t.action,r=t.organization_id,a=(0,w["default"])(t,["action","organization_id"]),o=r,i=this.host.modelByTypeNS(a.xmlns);if(!i)return void this.logger.error("Class "+a.xmlns+" not found");switch(n){case"add":
"group"==i.name&&(a.organizationId=o);var s=this.host.injectModel(a);this.__addedByCounterParty(s,o);break;case"del":this.__removedByCounterParty(i.name,a.token,o);break;default:this.logger.error("friends action not implemented",n,e)}}},{key:"_onMessageSending",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(e));var t=this.__ensureConversationFromMessage(e);this.__addConversationCounterPartyToServerRosterIfShould(t),this.__reloadConversation(t),this.__notifyOrganizationChange(t.organizationId)}},{key:"_onMessageSent",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(e));var t=this.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId);this.__reloadConversation(t),t.emit("message",e)}},{key:"_onMessageChange",value:function(e,t){t.conversation&&this.__queueReload(t.conversation)}},{key:"_onGroupDelete",value:function(e,t){this.ejectConversation("group",t.id,t.organizationId)}},{key:"__queueReload",value:function(e){R["default"].contain(this.__queuedConversationsToReload,e),this._throtelled__flushConversationsToReload()}},{key:"__flushConversationsToReload",value:function(){var e=this;this.__queuedConversationsToReload.forEach(function(t){return e.__reloadConversation(t)}),this.__queuedConversationsToReload.length=0}},{key:"__reloadConversation",value:function(e){var t=R["default"].pick(e,["messages","lastMessage","unreadMessages","unreadCount","lastEventMessageSortNumber"]),n={},r=(0,R["default"])(this.host.models.Message.getAll()).filter({conversationId:e.id}).orderBy(["sortNumber"],["asc"]).value();n.messages=r,n.lastMessage=R["default"].last(r),n.unreadMessages=r.filter(function(e){return e.direction===D.MessageDirection.INCOMING&&(e.recipientStatus===D.MessageRecipientStatus.NEW||e.recipientStatus===D.MessageRecipientStatus.DELIVERED)}),n.unreadCount=n.unreadMessages.length,n.lastEventMessageSortNumber=n.lastMessage&&n.lastMessage.sortNumber||0;var a=!1;R["default"].each(t,function(t,r){(0,B["default"])(t,n[r])||(e[r]=n[r],a=!0)}),a&&(this.host.models.Conversation.inject(e),e.emit("change"),this.emit("change",e))}},{key:"__notifyOrganizationChange",value:function(e){var t=this.host.models.Organization.get(e);t&&t.emit("change")}},{key:"__ensureConversationFromMessage",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(e));var t=this.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId);return t}},{key:"__addConversationCounterPartyToServerRosterIfShould",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(e));e&&(e._counterPartyAddedOnServer||this.add(e.counterPartyType,e.counterPartyId,e.organizationId))}},{key:"getMessageConversationKey",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(e));if(e.groupId)return this.conversationHashForGroupId(e.groupId);var t=e.senderId==this.host.getCurrentUser().id?e.recipientId:e.senderId;return this.conversationHashForUserMessage(t,e.senderOrganizationId,e.recipientOrganizationId)}},{key:"getConversationKey",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?n:arguments[3];if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));if("string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));if("string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));switch(e){case"user":return this.conversationHashForUserMessage(t,n,r);case"group":return this.conversationHashForGroupId(t);default:throw new Error("type "+e+" not supported in conversation")}}},{key:"conversationHashForUserMessage",value:function(e,t,n){var r=[e,t,n].join(":");return Z.b64(r)}},{key:"conversationHashForGroupId",value:function(e){return Z.b64(e)}},{key:"findConversationWithUser",value:function(){var e=(0,k["default"])(x["default"].mark(function t(e,n){return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return t.abrupt("return",this.get(this.host.models.User.name,e,n));case 9:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findConversationWithGroup",value:function(){var e=(0,k["default"])(x["default"].mark(function t(e,n){return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e){t.next=6;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return t.abrupt("return",this.get(this.host.models.Group.name,e,n));case 9:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findAllGroupConversationsWithMembers",value:function(){var e=(0,k["default"])(x["default"].mark(function t(e,n){var r,a=this;return x["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||Array.isArray(e)&&e.every(function(e){return e instanceof Object})){t.next=6;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return e=R["default"].arrayWrap(e).map(this._resolveModelId.bind(this)),t.next=11,this.host.groups.findAllWithSpecificMembers(e,n);case 11:return r=t.sent,t.abrupt("return",r.map(function(e){return a.get(a.host.models.Group.name,e.id,n)}));case 13:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"get",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));var r=this.getConversationKey(e,t,n),a=this.host.models.Conversation.get(r);return a||null}},{key:"getAll",value:function(){return this.host.models.Conversation.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));return this.host.models.Conversation.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+o(e));return this.host.models.Conversation.getMulti(e)}},{key:"__addedByCounterParty",value:function(e,t){if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));this.ensureConversation(e.$entityType,e.id,t)}},{key:"__removedByCounterParty",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));this.ejectConversation(e,t,n)}},{key:"__ensureEntities",value:function(e){var t,n,r=this;this.host.models.Organization.ensureEntityOrCreateTemporaryAndFind({id:e.organizationId,name:"Loading..."},{finder:(t=this.host.organizations).find.bind(t),onMissing:function(){r.logger.info("org "+e.organizationId+" not found, created temporary org"),e.$loadingOrganization=!0},onLoad:function(t){r.logger.info("org "+e.organizationId+" loaded"),e.$loadingOrganization=!1}});var a={id:e.counterPartyId},o=void 0;switch(e.counterPartyType){case"user":a.displayName="Loading...",o=(n=this.host.users).find.bind(n);break;case"group":a.displayName="Loading group...",a.organizationId=e.organizationId,o=(n=this.host.groups).find.bind(n);break;default:throw new Error("unsupported counterPartyType",e.counterPartyType)}this.host.store.store.models[e.counterPartyType].ensureEntityOrCreateTemporaryAndFind(a,{finder:o,onMissing:function(){r.logger.info("entry "+e.counterPartyId+" not found, created temporary on org "+e.organizationId),e.$loadingCounterParty=!0},onLoad:function(t){e.$loadingCounterParty=!1,r.__fireChange("update",e)}}),this.__fireChange("add",e)}},{key:"__ensureMessageEntities",value:function(e){var t,n=this,r=this.host.getCurrentUser().id,a=e.senderId==r?e.recipientId:e.senderId;a&&this.host.models.User.ensureEntityOrCreateTemporaryAndFind({id:a,displayName:"Loading..."},{finder:(t=this.host.users).find.bind(t),onlyPlaceholder:!!e.groupId,onMissing:function(){n.logger.info("message otherUser "+a+" not found, created temporary"),e.$loadingOtherUser=!0},onLoad:function(t){e.$loadingOtherUser=!1,n.__fireChange("update",e.conversation)}})}},{key:"__fireChange",value:function(e,t){}}]),t}(P["default"]),a(f.prototype,"findAll",[s],(0,m["default"])(f.prototype,"findAll"),f.prototype),a(f.prototype,"add",[u],(0,m["default"])(f.prototype,"add"),f.prototype),a(f.prototype,"remove",[c],(0,m["default"])(f.prototype,"remove"),f.prototype),a(f.prototype,"_onMessageSending",[F["default"]],(0,m["default"])(f.prototype,"_onMessageSending"),f.prototype),a(f.prototype,"_onMessageSent",[F["default"]],(0,m["default"])(f.prototype,"_onMessageSent"),f.prototype),a(f.prototype,"_onMessageChange",[F["default"]],(0,m["default"])(f.prototype,"_onMessageChange"),f.prototype),a(f.prototype,"_onGroupDelete",[F["default"]],(0,m["default"])(f.prototype,"_onGroupDelete"),f.prototype),a(f.prototype,"__flushConversationsToReload",[F["default"]],(0,m["default"])(f.prototype,"__flushConversationsToReload"),f.prototype),f);t["default"]=H,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a=n(23),o=r(a),i=n(14),s=r(i),u=n(15),c=r(u),f=n(24),d=r(f),l=n(25),p=r(l),h=n(47),y=r(h),g=n(31),v=(r(g),n(56)),m=function(e){function t(e,n){(0,s["default"])(this,t);var r=(0,d["default"])(this,(0,o["default"])(t).call(this,e,n));return r._data={},r.host.models.User.on("beforeInject",function(e,t){return r._onUserInjected(t)}),r}return(0,p["default"])(t,e),(0,c["default"])(t,[{key:"reactToPresenceEvent",value:function(e){this.set(e.from,v.PresenceStatus.resolve(e.type))}},{key:"set",value:function(e,t){var n=this.host.models.User.get(e);n&&(n.presence=t),this._data[e]=t}},{key:"get",value:function(e){return e==this.host.getCurrentUser().id?v.PresenceStatus.AVAILABLE:this._data[e]}},{key:"_onUserInjected",value:function(e){e.id in this._data&&(e.presence=this._data[e.id])}}]),t}(y["default"]);t["default"]=m,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n,r,a){var o={};return Object.keys(r).forEach(function(e){o[e]=r[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var a=(0,S["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(s+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+s+"\n"+i+"}":"{\n  "+i+s+"\n"+i+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,y["default"])(u))?u.v:void 0}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,y["default"])(e);if(!Array.isArray(e)){var a=(0,S["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var o="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,p["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+o);return a.length>=r&&(s+="\n  "+o+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+o+s+"\n"+o+"}":"{\n  "+o+s+"\n"+o+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=i(e[0],t);return e.every(function(e){return i(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,y["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var s,u,c,f,d,l=n(7),p=r(l),h=n(9),y=r(h),g=n(45),v=r(g),m=n(73),b=r(m),w=n(53),E=r(w),x=n(54),_=r(x),k=n(74),j=r(k),I=n(17),O=r(I),T=n(11),A=r(T),M=n(10),G=r(M),V=n(12),z=r(V),C=n(8),S=r(C),P=n(13),$=r(P),q=n(23),R=r(q),N=n(14),U=r(N),D=n(15),L=r(D),B=n(24),K=r(B),F=n(25),Z=r(F),H=n(47),W=r(H),Y=n(31),X=r(Y),Q=n(21),J=r(Q),ee=n(32),te=(s=(0,ee.decorator)(),u=(0,ee.decorator)(),d=f=function(e){function t(){return(0,U["default"])(this,t),(0,K["default"])(this,(0,R["default"])(t).apply(this,arguments))}return(0,Z["default"])(t,e),(0,L["default"])(t,[{key:"fullUpdate",value:function(){var e=(0,$["default"])(z["default"].mark(function t(e,n,r){return z["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if(n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 8:if(n instanceof Object){t.next=10;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:if(r){t.next=14;break}throw new J["default"].ValidationError("organizationId","required");case 14:if(!(this.host.config.maxMetadataKeyCount>0&&(0,S["default"])(n).length>this.host.config.maxMetadataKeyCount)){t.next=16;break}throw new J["default"].ValidationError("entireData","invalid","Total number of metadata keys is "+(0,S["default"])(n)+" and should not exceed "+this.host.config.maxMetadataKeyCount);case 16:return this.host.requireUser(),e=this._resolveModelId(e),t.prev=18,t.next=21,this.host.api.metadata.update(e,n,r);case 21:return this.__injectMetadata(e,r,n),t.abrupt("return",n);case 25:if(t.prev=25,t.t0=t["catch"](18),!t.t0.response||404!=t.t0.response.status){t.next=31;break}throw new J["default"].NotFoundError("metadata",e);case 31:throw t.t0;case 32:case"end":return t.stop()}},t,this,[[18,25]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,$["default"])(z["default"].mark(function t(e,n,r){var a,s;return z["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if(n instanceof Object){t.next=4;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));case 4:if("string"==typeof r){t.next=6;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));case 6:if("string"==typeof e||e instanceof Object){t.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 8:if(n instanceof Object){t.next=10;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(n));case 10:if("string"==typeof r){t.next=12;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(r));case 12:if(r){t.next=14;break}throw new J["default"].ValidationError("organizationId","required");case 14:return t.next=16,this.find(e,r);case 16:return a=t.sent,s=(0,G["default"])({},a,n),t.abrupt("return",this.fullUpdate(e,s,r));case 19:case"end":return t.stop()}},t,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,$["default"])(z["default"].mark(function t(e,n){var r;return z["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if("string"==typeof e||e instanceof Object){t.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:if(n){t.next=10;break}throw new J["default"].ValidationError("organizationId","required");case 10:return this.host.requireUser(),e=this._resolveModelId(e),t.prev=12,t.next=15,this.host.api.metadata.find(e,n);case 15:return r=t.sent,this.__injectMetadata(e,n,r),t.abrupt("return",r);case 20:if(t.prev=20,t.t0=t["catch"](12),!t.t0.response||404!=t.t0.response.status){t.next=26;break}throw new J["default"].NotFoundError("metadata",e);case 26:throw t.t0;case 27:case"end":return t.stop()}},t,this,[[12,20]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findMulti",value:function(){var e=(0,$["default"])(z["default"].mark(function t(e,n){var r,a,s,u,c=this;return z["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e||e instanceof Object})){t.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:if(n){t.next=10;break}throw new J["default"].ValidationError("organizationId","required");case 10:return this.host.requireUser(),e=X["default"].uniq(X["default"].arrayWrap(e).map(this._resolveModelId.bind(this))),r=X["default"].chunk(e,20),a=r.map(function(e){return c.__findMultiPaged(e,n)}),t.next=16,A["default"].all(a);case 16:return s=t.sent,u=X["default"].assign.apply(X["default"],[{}].concat((0,O["default"])(s))),t.abrupt("return",u);case 19:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"__findMultiPaged",value:function(){var e=(0,$["default"])(z["default"].mark(function t(e,n){var r,a,s,u,c,f,d,l,p,h,y,g,v,m,w,x;return z["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){t.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+i(e));case 2:if("string"==typeof n){t.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));case 4:if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e})){t.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+o(e));case 6:if("string"==typeof n){t.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(n));case 8:return t.prev=8,t.next=11,this.host.api.metadata.findMulti(e,n);case 11:if(r=t.sent,d=(0,j["default"])(r),d&&("function"==typeof d[_["default"]]||Array.isArray(d))){t.next=15;break}throw new TypeError("Expected _Object$entries to be iterable, got "+o(d));case 15:if(d&&("function"==typeof d[_["default"]]||Array.isArray(d))){t.next=17;break}throw new TypeError("Expected _Object$entries to be iterable, got "+i(d));case 17:for(a=!0,s=!1,u=void 0,t.prev=20,c=(0,E["default"])(d);!(a=(f=c.next()).done);a=!0)l=(0,b["default"])(f.value,2),p=l[0],h=l[1],h&&this.__injectMetadata(p,n,h);t.next=28;break;case 24:t.prev=24,t.t0=t["catch"](20),s=!0,u=t.t0;case 28:t.prev=28,t.prev=29,!a&&c["return"]&&c["return"]();case 31:if(t.prev=31,!s){t.next=34;break}throw u;case 34:return t.finish(31);case 35:return t.finish(28);case 36:return t.abrupt("return",r);case 39:if(t.prev=39,t.t1=t["catch"](8),!t.t1.response||404!=t.t1.response.status){t.next=84;break}if(y={},e&&("function"==typeof e[_["default"]]||Array.isArray(e))){t.next=45;break}throw new TypeError("Expected ids to be iterable, got "+o(e));case 45:if(e&&("function"==typeof e[_["default"]]||Array.isArray(e))){t.next=47;break}throw new TypeError("Expected ids to be iterable, got "+i(e));case 47:g=!0,v=!1,m=void 0,t.prev=50,w=(0,E["default"])(e);case 52:if(g=(x=w.next()).done){t.next=67;break}return p=x.value,t.prev=54,t.next=57,this.find(p,n);case 57:y[p]=t.sent,t.next=64;break;case 60:if(t.prev=60,t.t2=t["catch"](54),t.t2.code==J["default"].NotFoundError.CODE){t.next=64;break}throw t.t2;case 64:g=!0,t.next=52;break;case 67:t.next=73;break;case 69:t.prev=69,t.t3=t["catch"](50),v=!0,m=t.t3;case 73:t.prev=73,t.prev=74,!g&&w["return"]&&w["return"]();case 76:if(t.prev=76,!v){t.next=79;break}throw m;case 79:return t.finish(76);case 80:return t.finish(73);case 81:return t.abrupt("return",y);case 84:throw t.t1;case 85:case"end":return t.stop()}},t,this,[[8,39],[20,24,28,36],[29,,31,35],[50,69,73,81],[54,60],[74,,76,80]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"__injectMetadata",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+o(n));var r=e+":"+t;this.host.models.Metadata.inject({id:r,data:n,entityId:e,organizationId:t})}}]),t}(W["default"]),f.METADTA_TYPES=["user","group"],c=d,a(c.prototype,"find",[s],(0,v["default"])(c.prototype,"find"),c.prototype),a(c.prototype,"findMulti",[u],(0,v["default"])(c.prototype,"findMulti"),c.prototype),c);t["default"]=te,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/helpers/slicedToArray")},function(e,t){e.exports=require("babel-runtime/core-js/object/entries")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n,r,a){var o={};return Object.keys(r).forEach(function(e){o[e]=r[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o,i,s=n(45),u=r(s),c=n(12),f=r(c),d=n(11),l=r(d),p=n(8),h=r(p),y=n(13),g=r(y),v=n(23),m=r(v),b=n(14),w=r(b),E=n(15),x=r(E),_=n(24),k=r(_),j=n(25),I=r(j),O=n(47),T=r(O),A=n(32),M=n(21),G=r(M),V=n(31),z=r(V),C=n(68),S=r(C),P={user:"account",distributionList:"distribution_list",group:"group",organization:"organization"},$=z["default"].values(P),q=(o=(0,A.decorator)(),i=function(e){function t(){return(0,w["default"])(this,t),(0,k["default"])(this,(0,m["default"])(t).apply(this,arguments))}return(0,I["default"])(t,e),(0,x["default"])(t,[{key:"query",value:function(){var e=(0,g["default"])(f["default"].mark(function t(e){var n,r,a,o,i,s=this,u=e.types,c=void 0===u?[]:u,d=e.query,p=void 0===d?{}:d,y=e.continuation,g=void 0===y?null:y,v=e.includeDisabled,m=void 0===v?!1:v,b=e.excludeTokens,w=void 0===b?[]:b,E=e.resultsFormat,x=void 0===E?"entities":E,_=e.organizationId,k=void 0===_?null:_,j=e.organizationIds,I=void 0===j?[]:j,O=e.sort,T=void 0===O?[]:O,A=e.includeMetadata,M=void 0===A?!1:A;return f["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=c.length){e.next=2;break}throw new G["default"].ValidationError("types","required","no types specified");case 2:if(c=c.map(function(e){return P[e]}),n=z["default"].difference(c,$),!(n.length>0)){e.next=6;break}throw new G["default"].ValidationError("types","invalid","invalid types: "+n.join(", "));case 6:if(k&&(I=[k]),0!=I.length){e.next=9;break}throw new G["default"].ValidationError("organizationIds","invalid","search must be done in a context of an organization");
case 9:return"ids"===x&&(x="tokens"),r={type:c,include_disabled:m,directory:I,results_format:x},g&&(r.continuation=g),T&&T.length&&(r.sort=T),w=z["default"].arrayWrap(w),p&&(0,h["default"])(p).length>0&&(r.bool={must:S["default"].underscoreObject(p)}),e.next=17,this.httpClient.post("/search",{data:r});case 17:if(a=e.sent,o=a.data.results,i=z["default"].eachWithObject(o,function(e,t){var n=e.type,r=e.entity,a=e.organization_id;if(0!=(0,h["default"])(r).length){"tigertext:entity:account"===n&&z["default"].replaceKey(r,"status","account_status");var o=s.host.injectModel(r,n);if(!w.length||!w.includes(o.id)){if(!o)return void s.logger.warn("no entity for ",e);var i=new s.host.models.SearchResult(o,a);t.push(i)}}},[]),!M){e.next=22;break}return e.delegateYield(f["default"].mark(function t(){var e,n,r;return f["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=z["default"].groupBy(i,"organizationId"),n=z["default"].keyBy(i,"entityId"),r=z["default"].transform(e,function(e,t,r){e.push(s.host.metadata.findMulti(z["default"].map(t,"entityId"),r).then(function(e){z["default"].each(e,function(e,t){return n[t].metadata=e})}))},[]),!(r.length>0)){t.next=6;break}return t.next=6,l["default"].all(r);case 6:case"end":return t.stop()}},t,s)})(),"t0",22);case 22:return e.abrupt("return",i);case 23:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(T["default"]),a(i.prototype,"query",[o],(0,u["default"])(i.prototype,"query"),i.prototype),i);t["default"]=q,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a=n(41),o=r(a),i=n(49),s=r(i),u=n(14),c=r(u),f=n(15),d=r(f),l=n(31),p=r(l),h=n(77),y=r(h),g=n(80),v=r(g),m=n(68),b=r(m),w=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=n.logger,a=(0,s["default"])(n,["logger"]);(0,c["default"])(this,e),this.host=t,this.options=a,this.logger=r,this.store=new y["default"]((0,o["default"])({},a,{host:t,logger:r}))}return(0,d["default"])(e,[{key:"defineModels",value:function(){var e=this,t={},n=(0,o["default"])({},this.options,{host:this.host,logger:this.logger});p["default"].each(v["default"],function(r,a){t[a]=r(e,n)}),this.models=t}},{key:"defineModel",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t.replaceKeys=t.replaceKeys||{},p["default"].defaults(t.replaceKeys,{token:"id"});var n=(this.store,this.store.defineModel(e,(0,o["default"])({},t,{beforeCreateInstance:function(e){!e[n.idAttribute]||"serverId"in e||(e.serverId=e[n.idAttribute]),t.beforeCreateInstance&&t.beforeCreateInstance(e)},beforeInject:function(e){var r=n.get(e[n.idAttribute]);!r||"serverId"in e||(e.serverId=r.serverId),t.beforeInject&&t.beforeInject(e)},afterInject:function(e){var n=Date.now();e.$lastModified==n&&(n+=1e-5),e.$lastModified=n,t.afterInject&&t.afterInject(e)},parseAttrs:function(e){var n=b["default"].camelizeObject(e);return p["default"].each(t.replaceKeys,function(e,t){p["default"].replaceKey(n,t,e)}),t.parseAttrs&&(n=t.parseAttrs(n,e)),n}})));return n}},{key:"clear",value:function(){this.store.clear()}}]),e}();t["default"]=w,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var o=(0,c["default"])(e);if(!o.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=o.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+a(e[n],t)+";"}).join("\n  "+i);return o.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var o=a(e[0],t);return e.every(function(e){return a(e,t)===o})?{v:o.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return a(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}function o(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,d["default"])(e);if(!Array.isArray(e)){var a=(0,c["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var i="  ".repeat(t-1),u=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,s["default"])(n))+": "+o(e[n],t)+";"}).join("\n  "+i);return a.length>=r&&(u+="\n  "+i+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+i+u+"\n"+i+"}":"{\n  "+i+u+"\n"+i+"}"}if(!(e.length>0))return"Array";var f=function(){if(t>n)return{v:"[...]"};var a=o(e[0],t);return e.every(function(e){return o(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return o(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof f?"undefined":(0,d["default"])(f))?f.v:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(7),s=r(i),u=n(8),c=r(u),f=n(9),d=r(f),l=n(12),p=r(l),h=n(13),y=r(h),g=n(41),v=r(g),m=n(78),b=r(m),w=n(10),E=r(w),x=n(14),_=r(x),k=n(15),j=r(k),I=n(31),O=r(I),T=n(33),A=r(T),M=n(79),G=r(M);A["default"].prototype.off=A["default"].prototype.removeListener;var V={idAttribute:"id",parseAttrs:O["default"].identity,relations:{belongsTo:{},hasMany:{}},defaultValues:null,computed:{}},z=function(){function e(t,n){var r=this,a=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];(0,_["default"])(this,e),this.options=O["default"].defaultsDeep({},a,V),this.idAttribute=this.options.idAttribute,this.name=n,this.store=t,this.entitiesById={},this.entitiesList=[],this.transientAttrsStore={},this.options.relations&&this.__initRelations(),this.__initTransientAttrs(),(0,E["default"])(this.options.computed,{$entityType:{enumerable:!0,get:function(){return n}},$entityClass:{enumerable:!1,get:function(){return r}}}),this.options.computed=O["default"].transform(this.options.computed,function(e,t,n){"function"==typeof t?e[n]={get:t,enumerable:!1}:e[n]=t},{}),this._computedKeys=(0,O["default"])(this.options.computed).keys().without("$entityType","$entityClass","$$transientAttrs").value(),this._writablePropertyKeys=(0,O["default"])(this.options.computed).toPairs().filter(function(e){return e[1].set}).map(O["default"].first).value(),this._relationKeys=(0,O["default"])(this.options.relations).values().map(O["default"].keys).flatten().value()}return(0,j["default"])(e,null,[{key:"create",value:function(e,t,n){return new this(e,t,n)}}]),(0,j["default"])(e,[{key:"__initRelations",value:function(){var e=this,t=O["default"].transform(this.options.relations.belongsTo,function(t,n,r){t[r]={get:function(){return e.store.get(n.type,this[n.foreignKey])},set:function(t){this[n.foreignKey]=e.store.resolveId(n.type,t)}}},{});(0,E["default"])(this.options.computed,t);var n=O["default"].transform(this.options.relations.hasMany,function(t,n,r){t[r]={get:function(){var t=this;if(this.$$transientAttrs.relations||(this.$$transientAttrs.relations={},this.$$transientAttrs.relationsCreated={}),this.$$transientAttrs.relations[r])return this.$$transientAttrs.relations[r];var a=e.store.getAll(n.type).filter(function(r){return r[n.foreignKey]==t[e.options.idAttribute]});return this.$$transientAttrs.relations[r]=a,this.$$transientAttrs.relationsCreated[r]=!0,a},set:function(e){}}},{});(0,E["default"])(this.options.computed,n)}},{key:"__initTransientAttrs",value:function(){var e=this,t=this,n={$$transientAttrs:{enumerable:!1,get:function(){var e=this[t.options.idAttribute];return t.transientAttrsStore[e]||(t.transientAttrsStore[e]={})}}},r={};this.options.transientAttrs&&this.options.transientAttrs.forEach(function(t){e.options.defaultValues&&t in e.options.defaultValues&&(r[t]=(0,G["default"])(e.options.defaultValues[t]),delete e.options.defaultValues[t]),n[t]={get:function(){return t in this.$$transientAttrs?this.$$transientAttrs[t]:t in r?this.$$transientAttrs[t]=r[t]:void 0},set:function(e){this.$$transientAttrs[t]=e}}}),(0,E["default"])(this.options.computed,n)}},{key:"createInstance",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=this;t&&(e=this.parseAttrs(e)),this.options.defaultValues&&O["default"].defaults(e,(0,G["default"])(this.options.defaultValues));var r={};return this._writablePropertyKeys.forEach(function(t){t in e&&(r[t]=e[t],delete e[t])}),(0,b["default"])(e,this.options.computed),(0,E["default"])(e,r),this.options.instanceEvents&&(0,E["default"])(e,A["default"].prototype),(0,E["default"])(e,{toPlainObject:function(e){var t=this,r={};n._computedKeys.forEach(function(e){return r[e]=t[e]});var a=(0,E["default"])({},this,r);return delete a.toPlainObject,delete a.setMaxListeners,delete a.emit,delete a.addListener,delete a.on,delete a.once,delete a.removeListener,delete a.removeAllListeners,delete a.listeners,delete a.listenerCount,delete a.off,delete a.toPlainObject,delete a._events,delete a._maxListeners,a}}),this.options.beforeCreateInstance&&this.options.beforeCreateInstance(e),e}},{key:"inject",value:function(e){var t=void 0,n=!0,r=this.is(e);if(r){if(t=e,this.entitiesById[this.resolveId(t)])return this.options.beforeInject&&this.options.beforeInject(t),this.emit("beforeInject",this,t),this.options.afterInject&&this.options.afterInject(t),this.emit("afterInject",this,t),t;n=!1}n&&(e=this.parseAttrs(e));var a=this.resolveId(e);if(!this.isValidId(a))throw new Error("'"+this.options.idAttribute+"' is required");return(t=this.entitiesById[a])?(this.options.beforeInject&&this.options.beforeInject(e),this.emit("beforeInject",this,e),(0,E["default"])(t,e)):(t=r?e:this.createInstance(e,!1),this.options.beforeInject&&this.options.beforeInject(e),this.emit("beforeInject",this,e),this.entitiesById[a]=t,this.entitiesList.push(t)),this.__addToHasManyRelationships(t),this.options.afterInject&&this.options.afterInject(t),this.emit("afterInject",this,t),t}},{key:"eject",value:function(e){e=this.resolveId(e);var t=this.entitiesById[e];t&&(this.__removeFromHasManyRelationships(t),delete this.entitiesById[e],O["default"].pull(this.entitiesList,t),e in this.transientAttrsStore&&delete this.transientAttrsStore[e],this.emit("afterEject",this,t))}},{key:"__addToHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"add")}},{key:"__removeFromHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"remove")}},{key:"__updateRelationsIfNeeded",value:function(e,t){var n=this,r=this.store.getParentRelationshipsOfModel(this.name);r&&r.forEach(function(r){var a=n.store.get(r.parent,e[r.foreignKey]);a&&a.$$transientAttrs.relationsCreated&&a.$$transientAttrs.relationsCreated[r.relationKey]&&("add"==t?a[r.relationKey].includes(e)||a[r.relationKey].push(e):"remove"==t&&O["default"].pull(a[r.relationKey],e))})}},{key:"ejectAll",value:function(){var e=this;O["default"].eachRight(this.entitiesList,function(t){return e.eject(t)})}},{key:"parseAttrs",value:function(e){var t=this,n=O["default"].pickBy(e,function(e){return t.store.isEntity(e)||t.store.isEntityArray(e)}),r=O["default"].omit(e,O["default"].keys(n)),a=this.options.parseAttrs((0,G["default"])(r)),o=(0,v["default"])({},a,n);return o}},{key:"get",value:function(e){return this.entitiesById[e]}},{key:"getAll",value:function(){return this.entitiesList}},{key:"getMulti",value:function(e){return e.map(this.get.bind(this))}},{key:"resolveId",value:function(e){return this.isValidId(e)?e:e[this.options.idAttribute]}},{key:"isValidId",value:function(e){return"string"==typeof e||"number"==typeof e}},{key:"is",value:function(e){return e&&e.$entityClass==this}},{key:"find",value:function(){var e=(0,y["default"])(p["default"].mark(function t(e){return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+o(e));case 2:if("string"==typeof e){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+a(e));case 4:throw new"not implemented find";case 5:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=(0,y["default"])(p["default"].mark(function t(e){return p["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e||e instanceof Object){t.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+o(e));case 2:if("string"==typeof e||e instanceof Object){t.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+a(e));case 4:throw e=this.resolveId(e),new"not implemented refresh";case 6:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();(0,E["default"])(z.prototype,A["default"].prototype);var C=function(){function e(){var t=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];(0,_["default"])(this,e),this.options=n,this.models={},this.__relationsOfHasManyByContainedItem={},["inject","get","getAll","filter","resolveId","is","find","refresh"].forEach(function(e){t[e]=function(n){for(var r,a=arguments.length,o=Array(a>1?a-1:0),i=1;a>i;i++)o[i-1]=arguments[i];return(r=t.models[n])[e].apply(r,o)}})}return(0,j["default"])(e,[{key:"defineModel",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(this.models[e])throw new Error(e+" already defined");n=(0,v["default"])({},this.options,n),this.models[e]=z.create(this,e,n);var r=this.models[e].options.relations.hasMany;return O["default"].isEmpty(r)||O["default"].each(r,function(n,r){t.__relationsOfHasManyByContainedItem[n.type]||(t.__relationsOfHasManyByContainedItem[n.type]=[]),t.__relationsOfHasManyByContainedItem[n.type].push((0,v["default"])({},n,{relationKey:r,parent:e}))}),this.models[e]}},{key:"getParentRelationshipsOfModel",value:function(e){return this.__relationsOfHasManyByContainedItem[e]}},{key:"isEntity",value:function(e){return e&&e.$entityClass&&e.$entityClass.constructor===z}},{key:"isEntityArray",value:function(e){return e&&Array.isArray(e)&&e.some(this.isEntity)}},{key:"clear",value:function(){(0,O["default"])(this.models).values().forEach(function(e){return e.ejectAll()})}}]),e}();t["default"]=C,e.exports=t["default"]},function(e,t){e.exports=require("babel-runtime/core-js/object/define-properties")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(7),o=r(a),i=function(e){return JSON.parse((0,o["default"])(e))};t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={User:n(81),Group:n(83),Organization:n(84),Message:n(85),MessageStatusPerRecipient:n(86),Event:n(87),Conversation:n(88),SearchResult:n(89),Metadata:n(90)};t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){var n=e.defineModel("user",{transientAttrs:["presence"],replaceKeys:{avatar:"avatarUrl"},defaultValues:{presence:c["default"].UNKNOWN},computed:{metadataByOrganizationId:{enumerable:!0,get:function(){return(0,o["default"])(e.store.getAll("metadata")).filter({entityId:this.id}).keyBy("organizationId").mapValues("data").value()}}},parseAttrs:function(e){return e.presence&&(e.presence=c["default"].resolve(e.presence)||c["default"].UNKNOWN),e}});return(0,s["default"])(e,n,{before:function(e,t,n){},after:function(e,t){}}),n};var a=n(31),o=r(a),i=n(82),s=r(i),u=n(62),c=r(u);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(){}function o(e,t,n){var r=n.before,o=n.after;if(null==arguments[2]||null!=arguments[2].before&&"function"!=typeof arguments[2].before||null!=arguments[2].after&&"function"!=typeof arguments[2].after)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ before: ?Function;\n  after: ?Function;\n}\n\nGot:\n"+s(arguments[2]));if(null==arguments[2]||null!=arguments[2].before&&"function"!=typeof arguments[2].before||null!=arguments[2].after&&"function"!=typeof arguments[2].after)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{ before: ?Function;\n  after: ?Function;\n}\n\nGot:\n"+i(arguments[2]));e.ensureEntityOrCreateTemporaryAndFind||(e.ensureEntityOrCreateTemporaryAndFind=function(t,n){function r(){var n=this;if(e.host.config.enableEnsureEntityFindMissing&&!w[E(c)]){var r=function(){var r=(0,v["default"])(y["default"].mark(function i(){return y["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(c.$temporary){n.next=3;break}return e.logger.info("entity "+t+":"+u+" was already updated elsewhere"),n.abrupt("return");case 3:return n.next=5,a();case 5:delete w[E(c)];case 6:case"end":return n.stop()}},i,n)})),o=n;return function(){return r.apply(o,arguments)}}(),a=function(){var e=(0,v["default"])(y["default"].mark(function r(){return y["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.finder(u,{bypassCache:!0});case 3:delete c.$temporary,s.after(c,o),o.onLoad(c),e.next=13;break;case 8:e.prev=8,e.t0=e["catch"](0),e.next=12;break;case 12:o.onLoad(null);case 13:case"end":return e.stop()}},r,n,[[0,8]])})),t=n;return function(){return e.apply(t,arguments)}}();e.host.config.temporaryEntityDelayBeforeRefreshing?w[E(c)]=setTimeout(r,e.host.config.temporaryEntityDelayBeforeRefreshing):a()}}var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(e.host.config.enableEnsureEntityWithTemp||e.host.config.enableEnsureEntityFindMissing){if(o=b["default"].defaults(o,{onLoad:a,onExists:a,onMissing:a,onlyPlaceholder:!1}),!o.finder)throw new Error("finder is missing in ensureEntityOrCreateTemporaryAndFind call");var i=e.store.models[t],s=i.__addEnsureEntityOrCreateTemporaryAndFind__config,u=n[i.idAttribute],c=e.store.get(t,u);if(s.before(n,c,o),c)s.after(c,o),c.$temporary?o.onlyPlaceholder||r():o.onExists(c);else{if(o.onMissing(),c=e.store.inject(t,n),Object.defineProperty(c,"$temporary",{value:!0,configurable:!0}),o.onlyPlaceholder)return c;r()}return c}}),t.__addEnsureEntityOrCreateTemporaryAndFind__config={before:r||a,after:o||a},t.ensureEntityOrCreateTemporaryAndFind=function(n,r){return e.ensureEntityOrCreateTemporaryAndFind(t.name,n,r)}}function i(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p["default"])(e);if(!Array.isArray(e)){var a=(0,d["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var o="  ".repeat(t-1),s=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,c["default"])(n))+": "+i(e[n],t)+";"}).join("\n  "+o);return a.length>=r&&(s+="\n  "+o+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+o+s+"\n"+o+"}":"{\n  "+o+s+"\n"+o+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=i(e[0],t);return e.every(function(e){return i(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return i(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,p["default"])(u))?u.v:void 0}function s(e,t){var n=4,r=15;if(void 0===t&&(t=0),t+=1,null===e)return"null";if(void 0===e)return"void";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return"undefined"==typeof e?"undefined":(0,p["default"])(e);if(!Array.isArray(e)){var a=(0,d["default"])(e);if(!a.length)return e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"Object";if(t>n)return"{...}";var o="  ".repeat(t-1),i=a.slice(0,r).map(function(n){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(n)?n:(0,c["default"])(n))+": "+s(e[n],t)+";"}).join("\n  "+o);return a.length>=r&&(i+="\n  "+o+"..."),e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}if(!(e.length>0))return"Array";var u=function(){if(t>n)return{v:"[...]"};var a=s(e[0],t);return e.every(function(e){return s(e,t)===a})?{v:a.trim()+"[]"}:{v:"["+e.slice(0,r).map(function(e){return s(e,t)}).join(", ")+(e.length>=r?", ...":"")+"]"}}();return"object"===("undefined"==typeof u?"undefined":(0,p["default"])(u))?u.v:void 0}Object.defineProperty(t,"__esModule",{value:!0});var u=n(7),c=r(u),f=n(8),d=r(f),l=n(9),p=r(l),h=n(12),y=r(h),g=n(13),v=r(g);t["default"]=o;var m=n(31),b=r(m),w={},E=function(e){return e.$entityType+":"+e.id};e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){function n(n){var r;e.ensureEntityOrCreateTemporaryAndFind("user",{id:n,displayName:"Loading..."},{onlyPlaceholder:!0,finder:(r=t.host.users).find.bind(r)})}function r(e){e.memberIds&&e.memberIds.forEach(n)}function a(e){e&&e.forEach(n)}var s=e.defineModel("group",{replaceKeys:{organizationKey:"organizationId",members:"memberIds",avatar:"avatarUrl",displayName:"name",numMembers:"memberCount",createdTime:"createdAt"},defaultValues:{memberIds:[],memberCount:0,groupType:i.GroupType.GROUP},validate:function(){u["default"].notEmpty("groupType",this.groupType)},__extractGroupTypeFromAttrs:function(e){return"tigertext:entity:list"==(e.type||e.xmlns)?i.GroupType.DISTRIBUTION_LIST:e.isPublic?i.GroupType.ROOM:null},parseAttrs:function(e){var t=this.__extractGroupTypeFromAttrs(e);return t&&(e.groupType=t),e},beforeCreateInstance:function(e){a(e.memberIds)},afterInject:function(e){e.memberIds&&e.memberIds.length>0&&!e.memberCount&&(e.memberCount=e.memberIds.length)},computed:{metadata:{enumerable:!0,get:function(){var t=e.store.get("metadata",this.id+":"+this.organizationId);return t?t.data:null}},members:{enumerable:!0,get:function(){return this.memberIds.map(function(t){return e.store.get("user",t)})}},conversation:{enumerable:!0,get:function(){return t.host.conversations.get("group",this.id,this.organizationId)}},displayName:{configurable:!0,enumerable:!0,get:function(){return this.name}}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}});return(0,o["default"])(e,s,{before:function(e,t,n){t&&r(t)},after:function(e,t){r(e)}}),s};var a=n(82),o=r(a),i=n(56),s=n(64),u=r(s);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){var n=e.defineModel("organization",{instanceEvents:!0,replaceKeys:{members:"memberCount"},fields:{},transientAttrs:["conversations","unreadCount"],defaultValues:{conversations:[]}});return(0,i["default"])(e,n,{before:function(e,t,n){},after:function(e,t){}}),n};var a=n(31),o=(r(a),n(82)),i=r(o);e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){var t=e.defineModel("message",{replaceKeys:{messageId:"id",clientId:"id",senderToken:"senderId",sender:"senderId",recipientToken:"recipientId",recipient:"recipientId",senderOrganization:"senderOrganizationId",recipientOrganization:"recipientOrganizationId",groupToken:"groupId",status:"recipientStatus",createdTime:"createdAt"},defaultValues:{recipientStatus:r.MessageRecipientStatus.NEW,senderStatus:r.MessageRecipientStatus.NEW,sortNumber:0},fields:{id:{type:"string"},senderStatus:{type:"enum","enum":r.MessageSenderStatus,require:!0},recipientStatus:{type:"enum","enum":r.MessageRecipientStatus,require:!0},direction:{type:"enum","enum":r.MessageDirection,require:!0},counterPartyId:{type:"string",require:!0},counterPartyType:{type:"enum",values:["user","group"],require:!0},createdAt:{type:Date,require:!0}},parseAttrs:function(e){return e.recipientStatus&&(e.recipientStatus=r.MessageRecipientStatus.resolve(e.recipientStatus)),e},relations:{belongsTo:{sender:{type:"user",foreignKey:"senderId"},recipient:{type:"user",foreignKey:"recipientId"},senderOrganization:{type:"organization",foreignKey:"senderOrganizationId"},recipientOrganization:{type:"organization",foreignKey:"recipientOrganizationId"},group:{type:"group",foreignKey:"groupId"},conversation:{type:"conversation",foreignKey:"conversationId"}},hasMany:{statusesPerRecipient:{type:"messageStatusPerRecipient",foreignKey:"messageId"}}},computed:{counterParty:{enumerable:!0,get:function(){return this.counterPartyType&&this.counterPartyId?e.store.get(this.counterPartyType,this.counterPartyId):null},set:function(e){if(e){switch(e.$entityType){case"user":this.recipientId=e.id;break;case"group":this.groupId=e.id;break;default:throw new Error("unsupported counterPartyType '"+e.$entityType+"'")}this.counterPartyId=e.id,this.counterPartyType=e.$entityType}else this.counterPartyId=null,this.counterPartyType=null}}}});return t};var r=n(56);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){var t=e.defineModel("messageStatusPerRecipient",{replaceKeys:{accountId:"userId",timestamp:"createdAt"},defaultValues:{status:o["default"].NEW},fields:{userId:{type:String,require:!0},messageId:{type:String,require:!0},recipientStatus:{type:"enum","enum":o["default"],require:!0},createdAt:{type:Date,require:!0}},parseAttrs:function(e){return e.status&&(e.status=o["default"].resolve(e.status)),e},relations:{belongsTo:{message:{type:"message",foreignKey:"messageId"},user:{type:"user",foreignKey:"userId"}}}});return t};var a=n(57),o=r(a);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(10),o=r(a),i=n(49),s=r(i),u=n(14),c=r(u),f=n(15),d=r(f);t["default"]=function(){return function(){function e(t,n,r,a){var i=this;(0,c["default"])(this,e),this.id=t,this.type=n,this.data=r,a&&!function(){var e=a._origData,t=(0,s["default"])(a,["_origData"]);Object.defineProperty(i,"_origData",{get:function(){return e}}),(0,o["default"])(i,t)}()}return(0,d["default"])(e,null,[{key:"is",value:function(e){return e instanceof this}}]),e}()},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){var t=e.defineModel("conversation",{instanceEvents:!0,transientAttrs:["messages","lastMessage","unreadCount","unreadMessages","lastEventMessageSortNumber","_counterPartyAddedOnServer"],defaultValues:{lastEventMessageSortNumber:0,messages:[],unreadMessages:[],unreadCount:0},computed:{counterParty:{enumerable:!0,get:function(){return this.counterPartyType&&this.counterPartyId?e.store.get(this.counterPartyType,this.counterPartyId):null},set:function(e){if(e)switch(console.log("set newCounterParty",e),e.$entityType){case"user":case"group":this.counterPartyId=e.id,this.counterPartyType=e.$entityType;break;default:throw new Error("unsupported counterPartyType '"+e.$entityType+"'")}else this.counterPartyId=null,this.counterPartyType=null}}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}});return t};var a=n(31),o=(r(a),n(57));r(o),e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(14),o=r(a),i=n(15),s=r(i);t["default"]=function(){return function(){function e(t,n){(0,o["default"])(this,e),this.id="searchResult:"+n+":"+t.id,this.entityType=t.$entityType,this.entityId=t.id,this.entity=t,this.organizationId=n}return(0,s["default"])(e,null,[{key:"is",value:function(e){return e instanceof this}}]),e}()},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){var n=e.defineModel("metadata",{fields:{entityType:{type:"string",required:!0},entityId:{type:"string",required:!0},organizationId:{type:"string",required:!0}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}},parseAttrs:function(e,t){return e.data=t.data,e}});return n},e.exports=t["default"]},function(e,t){e.exports=require("invariant")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(10),o=r(a),i=n(8),s=r(i);t["default"]=function(e){function t(t,n){return e.includes(t,n)||t.push(n),t}e.__tigerconnectJsUtilsEnhanced||(e.__tigerconnectJsUtilsEnhanced=!0,e.mixin({arrayWrap:function(e){return Array.isArray(e)?e:void 0!=e&&null!=e?[e]:[]},eachWithObject:function(t,n,r){return Array.isArray(t)?t.forEach(function(e,a){return n(e,r,a,t)}):e.each(t,function(e,a,o){return n(e,a,r,o,t)}),r},contain:function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),a=1;n>a;a++)r[a-1]=arguments[a];return r.forEach(function(n){return t(e,n)}),e},count:function(t){var n=arguments.length<=1||void 0===arguments[1]?e.identity:arguments[1];return t.reduce(function(e,t){return e+(n(t)?1:0)},0)},replaceKey:function(e,t,n){!(n in e)&&t in e&&(e[n]=e[t],delete e[t])},replaceObject:function(t,n){var r=(0,s["default"])(t),a=(0,s["default"])(n),i=e.difference(r,a);(0,o["default"])(t,n),i.forEach(function(e){return delete t[e]})}}))},e.exports=t["default"]}]);